!function e(t,n,o){function r(a,l){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!l&&s)return s(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[a]={exports:{}};t[a][0].call(d.exports,function(e){var n=t[a][1][e];return r(n?n:e)},d,d.exports,e,t,n,o)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<o.length;a++)r(o[a]);return r}({1:[function(e,t,n){"use strict";function o(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function r(e){return 3*e.length/4-o(e)}function i(e){var t,n,r,i,a,l,s=e.length;a=o(e),l=new u(3*s/4-a),r=a>0?s-4:s;var c=0;for(t=0,n=0;t<r;t+=4,n+=3)i=d[e.charCodeAt(t)]<<18|d[e.charCodeAt(t+1)]<<12|d[e.charCodeAt(t+2)]<<6|d[e.charCodeAt(t+3)],l[c++]=i>>16&255,l[c++]=i>>8&255,l[c++]=255&i;return 2===a?(i=d[e.charCodeAt(t)]<<2|d[e.charCodeAt(t+1)]>>4,l[c++]=255&i):1===a&&(i=d[e.charCodeAt(t)]<<10|d[e.charCodeAt(t+1)]<<4|d[e.charCodeAt(t+2)]>>2,l[c++]=i>>8&255,l[c++]=255&i),l}function a(e){return c[e>>18&63]+c[e>>12&63]+c[e>>6&63]+c[63&e]}function l(e,t,n){for(var o,r=[],i=t;i<n;i+=3)o=(e[i]<<16)+(e[i+1]<<8)+e[i+2],r.push(a(o));return r.join("")}function s(e){for(var t,n=e.length,o=n%3,r="",i=[],a=16383,s=0,d=n-o;s<d;s+=a)i.push(l(e,s,s+a>d?d:s+a));return 1===o?(t=e[n-1],r+=c[t>>2],r+=c[t<<4&63],r+="=="):2===o&&(t=(e[n-2]<<8)+e[n-1],r+=c[t>>10],r+=c[t>>4&63],r+=c[t<<2&63],r+="="),i.push(r),i.join("")}n.byteLength=r,n.toByteArray=i,n.fromByteArray=s;for(var c=[],d=[],u="undefined"!=typeof Uint8Array?Uint8Array:Array,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",m=0,g=f.length;m<g;++m)c[m]=f[m],d[f.charCodeAt(m)]=m;d["-".charCodeAt(0)]=62,d["_".charCodeAt(0)]=63},{}],2:[function(e,t,n){(function(t){"use strict";function o(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}function r(){return a.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function i(e,t){if(r()<t)throw new RangeError("Invalid typed array length");return a.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t),e.__proto__=a.prototype):(null===e&&(e=new a(t)),e.length=t),e}function a(e,t,n){if(!(a.TYPED_ARRAY_SUPPORT||this instanceof a))return new a(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return d(this,e)}return l(this,e,t,n)}function l(e,t,n,o){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?m(e,t,n,o):"string"==typeof t?u(e,t,n):g(e,t)}function s(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function c(e,t,n,o){return s(t),t<=0?i(e,t):void 0!==n?"string"==typeof o?i(e,t).fill(n,o):i(e,t).fill(n):i(e,t)}function d(e,t){if(s(t),e=i(e,t<0?0:0|p(t)),!a.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function u(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!a.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var o=0|E(t,n);e=i(e,o);var r=e.write(t,n);return r!==o&&(e=e.slice(0,r)),e}function f(e,t){var n=t.length<0?0:0|p(t.length);e=i(e,n);for(var o=0;o<n;o+=1)e[o]=255&t[o];return e}function m(e,t,n,o){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(o||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===o?new Uint8Array(t):void 0===o?new Uint8Array(t,n):new Uint8Array(t,n,o),a.TYPED_ARRAY_SUPPORT?(e=t,e.__proto__=a.prototype):e=f(e,t),e}function g(e,t){if(a.isBuffer(t)){var n=0|p(t.length);return e=i(e,n),0===e.length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||X(t.length)?i(e,0):f(e,t);if("Buffer"===t.type&&$(t.data))return f(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function p(e){if(e>=r())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r().toString(16)+" bytes");return 0|e}function h(e){return+e!=e&&(e=0),a.alloc(+e)}function E(e,t){if(a.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var o=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return W(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return Z(e).length;default:if(o)return W(e).length;t=(""+t).toLowerCase(),o=!0}}function C(e,t,n){var o=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if(n>>>=0,t>>>=0,n<=t)return"";for(e||(e="utf8");;)switch(e){case"hex":return I(this,t,n);case"utf8":case"utf-8":return x(this,t,n);case"ascii":return R(this,t,n);case"latin1":case"binary":return w(this,t,n);case"base64":return D(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,t,n);default:if(o)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function T(e,t,n){var o=e[t];e[t]=e[n],e[n]=o}function b(e,t,n,o,r){if(0===e.length)return-1;if("string"==typeof n?(o=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=a.from(t,o)),a.isBuffer(t))return 0===t.length?-1:v(e,t,n,o,r);if("number"==typeof t)return t=255&t,a.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):v(e,[t],n,o,r);throw new TypeError("val must be string, number or Buffer")}function v(e,t,n,o,r){function i(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}var a=1,l=e.length,s=t.length;if(void 0!==o&&(o=String(o).toLowerCase(),"ucs2"===o||"ucs-2"===o||"utf16le"===o||"utf-16le"===o)){if(e.length<2||t.length<2)return-1;a=2,l/=2,s/=2,n/=2}var c;if(r){var d=-1;for(c=n;c<l;c++)if(i(e,c)===i(t,d===-1?0:c-d)){if(d===-1&&(d=c),c-d+1===s)return d*a}else d!==-1&&(c-=c-d),d=-1}else for(n+s>l&&(n=l-s),c=n;c>=0;c--){for(var u=!0,f=0;f<s;f++)if(i(e,c+f)!==i(t,f)){u=!1;break}if(u)return c}return-1}function y(e,t,n,o){n=Number(n)||0;var r=e.length-n;o?(o=Number(o),o>r&&(o=r)):o=r;var i=t.length;if(i%2!==0)throw new TypeError("Invalid hex string");o>i/2&&(o=i/2);for(var a=0;a<o;++a){var l=parseInt(t.substr(2*a,2),16);if(isNaN(l))return a;e[n+a]=l}return a}function S(e,t,n,o){return q(W(t,e.length-n),e,n,o)}function A(e,t,n,o){return q(K(t),e,n,o)}function N(e,t,n,o){return A(e,t,n,o)}function O(e,t,n,o){return q(Z(t),e,n,o)}function _(e,t,n,o){return q(j(t,e.length-n),e,n,o)}function D(e,t,n){return 0===t&&n===e.length?J.fromByteArray(e):J.fromByteArray(e.slice(t,n))}function x(e,t,n){n=Math.min(e.length,n);for(var o=[],r=t;r<n;){var i=e[r],a=null,l=i>239?4:i>223?3:i>191?2:1;if(r+l<=n){var s,c,d,u;switch(l){case 1:i<128&&(a=i);break;case 2:s=e[r+1],128===(192&s)&&(u=(31&i)<<6|63&s,u>127&&(a=u));break;case 3:s=e[r+1],c=e[r+2],128===(192&s)&&128===(192&c)&&(u=(15&i)<<12|(63&s)<<6|63&c,u>2047&&(u<55296||u>57343)&&(a=u));break;case 4:s=e[r+1],c=e[r+2],d=e[r+3],128===(192&s)&&128===(192&c)&&128===(192&d)&&(u=(15&i)<<18|(63&s)<<12|(63&c)<<6|63&d,u>65535&&u<1114112&&(a=u))}}null===a?(a=65533,l=1):a>65535&&(a-=65536,o.push(a>>>10&1023|55296),a=56320|1023&a),o.push(a),r+=l}return L(o)}function L(e){var t=e.length;if(t<=ee)return String.fromCharCode.apply(String,e);for(var n="",o=0;o<t;)n+=String.fromCharCode.apply(String,e.slice(o,o+=ee));return n}function R(e,t,n){var o="";n=Math.min(e.length,n);for(var r=t;r<n;++r)o+=String.fromCharCode(127&e[r]);return o}function w(e,t,n){var o="";n=Math.min(e.length,n);for(var r=t;r<n;++r)o+=String.fromCharCode(e[r]);return o}function I(e,t,n){var o=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>o)&&(n=o);for(var r="",i=t;i<n;++i)r+=G(e[i]);return r}function M(e,t,n){for(var o=e.slice(t,n),r="",i=0;i<o.length;i+=2)r+=String.fromCharCode(o[i]+256*o[i+1]);return r}function k(e,t,n){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function P(e,t,n,o,r,i){if(!a.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<i)throw new RangeError('"value" argument is out of bounds');if(n+o>e.length)throw new RangeError("Index out of range")}function B(e,t,n,o){t<0&&(t=65535+t+1);for(var r=0,i=Math.min(e.length-n,2);r<i;++r)e[n+r]=(t&255<<8*(o?r:1-r))>>>8*(o?r:1-r)}function U(e,t,n,o){t<0&&(t=4294967295+t+1);for(var r=0,i=Math.min(e.length-n,4);r<i;++r)e[n+r]=t>>>8*(o?r:3-r)&255}function z(e,t,n,o,r,i){if(n+o>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function F(e,t,n,o,r){return r||z(e,t,n,4,3.4028234663852886e38,-3.4028234663852886e38),Q.write(e,t,n,o,23,4),n+4}function H(e,t,n,o,r){return r||z(e,t,n,8,1.7976931348623157e308,-1.7976931348623157e308),Q.write(e,t,n,o,52,8),n+8}function Y(e){if(e=V(e).replace(te,""),e.length<2)return"";for(;e.length%4!==0;)e+="=";return e}function V(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function G(e){return e<16?"0"+e.toString(16):e.toString(16)}function W(e,t){t=t||1/0;for(var n,o=e.length,r=null,i=[],a=0;a<o;++a){if(n=e.charCodeAt(a),n>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(a+1===o){(t-=3)>-1&&i.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),r=n;continue}n=(r-55296<<10|n-56320)+65536}else r&&(t-=3)>-1&&i.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function K(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function j(e,t){for(var n,o,r,i=[],a=0;a<e.length&&!((t-=2)<0);++a)n=e.charCodeAt(a),o=n>>8,r=n%256,i.push(r),i.push(o);return i}function Z(e){return J.toByteArray(Y(e))}function q(e,t,n,o){for(var r=0;r<o&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}function X(e){return e!==e}var J=e("base64-js"),Q=e("ieee754"),$=e("isarray");n.Buffer=a,n.SlowBuffer=h,n.INSPECT_MAX_BYTES=50,a.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:o(),n.kMaxLength=r(),a.poolSize=8192,a._augment=function(e){return e.__proto__=a.prototype,e},a.from=function(e,t,n){return l(null,e,t,n)},a.TYPED_ARRAY_SUPPORT&&(a.prototype.__proto__=Uint8Array.prototype,a.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&a[Symbol.species]===a&&Object.defineProperty(a,Symbol.species,{value:null,configurable:!0})),a.alloc=function(e,t,n){return c(null,e,t,n)},a.allocUnsafe=function(e){return d(null,e)},a.allocUnsafeSlow=function(e){return d(null,e)},a.isBuffer=function(e){return!(null==e||!e._isBuffer)},a.compare=function(e,t){if(!a.isBuffer(e)||!a.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,o=t.length,r=0,i=Math.min(n,o);r<i;++r)if(e[r]!==t[r]){n=e[r],o=t[r];break}return n<o?-1:o<n?1:0},a.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(e,t){if(!$(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return a.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var o=a.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var i=e[n];if(!a.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(o,r),r+=i.length}return o},a.byteLength=E,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)T(this,t,t+1);return this},a.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)T(this,t,t+3),T(this,t+1,t+2);return this},a.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)T(this,t,t+7),T(this,t+1,t+6),T(this,t+2,t+5),T(this,t+3,t+4);return this},a.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?x(this,0,e):C.apply(this,arguments)},a.prototype.equals=function(e){if(!a.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===a.compare(this,e)},a.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},a.prototype.compare=function(e,t,n,o,r){if(!a.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===o&&(o=0),void 0===r&&(r=this.length),t<0||n>e.length||o<0||r>this.length)throw new RangeError("out of range index");if(o>=r&&t>=n)return 0;if(o>=r)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,o>>>=0,r>>>=0,this===e)return 0;for(var i=r-o,l=n-t,s=Math.min(i,l),c=this.slice(o,r),d=e.slice(t,n),u=0;u<s;++u)if(c[u]!==d[u]){i=c[u],l=d[u];break}return i<l?-1:l<i?1:0},a.prototype.includes=function(e,t,n){return this.indexOf(e,t,n)!==-1},a.prototype.indexOf=function(e,t,n){return b(this,e,t,n,!0)},a.prototype.lastIndexOf=function(e,t,n){return b(this,e,t,n,!1)},a.prototype.write=function(e,t,n,o){if(void 0===t)o="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)o=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t=0|t,isFinite(n)?(n=0|n,void 0===o&&(o="utf8")):(o=n,n=void 0)}var r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");o||(o="utf8");for(var i=!1;;)switch(o){case"hex":return y(this,e,t,n);case"utf8":case"utf-8":return S(this,e,t,n);case"ascii":return A(this,e,t,n);case"latin1":case"binary":return N(this,e,t,n);case"base64":return O(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _(this,e,t,n);default:if(i)throw new TypeError("Unknown encoding: "+o);o=(""+o).toLowerCase(),i=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var ee=4096;a.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),t<e&&(t=e);var o;if(a.TYPED_ARRAY_SUPPORT)o=this.subarray(e,t),o.__proto__=a.prototype;else{var r=t-e;o=new a(r,(void 0));for(var i=0;i<r;++i)o[i]=this[i+e]}return o},a.prototype.readUIntLE=function(e,t,n){e=0|e,t=0|t,n||k(e,t,this.length);for(var o=this[e],r=1,i=0;++i<t&&(r*=256);)o+=this[e+i]*r;return o},a.prototype.readUIntBE=function(e,t,n){e=0|e,t=0|t,n||k(e,t,this.length);for(var o=this[e+--t],r=1;t>0&&(r*=256);)o+=this[e+--t]*r;return o},a.prototype.readUInt8=function(e,t){return t||k(e,1,this.length),this[e]},a.prototype.readUInt16LE=function(e,t){return t||k(e,2,this.length),this[e]|this[e+1]<<8},a.prototype.readUInt16BE=function(e,t){return t||k(e,2,this.length),this[e]<<8|this[e+1]},a.prototype.readUInt32LE=function(e,t){return t||k(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},a.prototype.readUInt32BE=function(e,t){return t||k(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},a.prototype.readIntLE=function(e,t,n){e=0|e,t=0|t,n||k(e,t,this.length);for(var o=this[e],r=1,i=0;++i<t&&(r*=256);)o+=this[e+i]*r;return r*=128,o>=r&&(o-=Math.pow(2,8*t)),o},a.prototype.readIntBE=function(e,t,n){e=0|e,t=0|t,n||k(e,t,this.length);for(var o=t,r=1,i=this[e+--o];o>0&&(r*=256);)i+=this[e+--o]*r;return r*=128,i>=r&&(i-=Math.pow(2,8*t)),i},a.prototype.readInt8=function(e,t){return t||k(e,1,this.length),128&this[e]?(255-this[e]+1)*-1:this[e]},a.prototype.readInt16LE=function(e,t){t||k(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt16BE=function(e,t){t||k(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt32LE=function(e,t){return t||k(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},a.prototype.readInt32BE=function(e,t){return t||k(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},a.prototype.readFloatLE=function(e,t){return t||k(e,4,this.length),Q.read(this,e,!0,23,4)},a.prototype.readFloatBE=function(e,t){return t||k(e,4,this.length),Q.read(this,e,!1,23,4)},a.prototype.readDoubleLE=function(e,t){return t||k(e,8,this.length),Q.read(this,e,!0,52,8)},a.prototype.readDoubleBE=function(e,t){return t||k(e,8,this.length),Q.read(this,e,!1,52,8)},a.prototype.writeUIntLE=function(e,t,n,o){if(e=+e,t=0|t,n=0|n,!o){var r=Math.pow(2,8*n)-1;P(this,e,t,n,r,0)}var i=1,a=0;for(this[t]=255&e;++a<n&&(i*=256);)this[t+a]=e/i&255;return t+n},a.prototype.writeUIntBE=function(e,t,n,o){if(e=+e,t=0|t,n=0|n,!o){var r=Math.pow(2,8*n)-1;P(this,e,t,n,r,0)}var i=n-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+n},a.prototype.writeUInt8=function(e,t,n){return e=+e,t=0|t,n||P(this,e,t,1,255,0),a.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},a.prototype.writeUInt16LE=function(e,t,n){return e=+e,t=0|t,n||P(this,e,t,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):B(this,e,t,!0),t+2},a.prototype.writeUInt16BE=function(e,t,n){return e=+e,t=0|t,n||P(this,e,t,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):B(this,e,t,!1),t+2},a.prototype.writeUInt32LE=function(e,t,n){return e=+e,t=0|t,n||P(this,e,t,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):U(this,e,t,!0),t+4},a.prototype.writeUInt32BE=function(e,t,n){return e=+e,t=0|t,n||P(this,e,t,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):U(this,e,t,!1),t+4},a.prototype.writeIntLE=function(e,t,n,o){if(e=+e,t=0|t,!o){var r=Math.pow(2,8*n-1);P(this,e,t,n,r-1,-r)}var i=0,a=1,l=0;for(this[t]=255&e;++i<n&&(a*=256);)e<0&&0===l&&0!==this[t+i-1]&&(l=1),this[t+i]=(e/a>>0)-l&255;return t+n},a.prototype.writeIntBE=function(e,t,n,o){if(e=+e,t=0|t,!o){var r=Math.pow(2,8*n-1);P(this,e,t,n,r-1,-r)}var i=n-1,a=1,l=0;for(this[t+i]=255&e;--i>=0&&(a*=256);)e<0&&0===l&&0!==this[t+i+1]&&(l=1),this[t+i]=(e/a>>0)-l&255;return t+n},a.prototype.writeInt8=function(e,t,n){return e=+e,t=0|t,n||P(this,e,t,1,127,-128),a.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},a.prototype.writeInt16LE=function(e,t,n){return e=+e,t=0|t,n||P(this,e,t,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):B(this,e,t,!0),t+2},a.prototype.writeInt16BE=function(e,t,n){return e=+e,t=0|t,n||P(this,e,t,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):B(this,e,t,!1),t+2},a.prototype.writeInt32LE=function(e,t,n){return e=+e,t=0|t,n||P(this,e,t,4,2147483647,-2147483648),a.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):U(this,e,t,!0),t+4},a.prototype.writeInt32BE=function(e,t,n){return e=+e,t=0|t,n||P(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):U(this,e,t,!1),t+4},a.prototype.writeFloatLE=function(e,t,n){return F(this,e,t,!0,n)},a.prototype.writeFloatBE=function(e,t,n){return F(this,e,t,!1,n)},a.prototype.writeDoubleLE=function(e,t,n){return H(this,e,t,!0,n)},a.prototype.writeDoubleBE=function(e,t,n){return H(this,e,t,!1,n)},a.prototype.copy=function(e,t,n,o){if(n||(n=0),o||0===o||(o=this.length),t>=e.length&&(t=e.length),t||(t=0),o>0&&o<n&&(o=n),o===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(o<0)throw new RangeError("sourceEnd out of bounds");o>this.length&&(o=this.length),e.length-t<o-n&&(o=e.length-t+n);var r,i=o-n;if(this===e&&n<t&&t<o)for(r=i-1;r>=0;--r)e[r+t]=this[r+n];else if(i<1e3||!a.TYPED_ARRAY_SUPPORT)for(r=0;r<i;++r)e[r+t]=this[r+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+i),t);return i},a.prototype.fill=function(e,t,n,o){if("string"==typeof e){if("string"==typeof t?(o=t,t=0,n=this.length):"string"==typeof n&&(o=n,n=this.length),1===e.length){var r=e.charCodeAt(0);r<256&&(e=r)}if(void 0!==o&&"string"!=typeof o)throw new TypeError("encoding must be a string");if("string"==typeof o&&!a.isEncoding(o))throw new TypeError("Unknown encoding: "+o)}else"number"==typeof e&&(e=255&e);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0);var i;if("number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var l=a.isBuffer(e)?e:W(new a(e,o).toString()),s=l.length;for(i=0;i<n-t;++i)this[i+t]=l[i%s]}return this};var te=/[^+\/0-9A-Za-z-_]/g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":1,ieee754:3,isarray:4}],3:[function(e,t,n){n.read=function(e,t,n,o,r){var i,a,l=8*r-o-1,s=(1<<l)-1,c=s>>1,d=-7,u=n?r-1:0,f=n?-1:1,m=e[t+u];for(u+=f,i=m&(1<<-d)-1,m>>=-d,d+=l;d>0;i=256*i+e[t+u],u+=f,d-=8);for(a=i&(1<<-d)-1,i>>=-d,d+=o;d>0;a=256*a+e[t+u],u+=f,d-=8);if(0===i)i=1-c;else{if(i===s)return a?NaN:(m?-1:1)*(1/0);a+=Math.pow(2,o),i-=c}return(m?-1:1)*a*Math.pow(2,i-o)},n.write=function(e,t,n,o,r,i){var a,l,s,c=8*i-r-1,d=(1<<c)-1,u=d>>1,f=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,m=o?0:i-1,g=o?1:-1,p=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(l=isNaN(t)?1:0,a=d):(a=Math.floor(Math.log(t)/Math.LN2),t*(s=Math.pow(2,-a))<1&&(a--,s*=2),t+=a+u>=1?f/s:f*Math.pow(2,1-u),t*s>=2&&(a++,s/=2),a+u>=d?(l=0,a=d):a+u>=1?(l=(t*s-1)*Math.pow(2,r),a+=u):(l=t*Math.pow(2,u-1)*Math.pow(2,r),a=0));r>=8;e[n+m]=255&l,m+=g,l/=256,r-=8);for(a=a<<r|l,c+=r;c>0;e[n+m]=255&a,m+=g,a/=256,c-=8);e[n+m-g]|=128*p}},{}],4:[function(e,t,n){var o={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==o.call(e)}},{}],5:[function(e,t,n){"use strict";function o(){function e(e,t){if(!e)return!1;var n=m.getLastDeepChild(e),o=m.getParentByFilter(n,function(e){return e===t},!0);return!!o}var t,n,o,i,a=!1;return t=g.getRange(),n=r.doc.queryCommandValue("formatBlock"),/^h[1-6]+$/i.test(n)&&t&&t.startOffset===m.getEndOffset(t.startContainer)&&(o=m.getParentByTagName(t.startContainer,n,!0),a=e(o,t.startContainer)),!(!a||!o)&&(i=r.doc.createElement("div"),i.appendChild(r.doc.createElement("br")),m.after(i,o),g.setRange(i,0),!0)}var r=e("../common/env"),i=e("../common/const"),a=e("../common/lang"),l=e("../common/utils"),s=e("../common/historyUtils"),c=(a.getLang(),e("./amendUtils/amendExtend")),d=e("./amendUser"),u=e("./amendInfo"),f=e("../blockUtils/blockUtils"),m=e("../domUtils/domExtend"),g=e("../rangeUtils/rangeExtend"),p=e("../codeUtils/codeCore"),h=e("../tableUtils/tableCore"),E=e("../tableUtils/tableUtils"),C=e("../todoUtils/todoCore");!function(){var e=m.modifyNodeStyle;m.modifyNodeStyle=function(t,n,o,r){var a;return 1==t.nodeType&&o&&o[i.ATTR.SPAN_DELETE]&&m.isTag(t,"img")?(c.deleteImg(t,d.getCurUser()),t):1==t.nodeType&&o&&o[i.ATTR.SPAN_DELETE]&&m.isEmptyDom(t)?(a=t.parentNode,a.removeChild(t),m.removeEmptyParent(a),t):1==t.nodeType&&o&&o[i.ATTR.SPAN_DELETE]&&m.isSelfClosingTag(t)?t:o&&o[i.ATTR.SPAN_DELETE]&&c.getWizDeleteParent(t)?t:e(t,n,o,r)};var t=m.addDomForGetDomList;m.addDomForGetDomList=function(e,n){c.isWizDelete(n)||3==n.nodeType&&!m.getParentByTagName(n,["td","th"],!1,null)&&m.getParentByTagName(n,"table",!1,null)||t(e,n)}}();var T=!1,b={initUser:function(){d.initUser(r.options.userInfo)},setUsersData:function(){d.setUsersData(r.options.usersData)},start:function(){T=!0,b.stopReverse(),v.bind(),b.startAmendInfo(),r.event.add(i.EVENT.BEFORE_SAVESNAP,v.onBeforeSaveSnap),r.event.add(i.EVENT.AFTER_RESTORE_HISTORY,v.onAfterRestoreHistory)},stop:function(){T=!1,v.unbind(),u.remove(),!b.isAmendEdited(),r.event.remove(i.EVENT.BEFORE_SAVESNAP,v.onBeforeSaveSnap),r.event.remove(i.EVENT.AFTER_RESTORE_HISTORY,v.onAfterRestoreHistory)},startReverse:function(){b.stop(),v.bindReverse(),b.startAmendInfo()},stopReverse:function(){v.unbindReverse(),u.remove(),!b.isAmendEdited()},startAmendInfo:function(e){u.init(e,{onAccept:v.onAccept,onRefuse:v.onRefuse})},stopAmendInfo:function(){u.remove()},hideAmendInfo:function(){u.hide(!0)},isAmendEdited:function(){return c.isAmendEdited()},isAmendEditing:function(){return T},hasAmendSpanByCursor:function(){var e=c.getAmendDoms({selection:!0,selectAll:!1});return e.insertList.length>0||e.deleteList.length>0||e.deletedInsertList.length>0},accept:function(e){var t,n=r.doc.getSelection(),o={};if(e.total)o.selection=!0,o.selectAll=!0;else if(e.dom&&!e.isSelection)o.domList=c.getSameTimeStampDom(e.dom),o.selection=!1;else{if(0===n.rangeCount)return;o.selection=!0,o.selectAll=!1}s.saveSnap(!1),t=o.selection&&!o.selectAll?c.getSelectedAmendDoms():c.getAmendDoms(o),t&&(c.splitSelectedAmendDoms(t),c.wizAmendDelete(t.deleteList),c.wizAmendDelete(t.deletedInsertList),c.wizAmendSave(t.insertList)),m.clearChild(r.doc.body,[])},refuse:function(e){var t,n=r.doc.getSelection(),o={};if(e.total)o.selection=!0,o.selectAll=!0;else if(e.dom&&!e.isSelection)o.domList=c.getSameTimeStampDom(e.dom),o.selection=!1;else{if(0===n.rangeCount)return;o.selection=!0,o.selectAll=!1}if(s.saveSnap(!1),t=o.selection&&!o.selectAll?c.getSelectedAmendDoms():c.getAmendDoms(o)){c.splitSelectedAmendDoms(t);var i=t.deletedInsertList.length>0&&0==t.deleteList.length&&0==t.insertList.length;c.wizAmendSave(t.deleteList),i&&c.wizAmendSave(t.deletedInsertList),c.wizAmendDelete(t.insertList),i||c.wizAmendDelete(t.deletedInsertList)}m.clearChild(r.doc.body,[])},splitAmendDomByRange:function(e){return c.splitAmendDomByRange(e)},fragmentFilter:function(e){var t,n,o;if(!e)return!1;for(t=e.querySelectorAll("span["+i.ATTR.SPAN_DELETE+'="'+d.getCurUser().hash+'"]'),n=t.length-1;n>=0;n--)o=t[n],m.remove(o)},readyForPaste:function(){var e,t,n,o,a,l,s,u,f,p,h,E,C,T,v,y,S=r.doc.getSelection();0!==S.rangeCount&&(S.isCollapsed||(e=S.getRangeAt(0),t=m.getParentByTagName(e.endContainer,["td","th"],!0,null),c.removeSelection(d.getCurUser()),c.removeUserDel(null,d.getCurUser())),e=S.getRangeAt(0),n=e.endContainer,o=e.endOffset,m.isTag(n,["td","th"])&&0===o&&t!==n&&(n=t,o=m.getEndOffset(n)),T=c.splitInsertDom(n,o,!0,d.getCurUser()),a=(new Date).valueOf(),l=c.createDomForPaste(a),s=l.start,u=l.content,f=l.end,v=c.getWizAmendImgParent(n),T.split?(3==n.nodeType&&(n=n.parentNode),m.before([s,u,f],n,o>0)):v?m.after([s,u,f],v):1==n.nodeType?(y=!1,m.isTag(n,["td","th"])&&(m.isEmptyDom(n)&&(n.innerHTML="",n.appendChild(m.createSpan())),y=!0),o<n.childNodes.length?m.before([s,u,f],n.childNodes[o]):y?(n.appendChild(s),n.appendChild(u),n.appendChild(f)):m.after([s,u,f],n)):3==n.nodeType&&(c.splitDeletedDom(n,o)?m.after([s,u,f],n.parentNode):o<n.nodeValue.length?(C=r.doc.createTextNode(n.nodeValue.substr(o)),n.nodeValue=n.nodeValue.substr(0,o),m.after([s,u,f,C],n)):(h=m.getParentByTagName(n,"a",!0,null),p=n.nextSibling,h?m.after([s,u,f],h):p?m.before([s,u,f],p):(E=n.parentNode,E.insertBefore(s,null),E.insertBefore(u,null),E.insertBefore(f,null)))),g.setRange(u.childNodes[0],0,u.childNodes[0],1),setTimeout(function(){f=r.doc.querySelector("span["+i.ATTR.SPAN_PASTE_TYPE+'="'+i.TYPE.PASTE.END+'"]['+i.ATTR.SPAN_PASTE_ID+'="'+f.getAttribute(i.ATTR.SPAN_PASTE_ID)+'"]'),b.fixPaste(s,f,d.getCurUser())},200))},fixPaste:function(e,t,n){c.modifyDomForPaste(e,t,n)}},v={bind:function(){v.unbind(),r.event.add(i.EVENT.ON_KEY_DOWN,v.onKeyDown),r.event.add(i.EVENT.ON_COMPOSITION_START,v.onCompositionStart),r.event.add(i.EVENT.ON_COMPOSITION_END,v.onCompositionEnd),r.client.type.isIOS||r.client.type.isAndroid?r.event.add(i.EVENT.ON_TOUCH_START,v.onTouchStart):(r.event.add(i.EVENT.ON_MOUSE_DOWN,v.onMouseDown),r.event.add(i.EVENT.ON_MOUSE_UP,v.onMouseUp)),r.event.add(i.EVENT.ON_DRAG_START,v.onDragDrop),r.event.add(i.EVENT.ON_DRAG_ENTER,v.onDragDrop),r.event.add(i.EVENT.ON_DROP,v.onDragDrop)},unbind:function(){r.event.remove(i.EVENT.ON_KEY_DOWN,v.onKeyDown),r.event.remove(i.EVENT.ON_COMPOSITION_START,v.onCompositionStart),r.event.remove(i.EVENT.ON_COMPOSITION_END,v.onCompositionEnd),r.event.remove(i.EVENT.ON_MOUSE_DOWN,v.onMouseDown),r.event.remove(i.EVENT.ON_MOUSE_UP,v.onMouseUp),r.event.remove(i.EVENT.ON_TOUCH_START,v.onTouchStart),r.event.remove(i.EVENT.ON_DRAG_START,v.onDragDrop),r.event.remove(i.EVENT.ON_DRAG_ENTER,v.onDragDrop),r.event.remove(i.EVENT.ON_DROP,v.onDragDrop)},bindReverse:function(){v.unbindReverse(),r.event.add(i.EVENT.ON_KEY_DOWN,v.onKeyDown),r.event.add(i.EVENT.ON_COMPOSITION_START,v.onCompositionStart),r.event.add(i.EVENT.ON_COMPOSITION_END,v.onCompositionEnd),r.client.type.isIOS||r.client.type.isAndroid||(r.event.add(i.EVENT.ON_MOUSE_DOWN,v.onMouseDown),r.event.add(i.EVENT.ON_MOUSE_UP,v.onMouseUp))},unbindReverse:function(){r.event.remove(i.EVENT.ON_KEY_DOWN,v.onKeyDown),r.event.remove(i.EVENT.ON_COMPOSITION_START,v.onCompositionStart),r.event.remove(i.EVENT.ON_COMPOSITION_END,v.onCompositionEnd),r.event.remove(i.EVENT.ON_MOUSE_DOWN,v.onMouseDown),r.event.remove(i.EVENT.ON_MOUSE_UP,v.onMouseUp)},onAccept:function(e){b.accept(e)},onRefuse:function(e){b.refuse(e)},onBeforeSaveSnap:function(){u.hide(!0)},onAfterRestoreHistory:function(){b.startAmendInfo()},onCompositionStart:function(){i.COMPOSITION_START=!0},onCompositionEnd:function(){i.COMPOSITION_START=!1,setTimeout(function(){s.saveSnap(!0)},0)},onDragDrop:function(e){return l.stopEvent(e),!1},onKeyDown:function(e){var t=e.keyCode||e.which,n=r.doc.getSelection();8!==t&&46!==t||g.clearFillCharByCollapsed(),p.onKeyDown(e)&&h.onKeyDown(e)&&C.onKeyDown(e)&&(0===n.rangeCount||i.COMPOSITION_START||(b.isAmendEditing()?v.onKeyDownAmend(e):v.onKeyDownReverse(e)))},onKeyDownAmend:function(e){var t,n,a,u,f,p,h,E,C,T,b,v=e.keyCode||e.which,y=r.doc.getSelection();if(8===v)return s.saveSnap(!1),y.isCollapsed?(g.selectCharIncludeFillChar(!0),c.removeSelection(d.getCurUser()),b=g.getRangeParentRoot(),y.collapseToStart(),c.removeUserDel(b,d.getCurUser()),y.collapseToStart()):(c.removeSelection(d.getCurUser()),c.removeUserDel(null,d.getCurUser()),y.collapseToStart()),g.caretFocus(),void l.stopEvent(e);if(46===v)return s.saveSnap(!1),y.isCollapsed&&g.selectCharIncludeFillChar(!1),c.removeSelection(d.getCurUser()),c.removeUserDel(null,d.getCurUser()),y.collapseToEnd(),g.caretFocus(),void l.stopEvent(e);if(!l.checkNonTxtKey(e)){var S,A;if(s.saveSnap(!1),y.isCollapsed||(c.removeSelection(d.getCurUser()),c.removeUserDel(null,d.getCurUser())),t=y.getRangeAt(0),n=t.endContainer,a=t.endOffset,13===v){var N=c.getWizDeleteParent(n),O=c.getWizInsertParent(n),_=!!O&&c.getWizAmendImgParent(n),D=N||O;if(D&&1===D.childNodes.length&&(!m.isUsableTextNode(D.childNodes[0])||1===D.childNodes[0].nodeType&&m.isTag(D.childNodes[0],"br")))!function(){var e=D.parentNode,t=r.doc.createElement("br");e.insertBefore(t,D),e.removeChild(D),g.setRange(t,1,t,1)}();else if(O&&_)!function(){var e=m.createSpan();e.innerHTML=i.FILL_CHAR,m.after(e,O),g.setRange(e,1,e,1);
}();else if(O)!function(){var e=m.createSpan();e.innerHTML=i.FILL_CHAR,S=c.splitInsertDom(n,a,!0,d.getCurUser()),S.isInsert&&S.split?(m.after(e,O),g.setRange(e,1,e,1)):S.isInsert&&(m.before(e,O,a>0),g.setRange(e,1,e,1))}();else if(N)!function(){var e=m.createSpan();e.innerHTML=i.FILL_CHAR,S=c.splitDeletedDom(n,a),S?(m.after(e,N),g.setRange(e,1,e,1)):(m.before(e,N,a>0),g.setRange(e,1,e,1))}();else if(o())return void l.stopEvent(e);return void y.collapseToEnd()}if(S=c.splitInsertDom(n,a,!1,d.getCurUser()),A=c.getWizAmendImgParent(n),S.isInsert&&!S.split&&!A)return 0===a&&1===S.insertDom.nodeType?(m.before(r.doc.createTextNode(i.FILL_CHAR),S.insertDom.childNodes[0]),g.setRange(S.insertDom,1,null,null)):g.setRange(n,a,null,null),t=y.getRangeAt(0),void(9===v&&(t.insertNode(m.getTab()),y.modify("move","forward","character"),y.modify("move","forward","character"),y.modify("move","forward","character"),y.modify("move","forward","character"),l.stopEvent(e)));u=c.createDomForInsert(d.getCurUser()),S.split?(3==n.nodeType&&(n=n.parentNode),m.before(u,n,a>0)):A?m.after(u,A):1==n.nodeType?a<n.childNodes.length?n.getAttribute(i.ATTR.SPAN)&&(0===n.childNodes.length||1===n.childNodes.length&&m.isTag(n.childNodes[0],"br"))?(m.before(u,n),m.remove(n)):m.before(u,n.childNodes[a]):m.isTag(n,["td","th"])||m.hasClass(n,i.CLASS.TODO_MAIN)?(m.isEmptyDom(n)&&(n.innerHTML=""),n.appendChild(u)):m.after(u,n):3==n.nodeType&&(c.splitDeletedDom(n,a)?m.after(u,n.parentNode):a<n.nodeValue.length?(C=n.nodeValue.substr(a),T=r.doc.createTextNode(C),n.nodeValue=n.nodeValue.substr(0,a),m.after([u,T],n)):(p=m.getParentByTagName(n,"a",!0,null),E=p?m.getNextNode(n):null,h=E?m.getParentByTagName(E,"a",!0,null):null,f=n.nextSibling,p&&p!==h?m.after(u,p):f?m.before(u,f):n.parentNode.insertBefore(u,null))),9===v?(u.appendChild(m.getTab()),g.setRange(u,2,null,null),l.stopEvent(e)):g.setRange(u.childNodes[0],1,null,null)}},onKeyDownReverse:function(e){function t(e,t){if(e){var n,o;o=c.getWizAmendParent(e),o&&1===o.childNodes.length&&(n=m.createSpan(),n.innerHTML=i.FILL_CHAR+i.FILL_CHAR,m.before(n,o,t>0),m.remove(o),g.setRange(n,t>0?0:2,n,1))}}var n=e.keyCode||e.which,a=r.doc.getSelection(),d=c.fixedAmendRange();if(8===n)return s.saveSnap(!1),void(a.isCollapsed&&d.leftDom&&(d.startImg=c.getWizAmendImgParent(d.leftDom),d.startImg?(d.startDom=d.startImg,d.startOffset=0,g.setRange(d.startDom,d.startOffset,d.endDom,d.endOffset)):3===d.leftDom.nodeType&&1==d.leftDom.nodeValue.length&&t(d.leftDom,-1)));if(46===n)return s.saveSnap(!1),void(a.isCollapsed&&d.rightDom&&(d.endImg=c.getWizAmendImgParent(d.rightDom),d.endImg?(d.endDom=d.endImg,d.endOffset=d.endImg.childNodes.length,g.setRange(d.startDom,d.startOffset,d.endDom,d.endOffset)):3===d.rightDom.nodeType&&1==d.rightDom.nodeValue.length&&t(d.rightDom,1)));if(!l.checkNonTxtKey(e)){s.saveSnap(!1),b.splitAmendDomByRange(d);var u=E.checkCaretInTableContainer();return f.insertEmptyLine(u.tableContainer,u.after),13===n&&o()?void l.stopEvent(e):void 0}},onMouseDown:function(e){var t=u.isInfo(e.target);return t?void l.stopEvent(e):void u.stop()},onMouseUp:function(e){u.start()},onTouchStart:function(e){}};t.exports=b},{"../blockUtils/blockUtils":11,"../codeUtils/codeCore":12,"../common/const":16,"../common/env":18,"../common/historyUtils":19,"../common/lang":20,"../common/utils":22,"../domUtils/domExtend":27,"../rangeUtils/rangeExtend":43,"../tableUtils/tableCore":44,"../tableUtils/tableUtils":46,"../todoUtils/todoCore":48,"./amendInfo":6,"./amendUser":7,"./amendUtils/amendExtend":9}],6:[function(e,t,n){"use strict";function o(){var e,t=u.doc.getElementById(f.ID.AMEND_INFO);return h.remove(t),t=u.doc.createElement("div"),e=u.doc.createElement("div"),h.setContenteditable(e,!1),t.appendChild(e),t.id=f.ID.AMEND_INFO,h.css(t,{position:"absolute","z-index":f.CSS.Z_INDEX.amendInfo,display:"none",padding:"6px","font-family":'"Microsoft Yahei","微软雅黑",Helvetica,SimSun,SimHei'}),e.innerHTML=r(),h.css(e,{"background-color":"white",padding:"0px","font-size":"12px",border:"1px solid #D8D8D8","-webkit-border-radius":"4px","-moz-border-radius":"4px","-border-radius":"4px","-webkit-box-shadow":"rgba(0, 0, 0, 0.24) 0px 3px 3px","-moz-box-shadow":"rgba(0, 0, 0, 0.24) 0px 3px 3px","box-shadow":"rgba(0, 0, 0, 0.24) 0px 3px 3px","min-width":"160px","max-width":"280px","min-height":"50px"}),S.template.appendChild(t),t}function r(){return u.client.type.isIOS||u.client.type.isMac||u.client.type.isAndroid?'<div id="'+f.ID.AMEND_INFO_SINGLE+'" style="display:none; padding: 8px 16px;"><img id="'+f.ID.AMEND_INFO_IMG+'" class="'+f.CLASS.IMG_NOT_DRAG+'" style="width: 40px; height: 40px !important; position: absolute; -webkit-border-radius: 40px;-moz-border-radius:40px;border-radius:40px;"><ul style="list-style-type: none;margin: 4px 0 0 50px;padding-left: 0;"><li style="line-height: 18px;white-space: nowrap;padding: 2px 0;"><span id="'+f.ID.AMEND_INFO_NAME+'" style="color:#000;font-size:12px;font-weight:bold;max-width:90px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;display:inline-block;"></span><span id="'+f.ID.AMEND_INFO_CONTENT+'" style="color:#000;font-size:12px;margin-left:.5em;display:inline-block;overflow:hidden;float:right"></span></li><li style="line-height: 18px;text-align: right;"><span id="'+f.ID.AMEND_INFO_TIME+'" style="color:#A3A3A3;font-size:12px;"></span></li></ul></div><div id="'+f.ID.AMEND_INFO_MULTI+'" style="display:none; padding: 8px 16px;"><p style="margin: 4px 16px;">'+p.Amend.MultiInfo+'</p></div><div id="'+f.ID.AMEND_INFO_TOOLS+'" style="padding:0;margin:0;box-sizing: border-box;"><div style="line-height: 26px;width: 50%;display:inline-block;text-align: center;padding:0 8px;margin:0;box-sizing: border-box;"><a id="'+f.ID.AMEND_INFO_REFUSE+'" href="javascript:void(0);" style="font-size:12px;display:block;cursor:pointer;color:#447BD8;text-decoration: blink;">'+p.Amend.BtnRefuse+'</a></div><div style="line-height: 26px;width: 50%;display:inline-block;text-align: center;padding:0 8px;margin:0;box-sizing: border-box;"><a id="'+f.ID.AMEND_INFO_ACCEPT+'" href="javascript:void(0);" style="font-size:12px;display:block;cursor:pointer;color:#447BD8;text-decoration: blink;">'+p.Amend.BtnAccept+"</a></div></div>":'<div id="'+f.ID.AMEND_INFO_SINGLE+'" style="display:none; padding: 8px 16px;"><img id="'+f.ID.AMEND_INFO_IMG+'" class="'+f.CLASS.IMG_NOT_DRAG+'" style="width: 40px; height: 40px !important; position: absolute;"><ul style="list-style-type: none;margin: 4px 0 0 50px;padding-left: 0;"><li style="line-height: 18px;white-space: nowrap;padding: 2px 0;"><span id="'+f.ID.AMEND_INFO_NAME+'" style="color:#000;font-size:12px;font-weight:bold;max-width:90px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;display:inline-block;"></span><span id="'+f.ID.AMEND_INFO_CONTENT+'" style="color:#000;font-size:12px;margin-left:.5em;display:inline-block;overflow:hidden;float:right"></span></li><li style="line-height: 18px;text-align: right;"><span id="'+f.ID.AMEND_INFO_TIME+'" style="color:#A3A3A3;font-size:12px;"></span></li></ul></div><div id="'+f.ID.AMEND_INFO_MULTI+'" style="display:none; padding: 8px 16px;"><p style="margin: 4px 16px;">'+p.Amend.MultiInfo+'</p></div><div id="'+f.ID.AMEND_INFO_TOOLS+'" style="padding:0;margin:0;box-sizing:border-box;border-top:1px solid #D8D8D8"><div style="line-height: 26px;width: 50%;display:inline-block;text-align: center;padding:0 8px;margin:0;box-sizing: border-box;border-right: 1px solid #D8D8D8"><a id="'+f.ID.AMEND_INFO_ACCEPT+'" href="javascript:void(0);" style="font-size:12px;display:block;cursor:pointer;color:#447BD8;text-decoration: blink;">'+p.Amend.BtnAccept+'</a></div><div style="line-height: 26px;width: 50%;display:inline-block;text-align: center;padding:0 8px;margin:0;box-sizing: border-box;"><a id="'+f.ID.AMEND_INFO_REFUSE+'" href="javascript:void(0);" style="font-size:12px;display:block;cursor:pointer;color:#447BD8;text-decoration: blink;">'+p.Amend.BtnRefuse+"</a></div></div>"}function i(){return{dom:S.cur,isSelection:!!S.isSelection}}function a(e){var t=S.cur,n=t.getAttribute(f.ATTR.SPAN_USERID),o=C.getUserByGuid(n),r=o?o.name:p.Amend.UserNameDefault,i=t.getAttribute(f.ATTR.SPAN_TIMESTAMP),a=!!t.getAttribute(f.ATTR.SPAN_DELETE),o=C.getUserByGuid(n);i=i.substring(0,i.length-3),S.curPos=e,S.img.src=o?o.imgUrl:"",S.name.innerText=r,S.name.setAttribute("title",r),S.content.innerText=a?p.Amend.Delete:p.Amend.Edit,S.time.innerText=i,S.multiUser.style.display="none",S.singleUser.style.display="block"}function l(e){S.curPos=e,S.singleUser.style.display="none",S.multiUser.style.display="block"}function s(e){S.main.parentNode==S.template&&(u.doc.body.appendChild(S.main),S.singleUser=u.doc.getElementById(f.ID.AMEND_INFO_SINGLE),S.multiUser=u.doc.getElementById(f.ID.AMEND_INFO_MULTI),S.img=u.doc.getElementById(f.ID.AMEND_INFO_IMG),S.name=u.doc.getElementById(f.ID.AMEND_INFO_NAME),S.content=u.doc.getElementById(f.ID.AMEND_INFO_CONTENT),S.time=u.doc.getElementById(f.ID.AMEND_INFO_TIME),S.tools=u.doc.getElementById(f.ID.AMEND_INFO_TOOLS),S.btnAccept=u.doc.getElementById(f.ID.AMEND_INFO_ACCEPT),S.btnRefuse=u.doc.getElementById(f.ID.AMEND_INFO_REFUSE)),S.cur?a(e):l(e),A.bindInfoBtn(),S.readonly?S.tools.style.display="none":S.tools.style.display="block",h.css(S.main,{top:"0px",left:"0px",display:"block",visibility:"hidden"}),h.setLayout({layerObj:S.main,target:e,layout:f.TYPE.POS.upLeft,fixed:!1,noSpace:!1,reverse:!0}),h.css(S.main,{display:"block",visibility:"visible"})}function c(){S.main&&(A.unbindInfoBtn(),S.cur=null,S.curPos=null,S.isMulti=!1,S.isSelection=!1,S.img.src="",S.name.innerText="",S.name.setAttribute("title",""),S.content.innerText="",h.css(S.main,{display:"none"}),S.template.appendChild(S.main))}function d(){h.remove(u.doc.getElementById(f.ID.AMEND_INFO))}var u=e("../common/env"),f=e("../common/const"),m=e("../common/utils"),g=e("../common/lang"),p=g.getLang(),h=e("../domUtils/domBase"),E=e("./amendUtils/amendBase"),C=e("./amendUser"),T=e("../common/wizUserAction"),b={onAccept:null,onRefuse:null},v=!1,y={x:null,y:null},S={cur:null,curPos:null,isMulti:!1,isSelection:!1,template:null,main:null,img:null,name:null,content:null,time:null,btnAccept:null,btnRefuse:null,init:function(e,t){S.template=u.doc.createElement("div"),S.main=o(),S.readonly=!(!e||!e.readonly),h.setContenteditable(S.main,!1),t&&t.onAccept&&(b.onAccept=t.onAccept),t&&t.onRefuse&&(b.onRefuse=t.onRefuse),A.unbind(),A.bind()},remove:function(){A.unbind(),d(),S.main=null,S.img=null,S.name=null,S.content=null,S.time=null,S.btnAccept=null,S.btnRefuse=null},show:function(e,t){clearTimeout(S.showTimer),clearTimeout(S.hideTimer);var n=m.isArray(e),o=n&&e.length>1,r=n?o?null:e[0]:e,i=!1;S.isSelection=n,S.isMulti!==o||r!==S.cur?(S.hide(!0),i=!0):(!S.curPos||Math.abs(S.curPos.left-t.left)>75||Math.abs(S.curPos.top-t.top)>24)&&(i=!0),i&&(S.showTimer=setTimeout(function(){S.isMulti=o,S.cur=r,s(t)},2*f.AMEND.INFO_TIMER))},hide:function(e){clearTimeout(S.showTimer),clearTimeout(S.hideTimer),(S.cur||S.isMulti)&&(e?c():S.hideTimer=setTimeout(c,f.AMEND.INFO_TIMER))},isInfo:function(e){var t=h.getParentByFilter(e,function(e){return e==S.main},!0);return!!t},start:function(){v=!1},stop:function(){S.hide(!0),v=!0}},A={bind:function(){u.client.type.isIOS||u.client.type.isAndroid?(u.event.add(f.EVENT.ON_TOUCH_START,A.handler.onTouchstart),u.event.add(f.EVENT.ON_TOUCH_END,A.handler.onMouseMove)):u.event.add(f.EVENT.ON_MOUSE_MOVE,A.handler.onMouseMove)},unbind:function(){u.event.remove(f.EVENT.ON_TOUCH_START,A.handler.onTouchstart),u.event.remove(f.EVENT.ON_TOUCH_END,A.handler.onMouseMove),u.event.remove(f.EVENT.ON_MOUSE_MOVE,A.handler.onMouseMove)},bindInfoBtn:function(){A.unbindInfoBtn(),u.client.type.isIOS||u.client.type.isAndroid?S.main.addEventListener("touchend",A.handler.onClick):S.main.addEventListener("click",A.handler.onClick)},unbindInfoBtn:function(){u.client.type.isIOS||u.client.type.isAndroid?S.main.removeEventListener("touchend",A.handler.onClick):S.main.removeEventListener("click",A.handler.onClick)},handler:{onMouseMove:function(e){var t=m.getEventClientPos(e);if((y.x!==t.x||y.y!==t.y)&&(y=t,!v)){var n,o=e.target,r=S.isInfo(o),i={width:20,height:20};if(r)return clearTimeout(S.showTimer),void clearTimeout(S.hideTimer);var a,l=u.doc.getSelection(),s=E.getWizDeleteParent(o)||E.getWizInsertParent(o);!l.isCollapsed&&s&&l.containsNode(s,!0)&&(a=l.isCollapsed?null:E.getAmendDoms({selection:!0,selectAll:!1})),a&&(a=a.deletedInsertList.concat(a.insertList,a.deleteList),0===a.length&&(a=null));var c;a||s?(c=parseInt(u.win.getComputedStyle(s)["font-size"]),isNaN(c)&&(c=14),n=h.getPageScroll(),i.left=t.x+n.left,i.top=t.y+n.top-c,i.top<s.offsetTop&&(i.top=s.offsetTop),S.show(a||s,i)):S.hide(!1)}},onTouchstart:function(e){var t=e.target,n=S.isInfo(t);n||S.hide(!1)},onClick:function(e){var t;t=e.changedTouches?e.changedTouches[0].target:e.target,t.id==f.ID.AMEND_INFO_ACCEPT?A.handler.onAccept(e):t.id==f.ID.AMEND_INFO_REFUSE&&A.handler.onRefuse(e),m.stopEvent(e)},onAccept:function(e){b.onAccept&&b.onAccept(i()),S.hide(!0),T.save(T.ActionId.ClickAcceptFromAmendInfo)},onRefuse:function(e){b.onRefuse&&b.onRefuse(i()),S.hide(!0),T.save(T.ActionId.ClickRefuseFromAmendInfo)}}};t.exports=S},{"../common/const":16,"../common/env":18,"../common/lang":20,"../common/utils":22,"../common/wizUserAction":24,"../domUtils/domBase":26,"./amendUser":7,"./amendUtils/amendBase":8}],7:[function(e,t,n){"use strict";function o(e){return e}function r(e){if(f.client.type.isWeb)return"/wizas/a/users/avatar/"+e+"?default=true&_"+(new Date).valueOf();if(f.client.type.isWin)try{var t=external.GetAvatarByUserGUID(e);return t?t:g}catch(e){console.error(e)}else f.client.type.isMac||f.client.type.isIOS||f.client.type.isAndroid;return g}function i(e){if(f.client.type.isWeb);else if(f.client.type.isWin)try{return external.GetAliasByUserGUID(e)}catch(e){console.error(e)}else f.client.type.isMac||f.client.type.isIOS||f.client.type.isAndroid;return null}function a(){return E?E:E=f.doc.getElementById(m.ID.AMEND_USER_INFO)}function l(){E=f.doc.createElement("meta"),E.id=m.ID.AMEND_USER_INFO,E.name=m.ID.AMEND_USER_INFO,f.doc.getElementsByTagName("HEAD")[0].insertBefore(E,null)}function s(){if(!C){var e,t,n;if(C={},T={},E=a())try{T=JSON.parse(E.content);for(e in T)T.hasOwnProperty(e)&&(t=T[e],t.user_guid=e,n=i(e),n?t.user_name=n:t.user_name=t.name,C[e]=new p(t))}catch(e){}}}function c(e){var t,n,o=e.hash,r=m.COLOR.length,i={};if(s(),C[o])return C[o].color;for(t in C)C.hasOwnProperty(t)&&(n=C[t].color,i[n]=!0);for(t=0;t<r;t++)if(n=m.COLOR[t],!i[n])return n;return m.COLOR[0]}function d(e){C[e.guid]=e,T[e.guid]={color:e.color,name:e.name}}function u(){E||l(),E.content=JSON.stringify(T)}var f=e("../common/env"),m=e("../common/const"),g=(e("../domUtils/domBase"),"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAExUlEQVRYR9WZz08bRxTHvya1CHbUSHXCiZzCIaaBBOUUEveQSORWYwwRxRCpqtIqjZL8XQkEUppAbQMX6hgh5UetRiFV4MABQXoK2AgUx1vNzs7u7Hpmf3m3Vc3Blm2Gz/vOd95784goiqLgf/aIhAVdrVaxu7sLKomC7u7uwKQJBPrFi5eoVvfx6VMdZONOnIhjf78KBQoINQEnrwcuD+DkyS9bhvcNfXR0hFKppEKqWqp8BE0l1N7XgPXvKOjq6kJfX29L4L6hCfDh4aEnYBbQjRuD+PhxD4nEV77gfUEvLy/rXm1S2GIJQ3VtJ9TdoFtDfuKxOK5fv+YJ3jM0BfZmCd4y5tcUPp3+Njzo1dVV1Go1X5Yw+Z1oTOLWVI91HMfg4KBrcE9KLy0tq+mrVUvwwGSxzs5ODAxcDgt6yXWWcLIEVd5QezgzFA704iKBdk5rQmCLJdRzwYEPD2fCgS4WF408LMkSooOmhsl5mBYcTmlFQTY7HA50oVi0LRxeLcHDj4QGXShKK50jsGpfsyWY2uR5dCQbjtL5QsHUSzgVDidL8AcxNOiVlRXUagdccTEfSqGfLVmCt4RRpBTcHB0JR+lS6Tn29va04iIBdsgSvCVoxlMQ/SKKTCYdPPT29jb+qFSEB5HvJbxYgnqctq2958+jpyfpCtx1RVxY+M1eYUsKYyrqAWmf85ZgwAx+bOxm8ND0D4rLOK+wXZbQg+F6bALfQAOj2Syi0agjuGul5+cXTA1+EJbg7UFeZ4bS6OjoCA762fy87udWsoTMHkT43PiYIzD5gmul19bW8OHD36Yy7tUSVg/T8q6VeCjIjX8XLDRZ/OkzojZNdX6zhNUSzOPEGrFYLFhotlpxcQkHBwdaZTS3l7LCYWeJeDyGoTBvLgy8XC5jl1jFppeQZQm/luC3wLWn+V9qNBqYm/u1qb3kewmZDXjVe5JJ9PdfdGWJlqHJAk9+mQOBl1nC6dCRTZrIuTt41qh8Kc0WmZmZ1dXmFbTzMCtOly71I3nunGeVPaU80eo7Ozv4vfRcvzY1WULrK8wBqW7HRG7cF3DL0GSBqenHRk9iKc3WQ8eGka0ABwZtpzADNZ4VTE7kfKscCPSjqWm9vZRnDGoJVv1uTf7H0A8fTen24DOGSGH23q3JiX9f6Xq9jnfv/sKfb954BmbTqYsX+nDmTBcSiYTnAFynvK2tLZDhef3zZ60S0huHLNXxHrZTnXwWiUTQffYsUqkrrgKQQpMLbD6fF+ZhN4WD9zB/cTC/ZsN3YwysN1CZNE6fOiUMwgT99u061tfXjRmb4IrkpnCIgOVBNAObdg/A1z1JfJO6qgegQ5fLqyDFwnqnY/M2L4WD75GZh5nCIqWlFqOyq7sdaWvDnZ9uq+A69Ozsk1AUtt4rhd2fNkpg4wWzULT9JZ/d/uF7tLe3U+iNjU1tPGAMBu1uzbJKZ1W4FUuIhpQX+nqRSl2l0O/fb6BSqZhbTX32xmUJm14iVGCN5VjbMfx850cK/erVa2xuburb4LaBl6U1mSVE6zpZwphhE4s0cP/eXQqdzxewX61Kcy6bS9ComPLm0ixKa34PXXMyoMDkoUNPP56Rt5fcITGUEgMH6mGLPdl/fh/cv4t/ANultPKz243RAAAAAElFTkSuQmCC"),p=function(e){e||(e={}),this.guid=e.user_guid||"",this.hash=o(this.guid),this.name=e.user_name||"",this.imgUrl=e.img_url?e.img_url:r(this.guid),this.color=e.color||c(this)},h=null,E=null,C=null,T=null,b={initUser:function(e){return s(),e?(h=new p(e),void d(h)):null},getCurUser:function(){return u(),h},getUserByGuid:function(e){return h&&e===h.guid?h:C&&C[e]?C[e]:(s(),C[e])},setUsersData:function(e){var t,n,o,r,i;if(e)for(t=0,n=e.length;t<n;t++)o=e[t],r=C[o.user_guid],i=T[o.user_guid],r&&o.user_name&&(r.name=o.user_name),r&&o.img_url&&(r.imgUrl=o.img_url),i&&o.user_name&&(i.name=o.user_name)}};t.exports=b},{"../common/const":16,"../common/env":18,"../domUtils/domBase":26}],8:[function(e,t,n){"use strict";var o=e("../../common/env"),r=e("../../common/const"),i=e("../../common/utils"),a=e("../../domUtils/domBase"),l=e("../../rangeUtils/rangeBase"),s={getAmendDoms:function(e){var t,n,o,l={},c={},d={insertList:[],deleteList:[],deletedInsertList:[]},u=[];if(e.selection)l[r.ATTR.SPAN_INSERT]="",d.insertList=s.getWizSpanFromRange(e.selectAll,l),d.deletedInsertList=a.removeListFilter(d.insertList,function(e){return e.getAttribute(r.ATTR.SPAN_DELETE)}),c[r.ATTR.SPAN_DELETE]="",d.deleteList=s.getWizSpanFromRange(e.selectAll,c),u=a.removeListFilter(d.deleteList,function(e){return e.getAttribute(r.ATTR.SPAN_INSERT)}),d.deletedInsertList=i.removeDup(d.deletedInsertList.concat(u));else for(t=0,n=e.domList.length;t<n;t++)o=e.domList[t],o.getAttribute(r.ATTR.SPAN_DELETE)&&o.getAttribute(r.ATTR.SPAN_INSERT)?d.deletedInsertList.push(o):o.getAttribute(r.ATTR.SPAN_DELETE)?d.deleteList.push(o):o.getAttribute(r.ATTR.SPAN_INSERT)&&d.insertList.push(o);return d},getSameTimeStampDom:function(e){function t(e,t,a){var l,c,d,u=n(e),f=e.getAttribute(r.ATTR.SPAN_TIMESTAMP),m=e.getAttribute(r.ATTR.SPAN_USERID);if(f)for(var g=o(e,t);g;)l=s.getWizInsertParent(g)||s.getWizDeleteParent(g),g=l,g&&g.getAttribute(r.ATTR.SPAN_USERID)!==m?g=null:g&&(c=g.getAttribute(r.ATTR.SPAN_TIMESTAMP),d=n(g),u===d&&i.isSameAmendTime(g.getAttribute(r.ATTR.SPAN_TIMESTAMP),f)?(t?a.splice(0,0,g):a.push(g),g=o(g,t)):g=null)}function n(e){return e.getAttribute(r.ATTR.SPAN_DELETE)&&e.getAttribute(r.ATTR.SPAN_INSERT)?1:e.getAttribute(r.ATTR.SPAN_INSERT)?2:e.getAttribute(r.ATTR.SPAN_DELETE)?3:0}function o(e,t){return t?a.getPreviousNode(e,!1,null):a.getNextNode(e,!1,null)}if(!e||1!=e.nodeType)return[];var l=[];return t(e,!0,l),l.push(e),t(e,!1,l),l},getSelectedAmendDoms:function(){function e(e,t,n){if(0===e.length||0===n)return null;var o=e[0];return o===t||a.contains(o,t)?(e.splice(0,1),{dom:t,offset:n}):null}function t(e,t,n){if(0===e.length)return null;var o=3===t.nodeType?t.length:t.childNodes.length;if(n===o)return null;var r=e[e.length-1];return r===t||a.contains(r,t)?(e.splice(e.length-1,1),{dom:t,offset:n}):null}var n,r,i,l,c=o.doc.getSelection(),d=c.getRangeAt(0),u=s.getAmendDoms({selection:!0,selectAll:!1});if(0===u.insertList.length&&0===u.deleteList.length&&0===u.deletedInsertList.length)return null;if(c.isCollapsed)return u;n=d.startContainer,i=d.startOffset,r=d.endContainer,l=d.endOffset;var f=e(u.deleteList,n,i);f||(f=e(u.insertList,n,i),f||(f=e(u.deletedInsertList,n,i)));var m={};return r===n&&f?(m.dom=f.dom,m.offset=l):(m=t(u.deleteList,r,l),m||(m=t(u.insertList,r,l),m||(m=t(u.deletedInsertList,r,l)))),u.start=f,u.end=m,u},getWizAmendImgParent:function(e){return a.getParentByFilter(e,function(e){return e&&1===e.nodeType&&e.getAttribute(r.ATTR.IMG)},!0)},getWizAmendParent:function(e){return a.getParentByFilter(e,function(e){return e&&1===e.nodeType&&(e.getAttribute(r.ATTR.SPAN_INSERT)||e.getAttribute(r.ATTR.SPAN_DELETE))},!0)},getWizDeleteParent:function(e){return a.getParentByFilter(e,function(e){return e&&1===e.nodeType&&e.getAttribute(r.ATTR.SPAN_DELETE)},!0)},getWizInsertParent:function(e){return a.getParentByFilter(e,function(e){return e&&1===e.nodeType&&e.getAttribute(r.ATTR.SPAN_INSERT)&&!e.getAttribute(r.ATTR.SPAN_DELETE)&&e.childNodes.length>0},!0)},getWizSpanFromRange:function(e,t){function n(e){if(!e||1!==e.nodeType)return!1;var n;for(n in t)if(t.hasOwnProperty(n)&&(!e.getAttribute(n)||t[n]&&e.getAttribute(n)!=t[n]))return!1;return!0}var r,i,s,c="span";if(!t)return[];for(r in t)t.hasOwnProperty(r)&&(c+=t[r]?"["+r+'="'+t[r]+'"]':"["+r+"]");var d,u,f,m,g,p,h,E,C,T=o.doc.getSelection(),b=[];if(e){var v=o.doc.querySelectorAll(c);for(r=0,i=v.length;r<i;r++)b.push(v[r]);return b}if(0===T.rangeCount)return[];if(T.isCollapsed)return u=l.getRangeAnchor(!1),d=a.getPreviousNode(u,!1,null),u&&(u=a.getParentByFilter(u,n,!0),u&&b.push(u)),b;if(d=l.getRangeAnchor(!0),u=l.getRangeAnchor(!1),!d||!u)return[];if(f=a.getParentByFilter(d,n,!0),m=a.getParentByFilter(u,n,!0),f&&f==m)return[f];for(g=a.getParentRoot([d,u]),p=g.querySelectorAll(c),h=a.getIndexList(d),E=a.getIndexList(u),f&&b.push(f),r=0,i=p.length;r<i;r++)s=p[r],C=a.getIndexList(s),a.compareIndexList(h,C)<=0&&a.compareIndexList(E,C)>=0&&b.push(s);return b},isAmendEdited:function(){var e=s.getAmendDoms({selection:!0,selectAll:!0});return!!e&&(e.deleteList.length>0||e.insertList.length>0||e.deletedInsertList.length>0)},isWizAmend:function(e){return s.getWizAmendParent(e)},isWizDelete:function(e){return!!s.getWizDeleteParent(e)},isWizInsert:function(e){return!!s.getWizInsertParent(e)}};t.exports=s},{"../../common/const":16,"../../common/env":18,"../../common/utils":22,"../../domUtils/domBase":26,"../../rangeUtils/rangeBase":42}],9:[function(e,t,n){"use strict";var o=e("../../common/env"),r=e("../../common/const"),i=e("../../common/utils"),a=e("../../domUtils/domExtend"),l=e("../../editor/commandExtend"),s=e("../../rangeUtils/rangeExtend"),c=e("./../amendUser"),d=e("./amendBase");d.add2SelectedAmendDoms=function(e,t){t&&(t.getAttribute(r.ATTR.SPAN_INSERT)&&t.getAttribute(r.ATTR.SPAN_DELETE)?e.deletedInsertList.push(t):t.getAttribute(r.ATTR.SPAN_INSERT)?e.insertList.push(t):t.getAttribute(r.ATTR.SPAN_DELETE)&&e.deleteList.push(t))},d.createDomForImg=function(e,t){var n=o.doc.createElement("span");return d.setDefaultAttr(n,t),n.setAttribute(r.ATTR.IMG,"1"),e==r.TYPE.IMG_DELETE&&(n.removeAttribute(r.ATTR.SPAN_INSERT),n.setAttribute(r.ATTR.SPAN_DELETE,t.hash)),d.setUserImgContainerStyle(n),n},d.createDomForInsert=function(e){var t=o.doc.createElement("span");return d.setDefaultAttr(t,e),d.setUserInsertStyle(t,e),t.innerHTML=r.FILL_CHAR,t},d.createDomForReverse=function(){var e=o.doc.createElement("span");return e.innerHTML=r.FILL_CHAR,e},d.createDomForPaste=function(e){var t,n,o;return t=a.createSpan(),t.setAttribute(r.ATTR.SPAN_PASTE_TYPE,r.TYPE.PASTE.START),t.setAttribute(r.ATTR.SPAN_PASTE_ID,e),t.innerHTML=r.FILL_CHAR,n=a.createSpan(),n.setAttribute(r.ATTR.SPAN_PASTE_TYPE,r.TYPE.PASTE.CONTENT),n.setAttribute(r.ATTR.SPAN_PASTE_ID,e),n.innerHTML=r.FILL_CHAR+r.FILL_CHAR,o=a.createSpan(),o.setAttribute(r.ATTR.SPAN_PASTE_TYPE,r.TYPE.PASTE.END),o.setAttribute(r.ATTR.SPAN_PASTE_ID,e),o.innerHTML=r.FILL_CHAR,{start:t,content:n,end:o}},d.deleteImg=function(e,t){var n,o=d.getWizAmendImgParent(e);if(o)return void(o.getAttribute(r.ATTR.SPAN_DELETE)||(o.setAttribute(r.ATTR.SPAN_USERID,t.hash),o.setAttribute(r.ATTR.SPAN_DELETE,t.hash),n=o.querySelector("img["+r.ATTR.IMG_MASK+"]"),a.css(n,r.CSS.IMG.MASK),a.css(n,r.CSS.IMG_DELETED)));var i=s.isRangeEdge(e),l=d.packageImg(e,r.TYPE.IMG_DELETE,t);i.isStart&&(i.startDom=l,i.startOffset=0),i.isEnd&&(i.endDom=l.parentNode,i.endOffset=a.getIndex(l)+1),i.isCollapsed&&i.isStart?s.setRange(i.startDom,a.getEndOffset(i.startDom),null,null):i.isCollapsed||!i.isStart&&!i.isEnd||s.setRange(i.startDom,i.startOffset,i.endDom,i.endOffset)},d.fixSelectionByDeleteImg=function(){var e,t,n,i,l=o.doc.getSelection(),s=l.getRangeAt(0),c=!1,u=!1;0!==l.rangeCount&&(e=d.getWizAmendImgParent(s.startContainer),e&&!e.getAttribute(r.ATTR.SPAN_DELETE)&&(e=null),e?(c=!0,n=0):(e=s.startContainer,n=s.startOffset),l.isCollapsed?(t=e,u=c):(t=d.getWizAmendImgParent(s.endContainer),t?u=!0:(t=s.endContainer,i=s.endOffset)),u&&t&&t.nextSibling?(i=0,t=t.nextSibling):u&&t?(i=a.getIndex(t)+1,t=t.parentNode):i=s.endOffset,l.isCollapsed?l.collapse(t,i):(l.collapse(e,n),l.extend(t,i)))},d.modifyDomForPaste=function(e,t,n){if(e&&t){1===e.childNodes.length&&e.innerText==r.FILL_CHAR&&(e.innerHTML=""),1===t.childNodes.length&&t.innerText==r.FILL_CHAR&&(t.innerHTML="");var l=a.getParentRoot([e,t]);if(l){var s,c,u,f,m,g,p,h;for(p=a.getListA2B({startDom:e,startOffset:0,endDom:t,endOffset:a.getEndOffset(t)}),h=p.list,f=0,m=h.length;f<m;f++)if(g=h[f],s=g.parentNode,u=d.getWizAmendParent(g),s){if(u)g=u;else if(3==g.nodeType){if(i.isEmpty(g.nodeValue))continue;a.isWizSpan(s)&&0===s.children.length?g=s:(c=d.createDomForInsert(n),c.innerHTML="",s.insertBefore(c,g),c.appendChild(g),g=c)}if(a.isTag(g,"img"))g=d.packageImg(g,r.TYPE.IMG_INSERT,n);else if(a.isSelfClosingTag(g))continue;d.setDefaultAttr(g,n),d.setUserInsertStyle(g,n)}for(l!=o.doc.body&&l!=o.doc.body.parentNode&&l.parentNode&&(l=l.parentNode),h=l.querySelectorAll("span["+r.ATTR.SPAN_PASTE_TYPE+"]"),f=0,m=h.length;f<m;f++)g=h[f],0===g.childNodes.length?a.remove(g):(g.removeAttribute(r.ATTR.SPAN_PASTE_TYPE),g.removeAttribute(r.ATTR.SPAN_PASTE_ID))}}},d.packageImg=function(e,t,n){var i,l,s,c=d.createDomForImg(t,n);for(i=e.parentNode,l=e.nextSibling;l&&3==l.nodeType&&l.nodeValue==r.FILL_CHAR;)s=l,l=l.nextSibiling,a.remove(s);c.appendChild(e);var u=o.doc.createElement("img");return u.className+=r.CLASS.IMG_NOT_DRAG,u.setAttribute(r.ATTR.IMG_MASK,"1"),e.style.maxWidth&&(u.style.maxWidth=e.style.maxWidth),e.style.maxHeight&&(u.style.maxHeight=e.style.maxHeight),e.style.width&&(u.style.width=e.style.width),e.style.height&&(u.style.height=e.style.height),a.css(u,r.CSS.IMG.MASK),t==r.TYPE.IMG_DELETE?a.css(u,r.CSS.IMG_DELETED):a.css(u,r.CSS.IMG_INSERT),c.appendChild(u),i.insertBefore(c,l),c},d.removeUserDel=function(e,t){var n,o,i,l,c=[];for(e||(e=s.getRangeParentRoot()),e&&(a.isBody(e)||(e=e.parentNode),i=d.getWizAmendImgParent(e),i&&i.getAttribute(r.ATTR.SPAN_USERID)!==t.hash&&(i=null),i?c.push(i):(a.search(e,"["+r.ATTR.SPAN_INSERT+'="'+t.hash+'"]['+r.ATTR.SPAN_DELETE+'="'+t.hash+'"]',c),a.search(e,"["+r.ATTR.SPAN_USERID+'="'+t.hash+'"] ['+r.ATTR.SPAN_DELETE+'="'+t.hash+'"]',c))),n=0,o=c.length;n<o;n++)i=c[n],l=i.parentNode,l.removeChild(i),a.removeEmptyParent(l)},d.getDeletedStyle=function(e){var t={};t[r.ATTR.SPAN_DELETE]=e.hash,t[r.ATTR.SPAN_USERID]=e.hash,t[r.ATTR.SPAN_TIMESTAMP]=i.getTime();var n={color:e.color,"text-decoration":"line-through"};return{attr:t,style:n}},d.removeSelection=function(e){var t,n=o.doc.getSelection(),r=n.getRangeAt(0),i=r.startContainer,a=r.startOffset,l=r.endContainer,c=r.endOffset,u=d.getWizAmendImgParent(i),f=d.getWizAmendImgParent(l);if(f||(t=d.splitInsertDom(l,c,!0,e),t.isInsert&&t.split&&s.setRange(i,a,l,c)),u||(t=d.splitInsertDom(i,a,!0,e),t.isInsert&&t.split&&(l===i&&(l=t.insertDom.nextSibling,c=l.childNodes.length),i=t.insertDom,a=t.insertDom.childNodes.length,s.setRange(i,a,l,c))),!n.isCollapsed){var m=d.getDeletedStyle(e);s.modifySelectionDom(m.style,m.attr),d.fixSelectionByDeleteImg()}},d.setDefaultAttr=function(e,t){1==e.nodeType&&(e.setAttribute(r.ATTR.SPAN,r.ATTR.SPAN),e.setAttribute(r.ATTR.SPAN_INSERT,t.hash),e.setAttribute(r.ATTR.SPAN_USERID,t.hash),e.setAttribute(r.ATTR.SPAN_TIMESTAMP,i.getTime()))},d.setUserImgContainerStyle=function(e){a.css(e,r.CSS.IMG.SPAN)},d.setUserInsertStyle=function(e,t){a.css(e,{color:t.color,"text-decoration":"underline"})},d.fixedAmendRange=function(){var e,t,n,r,i,l,c=o.doc.getSelection(),u=c.getRangeAt(0),f=u.startContainer,m=u.endContainer,g=u.startOffset,p=u.endOffset;return c.isCollapsed?(t=s.getRangeAnchor(!1),e=3===m.nodeType&&p>0&&p<m.nodeValue.length?t:a.getPreviousNode(t,!1,null)):(n=s.getRangeAnchor(!0),r=s.getRangeAnchor(!1),i=d.getWizAmendImgParent(n),l=d.getWizAmendImgParent(r),i&&(f=i,g=0),l&&(m=l,p=l.childNodes.length),(i||l)&&s.setRange(f,g,m,p)),{startImg:i,endImg:l,startDom:f,startOffset:g,endDom:m,endOffset:p,leftDom:e,rightDom:t}},d.splitAmendDomByRange=function(e){var t,n,r,i=o.doc.getSelection(),a=e.startContainer,c=e.endContainer,u=e.startOffset,f=e.endOffset;i.isCollapsed?(n=d.getWizAmendImgParent(e.leftDom),r=d.getWizAmendImgParent(e.rightDom),r?(c=r,f=0,s.setRange(c,f,c,f)):n&&(a=n,u=n.childNodes.length,s.setRange(a,u,a,u)),t=i.getRangeAt(0),c=t.endContainer,f=t.endOffset):(l.execCommand("delete"),t=i.getRangeAt(0),c=t.endContainer,f=t.endOffset);var m=d.splitAmendDomForReverse(c,f);return m?(s.setRange(m,1,m,1),m):null},d.splitDeletedDom=function(e,t){if(1==e.nodeType)return!1;var n=null;return!!d.isWizDelete(e)&&(n=d.splitWizDomWithTextNode(e,t),!!n)},d.splitInsertDom=function(e,t,n,o){var l={insertDom:null,isInsert:!1,split:!1};if(!e)return l;if(1==e.nodeType&&t>0?(e=e.childNodes[t-1],t=a.getEndOffset(e)):1==e.nodeType&&(e=e.childNodes[0]),!e)return l;var s,c,u=d.getWizAmendImgParent(e),f=d.getWizInsertParent(e);return l.insertDom=f,f||1!=e.nodeType?u?l:(f&&(n||f.getAttribute(r.ATTR.SPAN_USERID)!==o.hash)?l.split=!0:f&&(s=f.getAttribute(r.ATTR.SPAN_TIMESTAMP),c=i.getTime(),i.getDateForTimeStr(c)-i.getDateForTimeStr(s)>=r.AMEND_TIME_SPACE?l.split=!0:f.setAttribute(r.ATTR.SPAN_TIMESTAMP,c)),l.split&&(l.split=!!d.splitWizDomWithTextNode(e,t)),l.isInsert=!!f,l):l},d.splitAmendDomForReverse=function(e,t){var n=d.getWizAmendImgParent(e);if(!n&&1==e.nodeType&&t>0?(e=e.childNodes[t-1],t=a.getEndOffset(e)):n||1!=e.nodeType||(e=e.childNodes[0]),!e)return null;var o=d.getWizInsertParent(e),r=d.getWizDeleteParent(e),i=o||r,l=d.createDomForReverse();if(n)a.before(l,n,t>0);else{if(!i)return null;if(i=d.splitWizDomWithTextNode(e,t),!i)return null;a.after(l,i)}return l},d.splitSelectedAmendDoms=function(e){if(e&&(e.start||e.end)){var t,n=o.doc.getSelection(),r=n.getRangeAt(0),i=r.startContainer,a=r.startOffset,l=r.endContainer,c=r.endOffset;e.start&&e.end&&e.start.dom==e.end.dom?(d.splitWizDomWithTextNode(e.end.dom,e.end.offset),t=d.splitWizDomWithTextNode(e.start.dom,e.start.offset),t=t.nextSibling,d.add2SelectedAmendDoms(e,t),i=t,a=0,l=t,c=t.childNodes.length):(e.start&&(t=d.splitWizDomWithTextNode(e.start.dom,e.start.offset),t=t.nextSibling,d.add2SelectedAmendDoms(e,t),i=t,a=0),e.end&&(t=d.splitWizDomWithTextNode(e.end.dom,e.end.offset),d.add2SelectedAmendDoms(e,t),l=t,c=t.childNodes.length)),delete e.start,delete e.end,s.setRange(i,a,l,c)}},d.splitWizDomWithTextNode=function(e,t){if(!e||3!==e.nodeType)return null;var n,o,i,l,s=null;for(t<e.nodeValue.length?(n=e.nodeValue.substr(t),o=e.cloneNode(!1),o.nodeValue=n,e.nodeValue=e.nodeValue.substr(0,t),e.parentNode.insertBefore(o,e.nextSibling),s=e,i=e.parentNode,l=o):(i=e.parentNode,l=e.nextSibling);i&&!a.isBody(i)&&(s=i,a.splitDomBeforeSub(i,l),!i||1!==i.nodeType||!i.getAttribute(r.ATTR.SPAN_DELETE)&&!i.getAttribute(r.ATTR.SPAN_INSERT));)l=i.nextSibling,i=i.parentNode;return s},d.wizAmendDelete=function(e){var t,n,o,r;for(t=0,n=e.length;t<n;t++)o=e[t],r=o.parentNode,r.removeChild(o),a.removeEmptyParent(r)},d.wizAmendSave=function(e){var t,n,o,i;for(t=0,n=e.length;t<n;t++)o=e[t],o.getAttribute(r.ATTR.SPAN_DELETE)&&o.getAttribute(r.ATTR.SPAN_INSERT)&&o.getAttribute(r.ATTR.SPAN_INSERT)!==o.getAttribute(r.ATTR.SPAN_USERID)?(i=c.getUserByGuid(o.getAttribute(r.ATTR.SPAN_INSERT)),i=i?i:{},o.removeAttribute(r.ATTR.SPAN_DELETE),o.setAttribute(r.ATTR.SPAN_USERID,i.hash),o.getAttribute(r.ATTR.IMG)?(d.setUserImgContainerStyle(o),a.css(mask,r.CSS.IMG_INSERT)):d.setUserInsertStyle(o,i)):o.getAttribute(r.ATTR.IMG)?(a.before(o.children[0],o),
a.remove(o)):(a.css(o,{color:"","text-decoration":""}),o.removeAttribute(r.ATTR.SPAN_USERID),o.removeAttribute(r.ATTR.SPAN_INSERT),o.removeAttribute(r.ATTR.SPAN_DELETE),o.removeAttribute(r.ATTR.SPAN_PASTE),o.removeAttribute(r.ATTR.SPAN_PASTE_TYPE),o.removeAttribute(r.ATTR.SPAN_PASTE_ID),o.removeAttribute(r.ATTR.SPAN_TIMESTAMP))},t.exports=d},{"../../common/const":16,"../../common/env":18,"../../common/utils":22,"../../domUtils/domExtend":27,"../../editor/commandExtend":31,"../../rangeUtils/rangeExtend":43,"./../amendUser":7,"./amendBase":8}],10:[function(e,t,n){"use strict";function o(){d&&d.parentNode!==c&&i(),u&&clearTimeout(u),u=setTimeout(r,100)}function r(){T=[];var e,t,n,o,r=f.doc.querySelectorAll("table");for(e=r.length-1;e>=0;e--)n=r[e],o=h.getContainer(n),o||(h.initTableContainer(n),o=h.getContainer(n)),t=o.querySelector("."+m.CLASS.TABLE_BODY),T.push({type:C.Table,target:t,top:o.offsetTop,height:o.offsetHeight});if(!f.client.type.isPhone&&!f.client.type.isPad){var a,l,s=f.doc.querySelectorAll("."+m.CLASS.CODE_MIRROR);for(e=s.length-1;e>=0;e--)a=s[e],l=g.getContainerFromChild(a),l||(g.fixCode(a),l=g.getContainerFromChild(a)),l&&(t=a.querySelector("."+m.CLASS.CODE_MIRROR_HSCROLL),T.push({type:C.Code,target:t,codeMirror:l.codeMirror,top:l.offsetTop,height:l.offsetHeight}))}i()}function i(){if(0!==T.length){var e,t,n=f.doc.documentElement.clientHeight,o=f.doc.body.scrollTop,r=o+n;for(e=T.length-1;e>=0;e--)if(t=T[e],t.top<r&&t.top+t.height>r&&t.target.offsetWidth<t.target.scrollWidth)return d&&d.curBlock&&d.curBlock.target===t.target?void l(t):(d&&a(),void s(t));a()}}function a(){d&&(b.unbindScroll(),d.curBlock=null,c.appendChild(d))}function l(e){var t;d?t=d.children[0]:(d=f.doc.createElement(m.TAG.TMP_TAG),t=f.doc.createElement("div"),d.appendChild(t),p.addClass(d,m.CLASS.BLOCK_SCROLL));var n=e.target.scrollWidth;p.css(t,{width:n+"px",height:"1px","background-color":"rgba(255, 255, 255, 0.2)"}),p.css(d,{"background-color":"rgba(255, 255, 255, 0.2)",height:"17px",width:e.target.offsetWidth+"px","overflow-x":"scroll","overflow-y":"hidden",position:"fixed",bottom:"0px","z-index":999}),d.scrollLeft=e.target.scrollLeft}function s(e){l(e),d.curBlock=e,p.after(d,e.target),b.bindScroll(),b.handler.onTxScroll()}var c,d,u,f=e("../common/env"),m=e("../common/const"),g=e("../codeUtils/codeUtils"),p=e("../domUtils/domExtend"),h=e("../tableUtils/tableUtils"),E=e("./blockUtils"),C={Table:"table",Code:"code"},T=[],b={bind:function(){b.unbind(),f.client.type.isIOS||f.client.type.isAndroid||(f.event.add(m.EVENT.ON_SCROLL,b.handler.onScroll),f.event.add(m.EVENT.ON_DOM_SUBTREE_MODIFIED,b.handler.updateRender),f.win.addEventListener("resize",b.handler.updateRender)),f.readonly||(f.client.type.isPhone||f.client.type.isPad?f.event.add(m.EVENT.ON_TOUCH_START,b.handler.onMouseDown):f.event.add(m.EVENT.ON_MOUSE_DOWN,b.handler.onMouseDown))},unbind:function(){a(),f.event.remove(m.EVENT.ON_SCROLL,b.handler.onScroll),f.event.remove(m.EVENT.ON_DOM_SUBTREE_MODIFIED,b.handler.updateRender),f.win.removeEventListener("resize",b.handler.updateRender),f.event.remove(m.EVENT.ON_TOUCH_START,b.handler.onMouseDown),f.event.remove(m.EVENT.ON_MOUSE_DOWN,b.handler.onMouseDown)},bindScroll:function(){b.unbindScroll(),d.addEventListener("scroll",b.handler.onSxScroll)},unbindScroll:function(){d.removeEventListener("scroll",b.handler.onSxScroll)},handler:{onMouseDown:function(e){var t="mousedown"!==e.type||0===e.button||1===e.button;t&&E.checkAndInsertEmptyLine(e)},onScroll:function(){o()},onSxScroll:function(){d.curBlock&&(d.curBlock.target.scrollLeft=d.scrollLeft)},onTxScroll:function(){d.curBlock&&(d.scrollLeft=d.curBlock.target.scrollLeft)},updateRender:function(){o()}}},v={on:function(){b.bind(),f.client.type.isIOS||f.client.type.isAndroid||(c||(c=f.doc.createElement("div")),o())},off:function(){b.unbind()}};t.exports=v},{"../codeUtils/codeUtils":14,"../common/const":16,"../common/env":18,"../domUtils/domExtend":27,"../tableUtils/tableUtils":46,"./blockUtils":11}],11:[function(e,t,n){"use strict";function o(e,t,n){var o,r,i=!1,a=!1,c=e?u.getFirstDeepChild(l.doc.body):u.getLastDeepChild(l.doc.body);if(r=u.getParentByClass(c,s.CLASS.CODE_CONTAINER))i=!0;else for(;c&&!u.canEdit(c);)c=e?u.getNextNodeCanEdit(c,!1):u.getPreviousNodeCanEdit(c,!1);return c&&(3==c.nodeType&&(c=c.parentNode),o=u.getOffset(c),r=u.getParentByFilter(c,n,!0),e&&t<o.top&&r?i=!0:!e&&t>o.top+c.offsetHeight&&r?a=!0:c=null),{container:r,isFirst:i,isLast:a}}function r(e){return u.hasClass(e,s.CLASS.CODE_CONTAINER)||u.hasClass(e,s.CLASS.TABLE_CONTAINER)}function i(e){return u.getParentByFilter(e,r,!0)}function a(e){return u.hasClass(e,s.CLASS.CODE_CONTAINER)||u.hasClass(e,s.CLASS.TABLE_CONTAINER)||u.hasClass(e,s.CLASS.TABLE_BODY)}var l=e("../common/env"),s=e("../common/const"),c=e("../common/utils"),d=e("../common/historyUtils"),u=e("../domUtils/domExtend"),f=e("../editor/commandExtend"),m=e("../tableUtils/tableZone"),g=e("../rangeUtils/rangeExtend"),p={checkAndInsertEmptyLine:function(e){var t,n,s,f,m=e.changedTouches?e.changedTouches[0]:null,g=m?m.target:e.target,h=c.getEventClientPos(e),E=l.doc.body.scrollTop+h.y,C=!1,T=!1;g===l.doc.body||g===l.doc.body.parentNode?(g===l.doc.body&&(s=o(!0,E,r),T=s.isFirst,n=s.container),T||(s=o(!1,E,r),C=s.isLast,n=s.container)):a(g)&&(n=i(g),f=0,n&&(f=E-u.getOffset(n).top),n&&f<15?(t=u.getPreviousNodeCanEdit(g,!1),t&&!i(t)||(T=!0)):n&&g.offsetHeight-f<15&&(t=u.getNextNodeCanEdit(g,!1),t&&!i(t)||(C=!0))),n&&(C||T)?(d.saveSnap(!1),p.insertEmptyLine(n,C)):t=null},insertBlock:function(e){var t,n,o,r,i=g.getRange();return i?(i=g.getRange(),t=g.getRangeDetail(i.startContainer,i.startOffset),n=t.container,o=u.getBlockParent(n,!0),u.hasClass(o,s.CLASS.TODO_LAYER)?(n=l.doc.createElement(o.tagName),u.after(n,o),n.appendChild(e),o=n):o&&u.isEmptyDom(o)||(f.execCommand("insertparagraph"),i=g.getRange(),n=i.startContainer,o=u.getBlockParent(n,!0)),u.isEmptyDom(o)&&u.isTag(o,"div")?(o.innerHTML="",o.appendChild(e)):(n=l.doc.createElement("div"),u.before(n,o),n.appendChild(e),u.isEmptyDom(o)&&u.remove(o),o=n)):(o=l.doc.createElement("div"),o.appendChild(e),l.doc.body.appendChild(o),r=l.doc.createElement("div"),r.appendChild(l.doc.createElement("br")),l.doc.body.appendChild(r)),o},insertEmptyLine:function(e,t){if(e){var n=l.doc.createElement("div"),o=l.doc.createElement("br");n.appendChild(o),u.before(n,e,t),m.clear(),g.setRange(o,0)}}};t.exports=p},{"../common/const":16,"../common/env":18,"../common/historyUtils":19,"../common/utils":22,"../domUtils/domExtend":27,"../editor/commandExtend":31,"../rangeUtils/rangeExtend":43,"../tableUtils/tableZone":47}],12:[function(e,t,n){"use strict";var o=e("../common/env"),r=e("../common/const"),i=e("../common/utils"),a=e("../common/dependLoader"),l=e("../common/historyUtils"),s=e("../blockUtils/blockUtils"),c=e("../domUtils/domExtend"),d=e("../rangeUtils/rangeExtend"),u=e("./codeUtils"),f=e("./codeStyle"),m={bind:function(){m.unbind(),o.event.add(r.EVENT.ON_SELECT_PLUGIN_CHANGE,m.handler.onChangeSelector),o.event.add(r.EVENT.BEFORE_GET_DOCHTML,m.handler.beforeGetDocHtml),o.event.add(r.EVENT.BEFORE_SAVESNAP,m.handler.onBeforeSaveSnap),o.event.add(r.EVENT.AFTER_RESTORE_HISTORY,m.handler.onAfterRestoreHistory),o.event.add(r.EVENT.ON_MOUSE_DOWN,m.handler.onMouseDown)},unbind:function(){o.event.remove(r.EVENT.ON_SELECT_PLUGIN_CHANGE,m.handler.onChangeSelector),o.event.remove(r.EVENT.BEFORE_GET_DOCHTML,m.handler.beforeGetDocHtml),o.event.remove(r.EVENT.BEFORE_SAVESNAP,m.handler.onBeforeSaveSnap),o.event.remove(r.EVENT.AFTER_RESTORE_HISTORY,m.handler.onAfterRestoreHistory),o.event.remove(r.EVENT.ON_MOUSE_DOWN,m.handler.onMouseDown)},handler:{beforeGetDocHtml:function(){u.saveToText(),f.clearStyle()},onAfterRestoreHistory:function(){var e,t,n,o,r=u.getContainerList();for(o=r.length-1;o>=0;o--)e=r[o],t=e.codeMirror,t||(u.fixCodeContainer(e),n=l.getCodeMirrorDoc(e.id),n&&(t=e.codeMirror,t.swapDoc(n)))},onBeforeSaveSnap:function(){var e,t,n,o=u.getContainerList();for(n=o.length-1;n>=0;n--)e=o[n],t=e.codeMirror,t&&(t.save(),c.setTextarea(t.getTextArea()))},onChangeSelector:function(e){var t;return c.hasClass(e,r.CLASS.CODE_TOOLS_MODE)?(t=u.getContainerFromChild(e),u.changeMode(t,e.value),void t.codeMirror.focus()):c.hasClass(e,r.CLASS.CODE_TOOLS_THEME)?(t=u.getContainerFromChild(e),f.insertTheme(e.value),u.changeTheme(t,e.value),void t.codeMirror.focus()):void 0},onMouseDown:function(e){var t=u.getToolsFromChild(e.target);t&&i.stopEvent(e)},onKeyDown:function(e){return!u.onKeyDown(e)||(i.stopEvent(e),!1)}}},g={loadDependency:function(e){"undefined"==typeof CodeMirror?a.loadJs(o.doc,a.getDependencyFiles(o.dependency,"js","codeMirror"),function(){e()}):e()},on:function(){m.bind(),f.initCommon(),u.oldPatch.fixOldCode(),u.fixCodeContainer()},off:function(){m.unbind(),u.clearCodeMirror()},insertCode:function(){l.saveSnap(!1);var e=d.getRange();if(u.canCreateCode()){var t,n,i,a,f,m="";if(e){if(!e.collapsed){for(a=o.doc.createElement("div"),f=e.cloneContents();f.firstChild;)a.appendChild(f.firstChild);a.style.position="absolute",a.style.top="0px",a.style.left="-10000px",a.style.height="1px",o.doc.body.appendChild(a),m=a.innerText,o.doc.body.removeChild(a),e.deleteContents()}t=d.getRangeDetail(e.startContainer,e.startOffset),t=c.getBlockParent(t.container,!0),t&&t!==o.doc.body&&c.isEmptyDom(t)&&c.isTag(t,"div")&&(n=t,t.innerHTML="")}i=o.doc.createElement("textarea"),c.setTextarea(i,m),n=n?n:o.doc.createElement("div"),n.appendChild(i),c.addClass(n,r.CLASS.CODE_CONTAINER),n.isNew=!0,n.parentNode||s.insertBlock(n),u.fixCodeContainer(n),n.isNew=!1,n.codeMirror.focus(),o.event.call(r.EVENT.UPDATE_RENDER)}},onKeyDown:m.handler.onKeyDown};t.exports=g},{"../blockUtils/blockUtils":11,"../common/const":16,"../common/dependLoader":17,"../common/env":18,"../common/historyUtils":19,"../common/utils":22,"../domUtils/domExtend":27,"../rangeUtils/rangeExtend":43,"./codeStyle":13,"./codeUtils":14}],13:[function(e,t,n){"use strict";var o=e("../common/env"),r=e("../common/const"),i=e("../common/wizStyle"),a=(e("../common/dependLoader"),e("../domUtils/domBase"),{tmp:{common:".wiz-code-tools {display:none;position: absolute; top: -32px; right: 0; opacity: .95; z-index: 10;}.CodeMirror-focused .wiz-code-tools {display:block;}.CodeMirror-sizer {border-right: 0 !important;}body pre.prettyprint {padding:0;}body pre.prettyprint code {white-space: pre;}body pre.prettyprint.linenums {box-shadow:none; overflow: auto;-webkit-overflow-scrolling: touch;}body pre.prettyprint.linenums ol.linenums {box-shadow: 40px 0 0 #FBFBFC inset, 41px 0 0 #ECECF0 inset; padding: 10px 10px 10px 40px !important;}",reader:".CodeMirror-cursors {visibility: hidden !important;}",phone:"."+r.CLASS.CODE_CONTAINER+"{margin-left:0; margin-right:0;}"},common:"."+r.CLASS.CODE_CONTAINER+'{position: relative; padding:8px 0; margin: 5px 25px 5px 5px;text-indent:0; text-align:left;}.CodeMirror {font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace; color: black; font-size: 10pt; font-size: 0.83rem}.CodeMirror-lines {padding: 4px 0;}.CodeMirror pre {padding: 0 4px;}.CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler {background-color: white;}.CodeMirror-gutters {border-right: 1px solid #ddd; background-color: #f7f7f7; white-space: nowrap;}.CodeMirror-linenumbers {}.CodeMirror-linenumber {padding: 0 3px 0 5px; min-width: 20px; text-align: right; color: #999; white-space: nowrap;}.CodeMirror-guttermarker {color: black;}.CodeMirror-guttermarker-subtle {color: #999;}.CodeMirror-cursor {border-left: 1px solid black; border-right: none; width: 0;}.CodeMirror div.CodeMirror-secondarycursor {border-left: 1px solid silver;}.cm-fat-cursor .CodeMirror-cursor {width: auto; border: 0 !important; background: #7e7;}.cm-fat-cursor div.CodeMirror-cursors {z-index: 1;}.cm-animate-fat-cursor {width: auto; border: 0; -webkit-animation: blink 1.06s steps(1) infinite; -moz-animation: blink 1.06s steps(1) infinite; animation: blink 1.06s steps(1) infinite; background-color: #7e7;}@-moz-keyframes blink {  0% {}  50% { background-color: transparent; }  100% {}}@-webkit-keyframes blink {  0% {}  50% { background-color: transparent; }  100% {}}@keyframes blink {  0% {}  50% { background-color: transparent; }  100% {}}.CodeMirror-overwrite .CodeMirror-cursor {}.cm-tab { display: inline-block; text-decoration: inherit; }.CodeMirror-rulers {position: absolute; left: 0; right: 0; top: -50px; bottom: -20px; overflow: hidden;}.CodeMirror-ruler {border-left: 1px solid #ccc; top: 0; bottom: 0; position: absolute;}.cm-s-default .cm-header {color: blue;}.cm-s-default .cm-quote {color: #090;}.cm-negative {color: #d44;}.cm-positive {color: #292;}.cm-header, .cm-strong {font-weight: bold;}.cm-em {font-style: italic;}.cm-link {text-decoration: underline;}.cm-strikethrough {text-decoration: line-through;}.cm-s-default .cm-keyword {color: #708;}.cm-s-default .cm-atom {color: #219;}.cm-s-default .cm-number {color: #164;}.cm-s-default .cm-def {color: #00f;}.cm-s-default .cm-variable,.cm-s-default .cm-punctuation,.cm-s-default .cm-property,.cm-s-default .cm-operator {}.cm-s-default .cm-variable-2 {color: #05a;}.cm-s-default .cm-variable-3 {color: #085;}.cm-s-default .cm-comment {color: #a50;}.cm-s-default .cm-string {color: #a11;}.cm-s-default .cm-string-2 {color: #f50;}.cm-s-default .cm-meta {color: #555;}.cm-s-default .cm-qualifier {color: #555;}.cm-s-default .cm-builtin {color: #30a;}.cm-s-default .cm-bracket {color: #997;}.cm-s-default .cm-tag {color: #170;}.cm-s-default .cm-attribute {color: #00c;}.cm-s-default .cm-hr {color: #999;}.cm-s-default .cm-link {color: #00c;}.cm-s-default .cm-error {color: #f00;}.cm-invalidchar {color: #f00;}.CodeMirror-composing { border-bottom: 2px solid; }div.CodeMirror span.CodeMirror-matchingbracket {color: #0f0;}div.CodeMirror span.CodeMirror-nonmatchingbracket {color: #f22;}.CodeMirror-matchingtag { background: rgba(255, 150, 0, .3); }.CodeMirror-activeline-background {background: #e8f2ff;}.CodeMirror {position: relative; background: #f5f5f5;}.CodeMirror-scroll {overflow: hidden !important; margin-bottom: 0; margin-right: -30px; padding: 16px 30px 16px 0; outline: none; position: relative;}.CodeMirror-sizer {position: relative; border-right: 30px solid transparent;}.CodeMirror-vscrollbar, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler {position: absolute; z-index: 6; display: none;}.CodeMirror-vscrollbar {right: 0; top: 0; overflow-x: hidden; overflow-y: scroll;}.CodeMirror-hscrollbar {bottom: 0; left: 0 !important; overflow-y: hidden; overflow-x: scroll;}.CodeMirror-scrollbar-filler {right: 0; bottom: 0;}.CodeMirror-gutter-filler {left: 0; bottom: 0;}.CodeMirror-gutters {position: absolute; left: 0; top: -5px; min-height: 100%; z-index: 3;}.CodeMirror-gutter {white-space: normal; height: inherit; display: inline-block; vertical-align: top; margin-bottom: -30px;}.CodeMirror-gutter-wrapper {position: absolute; z-index: 4; background: none !important; border: none !important;}.CodeMirror-gutter-background {position: absolute; top: 0; bottom: 0; z-index: 4;}.CodeMirror-gutter-elt {position: absolute; cursor: default; z-index: 4; text-align: center;}.CodeMirror-gutter-wrapper ::selection { background-color: transparent }.CodeMirror-gutter-wrapper ::-moz-selection { background-color: transparent }.CodeMirror-lines {cursor: text; min-height: 1px;}.CodeMirror pre {-moz-border-radius: 0; -webkit-border-radius: 0; border-radius: 0; border-width: 0; background: transparent; font-family: inherit; font-size: inherit; margin: 0; white-space: pre; word-wrap: normal; line-height: inherit; color: inherit; z-index: 2; position: relative; overflow: visible; -webkit-tap-highlight-color: transparent; -webkit-font-variant-ligatures: contextual; font-variant-ligatures: contextual;}.CodeMirror-wrap pre {word-wrap: break-word; white-space: pre-wrap; word-break: normal;}.CodeMirror-linebackground {position: absolute; left: 0; right: 0; top: 0; bottom: 0; z-index: 0;}.CodeMirror-linewidget {position: relative; z-index: 2; overflow: auto;}.CodeMirror-widget {}.CodeMirror-rtl pre { direction: rtl; }.CodeMirror-code {outline: none;}.CodeMirror-scroll,.CodeMirror-sizer,.CodeMirror-gutter,.CodeMirror-gutters,.CodeMirror-linenumber {-moz-box-sizing: content-box; box-sizing: content-box;}.CodeMirror-measure {position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden;}.CodeMirror-cursor {position: absolute; pointer-events: none;}.CodeMirror-measure pre { position: static; }div.CodeMirror-cursors {visibility: hidden; position: relative; z-index: 3;}div.CodeMirror-dragcursors {visibility: visible;}.CodeMirror-focused div.CodeMirror-cursors {visibility: visible;}.CodeMirror-selected { background: #d9d9d9; }.CodeMirror-focused .CodeMirror-selected { background: #d7d4f0; }.CodeMirror-crosshair { cursor: crosshair; }.CodeMirror-line::selection, .CodeMirror-line > span::selection, .CodeMirror-line > span > span::selection { background: #d7d4f0; }.CodeMirror-line::-moz-selection, .CodeMirror-line > span::-moz-selection, .CodeMirror-line > span > span::-moz-selection { background: #d7d4f0; }.cm-searching {background: #ffa; background: rgba(255, 255, 0, .4);}.cm-force-border { padding-right: .1px; }@media print {  .CodeMirror div.CodeMirror-cursors {visibility: hidden;}}.cm-tab-wrap-hack:after { content: ""; }span.CodeMirror-selectedtext { background: none; }.CodeMirror-activeline-background, .CodeMirror-selected {transition: visibility 0ms 100ms;}.CodeMirror-blur .CodeMirror-activeline-background, .CodeMirror-blur .CodeMirror-selected {visibility:hidden;}.CodeMirror-blur .CodeMirror-matchingbracket {color:inherit !important;outline:none !important;text-decoration:none !important;}',theme:{"base16-dark":".cm-s-base16-dark.CodeMirror { background: #151515; color: #e0e0e0; }.cm-s-base16-dark div.CodeMirror-selected { background: #303030; }.cm-s-base16-dark .CodeMirror-line::selection, .cm-s-base16-dark .CodeMirror-line > span::selection, .cm-s-base16-dark .CodeMirror-line > span > span::selection { background: rgba(48, 48, 48, .99); }.cm-s-base16-dark .CodeMirror-line::-moz-selection, .cm-s-base16-dark .CodeMirror-line > span::-moz-selection, .cm-s-base16-dark .CodeMirror-line > span > span::-moz-selection { background: rgba(48, 48, 48, .99); }.cm-s-base16-dark .CodeMirror-gutters { background: #151515; border-right: 0px; }.cm-s-base16-dark .CodeMirror-guttermarker { color: #ac4142; }.cm-s-base16-dark .CodeMirror-guttermarker-subtle { color: #505050; }.cm-s-base16-dark .CodeMirror-linenumber { color: #505050; }.cm-s-base16-dark .CodeMirror-cursor { border-left: 1px solid #b0b0b0; }.cm-s-base16-dark span.cm-comment { color: #8f5536; }.cm-s-base16-dark span.cm-atom { color: #aa759f; }.cm-s-base16-dark span.cm-number { color: #aa759f; }.cm-s-base16-dark span.cm-property, .cm-s-base16-dark span.cm-attribute { color: #90a959; }.cm-s-base16-dark span.cm-keyword { color: #ac4142; }.cm-s-base16-dark span.cm-string { color: #f4bf75; }.cm-s-base16-dark span.cm-variable { color: #90a959; }.cm-s-base16-dark span.cm-variable-2 { color: #6a9fb5; }.cm-s-base16-dark span.cm-def { color: #d28445; }.cm-s-base16-dark span.cm-bracket { color: #e0e0e0; }.cm-s-base16-dark span.cm-tag { color: #ac4142; }.cm-s-base16-dark span.cm-link { color: #aa759f; }.cm-s-base16-dark span.cm-error { background: #ac4142; color: #b0b0b0; }.cm-s-base16-dark .CodeMirror-activeline-background { background: #202020; }.cm-s-base16-dark .CodeMirror-matchingbracket { text-decoration: underline; color: white !important; }","base16-light":".cm-s-base16-light.CodeMirror { background: #f5f5f5; color: #202020; }.cm-s-base16-light div.CodeMirror-selected { background: #e0e0e0; }.cm-s-base16-light .CodeMirror-line::selection, .cm-s-base16-light .CodeMirror-line > span::selection, .cm-s-base16-light .CodeMirror-line > span > span::selection { background: #e0e0e0; }.cm-s-base16-light .CodeMirror-line::-moz-selection, .cm-s-base16-light .CodeMirror-line > span::-moz-selection, .cm-s-base16-light .CodeMirror-line > span > span::-moz-selection { background: #e0e0e0; }.cm-s-base16-light .CodeMirror-gutters { background: #f5f5f5; border-right: 0px; }.cm-s-base16-light .CodeMirror-guttermarker { color: #ac4142; }.cm-s-base16-light .CodeMirror-guttermarker-subtle { color: #b0b0b0; }.cm-s-base16-light .CodeMirror-linenumber { color: #b0b0b0; }.cm-s-base16-light .CodeMirror-cursor { border-left: 1px solid #505050; }.cm-s-base16-light span.cm-comment { color: #8f5536; }.cm-s-base16-light span.cm-atom { color: #aa759f; }.cm-s-base16-light span.cm-number { color: #aa759f; }.cm-s-base16-light span.cm-property, .cm-s-base16-light span.cm-attribute { color: #90a959; }.cm-s-base16-light span.cm-keyword { color: #ac4142; }.cm-s-base16-light span.cm-string { color: #f4bf75; }.cm-s-base16-light span.cm-variable { color: #90a959; }.cm-s-base16-light span.cm-variable-2 { color: #6a9fb5; }.cm-s-base16-light span.cm-def { color: #d28445; }.cm-s-base16-light span.cm-bracket { color: #202020; }.cm-s-base16-light span.cm-tag { color: #ac4142; }.cm-s-base16-light span.cm-link { color: #aa759f; }.cm-s-base16-light span.cm-error { background: #ac4142; color: #505050; }.cm-s-base16-light .CodeMirror-activeline-background { background: #DDDCDC; }.cm-s-base16-light .CodeMirror-matchingbracket { text-decoration: underline; color: white !important; }",blackboard:".cm-s-blackboard.CodeMirror { background: #0C1021; color: #F8F8F8; }.cm-s-blackboard div.CodeMirror-selected { background: #253B76; }.cm-s-blackboard .CodeMirror-line::selection, .cm-s-blackboard .CodeMirror-line > span::selection, .cm-s-blackboard .CodeMirror-line > span > span::selection { background: rgba(37, 59, 118, .99); }.cm-s-blackboard .CodeMirror-line::-moz-selection, .cm-s-blackboard .CodeMirror-line > span::-moz-selection, .cm-s-blackboard .CodeMirror-line > span > span::-moz-selection { background: rgba(37, 59, 118, .99); }.cm-s-blackboard .CodeMirror-gutters { background: #0C1021; border-right: 0; }.cm-s-blackboard .CodeMirror-guttermarker { color: #FBDE2D; }.cm-s-blackboard .CodeMirror-guttermarker-subtle { color: #888; }.cm-s-blackboard .CodeMirror-linenumber { color: #888; }.cm-s-blackboard .CodeMirror-cursor { border-left: 1px solid #A7A7A7; }.cm-s-blackboard .cm-keyword { color: #FBDE2D; }.cm-s-blackboard .cm-atom { color: #D8FA3C; }.cm-s-blackboard .cm-number { color: #D8FA3C; }.cm-s-blackboard .cm-def { color: #8DA6CE; }.cm-s-blackboard .cm-variable { color: #FF6400; }.cm-s-blackboard .cm-operator { color: #FBDE2D; }.cm-s-blackboard .cm-comment { color: #AEAEAE; }.cm-s-blackboard .cm-string { color: #61CE3C; }.cm-s-blackboard .cm-string-2 { color: #61CE3C; }.cm-s-blackboard .cm-meta { color: #D8FA3C; }.cm-s-blackboard .cm-builtin { color: #8DA6CE; }.cm-s-blackboard .cm-tag { color: #8DA6CE; }.cm-s-blackboard .cm-attribute { color: #8DA6CE; }.cm-s-blackboard .cm-header { color: #FF6400; }.cm-s-blackboard .cm-hr { color: #AEAEAE; }.cm-s-blackboard .cm-link { color: #8DA6CE; }.cm-s-blackboard .cm-error { background: #9D1E15; color: #F8F8F8; }.cm-s-blackboard .CodeMirror-activeline-background { background: #3C3636; }.cm-s-blackboard .CodeMirror-matchingbracket { outline:1px solid grey;color:white !important; }",eclipse:".cm-s-eclipse span.cm-meta { color: #FF1717; }.cm-s-eclipse span.cm-keyword { line-height: 1em; font-weight: bold; color: #7F0055; }.cm-s-eclipse span.cm-atom { color: #219; }.cm-s-eclipse span.cm-number { color: #164; }.cm-s-eclipse span.cm-def { color: #00f; }.cm-s-eclipse span.cm-variable { color: black; }.cm-s-eclipse span.cm-variable-2 { color: #0000C0; }.cm-s-eclipse span.cm-variable-3 { color: #0000C0; }.cm-s-eclipse span.cm-property { color: black; }.cm-s-eclipse span.cm-operator { color: black; }.cm-s-eclipse span.cm-comment { color: #3F7F5F; }.cm-s-eclipse span.cm-string { color: #2A00FF; }.cm-s-eclipse span.cm-string-2 { color: #f50; }.cm-s-eclipse span.cm-qualifier { color: #555; }.cm-s-eclipse span.cm-builtin { color: #30a; }.cm-s-eclipse span.cm-bracket { color: #cc7; }.cm-s-eclipse span.cm-tag { color: #170; }.cm-s-eclipse span.cm-attribute { color: #00c; }.cm-s-eclipse span.cm-link { color: #219; }.cm-s-eclipse span.cm-error { color: #f00; }.cm-s-eclipse .CodeMirror-activeline-background { background: #e8f2ff; }.cm-s-eclipse .CodeMirror-matchingbracket { outline:1px solid grey; color:black !important; }",material:".cm-s-material.CodeMirror {background-color: #263238; color: rgba(233, 237, 237, 1);}.cm-s-material .CodeMirror-gutters {background: #263238; color: rgb(83,127,126); border: none;}.cm-s-material .CodeMirror-guttermarker, .cm-s-material .CodeMirror-guttermarker-subtle, .cm-s-material .CodeMirror-linenumber { color: rgb(83,127,126); }.cm-s-material .CodeMirror-cursor { border-left: 1px solid #f8f8f0; }.cm-s-material div.CodeMirror-selected { background: rgba(255, 255, 255, 0.15); }.cm-s-material.CodeMirror-focused div.CodeMirror-selected { background: rgba(255, 255, 255, 0.10); }.cm-s-material .CodeMirror-line::selection, .cm-s-material .CodeMirror-line > span::selection, .cm-s-material .CodeMirror-line > span > span::selection { background: rgba(255, 255, 255, 0.10); }.cm-s-material .CodeMirror-line::-moz-selection, .cm-s-material .CodeMirror-line > span::-moz-selection, .cm-s-material .CodeMirror-line > span > span::-moz-selection { background: rgba(255, 255, 255, 0.10); }.cm-s-material .CodeMirror-activeline-background { background: rgba(0, 0, 0, 0); }.cm-s-material .cm-keyword { color: rgba(199, 146, 234, 1); }.cm-s-material .cm-operator { color: rgba(233, 237, 237, 1); }.cm-s-material .cm-variable-2 { color: #80CBC4; }.cm-s-material .cm-variable-3 { color: #82B1FF; }.cm-s-material .cm-builtin { color: #DECB6B; }.cm-s-material .cm-atom { color: #F77669; }.cm-s-material .cm-number { color: #F77669; }.cm-s-material .cm-def { color: rgba(233, 237, 237, 1); }.cm-s-material .cm-string { color: #C3E88D; }.cm-s-material .cm-string-2 { color: #80CBC4; }.cm-s-material .cm-comment { color: #546E7A; }.cm-s-material .cm-variable { color: #82B1FF; }.cm-s-material .cm-tag { color: #80CBC4; }.cm-s-material .cm-meta { color: #80CBC4; }.cm-s-material .cm-attribute { color: #FFCB6B; }.cm-s-material .cm-property { color: #80CBAE; }.cm-s-material .cm-qualifier { color: #DECB6B; }.cm-s-material .cm-variable-3 { color: #DECB6B; }.cm-s-material .cm-tag { color: rgba(255, 83, 112, 1); }.cm-s-material .cm-error {color: rgba(255, 255, 255, 1.0); background-color: #EC5F67;}.cm-s-material .CodeMirror-matchingbracket {text-decoration: underline; color: white !important;}",monokai:".cm-s-monokai.CodeMirror { background: #272822; color: #f8f8f2; }.cm-s-monokai div.CodeMirror-selected { background: #49483E; }.cm-s-monokai .CodeMirror-line::selection, .cm-s-monokai .CodeMirror-line > span::selection, .cm-s-monokai .CodeMirror-line > span > span::selection { background: rgba(73, 72, 62, .99); }.cm-s-monokai .CodeMirror-line::-moz-selection, .cm-s-monokai .CodeMirror-line > span::-moz-selection, .cm-s-monokai .CodeMirror-line > span > span::-moz-selection { background: rgba(73, 72, 62, .99); }.cm-s-monokai .CodeMirror-gutters { background: #272822; border-right: 0px; }.cm-s-monokai .CodeMirror-guttermarker { color: white; }.cm-s-monokai .CodeMirror-guttermarker-subtle { color: #d0d0d0; }.cm-s-monokai .CodeMirror-linenumber { color: #d0d0d0; }.cm-s-monokai .CodeMirror-cursor { border-left: 1px solid #f8f8f0; }.cm-s-monokai span.cm-comment { color: #75715e; }.cm-s-monokai span.cm-atom { color: #ae81ff; }.cm-s-monokai span.cm-number { color: #ae81ff; }.cm-s-monokai span.cm-property, .cm-s-monokai span.cm-attribute { color: #a6e22e; }.cm-s-monokai span.cm-keyword { color: #f92672; }.cm-s-monokai span.cm-builtin { color: #66d9ef; }.cm-s-monokai span.cm-string { color: #e6db74; }.cm-s-monokai span.cm-variable { color: #f8f8f2; }.cm-s-monokai span.cm-variable-2 { color: #9effff; }.cm-s-monokai span.cm-variable-3 { color: #66d9ef; }.cm-s-monokai span.cm-def { color: #fd971f; }.cm-s-monokai span.cm-bracket { color: #f8f8f2; }.cm-s-monokai span.cm-tag { color: #f92672; }.cm-s-monokai span.cm-header { color: #ae81ff; }.cm-s-monokai span.cm-link { color: #ae81ff; }.cm-s-monokai span.cm-error { background: #f92672; color: #f8f8f0; }.cm-s-monokai .CodeMirror-activeline-background { background: #373831; }.cm-s-monokai .CodeMirror-matchingbracket {text-decoration: underline; color: white !important;}","tomorrow-night-eighties":".cm-s-tomorrow-night-eighties.CodeMirror { background: #000000; color: #CCCCCC; }.cm-s-tomorrow-night-eighties div.CodeMirror-selected { background: #2D2D2D; }.cm-s-tomorrow-night-eighties .CodeMirror-line::selection, .cm-s-tomorrow-night-eighties .CodeMirror-line > span::selection, .cm-s-tomorrow-night-eighties .CodeMirror-line > span > span::selection { background: rgba(45, 45, 45, 0.99); }.cm-s-tomorrow-night-eighties .CodeMirror-line::-moz-selection, .cm-s-tomorrow-night-eighties .CodeMirror-line > span::-moz-selection, .cm-s-tomorrow-night-eighties .CodeMirror-line > span > span::-moz-selection { background: rgba(45, 45, 45, 0.99); }.cm-s-tomorrow-night-eighties .CodeMirror-gutters { background: #000000; border-right: 0px; }.cm-s-tomorrow-night-eighties .CodeMirror-guttermarker { color: #f2777a; }.cm-s-tomorrow-night-eighties .CodeMirror-guttermarker-subtle { color: #777; }.cm-s-tomorrow-night-eighties .CodeMirror-linenumber { color: #515151; }.cm-s-tomorrow-night-eighties .CodeMirror-cursor { border-left: 1px solid #6A6A6A; }.cm-s-tomorrow-night-eighties span.cm-comment { color: #d27b53; }.cm-s-tomorrow-night-eighties span.cm-atom { color: #a16a94; }.cm-s-tomorrow-night-eighties span.cm-number { color: #a16a94; }.cm-s-tomorrow-night-eighties span.cm-property, .cm-s-tomorrow-night-eighties span.cm-attribute { color: #99cc99; }.cm-s-tomorrow-night-eighties span.cm-keyword { color: #f2777a; }.cm-s-tomorrow-night-eighties span.cm-string { color: #ffcc66; }.cm-s-tomorrow-night-eighties span.cm-variable { color: #99cc99; }.cm-s-tomorrow-night-eighties span.cm-variable-2 { color: #6699cc; }.cm-s-tomorrow-night-eighties span.cm-def { color: #f99157; }.cm-s-tomorrow-night-eighties span.cm-bracket { color: #CCCCCC; }.cm-s-tomorrow-night-eighties span.cm-tag { color: #f2777a; }.cm-s-tomorrow-night-eighties span.cm-link { color: #a16a94; }.cm-s-tomorrow-night-eighties span.cm-error { background: #f2777a; color: #6A6A6A; }.cm-s-tomorrow-night-eighties .CodeMirror-activeline-background { background: #343600; }.cm-s-tomorrow-night-eighties .CodeMirror-matchingbracket { text-decoration: underline; color: white !important; }"}}),l={clearStyle:function(){var e,t,n,a=o.doc.getElementsByName(r.NAME.CODE_STYLE);for(n=a.length-1;n>=0;n--)e=a[n],t=e.id.replace(r.ID.CODE_STYLE+"-",""),o.doc.querySelector("."+r.CLASS.CODE_CONTAINER+"[data-theme="+t+"]")||i.removeStyleById(e.id);var l=o.doc.querySelectorAll("."+r.CLASS.CODE_CONTAINER);0===l.length&&i.removeStyleById(r.ID.CODE_STYLE)},initCommon:function(){i.replaceStyleById(r.ID.CODE_STYLE,a.common,!1),l.insertTemp()},insertCommon:function(){var e=o.doc.getElementById(r.ID.CODE_STYLE);e||i.replaceStyleById(r.ID.CODE_STYLE,a.common,!1)},insertTemp:function(){i.insertStyle({name:r.NAME.TMP_STYLE},a.tmp.common),(o.client.type.isPhone||o.client.type.isPad)&&i.insertStyle({name:r.NAME.TMP_STYLE},a.tmp.phone),o.readonly&&i.insertStyle({name:r.NAME.TMP_STYLE},a.tmp.reader)},insertTheme:function(e){a.theme[e]&&!o.doc.querySelector("#"+r.ID.CODE_STYLE+"-"+e)&&i.insertStyle({id:r.ID.CODE_STYLE+"-"+e,name:r.NAME.CODE_STYLE},a.theme[e])}};t.exports=l},{"../common/const":16,"../common/dependLoader":17,"../common/env":18,"../common/wizStyle":23,"../domUtils/domBase":26}],14:[function(e,t,n){"use strict";var o=e("../common/env"),r=e("../common/const"),i=e("../common/utils"),a=e("../common/historyUtils"),l=e("../domUtils/domExtend"),s=e("../domUtils/selectPlugin"),c=e("../rangeUtils/rangeExtend"),d=e("./codeStyle"),u={MODE:{APL:{cm:"text/apl",
file:"apl",same:["apollo"]},C:{cm:"text/x-csrc",file:"clike",same:[]},"C++":{cm:"text/x-c++src",file:"clike",same:["cpp"]},"C#":{cm:"text/x-csharp",file:"clike",same:["cs"]},CSS:{cm:"text/css",file:"css",same:[]},Dart:{cm:"application/dart",file:["clike","dart"],same:[]},Erlang:{cm:"text/x-erlang",file:"erlang",same:[]},Go:{cm:"text/x-go",file:"go",same:[]},HTML:{cm:"text/html",file:[["xml","css","javascript","vbscript"],["htmlmixed"]],same:[]},Java:{cm:"text/x-java",file:"clike",same:[]},JavaScript:{cm:"text/javascript",file:"javascript",same:["js"]},JSX:{cm:"text/jsx",file:[["xml","javascript"],["jsx"]],same:[]},Lisp:{cm:"text/x-common-lisp",file:"commonlisp",same:[]},Lua:{cm:"text/x-lua",file:"lua",same:[]},"Octave (MATLAB)":{cm:"text/x-octave",file:"octave",same:["matlab","octave"]},"Objective-C":{cm:"text/x-objectivec",file:"clike",same:[]},Pascal:{cm:"text/x-pascal",file:"pascal",same:[]},Perl:{cm:"text/x-perl",file:"perl",same:[]},PHP:{cm:"application/x-httpd-php",file:"php",same:[]},Python:{cm:"text/x-python",file:"python",same:["py"]},Ruby:{cm:"text/x-ruby",file:"ruby",same:["rb"]},Shell:{cm:"text/x-sh",file:"shell",same:["sh"]},SQL:{cm:"text/x-sql",file:"sql",same:[]},Swift:{cm:"text/x-swift",file:"swift",same:[]},VBScript:{cm:"text/vbscript",file:"vbscript",same:["basic","vb"]},Verilog:{cm:"text/x-verilog",file:"verilog",same:[]},VHDL:{cm:"text/x-vhdl",file:"vhdl",same:[]},XML:{cm:"application/xml",file:"xml",same:[]},XSL:{cm:"application/xml",file:"xml",same:[]},YAML:{cm:"text/x-yaml",file:"yaml",same:[]}},THEME:{default:{name:"L1 (default)",same:["L1"]},"base16-light":{name:"L2 (base16-light)",same:["L2"]},eclipse:{name:"L3 (eclipse)",same:["L3"]},"base16-dark":{name:"D1 (base16-dark)",same:["D1"]},blackboard:{name:"D2 (blackboard)",same:["D2"]},material:{name:"D3 (material)",same:["D3"]},monokai:{name:"D4 (monokai)",same:["D4"]},"tomorrow-night-eighties":{name:"D5 (tomorrow)",same:["D5"]}}},f=[],m=[],g={},p={};!function(){var e,t,n;for(e in u.MODE)if(u.MODE.hasOwnProperty(e))for(f.push({text:e,value:e}),t=u.MODE[e].same,g[e.toLowerCase()]=e,n=0;n<t.length;n++)g[t[n].toLowerCase()]=e;for(e in u.THEME)if(u.THEME.hasOwnProperty(e))for(m.push({text:u.THEME[e].name,value:e}),t=u.THEME[e].same,p[e.toLowerCase()]=e,n=0;n<t.length;n++)p[t[n].toLowerCase()]=e}();var h={mode:"wiz-code-mode",theme:"wiz-code-theme"},E={canCreateCode:function(){var e=c.getRange();return!(!e||E.getContainerFromChild(e.startContainer)||l.getParentByClass(e.startContainer,r.CLASS.TABLE_CONTAINER,!0))},changeMode:function(e,t){if(e){var n=e.codeMirror;n&&(n.setOption("mode",u.MODE[t].cm),l.attr(e,{"data-mode":t}),o.win.localStorage&&!o.readonly&&o.win.localStorage.setItem(h.mode,t))}},changeTheme:function(e,t){if(e){t=t||"default";var n=e.codeMirror;n&&(d.insertTheme(t),n.setOption("theme",t),l.attr(e,{"data-theme":t}),o.win.localStorage&&!o.readonly&&o.win.localStorage.setItem(h.theme,t))}},clearCodeMirror:function(){var e,t,n,o=E.getContainerList();for(n=o.length-1;n>=0;n--)e=o[n],e.codeMirror&&(t=e.codeMirror,t.setOption("readOnly",!0),t.setOption("styleActiveLine",!1),t.getDoc().clearHistory())},fixCodeContainer:function(e){var t,n,r=e?[e]:E.getContainerList();for(n=r.length-1;n>=0;n--)t=r[n],t.removeAttribute("style"),t.removeAttribute("id"),t.removeAttribute("class"),E.fixCodeContainerParent(t),o.options.codeNoIDE?E.initCodeNoIDE(t):E.initCodeMirror(t)},fixCodeContainerParent:function(e){var t,n;t=l.getParentList(e),t.length>0&&(n=l.splitDomSingle(t[0],e),l.before(e,n),l.remove(n))},fixCode:function(e){if(!e)return null;var t=e.parentNode;return l.hasClass(t,r.CLASS.CODE_CONTAINER)?null:(t!==o.doc.body&&1===t.childNodes.length||(t=o.doc.createElement("div"),l.before(t,e),t.appendChild(e)),t)},focusToFirst:function(e){e.focus(),e.setCursor({line:0,ch:0})},focusToLast:function(e){e.focus(),e.setCursor({line:e.lastLine(),ch:e.getLineHandle(e.lastLine()).text.length})},getContainerFromChild:function(e){return l.getParentByClass(e,r.CLASS.CODE_CONTAINER,!0)},getToolsFromChild:function(e){return l.getParentByClass(e,r.CLASS.CODE_TOOLS,!0)},getContainerList:function(){return o.doc.querySelectorAll("."+r.CLASS.CODE_CONTAINER)},getCmMode:function(e){var t=(e.getAttribute("data-mode")||"").toLowerCase(),n="";return e.isNew&&o.win.localStorage&&!o.readonly&&(n=(o.win.localStorage.getItem(h.mode)||"").toLowerCase()),g[t]||g[n]||"JavaScript"},getCmTheme:function(e){var t=(e.getAttribute("data-theme")||"").toLowerCase(),n="";return e.isNew&&o.win.localStorage&&!o.readonly&&(n=(o.win.localStorage.getItem(h.theme)||"").toLowerCase()),p[t]||p[n]||"default"},getCmWrapper:function(e){return e.querySelector("."+r.CLASS.CODE_MIRROR)},initCodeNoIDE:function(e){if(e){E.removeCmWrapper(e);var t,n,r=e.querySelector("textarea"),i="";r&&(i=r.textContent,t=o.doc.createElement("pre"),n=o.doc.createElement("code"),t.appendChild(n),n.textContent=i,l.before(t,r),l.remove(r))}},removeCmWrapper:function(e){if(e.id){var t=o.doc.body.querySelector("."+r.CLASS.CODE_MIRROR+"[data-id="+e.id+"]");l.remove(t)}},initCodeMirror:function(e){if(e){d.insertCommon();var t,n,s,f,m,g,p;if(e.id||(e.id="wiz_cm_"+(new Date).valueOf()+"_"+Math.floor(1e4*Math.random())),l.addClass(e,r.CLASS.CODE_CONTAINER),l.attr(e,{contenteditable:"false"}),g=E.getCmMode(e),p=E.getCmTheme(e),e.codeMirror)return s=e.codeMirror,void(o.readonly?(s.setOption("matchBrackets",!1),s.setOption("readOnly",!o.client.type.isPhone&&!o.client.type.isPad||"nocursor"),s.setOption("styleActiveLine",!1),s.getDoc().clearHistory()):(s.setOption("matchBrackets",!0),s.setOption("readOnly",!1),s.setOption("styleActiveLine",!0)));for(E.removeCmWrapper(e);e.lastChild&&!l.isTag(e.lastChild,"textarea");)e.removeChild(e.lastChild);n=e.querySelector("textarea"),l.setTextarea(n,i.replaceSpecialChar(n.value)),t={fixedGutter:!1,indentUnit:4,lineWrapping:!0,scrollbarStyle:"null",lineNumbers:!0,matchBrackets:!o.readonly,mode:u.MODE[g].cm,extraKeys:{Tab:function(e){var t=Array(e.getOption("indentUnit")+1).join(" ");e.replaceSelection(t)},"Ctrl-Z":function(){a.undo()},"Cmd-Z":function(){a.undo()},"Ctrl-Y":function(){a.redo()},"Shift-Cmd-Z":function(){a.redo()},"Cmd-Y":function(){a.redo()}}},o.readonly?(t.readOnly=!o.client.type.isPhone&&!o.client.type.isPad||"nocursor",t.styleActiveLine=!1):(t.readOnly=!1,t.styleActiveLine=!0),s=CodeMirror.fromTextArea(n,t),e.codeMirror=s,e.mode=g,s.display.wrapper.setAttribute("data-id",e.id),f=e.querySelector("."+r.CLASS.CODE_MIRROR),m=o.doc.createElement(r.TAG.CODE_MIRROR),l.before(m,f),m.appendChild(f),E.changeMode(e,g),E.changeTheme(e,p);var h,C="";s.on("keydown",function(e,t){var n=t.keyCode||t.which;h=37===n||38===n?-1:39===n||40===n?1:0}),s.on("beforeSelectionChange",function(t,n){var r,i,t,a=n.ranges[0],s=a.anchor,d=a.head,u=[s.line,s.ch,d.line,d.ch].join(".");if("+move"===n.origin&&s.line==d.line&&s.ch==d.ch&&u===C)if(h===-1){for(r=l.getPreviousNode(e);r&&!l.isTag(r,"br")&&l.isEmptyDom(r);)r=l.getPreviousNode(r);r&&(i=E.getContainerFromChild(r),i?(t=i.codeMirror,E.focusToLast(t)):(o.doc.body.setAttribute("contenteditable",!0),c.setRange(r,l.getEndOffset(r))))}else if(1===h){for(r=l.getNextNode(e);r&&!l.isTag(r,"br")&&l.isEmptyDom(r);)r=l.getNextNode(r);r&&(i=E.getContainerFromChild(r),i?(t=i.codeMirror,E.focusToFirst(t)):(o.doc.body.setAttribute("contenteditable",!0),c.setRange(r,0)))}C=u}),s.on("beforeChange",function(t,n){"redo"!==n.origin&&"undo"!==n.origin&&a.saveSnap(!1,{type:r.HISTORY.TYPE.CODE_MIRROR,cmContainerId:e.id})}),s.on("change",function(e,t){/^(redo|undo|paste)$/i.test(t.origin)&&e.setSize()}),s.on("copy",function(e,t){(o.client.type.isPhone||o.client.type.isPad)&&o.readonly&&(t.codemirrorIgnore=!0)}),s.on("focus",function(e,t){var n=E.getContainerFromChild(e.display.wrapper);E.initTools(n)}),s.on("blur",function(e,t){});var T,b=e.querySelector(".CodeMirror-sizer");b&&(T=b.nextElementSibling,T&&(T.style.height="13px"))}},initTools:function(e){if(e&&!o.readonly&&!o.client.type.isPhone&&!o.client.type.isPad){var t,n,i=E.getCmWrapper(e),a=e.querySelector("."+r.CLASS.CODE_TOOLS),c=E.getCmMode(e),d=e.getAttribute("data-theme");a||(a=o.doc.createElement(r.TAG.TMP_TAG),t=s.create(f,r.CLASS.CODE_TOOLS_MODE,c),n=s.create(m,r.CLASS.CODE_TOOLS_THEME,d),a.appendChild(t),a.appendChild(n),l.addClass(t,r.CLASS.CODE_TOOLS_MODE),l.addClass(n,r.CLASS.CODE_TOOLS_THEME),l.addClass(a,r.CLASS.CODE_TOOLS)),i.appendChild(a)}},insertCodeSrc:function(e,t){var n=e.codeMirror;n&&n.replaceSelection(t,"end")},onKeyDown:function(e){var t=c.getRange(),n=o.doc.getSelection();if(!t||!t.collapsed)return!1;var r,i,s,d,u,f,m=e.keyCode||e.which,g=c.getRangeDetail(t.startContainer,t.startOffset),p=!1,h=!1,C=null,T=null,b=null;if(8===m&&0===g.offset&&(s=l.getPreviousNode(g.container,!1),b=E.getContainerFromChild(s)),46===m&&(l.isTag(g.container,"br")||g.offset===l.getEndOffset(g.container))&&(s=l.getNextNode(g.container,!1),b=E.getContainerFromChild(s),b&&l.isTag(g.container,"br")))return l.remove(g.container),E.focusToFirst(b.codeMirror),!0;if(b)return a.saveSnap(!1),l.remove(b),!0;switch(m){case 37:e.ctrlKey||e.metaKey||(u=!0,n.modify("move","backward","character")),d={x:-1,y:0};break;case 38:e.ctrlKey||e.metaKey||(u=!0,n.modify("move","backward","line")),d={x:0,y:-1};break;case 39:e.ctrlKey||e.metaKey||(u=!0,n.modify("move","forward","character")),d={x:1,y:0};break;case 40:e.ctrlKey||e.metaKey||(u=!0,n.modify("move","forward","line")),d={x:0,y:1}}if(u){if(t=c.getRange(),r=c.getRangeDetail(t.startContainer,t.startOffset),C=g.container,T=r.container,r.container===g.container&&r.offset!==g.offset||(r.container!==g.container?d.x>0||d.y>0?h=!0:p=!0:(d.x>0||d.y>0?h=!0:p=!0,T=o.doc.body)),h){for(i=l.getNextNode(C,!1,T);i&&i!==T&&!l.isTag(i,"br")&&l.isEmptyDom(i);)i=l.getNextNode(i,!1,T);i&&(i=l.getNextBlock(i))}else if(p){for(i=l.getPreviousNode(C,!1,T);i&&i!==T&&!l.isTag(i,"br")&&l.isEmptyDom(i);)i=l.getPreviousNode(i,!1,T);i&&(i=l.getPrevBlock(i))}i&&(b=E.getContainerFromChild(i),f=b&&b.codeMirror,f?(f.focus(),d.x>0||d.y>0?E.focusToFirst(f):E.focusToLast(f)):b=null),b||(d.x<0?n.modify("move","forward","character"):d.y<0?n.modify("move","forward","line"):d.x>0?n.modify("move","backward","character"):d.y>0&&n.modify("move","backward","line"))}return!!b},saveToText:function(){var e,t,n,o=E.getContainerList();for(n=o.length-1;n>=0;n--)e=o[n],t=e.codeMirror,t&&t.save()},pastePatch:{fix:function(){var e,t,n=o.doc.querySelectorAll("."+r.CLASS.CODE_CONTAINER_PASTE);for(e=n.length;e>=0;e--)t=n[e],l.removeClass(t,r.CLASS.CODE_CONTAINER_PASTE),E.fixCodeContainer(t)},ready:function(e,t){var n,i,a,s,c,d,u,f,m,g,p,h,C=e.querySelectorAll("."+r.CLASS.CODE_MIRROR);for(f=C.length-1;f>=0;f--){for(s=C[f],a=E.getContainerFromChild(s),a||(a=s),p=[],c=s.querySelectorAll("."+r.CLASS.CODE_MIRROR_LINE),m=0;m<c.length;m++)g=c[m],h=g.innerText||g.textContent,p.push(h.replace(r.FILL_CHAR_REG,""));n=o.doc.createElement("div"),t?n.innerHTML="<br/>"+p.join("<br/>")+"<br/><br/>":(d=a.getAttribute("data-mode"),u=a.getAttribute("data-theme"),i=o.doc.createElement("textarea"),i.textContent=p.join("\n"),l.addClass(n,r.CLASS.CODE_CONTAINER_PASTE),n.appendChild(i),d&&n.setAttribute("data-mode",d),u&&n.setAttribute("data-theme",u)),l.before(n,a),l.remove(a)}}},oldPatch:{oldCodeReady:function(){function e(e,t){var n,a,s,c,d,u;for(n=e.querySelectorAll(t),a=n.length-1;a>=0;a--)s=n[a],i.isEmpty(s.innerText)&&(d=l.getParentByClass(s,r.CLASS.CODE_CONTAINER_OLD,!1),d&&(c=l.splitDomSingle(d,s),u=o.doc.createElement("div"),u.appendChild(s),l.before(u,c),l.remove(c)))}var t,n,a;for(t=o.doc.querySelectorAll("."+r.CLASS.CODE_CONTAINER_OLD),a=t.length-1;a>=0;a--)n=t[a],e(n,"a");for(t=o.doc.querySelectorAll("."+r.CLASS.CODE_CONTAINER_OLD),a=t.length-1;a>=0;a--)n=t[a],e(n,"img")},fixOldCode:function(){var e,t,n,i,a,s,c,d=[];if(E.oldPatch.oldCodeReady(),e=o.doc.querySelectorAll("."+r.CLASS.CODE_CONTAINER_OLD),e.length>50)return d;for(c=e.length-1;c>=0;c--)t=e[c],i=E.fixCode(t),a=E.oldPatch.getSrc(t),n=E.oldPatch.getMode(t),i.removeChild(t),s=o.doc.createElement("textarea"),s.value=a,s.style.display="none",i.appendChild(s),l.addClass(i,r.CLASS.CODE_CONTAINER),n&&l.attr(i,{"data-mode":n}),d.push(i);return d},getMode:function(e){var t,n,o=/language-([\w]+)/i,r=/lang-([\w]+)/i,i=e.querySelector("code");return i&&i.className&&(t=i.className.match(o))?n=t[1]:e.className&&(t=e.className.match(r))&&(n=t[1]),n&&(n=g[n.toLowerCase()]),n},getSrc:function(e){if(!e)return"";var t,n,o,r=e.querySelectorAll("code");for(n=0,o=r.length;n<o;n++)t=r[n],t.innerText||(t.innerText="\n");return(e.innerText||e.textContent||"").replace(/\n$/,"")}},highlight:{clear:function(e){var t=e.codeMirror;if(t){var n=e.state;n||(n={},e.state=n),t.operation(function(){n.lastQuery=n.query||null,n.query&&(n.query=n.queryText=null,t.removeOverlay(n.overlay))})}},clearAll:function(){var e,t,n=E.getContainerList();for(e=0;e<n.length;e++)t=n[e],E.highlight.clear(t)},overlay:function(e){return e=new RegExp(e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),"gi"),{token:function(t){e.lastIndex=t.pos;var n=e.exec(t.string);return n&&n.index===t.pos?(t.pos+=n[0].length||1,"searching"):void(n?t.pos=n.index:t.skipToEnd())}}},search:function(e,t){if(!e.state||!e.state.query||e.state.query.toLowerCase()!==t.toLowerCase()){var n=e.codeMirror;if(n){E.highlight.clear(e);var o=e.state;t=t.toLowerCase(),o.query=t,n.removeOverlay(o.overlay),o.overlay=E.highlight.overlay(o.query),n.addOverlay(o.overlay)}}}}};t.exports=E},{"../common/const":16,"../common/env":18,"../common/historyUtils":19,"../common/utils":22,"../domUtils/domExtend":27,"../domUtils/selectPlugin":28,"../rangeUtils/rangeExtend":43,"./codeStyle":13}],15:[function(e,t,n){"use strict";var o,r={},i=r.Base64,a="2.1.8";"undefined"!=typeof t&&t.exports&&(o=e("buffer").Buffer);var l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=function(e){for(var t={},n=0,o=e.length;n<o;n++)t[e.charAt(n)]=n;return t}(l),c=String.fromCharCode,d=function(e){if(e.length<2){var t=e.charCodeAt(0);return t<128?e:t<2048?c(192|t>>>6)+c(128|63&t):c(224|t>>>12&15)+c(128|t>>>6&63)+c(128|63&t)}var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return c(240|t>>>18&7)+c(128|t>>>12&63)+c(128|t>>>6&63)+c(128|63&t)},u=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,f=function(e){return e.replace(u,d)},m=function(e){var t=[0,2,1][e.length%3],n=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0),o=[l.charAt(n>>>18),l.charAt(n>>>12&63),t>=2?"=":l.charAt(n>>>6&63),t>=1?"=":l.charAt(63&n)];return o.join("")},g=r.btoa?function(e){return r.btoa(e)}:function(e){return e.replace(/[\s\S]{1,3}/g,m)},p=o?function(e){return(e.constructor===o.constructor?e:new o(e)).toString("base64")}:function(e){return g(f(e))},h=function(e,t){return t?p(String(e)).replace(/[+\/]/g,function(e){return"+"==e?"-":"_"}).replace(/=/g,""):p(String(e))},E=function(e){return h(e,!0)},C=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),T=function(e){switch(e.length){case 4:var t=(7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3),n=t-65536;return c((n>>>10)+55296)+c((1023&n)+56320);case 3:return c((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return c((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},b=function(e){return e.replace(C,T)},v=function(e){var t=e.length,n=t%4,o=(t>0?s[e.charAt(0)]<<18:0)|(t>1?s[e.charAt(1)]<<12:0)|(t>2?s[e.charAt(2)]<<6:0)|(t>3?s[e.charAt(3)]:0),r=[c(o>>>16),c(o>>>8&255),c(255&o)];return r.length-=[0,0,2,1][n],r.join("")},y=r.atob?function(e){return r.atob(e)}:function(e){return e.replace(/[\s\S]{1,4}/g,v)},S=o?function(e){return(e.constructor===o.constructor?e:new o(e,"base64")).toString()}:function(e){return b(y(e))},A=function(e){return S(String(e).replace(/[-_]/g,function(e){return"-"==e?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))},N=function(){var e=r.Base64;return r.Base64=i,e};if(r.Base64={VERSION:a,atob:y,btoa:g,fromBase64:A,toBase64:h,utob:f,encode:h,encodeURI:E,btou:b,decode:A,noConflict:N},"function"==typeof Object.defineProperty){var O=function(e){return{value:e,enumerable:!1,writable:!0,configurable:!0}};r.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",O(function(){return A(this)})),Object.defineProperty(String.prototype,"toBase64",O(function(e){return h(this,e)})),Object.defineProperty(String.prototype,"toBase64URI",O(function(){return h(this,!0)}))}}t.exports=r.Base64},{buffer:2}],16:[function(e,t,n){"use strict";var o="​",r={AMEND_TIME_SPACE:18e4,AMEND_BATCH_TIME_SPACE:3e4,COMPOSITION_START:!1,FILL_CHAR:o,FILL_CHAR_REG:new RegExp(o,"ig"),AMEND:{INFO_SPACE:0,INFO_TIMER:300},ATTR:{IMG:"data-wiz-img",IMG_MASK:"data-wiz-img-mask",IMG_RATE:"data-wiz-img-rate",IMG_EDITING:"data-wiz-img-editing",SPAN:"data-wiz-span",SPAN_USERID:"data-wiz-user-id",SPAN_INSERT:"data-wiz-insert",SPAN_DELETE:"data-wiz-delete",SPAN_PASTE:"data-wiz-paste",SPAN_PASTE_TYPE:"data-wiz-paste-type",SPAN_PASTE_ID:"data-wiz-paste-id",SPAN_TIMESTAMP:"data-wiz-amend-time",TODO_ID:"wiz_todo_id",TODO_CHECK:"data-wiz-check"},CLASS:{BLOCK_SCROLL:"wiz-block-scroll",CODE_CONTAINER:"wiz-code-container",CODE_CONTAINER_PASTE:"wiz-code-container-paste",CODE_CONTAINER_OLD:"prettyprint",CODE_MIRROR:"CodeMirror",CODE_MIRROR_LINE:"CodeMirror-line",CODE_MIRROR_MEASURE:"CodeMirror-measure",CODE_MIRROR_GUTTER:"CodeMirror-gutter-wrapper",CODE_MIRROR_HSCROLL:"CodeMirror-scroll",CODE_TOOLS:"wiz-code-tools",CODE_TOOLS_MODE:"wiz-code-tools-mode",CODE_TOOLS_THEME:"wiz-code-tools-theme",IMG_ATTACHMENT:"wiz-img-attachment",IMG_NOT_DRAG:"wiz-img-cannot-drag",IMG_RESIZE_ACTIVE:"wiz-img-resize-active",IMG_RESIZE_CONTAINER:"wiz-img-resize-container",IMG_RESIZE_HANDLE:"wiz-img-resize-handle",ORDER_LIST_LEVEL:["wiz-list-level3","wiz-list-level1","wiz-list-level2"],SELECTED_CELL:"wiz-selected-cell",SELECTED_CELL_MULTI:"wiz-selected-cell-multi",SELECT_PLUGIN_CONTAINER:"wiz-select-plugin-container",SELECT_PLUGIN_HEADER:"wiz-select-plugin-header",SELECT_PLUGIN_HEADER_TEXT:"wiz-select-plugin-header-text",SELECT_PLUGIN_OPTIONS:"wiz-select-plugin-options",SELECT_PLUGIN_OPTIONS_ITEM:"wiz-select-plugin-options-item",TABLE_CONTAINER:"wiz-table-container",TABLE_TOOLS:"wiz-table-tools",TABLE_BODY:"wiz-table-body",TABLE_MENU_BUTTON:"wiz-table-menu-button",TABLE_MENU_ITEM:"wiz-table-menu-item",TABLE_MENU_SUB:"wiz-table-menu-sub",TABLE_MOVING:"wiz-table-moving",TODO_ACCOUNT:"wiz-todo-account",TODO_AVATAR:"wiz-todo-avatar",TODO_CHECKBOX:"wiz-todo-checkbox",TODO_CHECK_IMG_OLD:"wiz-todo-img",TODO_DATE:"wiz-todo-dt",TODO_LAYER:"wiz-todo-layer",TODO_MAIN:"wiz-todo-main",TODO_LABEL_OLD:"wiz-todo-label",TODO_CHECKED:"wiz-todo-checked",TODO_UNCHECKED:"wiz-todo-unchecked",TODO_CHECKED_OLD:"wiz-todo-label-checked",TODO_UNCHECKED_OLD:"wiz-todo-label-unchecked",TODO_TAIL_OLD:"wiz-todo-tail",TODO_USER_AVATAR:"wiz-todo-avatar-",TODO_USER_INFO:"wiz-todo-completed-info"},CLIENT_EVENT:{WizEditorPaste:"wizEditorPaste",WizEditorClickImg:"wizEditorClickImg",WizReaderClickImg:"wizReaderClickImg",WizMarkdownRender:"wizMarkdownRender",WizEditorTrackEvent:"wizEditorTrackEvent"},COLOR:["#CB3C3C","#0C9460","#FF3399","#FF6005","#8058BD","#009999","#8AA725","#339900","#CC6600","#3BBABA","#D4CA1A","#2389B0","#006699","#FF8300","#2C6ED5","#FF0000","#B07CFF","#CC3399","#EB4847","#3917E6"],CSS:{IMG:{SPAN:{position:"relative",display:"inline-block"},MASK:{position:"absolute",width:"100% !important",height:"100% !important",top:"0",left:"0",opacity:".5",filter:"alpha(opacity=50)",border:"2px solid","box-sizing":"border-box","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box"}},IMG_DELETED:{background:"#fdc6c6 url(data:image/gif;base64,R0lGODlhDwAPAIABAIcUFP///yH5BAEKAAEALAAAAAAPAA8AAAIajI8IybadHjxyhjox1I0zH1mU6JCXCSpmUAAAOw==)","border-color":"#E47070"},IMG_INSERT:{background:"#ccffcc","border-color":"#00AA00"},TODO_LIST:{IMG_WIDTH:40},Z_INDEX:{amendInfo:150,tableBorder:105,tableColRowLine:120,tableRangeDot:110,tableTDBefore:100,tableTools:130,tableToolsArrow:10}},EVENT:{BEFORE_GET_DOCHTML:"BEFORE_GET_DOCHTML",BEFORE_SAVESNAP:"BEFORE_SAVESNAP",AFTER_INSERT_DOM:"AFTER_INSERT_DOM",AFTER_RESTORE_HISTORY:"AFTER_RESTORE_HISTORY",EXEC_COMMEND:"EXEC_COMMEND",ON_DBLCLICK:"ON_DBLCLICK",ON_CLICK:"ON_CLICK",ON_COMPOSITION_START:"ON_COMPOSITION_START",ON_COMPOSITION_END:"ON_COMPOSITION_END",ON_COPY:"ON_COPY",ON_CUT:"ON_CUT",ON_DOM_SUBTREE_MODIFIED:"ON_DOM_SUBTREE_MODIFIED",ON_DRAG_START:"ON_DRAG_START",ON_DRAG_ENTER:"ON_DRAG_ENTER",ON_DROP:"ON_DROP",ON_EXEC_COMMAND:"ON_EXEC_COMMAND",ON_KEY_DOWN:"ON_KEY_DOWN",ON_KEY_UP:"ON_KEY_UP",ON_MOUSE_DOWN:"ON_MOUSE_DOWN",ON_MOUSE_MOVE:"ON_MOUSE_MOVE",ON_MOUSE_OVER:"ON_MOUSE_OVER",ON_MOUSE_UP:"ON_MOUSE_UP",ON_ORIENTATION_CHANGE:"ON_ORIENTATION_CHANGE",ON_PASTE:"ON_PASTE",ON_SCROLL:"ON_SCROLL",ON_SELECT_PLUGIN_CHANGE:"ON_SELECT_PLUGIN_CHANGE",ON_SELECTION_CHANGE:"ON_SELECTION_CHANGE",ON_SELECT_START:"ON_SELECT_START",ON_TOUCH_START:"ON_TOUCH_START",ON_TOUCH_END:"ON_TOUCH_END",UPDATE_RENDER:"UPDATE_RENDER"},HISTORY:{TYPE:{CODE_MIRROR:"CODE_MIRROR",COMMON:"COMMON"}},ID:{AMEND_INFO:"wiz-amend-info",AMEND_INFO_SINGLE:"wiz-amend-info-single",AMEND_INFO_MULTI:"wiz-amend-info-multi",AMEND_INFO_NAME:"wiz-amend-info-name",AMEND_INFO_IMG:"wiz-amend-info-image",AMEND_INFO_CONTENT:"wiz-amend-info-content",AMEND_INFO_TIME:"wiz-amend-info-time",AMEND_INFO_TOOLS:"wiz-amend-info-tools",AMEND_INFO_ACCEPT:"wiz-amend-info-accept",AMEND_INFO_REFUSE:"wiz-amend-info-refuse",AMEND_USER_INFO:"wiz-amend-user",CODE_STYLE:"wiz_code_style",FORMAT_PAINTER_STYLE:"wiz_format_painter_style",IFRAME_FOR_SAVE:"wiz-iframe-for-save",TABLE_RANGE_BORDER:"wiz-table-range-border",TABLE_ROW_LINE:"wiz-table-row-line",TABLE_COL_LINE:"wiz-table-col-line",TODO_STYLE:"wiz_todo_style",TODO_STYLE_OLD:"wiz_todo_style_id",TODO_AVATAR_STYLE:"wiz_todo_style_avatar_",WIZ_DEFAULT_STYLE:"wiz_custom_css"},NAME:{CODE_STYLE:"wiz_code_style",STYLE_FOR_LOAD:"wiz_style_for_load",TMP_STYLE:"wiz_tmp_editor_style",UNSAVE_STYLE:"wiz_unsave_style"},NOTE_TYPE:{COMMON:"common",MARKDOWN:"markdown",MATHJAX:"mathjax"},TAG:{CODE_MIRROR:"wiz_code_mirror",TMP_TAG:"wiz_tmp_tag",TMP_PLUGIN_TAG:"wiz_tmp_plugin_tag",TMP_HIGHLIGHT_TAG:"wiz_tmp_highlight_tag"},TYPE:{IMG_DELETE:"delete",IMG_INSERT:"insert",PASTE:{START:"start",END:"end",CONTENT:"content"},POS:{upLeft:"up-left",downLeft:"down-left",leftUp:"left-up",rightUp:"right-up",upRight:"up-right",downRight:"down-right",leftDown:"left-down",rightDown:"right-down"},TABLE:{COPY:"copy",PASTE:"paste",CLEAR_CELL:"clearCell",MERGE_CELL:"mergeCell",SPLIT_CELL:"splitCell",INSERT_ROW_UP:"insertRowUp",INSERT_ROW_DOWN:"insertRowDown",INSERT_COL_LEFT:"insertColLeft",INSERT_COL_RIGHT:"insertColRight",DELETE_ROW:"deleteRow",DELETE_COL:"deleteCol",SET_CELL_BG:"setCellBg",SET_CELL_ALIGN:"setCellAlign",DISTRIBUTE_COLS:"distributeCols",DELETE_TABLE:"deleteTable"},TODO:"tasklist"}};t.exports=r},{}],17:[function(e,t,n){"use strict";function o(e,t,n){a.load(e,t,n)}function r(e,t,n){var r=0,i=t.length,a=function a(){r<i?o(e,t[r++],a):n&&n()};return a}var i=e("./utils"),a=e("./scriptLoader"),l={getDependencyFiles:function(e,t,n){var o,r,i,a,l,s,c,d=[];for(o=0,r=e[t][n].length;o<r;o++)if(i=e[t][n][o],"css"==t)d.push(e.files[t][i]);else{for(c=[],a=0,l=i.length;a<l;a++)s=i[a],c.push(e.files[t][s]);d.push(c)}return d},loadJs:function(e,t,n){var o=r(e,t,n);o()},loadCss:function(e,t){var n,o;for(n=0,o=t.length;n<o;n++)i.loadSingleCss(e,t[n])}};t.exports=l},{"./scriptLoader":21,"./utils":22}],18:[function(e,t,n){"use strict";var o=e("./const"),r=e("./lang"),i=e("./base64"),a=r.initLang,l={},s="wiznotecmd://",c={options:{document:null,autoFocus:!0,lang:"en",clientType:"",noteType:"common",userInfo:null,usersData:[],userNameEncoder:"",dependencyUrl:"",indexFilesPath:"",indexFilesFullPath:"",maxRedo:100,noAmend:!1,codeNoIDE:!1,table:{colWidth:120,colWidthMin:30,rowHeightMin:33},timeout:{markdown:3e4,mathJax:3e4},callback:{markdown:null,mathJax:null,redo:null},pc:{pluginModified:!1}},init:function(e,t){function n(e,t){if(t){var o;for(o in e)e.hasOwnProperty(o)&&"undefined"!=typeof t[o]&&(/^(table|timeout|callback)$/.test(o)?n(e[o],t[o]):e[o]=t[o])}}n(c.options,t);var o,r,l=c.options.document||window.document;c.doc=l,c.win=c.doc.defaultView,a(c.options.lang),c.client.setType(c.options.clientType);var s,d=c.doc.body.className.split(" ");for(o=d.length-1;o>=0;o--)s=d[o],s&&!/^wiz-/gi.test(s)||d.splice(o,1);c.doc.body.className=d.join(" ");var u=decodeURIComponent(location.pathname),f=u.lastIndexOf("/")+1,m=u.lastIndexOf(".");if(c.options.indexFilesPath=u.substring(f,m)+"_files",c.options.indexFilesFullPath=location.protocol+"//"+u.substr(0,f)+c.options.indexFilesPath+"/","base64"===c.options.userNameEncoder&&(r=c.options.userInfo,r&&r.user_name&&(r.user_name=i.decode(r.user_name)),c.options.userData))for(o=0;o<c.options.usersData.length;o++)r=c.options.usersData[o],r.user_name=i.decode(r.user_name)},win:null,doc:null,readonly:null,dependency:{files:{css:{fonts:"{dependencyUrl}/fonts.css",github2:"{dependencyUrl}/github2.css",wizToc:"{dependencyUrl}/wizToc.css"},cursor:{formatPainter:"{dependencyUrl}/format-painter-wiz.cur"},js:{codemirror:"{dependencyUrl}/codemirror/codemirror.js",cmActiveLine:"{dependencyUrl}/codemirror/addon/selection/active-line.js",cmMatchBrackets:"{dependencyUrl}/codemirror/addon/edit/matchbrackets.js",cmMode:"{dependencyUrl}/codemirror/mode/mode.js",flowchart:"{dependencyUrl}/flowchart.js",jquery:"{dependencyUrl}/jquery-1.11.3.js",mathJax:"{dependencyUrl}/mathjax/MathJax.js?config=TeX-AMS-MML_SVG",prettify:"{dependencyUrl}/prettify.js",raphael:"{dependencyUrl}/raphael.js",sequence:"{dependencyUrl}/sequence-diagram.js",underscore:"{dependencyUrl}/underscore.js"},init:function(){function e(e){var n;for(n in e)e.hasOwnProperty(n)&&(e[n]=e[n].replace("{dependencyUrl}",t))}var t=c.options.dependencyUrl.replace(/\\/g,"/");e(c.dependency.files.css),e(c.dependency.files.cursor),e(c.dependency.files.js)}},css:{fonts:["fonts"],markdown:["github2","wizToc"]},js:{codeMirror:[["codemirror"],["cmActiveLine","cmMatchBrackets","cmMode"]],markdown:[["jquery"],["prettify","raphael","underscore"],["flowchart","sequence"]],mathJax:[["jquery"],["mathJax"]]}},client:{type:{isWeb:function(){return location&&0===location.protocol.indexOf("http")}(),isWin:!1,isMac:!1,isLinux:!1,isIOS:!1,isAndroid:!1,isPad:!1,isPhone:!1},sendCmdToWiznote:function(){},setType:function(e){if(e){if(e=e.toLowerCase(),e.indexOf("windows")>-1)c.client.type.isWin=!0,c.client.sendCmdToWiznote=function(e,t){e==o.CLIENT_EVENT.WizReaderClickImg&&c.win.external.OnClickedImage(t.src,JSON.stringify(t.imgList))};else if(e.indexOf("ios")>-1)c.client.type.isIOS=!0,c.client.sendCmdToWiznote=function(e,t){var n;e==o.CLIENT_EVENT.WizReaderClickImg&&delete t.imgList,n=s+e;var r,i=[];if(t){for(r in t)t.hasOwnProperty(r)&&i.push(r+"="+encodeURIComponent(t[r]));n+="?"+i.join("&")}var a=c.doc.createElement(o.TAG.TMP_TAG),l=c.doc.createElement("iframe");l.setAttribute("src",n),a.style.display="none",a.appendChild(l),c.doc.body.appendChild(a),a.parentNode.removeChild(a),l=null,a=null};else if(e.indexOf("android")>-1)c.client.type.isAndroid=!0,c.client.sendCmdToWiznote=function(e,t){e==o.CLIENT_EVENT.WizReaderClickImg?c.win.WizNote.onClickImg(t.src,t.imgList.join(",")):e==o.CLIENT_EVENT.WizEditorClickImg&&c.win.WizNote.onEditorClickImage(t.src)};else if(e.indexOf("mac")>-1){var t=c.win.navigator.userAgent;/Mac/i.test(t)||(c.client.type.isLinux=!0),c.client.type.isMac=!0,c.client.sendCmdToWiznote=function(e,t){e==o.CLIENT_EVENT.WizReaderClickImg&&c.win.WizExplorerApp.onClickedImage(t.src,JSON.stringify(t.imgList))}}(c.client.type.isIOS||c.client.type.isAndroid)&&(e.indexOf("pad")>-1?c.client.type.isPad=!0:c.client.type.isPhone=!0)}}},event:{add:function(e,t){function n(e,t){if(!e||!t)return!1;var n,o,r=l[e];if(!r||0===r.length)return!1;for(n=0,o=r.length;n<o;n++)if(r[n]===t)return!0;return!1}if(e&&t&&!n(e,t)){var o=l[e];o||(o=[]),o.push(t),l[e]=o}},call:function(e){var t,n,o=[],r=l[e];if(r&&0!==r.length){for(t=1,n=arguments.length;t<n;t++)o.push(arguments[t]);for(t=0,n=r.length;t<n;t++)r[t].apply(this,o)}},remove:function(e,t){if(e&&t){var n,o,r=l[e];if(r&&0!==r.length)for(n=0,o=r.length;n<o;n++)r[n]===t&&r.splice(n,1)}}}};t.exports=c},{"./base64":15,"./const":16,"./lang":20}],19:[function(e,t,n){"use strict";function o(e){var t=null,n=a.doc.querySelector("#"+e);return n&&n.codeMirror&&(t=n.codeMirror),t}function r(){return a.doc.querySelectorAll("."+l.CLASS.CODE_CONTAINER)}function i(){var e,t,n,o=r();for(n=o.length-1;n>=0;n--)e=o[n],t=e.codeMirror,t&&(f[e.id]=t.getDoc().copy(!0))}var a=e("./env"),l=e("./const"),s=e("./utils"),c=e("./../domUtils/domExtend"),d=e("./../rangeUtils/rangeExtend"),u=100,f={},m={enable:!1,callback:null,stack:[],stackIndex:0,init:function(){m.stack=[],m.stackIndex=0},start:function(e,t){e&&e>0&&(u=e),m.enable=!0,m.init(),g.bind(),t&&(m.callback=t)},stop:function(){m.enable=!1,m.init(),g.unbind()},applyCallback:function(){var e;m.callback&&(e=m.getUndoState(),m.callback(e))},getCodeMirrorDoc:function(e){var t=f[e]||null;return t&&(t=t.copy(!0)),t},getUndoState:function(){return{undoCount:m.stack.length,undoIndex:m.stackIndex}},undo:function(){if(!m.enable||m.stackIndex<=0||0===m.stack.length)return void(m.stackIndex=0);m.stackIndex>=m.stack.length&&m.saveSnap(!0);var e=m.stack[--m.stackIndex];e.nextChange.type===l.HISTORY.TYPE.CODE_MIRROR?m.restoreCodeMirror("undo",e):(i(),m.restoreSnap(e.snap)),a.event.call(l.EVENT.AFTER_RESTORE_HISTORY,{type:e.nextChange.type}),m.applyCallback(),e.type===l.HISTORY.TYPE.COMMON&&c.focus()},redo:function(){if(m.enable&&!(m.stackIndex>=m.stack.length-1)){var e=m.stack[++m.stackIndex];e.type===l.HISTORY.TYPE.CODE_MIRROR?m.restoreCodeMirror("redo",e):(i(),m.restoreSnap(e.snap)),a.event.call(l.EVENT.AFTER_RESTORE_HISTORY,{type:e.type}),m.applyCallback(),e.type===l.HISTORY.TYPE.COMMON&&c.focus()}},saveSnap:function(e,t){if(m.enable&&(!l.COMPOSITION_START||t&&t.type!==l.HISTORY.TYPE.COMMON)){a.event.call(l.EVENT.BEFORE_SAVESNAP);var n={type:l.HISTORY.TYPE.COMMON};t&&t.type===l.HISTORY.TYPE.CODE_MIRROR&&(n.type=l.HISTORY.TYPE.CODE_MIRROR,n.cmContainerId=t.cmContainerId);var r,i,s,c,d,f,g,p={nextChange:n};if(d=m.stackIndex>0?m.stack[m.stackIndex-1]:null,d&&d.nextChange.type==l.HISTORY.TYPE.CODE_MIRROR){if(c=d.cmContainerId,s=d.nextChange.cmContainerId,p.type=l.HISTORY.TYPE.CODE_MIRROR,p.cmContainerId=s,i=o(s)){if(m.stackIndex>=0&&m.stack.splice(m.stackIndex,m.stack.length-m.stackIndex),p.nextChange.type===l.HISTORY.TYPE.COMMON&&(p.snap=m.snapshot()),p.cmHistory=i.historySize(),c===s&&d.cmHistory.undo===p.cmHistory.undo&&d.cmHistory.redo===p.cmHistory.redo)return d.nextChange=p.nextChange,p.snap&&(d.snap=p.snap),void(e&&m.stackIndex--);m.stack.push(p),e||m.stackIndex++}}else p.type=l.HISTORY.TYPE.COMMON,r={add:!0,replace:!1,direct:0},f=m.snapshot(),!e&&d&&d.type==l.HISTORY.TYPE.COMMON&&(r=m.canSave(f,d.snap)),(r.add||r.replace)&&(f.direct=r.direct,m.stackIndex>=0&&m.stack.splice(m.stackIndex,m.stack.length-m.stackIndex),r.add?(p.snap=f,m.stack.push(p),e||m.stackIndex++):r.replace&&(g=d.snap,f.focus.startOffset=g.focus.startOffset,d.snap=f));m.stack.length>u&&(m.stack.shift(),m.stackIndex--),m.applyCallback()}},restoreCodeMirror:function(e,t){if(m.enable&&t){var n,r;n="undo"==e?t.nextChange.cmContainerId:t.cmContainerId,r=o(n),r&&("redo"===e?r.redo():r.undo())}},restoreSnap:function(e){if(m.enable&&e){var t,n,o;t=a.doc.getSelection(),a.doc.body.innerHTML=e.content;try{n=c.getFromIndexList(e.focus.start),t.collapse(n.dom,n.offset),e.focus.isCollapsed?d.setRange(n.dom,n.offset,n.dom,n.offset):(o=c.getFromIndexList(e.focus.end),d.setRange(n.dom,n.offset,o.dom,o.offset)),d.caretFocus()}catch(e){}}},canSave:function(e,t){function n(e,t){if(e.isCollapsed!=t.isCollapsed)return 0;if(e.start.length!=t.start.length||e.end.length!=t.end.length)return 0;var n=o(e.start,t.start);return n<1?n:n=o(e.end,t.end)}function o(e,t){
var n,o,r=1;for(n=0,o=e.length-1;n<o;n++)if(e[n]!=t[n]){r=0;break}return r&&e[o]<t[o]&&(r=-1),r}var r={add:!1,replace:!1,direct:0};return(e.content.length!=t.content.length||e.content.localeCompare(t.content))&&(r.direct=n(e.focus,t.focus),0===r.direct||r.direct!==t.direct||!/^\s*$/g.test(e.focus.lastChar+t.focus.lastChar)&&/\s/.test(t.focus.lastChar)||Math.abs(e.focus.startOffset-t.focus.startOffset)>20?r.add=!0:r.replace=!0),r},snapshot:function(){var e=a.doc.getSelection(),t=a.doc.body.innerHTML,n={isCollapsed:!0,start:[],end:[],lastChar:null,startOffset:-1},o={content:t,focus:n};if(0===e.rangeCount)return n.start.push(0),o;var r=e.getRangeAt(0);return n.start=c.getIndexList(r.startContainer),n.start.push(r.startOffset),n.isCollapsed=e.isCollapsed,e.isCollapsed?3===r.startContainer.nodeType&&r.startOffset>0&&(n.lastChar=r.startContainer.nodeValue.charAt(r.startOffset-1),n.startOffset=r.startOffset):(n.end=c.getIndexList(r.endContainer),n.end.push(r.endOffset)),o}},g={bind:function(){g.unbind(),a.event.add(l.EVENT.ON_KEY_DOWN,g.onKeyDown)},unbind:function(){a.event.remove(l.EVENT.ON_KEY_DOWN,g.onKeyDown)},onKeyDown:function(e){var t=e.keyCode||e.which;return e.ctrlKey&&90==t||e.metaKey&&90==t&&!e.shiftKey?(m.undo(),void s.stopEvent(e)):void((e.ctrlKey&&89==t||e.metaKey&&89==t||e.metaKey&&90==t&&e.shiftKey)&&(m.redo(),s.stopEvent(e)))}};t.exports=m},{"./../domUtils/domExtend":27,"./../rangeUtils/rangeExtend":43,"./const":16,"./env":18,"./utils":22}],20:[function(e,t,n){"use strict";function o(e){e||(e="en"),e=e.toLowerCase().replace("_","-"),r[e]?i=e:e="en";var t;for(t in r[e])r[e].hasOwnProperty(t)&&(a[t]=r[e][t])}var r={},i="en",a={};r.en={version:"en",Month:["Jan.","Feb.","Mar.","Apr.","May","June","July","Agu.","Sep.","Oct.","Nov.","Dec."],Amend:{Edit:"Inserted contents",Delete:"Deleted contents",BtnAccept:"Accept",BtnRefuse:"Reject",Accept:"Accept all changes? Or partially select the changes which need to be accepted.",Refuse:"Reject all changes? Or partially select the changes which need to be rejected.",MultiInfo:"Multiple changes are selected",UserNameDefault:"someone"},Table:{Copy:"Copy",Paste:"Paste",ClearCell:"Clear",MergeCell:"Merge Cells",SplitCell:"Unmerge Cells",InsertRowUp:"Add Row Above",InsertRowDown:"Add Row Below",InsertColLeft:"Add Column Before",InsertColRight:"Add Column After",DeleteRow:"Delete Row",DeleteCol:"Delete Column",SetCellBg:"Color Fill",CellAlign:"Arrange",DeleteTable:"Delete Table",DistributeCols:"Average Column Width"},Err:{Copy_Null:"Copy of deleted changes not allowed",Cut_Null:"Cut of deleted changes not allowed"}},r["zh-cn"]={version:"zh-cn",Date:{Year:"年",Month:"月",Day:"日"},Amend:{Edit:"插入了内容",Delete:"删除了内容",BtnAccept:"接受修订",BtnRefuse:"拒绝修订",Accept:"是否确认接受全部修订内容？ 如需接受部分内容请使用鼠标进行选择",Refuse:"是否确认拒绝全部修订内容？ 如需拒绝部分内容请使用鼠标进行选择",MultiInfo:"您选中了多处修订",UserNameDefault:"有人"},Table:{Copy:"复制",Paste:"粘贴",ClearCell:"清空单元格",MergeCell:"合并单元格",SplitCell:"拆分单元格",InsertRowUp:"上插入行",InsertRowDown:"下插入行",InsertColLeft:"左插入列",InsertColRight:"右插入列",DeleteRow:"删除当前行",DeleteCol:"删除当前列",SetCellBg:"单元格底色",CellAlign:"单元格对齐方式",DeleteTable:"删除表格",DistributeCols:"平均分配各列"},Err:{Copy_Null:"无法复制已删除的内容",Cut_Null:"无法剪切已删除的内容"}},r["zh-tw"]={version:"zh-tw",Date:{Year:"年",Month:"月",Day:"日"},Amend:{Edit:"插入了內容",Delete:"刪除了內容",BtnAccept:"接受修訂",BtnRefuse:"拒絕修訂",Accept:"是否確認接受全部修訂內容？ 如需接受部分內容請使用滑鼠進行選擇",Refuse:"是否確認拒絕全部修訂內容？ 如需拒絕部分內容請使用滑鼠進行選擇",MultiInfo:"您選中了多處修訂",UserNameDefault:"有人"},Table:{Copy:"複製",Paste:"粘貼",ClearCell:"清空儲存格",MergeCell:"合併儲存格",SplitCell:"拆分儲存格",InsertRowUp:"上插入行",InsertRowDown:"下插入行",InsertColLeft:"左插入列",InsertColRight:"右插入列",DeleteRow:"刪除當前行",DeleteCol:"刪除當前列",SetCellBg:"儲存格底色",CellAlign:"儲存格對齊方式",DeleteTable:"刪除表格",DistributeCols:"平均分配各列"},Err:{Copy_Null:"無法複製已刪除的內容",Cut_Null:"無法剪切已刪除的內容"}},t.exports.getLang=function(){return a},t.exports.initLang=function(e){o(e)}},{}],21:[function(e,t,n){"use strict";function o(e,t){return l[e]||(l[e]=0),l[e]++,function(){l[e]--,0===l[e]&&(l[e]=null,t&&t())}}function r(e){return"wiz_js_"+e}function i(e){if(e){var t={version:e.version,jsStr:e.jsStr};localStorage.setItem(e.id,JSON.stringify(t))}}var a={appendJsCode:function(e,t,n){var o=e.createElement("script");o.type=n,o.text=t,e.getElementsByTagName("head")[0].appendChild(o)},load:function(e,t,n){if(e&&t){var a,l,s,c,d=(new Date).valueOf(),u=!0;for(a=0,l=t.length;a<l;a++)if("string"==typeof t[a])s=this.loadSingleJs(e,t[a]),s!==!0&&(s.onload=o(d,n),u=!1);else{var f=t[a].link,m=r(t[a].id),g=t[a].version;if(window.localStorage){var p=JSON.parse(localStorage.getItem(m));p&&p.version==g?(s=this.inject(e,p.jsStr,m),s!==!0&&(c=o(d,n),setTimeout(function(){c()},10),u=!1)):(u=!1,c=o(d,n),$.ajax({url:f,context:{id:m,version:g},success:function(t){i({id:this.id,version:this.version,jsStr:t}),s=wizUI.scriptLoader.inject(e,t,this.id),s!==!0&&setTimeout(function(){c()},10)},error:function(){c()}}))}else s=this.loadSingleJs(e,t[a].link),s!==!0&&(s.onload=o(d,n),u=!1)}u&&n()}},loadSingleJs:function(e,t){var n="wiz_"+t;if(e.getElementById(n))return!0;var o=e.createElement("script");return o.type="text/javascript",o.setAttribute("charset","utf-8"),o.src=t.replace(/\\/g,"/"),o.id=n,e.getElementsByTagName("head")[0].insertBefore(o,null),o},inject:function(e,t,n){if(!e||e.getElementById(n))return!0;var o=e.createElement("script");return o.type="text/javascript",o.id=n,o.text=t,e.getElementsByTagName("head")[0].insertBefore(o,null),o}},l={};t.exports=a},{}],22:[function(e,t,n){"use strict";var o=e("./const");try{"abc".localeCompare("abcd")}catch(e){String.prototype.localeCompare=function(e){return this.toString()==e?0:this.toString()>e?1:-1}}var r=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;"wiz".trim||(String.prototype.trim=function(){return this.replace(r,"")});var i=/[\-\[\]{}()*+?.,\\\^$|#\s]/g;try{"abc".escapeRegex("abcd")}catch(e){String.prototype.escapeRegex=function(){return this.toString().replace(i,"\\$&")}}Array.prototype.indexOf||(Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1});var a={checkNonTxtKey:function(e){var t=e.keyCode||e.which;return!(!e.ctrlKey&&!e.metaKey)||!(t>=48&&t<=57||t>=65&&t<=90||t>=96&&t<=107||t>=109&&t<=111||t>=186&&t<=192||t>=219&&t<=222||229==t||0===t||13==t||32==t)},isArray:function(e){return"[object Array]"===Object.prototype.toString.apply(e)},isEmpty:function(e){if(!e)return!0;var t=/\r?\n/gi,n=new RegExp("[\r\n"+o.FILL_CHAR+"]","ig"),r=t.test(e),i=e.replace(n,""),a=0===e.replace(n,"").trim().length;return 0===i.length||r&&a},isSameAmendTime:function(e,t){if(!e||!t)return!1;var n=a.getDateForTimeStr(e),r=a.getDateForTimeStr(t);return Math.abs(n-r)<=o.AMEND_BATCH_TIME_SPACE},checkChar:function(e,t){var n,o,r,i;for(n=0,o=t.length;n<o;n++){if(r=t[n][0],i=t[n].length>1?t[n][1]:null,null===i&&e==r)return!0;if(null!==i&&e>=r&&e<=i)return!0}return!1},compareVersion:function(e,t){e=e.split("."),t=t.split(".");var n,o,r,i;for(n=0,o=e.length;n<o;n++){if(r=parseInt(e[n],10),i=t[n]?parseInt(t[n],10):-1,r<i)return-1;if(r>i)return 1}return e.length<t.length?-1:0},isCJK:function(e){var t=[[12352,12687],[13056,13183],[13312,15661],[19968,40959],[63744,64255],[44032,55215]];return a.checkChar(e,t)},isSpace:function(e){var t=[[9,13],[32],[160]];return a.checkChar(e,t)},isAlpha:function(e){var t=[[48,57],[65,90],[97,122],[192,214],[216,246],[248,256]];return a.checkChar(e,t)},getWordCount:function(e){var t={nWords:0,nChars:0,nCharsWithSpace:0,nNonAsianWords:0,nAsianChars:0};if(!e)return t;var n,o,r,i=!1,l=!1;for(t.nCharsWithSpace=e.length,t.nChars=t.nCharsWithSpace,n=0,o=e.length;n<o;n++)r=e.charCodeAt(n),i=!1,a.isCJK(r)?t.nAsianChars++:a.isSpace(r)?t.nChars--:a.isAlpha(r)&&(i=!0),i&&!l?l=!0:i||(l&&t.nNonAsianWords++,l=!1);return i&&l&&t.nNonAsianWords++,t.nWords=t.nNonAsianWords+t.nAsianChars,t},getEventClientPos:function(e){return{x:e.changedTouches?e.changedTouches[0].clientX:e.clientX,y:e.changedTouches?e.changedTouches[0].clientY:e.clientY}},getHash:function(e){var t,n,o=1315423911;for(t=e.length-1;t>=0;t--)n=e.charCodeAt(t),o^=(o<<5)+n+(o>>2);return 2147483647&o},getTime:function(){function e(e){var t=e.toString();return 1==t.length?"0"+t:t}var t=new Date;return t.getFullYear()+"-"+e(t.getMonth()+1)+"-"+e(t.getDate())+" "+e(t.getHours())+":"+e(t.getMinutes())+":"+e(t.getSeconds())},getDateForTimeStr:function(e){return new Date(Date.parse(e.replace(/-/g,"/")))},listToMap:function(e){if(!e)return{};e=a.isArray(e)?e:e.split(",");var t,n,o,r={};for(t=0,n=e.length;t<n;t++)o=e[t],r[o.toUpperCase()]=r[o]=1;return r},rgb2Hex:function(e){function t(e,t){return e+Math.floor((255-e)*(1-t))}function n(e){var t=e.toString(16);return 1===t.length?"0"+t:t}if(!e)return"";var o=e.replace(/.*\((.*)\)/gi,"$1").split(",");if(o.length<3)return"";var r=parseInt(o[0],10),i=parseInt(o[1],10),a=parseInt(o[2],10),l=4===o.length?parseFloat(o[3]):1;return 0===l?"":"#"+n(t(r,l))+n(t(i,l))+n(t(a,l))},removeDup:function(e){var t,n,o,r=[];for(t=0,n=e.length;t<n;t++)o=e[t],r.indexOf(o)<0&&r.push(o);return r},replaceSpecialChar:function(e){return e=e.replace(new RegExp(String.fromCharCode(160),"g")," ").replace(String.fromCharCode(65279),"")},stopEvent:function(e){e&&(e.stopPropagation(),e.preventDefault())},WizEditorTmpName:"wiz_tmp_editor_style",loadSingleCss:function(e,t){var n="wiz_"+t;if(e.getElementById(n))return!0;var o=e.createElement("link");return o.rel="stylesheet",o.setAttribute("charset","utf-8"),o.setAttribute("name",this.WizEditorTmpName),o.href=t.replace(/\\/g,"/"),e.getElementsByTagName("head")[0].insertBefore(o,null),o},appendCssCode:function(e,t,n){var o=e.createElement("style");o.type=n,o.text=t,o.setAttribute("name",this.WizEditorTmpName),e.getElementsByTagName("head")[0].appendChild(o)},getInnerText:function(e){var t="",n=function(e){return e?e.replace(/ +/gm," ").replace(/[\t]+/gm,"").replace(/[ ]+$/gm,"").replace(/^[ ]+/gm,"").replace(/\n+/gm,"\n").replace(/\n+$/,"").replace(/^\n+/,"").replace(/NEWLINE/gm,"\n"):""},o=function(e){var t=function(e){return!/[^\t\n\r ]/.test(e.nodeValue)},n=[],o=function e(o){for(var r=0;r<o.childNodes.length;r++){var i=o.childNodes[r];3==i.nodeType&&t(i)?n.push(i):i.hasChildNodes()&&e(i)}};o(e);for(var r=0;r<n.length;r++)n[r].parentNode.removeChild(n[r])},r=function(e,t){if(e.style[t])return e.style[t];var n=e.currentStyle||e.ownerDocument.defaultView.getComputedStyle(e,null);return"SCRIPT"==e.tagName?"none":n[t]?"block"==n[t]&&"TD"==e.tagName?"feaux-inline":n[t]:"LI,P,TR".indexOf(e.tagName)>-1?"block":e.style[t]},i="table-row,block,list-item",a=function(e){var t=r(e,"display")||"feaux-inline";return i.indexOf(t)>-1},l=function e(n){if(/pre/.test(r(n,"whiteSpace")))return t+=n.innerHTML.replace(/\t/g," "),"";var o=r(n,"display");if("none"==o)return"";var i=a(n)?"\n":" ";t+=i;for(var l=0;l<n.childNodes.length;l++){var s=n.childNodes[l];3==s.nodeType&&(t+=s.nodeValue),s.childNodes.length&&e(s)}return t+=i},s=e.cloneNode(!0);return s.innerHTML=s.innerHTML.replace(/<br[\/]?>/gi,"NEWLINE"),o(s),n(l(s))},markdownPreProcess:function(e){var t=$(e);t.find(".wiz-table-container").each(function(e){var t=$(this),n=$("<span></span>");n.text(t[0].outerHTML),n.insertAfter(t);var o=$("<br/>");o.insertAfter(t),t.remove()}),t.find("label.wiz-todo-label").each(function(e){var t=$(this),n=$(".wiz-todo-img",this);if(0!==n.length){var o=$("<span></span>");o.text(t[0].outerHTML),o.insertAfter(t),t.remove()}}),t.find(".wiz-todo-layer").each(function(e){var t=$(this),n=$(".wiz-todo-checkbox",this);if(0!==n.length){var o=$("<span></span>");o.text(t[0].outerHTML),o.insertAfter(t),t.remove()}}),t.find("a").each(function(e,t){var n=$(t),o=n.attr("href");if(o&&/^(wiz|wiznote):/.test(o)){var r=$("<span></span>");r.text(n[0].outerHTML),r.insertAfter(n),n.remove()}}),t.find("img").each(function(e){var t=$(this),n=$("<span></span>");n.text(t[0].outerHTML),n.insertAfter(t),t.remove()}),t.find("p").each(function(){var e=$(this);e.replaceWith($("<div>"+this.innerHTML+"</div>"))})}};t.exports=a},{"./const":16}],23:[function(e,t,n){"use strict";var o=e("./env"),r=e("./const"),i=e("../domUtils/domBase"),a={iosPhone:"body {overflow-y:scroll;-webkit-overflow-scrolling: touch;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);}body[contenteditable=true], .wiz-template-editable {padding-bottom: 44px !important;}td,th {position:static;}th:before,td:before,th:after,td:after {display:none;}",iosPad:"body {min-width: 90%;max-width: 100%;min-height: 100%;background: #ffffff;overflow-y:scroll;-webkit-overflow-scrolling: touch;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);}body[contenteditable=true], .wiz-template-editable {padding-bottom: 44px !important;}td,th {position:static;}th:before,td:before,th:after,td:after {display:none;}",imageResize:".wiz-img-resize-handle {position: absolute;z-index: 1000;border: 1px solid black;background-color: white;}.wiz-img-resize-handle {width:5px;height:5px;}.wiz-img-resize-handle.lt {cursor: nw-resize;}.wiz-img-resize-handle.tm {cursor: n-resize;}.wiz-img-resize-handle.rt {cursor: ne-resize;}.wiz-img-resize-handle.lm {cursor: w-resize;}.wiz-img-resize-handle.rm {cursor: e-resize;}.wiz-img-resize-handle.lb {cursor: sw-resize;}.wiz-img-resize-handle.bm {cursor: s-resize;}.wiz-img-resize-handle.rb {cursor: se-resize;}",selectPlugin:".wiz-select-plugin-container {position:relative;display:inline-block;width:160px;height:28px;border-radius:4px;padding:0;margin-left:5px;cursor:pointer;}.wiz-select-plugin-container, .wiz-select-plugin-options {box-sizing:border-box;background:white;border:1px solid #e7e7e7;color:#333;box-shadow: 1px 1px 5px #d0d0d0;}.wiz-select-plugin-options {display:none;}.wiz-select-plugin-header {line-height:28px;font-size:14px;padding: 0 0 0 5px;overflow:hidden;margin-right:27px;white-space:nowrap;}.wiz-select-plugin-header i {position:absolute;top:0;right:0;line-height:26px;padding:0 6px;border-left:1px solid #e7e7e7;box-sizing:border-box;}.wiz-select-plugin-options {background:white;list-style:none;padding:0px;white-space:nowrap;max-height:200px;min-width:160px;max-width:260px;overflow-x:hidden;overflow-y:auto;position:absolute;top:30px;right:-1px;}.wiz-select-plugin-options:hover .wiz-select-plugin-options-item.selected {background:white;color:inherit;}.wiz-select-plugin-options-item {font-size:11px;padding:0 5px;height:20px;line-height:20px;}.wiz-select-plugin-options-item.selected {background:#448aff;color:white;}.wiz-select-plugin-options-item:hover {background:#448aff !important;color:white !important;}.wiz-select-plugin-container.active .wiz-select-plugin-options {display:block;}",table:"."+r.CLASS.TABLE_BODY+"."+r.CLASS.TABLE_MOVING+" *, ."+r.CLASS.TABLE_BODY+"."+r.CLASS.TABLE_MOVING+" *:before, ."+r.CLASS.TABLE_BODY+"."+r.CLASS.TABLE_MOVING+" *:after {cursor:default !important;}td,th {position:relative;}#wiz-table-range-border {display: none;width: 0;height: 0;position: absolute;top: 0;left: 0; z-index:"+r.CSS.Z_INDEX.tableBorder+"}#wiz-table-col-line, #wiz-table-row-line {display: none;background-color: #448aff;position: absolute;z-index:"+r.CSS.Z_INDEX.tableColRowLine+";}#wiz-table-col-line {width: 1px;cursor:col-resize;}#wiz-table-row-line {height: 1px;cursor:row-resize;}#wiz-table-range-border_start, #wiz-table-range-border_range {display: none;width: 0;height: 0;position: absolute;}#wiz-table-range-border_start_top, #wiz-table-range-border_range_top {height: 2px;background-color: #448aff;position: absolute;top: 0;left: 0;}#wiz-table-range-border_range_top {height: 1px;}#wiz-table-range-border_start_right, #wiz-table-range-border_range_right {width: 2px;background-color: #448aff;position: absolute;top: 0;}#wiz-table-range-border_range_right {width: 1px;}#wiz-table-range-border_start_bottom, #wiz-table-range-border_range_bottom {height: 2px;background-color: #448aff;position: absolute;top: 0;}#wiz-table-range-border_range_bottom {height: 1px;}#wiz-table-range-border_start_left, #wiz-table-range-border_range_left {width: 2px;background-color: #448aff;position: absolute;top: 0;left: 0;}#wiz-table-range-border_range_left {width: 1px;}#wiz-table-range-border_start_dot, #wiz-table-range-border_range_dot {width: 5px;height: 5px;border: 2px solid rgb(255, 255, 255);background-color: #448aff;cursor: crosshair;position: absolute;z-index:"+r.CSS.Z_INDEX.tableRangeDot+";}.wiz-table-tools {display: block;background-color:#fff;position: absolute;left: 0px;border: 1px solid #ddd;-webkit-border-radius: 5px;-moz-border-radius: 5px;border-radius: 5px;z-index:"+r.CSS.Z_INDEX.tableTools+';}.wiz-table-tools ul {list-style: none;padding: 0;width:auto;}.wiz-table-tools .wiz-table-menu-item {position: relative;float: left;margin:5px 2px 5px 8px;clear: initial;}.wiz-table-tools .wiz-table-menu-item .wiz-table-menu-button {font-size:15px;width:20px;height:20px;line-height:20px;cursor: pointer;position:relative;}.wiz-table-tools i.editor-icon{font-size: 15px;color: #455a64;}.wiz-table-tools .wiz-table-menu-item .wiz-table-menu-button i#wiz-menu-bg-demo{position: absolute;top:1px;left:0;}.wiz-table-tools .wiz-table-menu-sub {position: absolute;display: none;width: 125px;padding: 5px 0;background: #fff;border-radius: 3px;border: 1px solid #E0E0E0;top:28px;left:-9px;box-shadow: 1px 1px 5px #d0d0d0;}.wiz-table-tools .wiz-table-menu-sub > div{font-size:15px;}.wiz-table-tools .wiz-table-menu-item.active .wiz-table-menu-sub {display: block}.wiz-table-tools .wiz-table-menu-sub:before, .wiz-table-tools .wiz-table-menu-sub:after {position: absolute;content: " ";border-style: solid;border-color: transparent;border-bottom-color: #cccccc;left: 22px;margin-left: -14px;top: -8px;border-width: 0 8px 8px 8px;z-index:'+r.CSS.Z_INDEX.tableToolsArrow+';}.wiz-table-tools .wiz-table-menu-sub:after {border-bottom-color: #ffffff;top: -7px;}.wiz-table-tools .wiz-table-menu-sub-item {padding: 4px 12px;font-size: 14px;}.wiz-table-tools .wiz-table-menu-sub-item.split {border-top: 1px solid #E0E0E0;}.wiz-table-tools .wiz-table-menu-sub-item:hover {background-color: #ececec;}.wiz-table-tools .wiz-table-menu-sub-item.disabled {color: #bbbbbb;cursor: default;}.wiz-table-tools .wiz-table-menu-sub-item.disabled:hover {background-color: transparent;}.wiz-table-tools .wiz-table-menu-item.wiz-table-cell-bg:hover .wiz-table-color-pad {display: block;}.wiz-table-tools .wiz-table-color-pad {display: none;padding: 10px;box-sizing: border-box;width: 85px;height: 88px;background-color: #fff;cursor: default;}.wiz-table-tools .wiz-table-color-pad > div{font-size:15px;}.wiz-table-tools .wiz-table-color-pad .wiz-table-color-pad-item {display: inline-block;width: 15px;height: 15px;margin-right: 9px;position: relative;}.wiz-table-tools .wiz-table-color-pad .wiz-table-color-pad-item i.pad-demo {position: absolute;top:3px;left:0;}.wiz-table-tools .wiz-table-color-pad .wiz-table-color-pad-item .icon-oblique_line{color: #cc0000;}.wiz-table-tools .wiz-table-color-pad .wiz-table-color-pad-item:last-child {margin-right: 0;}.wiz-table-tools .wiz-table-color-pad .wiz-table-color-pad-item.active i.editor-icon.icon-box {color: #448aff;}.wiz-table-tools .wiz-table-cell-align {display: none;padding: 10px;box-sizing: border-box;width: 85px;height: 65px;background-color: #fff;cursor: default;}.wiz-table-tools .wiz-table-cell-align .wiz-table-cell-align-item {display: inline-block;width: 15px;height: 15px;margin-right: 9px;position: relative;}.wiz-table-tools .wiz-table-cell-align .wiz-table-cell-align-item:last-child {margin-right:0}.wiz-table-tools .wiz-table-cell-align .wiz-table-cell-align-item i.valign{position: absolute;top:3px;left:0;color: #d2d2d2;}.wiz-table-tools .wiz-table-cell-align-item.active i.editor-icon.valign {color: #a1c4ff;}.wiz-table-tools .wiz-table-cell-align-item.active i.editor-icon.icon-box,.wiz-table-tools .wiz-table-cell-align-item.active i.editor-icon.align {color: #448aff;}.wiz-table-tools .wiz-table-color-pad .wiz-table-color-pad-item:last-child,.wiz-table-tools .wiz-table-cell-align .wiz-table-cell-align-item:last-child {margin-right: 0;}th.wiz-selected-cell-multi, td.wiz-selected-cell-multi {background: rgba(0,102,255,.05);}th:before,td:before,#wiz-table-col-line:before,#wiz-table-range-border_start_right:before,#wiz-table-range-border_range_right:before{content: " ";position: absolute;top: 0;bottom: 0;right: -5px;width: 9px;cursor: col-resize;background: transparent;z-index:'+r.CSS.Z_INDEX.tableTDBefore+';}th:after,td:after,#wiz-table-row-line:before,#wiz-table-range-border_start_bottom:before,#wiz-table-range-border_range_bottom:before{content: " ";position: absolute;left: 0;right: 0;bottom: -5px;height: 9px;cursor: row-resize;background: transparent;z-index:'+r.CSS.Z_INDEX.tableTDBefore+";}"},l={ios:"img {max-width: 100%;height: auto !important;margin: 0px auto;cursor: pointer;}"},s={body:"html {height:100%;} body {min-height:100%;box-sizing:border-box;word-wrap: break-word !important;}a {word-wrap: break-word;}img::selection {background-color: rgba(0, 0, 255, 0.3);}",blockScroll:".wiz-block-scroll::-webkit-scrollbar {width: 7px;height: 7px;}.wiz-block-scroll::-webkit-scrollbar-thumb {background-color: #7f7f7f;border-radius: 7px;}.wiz-block-scroll::-webkit-scrollbar-button {display: none;}",table:"."+r.CLASS.TABLE_CONTAINER+" {border:0px !important;}."+r.CLASS.TABLE_BODY+" {border:0px !important;position:relative;margin:10px 0;overflow-x:auto;overflow-y:hidden;-webkit-overflow-scrolling:touch;}."+r.CLASS.TABLE_BODY+" table {margin:0;outline:none;}td,th {outline:none;}"},c='Helvetica, "Hiragino Sans GB", "微软雅黑", "Microsoft YaHei UI", SimSun, SimHei, arial, sans-serif;',d={common:"html, body {font-size: 12pt;}body {font-family: "+c+"line-height: 1.6;margin: 0 auto;padding: 20px 16px;padding: 1.25rem 1rem;}h1, h2, h3, h4, h5, h6 {margin:20px 0 10px;margin:1.25rem 0 0.625rem;padding: 0;font-weight: bold;}h1 {font-size:20pt;font-size:1.67rem;}h2 {font-size:18pt;font-size:1.5rem;}h3 {font-size:15pt;font-size:1.25rem;}h4 {font-size:14pt;font-size:1.17rem;}h5 {font-size:12pt;font-size:1rem;}h6 {font-size:12pt;font-size:1rem;color: #777777;margin: 1rem 0;}div, p, ul, ol, dl, li {margin:0;}blockquote, table, pre, code {margin:8px 0;}ul, ol {padding-left:32px;padding-left:2rem;}ol.wiz-list-level1 > li {list-style-type:decimal;}ol.wiz-list-level2 > li {list-style-type:lower-latin;}ol.wiz-list-level3 > li {list-style-type:lower-roman;}blockquote {padding:0 12px;padding:0 0.75rem;}blockquote > :first-child {margin-top:0;}blockquote > :last-child {margin-bottom:0;}img {border:0;max-width:100%;height:auto !important;margin:2px 0;}table {border-collapse:collapse;border:1px solid #bbbbbb;}td, th {padding:4px 8px;border-collapse:collapse;border:1px solid #bbbbbb;min-height:28px;word-break:break-all;box-sizing: border-box;}.wiz-hide {display:none !important;}"},u={insertDefaultStyle:function(e,t){if(u.replaceStyleById(r.ID.WIZ_DEFAULT_STYLE,d.common,e),t){var n,o,i=!1;if("string"==typeof t)n=t,i=!0;else{n="html, body{";for(o in t)t.hasOwnProperty(o)&&(n+="font-family"===o.toLowerCase()?o+":"+t[o]+","+c+";":o+":"+t[o]+";",i=!0);n+="}"}i&&u.insertStyle({name:r.NAME.TMP_STYLE},n)}},insertCustomStyle:function(e,t,n){if(e&&t){var o={id:e};n&&(o.name=r.NAME.TMP_STYLE),u.insertStyle(o,t)}},insertStyle:function(e,t){var n=o.doc.createElement("style");return e.name&&n.setAttribute("name",e.name),e.id&&(n.setAttribute("id",e.id),u.removeStyleById(e.id)),o.doc.getElementsByTagName("HEAD")[0].insertBefore(n,null),n.innerHTML=t,n},insertTmpEditorStyle:function(){u.insertStyle({name:r.NAME.TMP_STYLE},s.body+s.table+a.imageResize+a.selectPlugin+a.table),o.client.type.isIOS&&o.client.type.isPhone?u.insertStyle({name:r.NAME.TMP_STYLE},a.iosPhone):o.client.type.isIOS&&o.client.type.isPad&&u.insertStyle({name:r.NAME.TMP_STYLE},a.iosPad),o.client.type.isMac&&u.insertStyle({name:r.NAME.TMP_STYLE},s.blockScroll)},insertTmpReaderStyle:function(){u.insertStyle({name:r.NAME.TMP_STYLE},s.body+s.table+s.code+l.code),o.client.type.isIOS&&u.insertStyle({name:r.NAME.TMP_STYLE},l.ios),o.client.type.isMac&&u.insertStyle({name:r.NAME.TMP_STYLE},s.blockScroll)},removeFormat:function(e,t,n){function a(e){return!!e&&1===e.nodeType&&(i.isTag(e,[r.TAG.TMP_TAG,r.TAG.TMP_PLUGIN_TAG])||e.getAttribute("name")===r.NAME.TMP_STYLE||/^wiz[_-]/i.test(e.id)||/(^| )wiz[_-]/i.test(e.className))}function l(e){if(e&&!i.hasClass(e,r.CLASS.CODE_CONTAINER)){a(e)||(e.removeAttribute("style"),e.style.cssText&&(e.style.cssText=""));var t=e.children;if(t)for(var n=0;n<t.length;n++)1===t[n].nodeType&&l(t[n])}}function s(e){if(e&&!i.hasClass(e,r.CLASS.CODE_CONTAINER)){a(e)||i.attr(e,{class:null});var t=e.children;if(t)for(var n=0;n<t.length;n++)1===t[n].nodeType&&s(t[n])}}var c,d,u,f,m,g;try{if(e&&o.doc.execCommand("SelectAll"),t&&o.doc.execCommand("RemoveFormat"),e&&(d=o.doc.documentElement,d&&n&&(s(d),l(d))),n){for(u=o.doc.getElementsByTagName("link"),c=u.length-1;c>=0;c--)f=u[c],"stylesheet"!==f.getAttribute("rel")||a(f)||f.remove();for(m=o.doc.getElementsByTagName("style"),c=m.length-1;c>=0;c--)g=m[c],a(g)||g.remove()}}catch(e){return void console.error(e)}},removeStyleById:function(e){var t=o.doc.getElementById(e);t&&i.isTag(t,["style","link"])&&i.remove(t)},removeStyleByName:function(e){var t,n,r=o.doc.getElementsByName(e);for(t=r.length-1;t>=0;t--)n=r[t],n&&i.isTag(n,["style","link"])&&i.remove(n)},replaceStyleById:function(e,t,n){n=!!n;var r=o.doc.getElementById(e);r||n||(r=o.doc.createElement("style"),r.id=e,o.doc.getElementsByTagName("HEAD")[0].insertBefore(r,null)),r&&(r.innerHTML=t)}};t.exports=u},{"../domUtils/domBase":26,"./const":16,"./env":18}],24:[function(e,t,n){"use strict";var o=e("../common/env"),r={ClickAcceptFromAmendInfo:"ClickAcceptFromAmendInfo",ClickRefuseFromAmendInfo:"ClickRefuseFromAmendInfo"},i={save:function(e){if(o.client.type.isWin)try{external&&external.LogAction&&external.LogAction(e)}catch(e){console.error(e.toString())}}},a={ActionId:r,save:i.save};t.exports=a},{"../common/env":18}],25:[function(e,t,n){"use strict";!function e(t,n,o){function r(a,l){if(!n[a]){if(!t[a]){var s="function"==typeof _require&&_require;if(!l&&s)return s(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[a]={exports:{}};t[a][0].call(d.exports,function(e){var n=t[a][1][e];return r(n?n:e)},d,d.exports,e,t,n,o)}return n[a].exports}for(var i="function"==typeof _require&&_require,a=0;a<o.length;a++)r(o[a]);return r}({1:[function(e,t,n){function o(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","loop","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],sup:[],strong:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","loop","preload","src","height","width"]}}function r(e,t,n){}function i(e,t,n){}function a(e,t,n){}function l(e,t,n){}function s(e){return e.replace(N,"&lt;").replace(O,"&gt;")}function c(e,t,n,o){if(n=p(n),"href"===t||"src"===t){if(n=S.trim(n),"#"===n)return"#";if("http://"!==n.substr(0,7)&&"https://"!==n.substr(0,8)&&"mailto:"!==n.substr(0,7)&&"#"!==n[0]&&"/"!==n[0])return""}else if("background"===t){if(w.lastIndex=0,w.test(n))return""}else if("style"===t){if(I.lastIndex=0,I.test(n))return"";if(M.lastIndex=0,M.test(n)&&(w.lastIndex=0,w.test(n)))return"";o!==!1&&(o=o||A,n=o.process(n))}return n=h(n)}function d(e){return e.replace(_,"&quot;")}function u(e){return e.replace(D,'"')}function f(e){return e.replace(x,function(e,t){return"x"===t[0]||"X"===t[0]?String.fromCharCode(parseInt(t.substr(1),16)):String.fromCharCode(parseInt(t,10))})}function m(e){return e.replace(L,":").replace(R," ")}function g(e){for(var t="",n=0,o=e.length;n<o;n++)t+=e.charCodeAt(n)<32?" ":e.charAt(n);return S.trim(t)}function p(e){return e=u(e),e=f(e),e=m(e),e=g(e)}function h(e){return e=d(e),e=s(e)}function E(){return""}function C(e,t){function n(t){return!!o||S.indexOf(e,t)!==-1}"function"!=typeof t&&(t=function(){});var o=!Array.isArray(e),r=[],i=!1;return{onIgnoreTag:function(e,o,a){if(n(e)){if(a.isClosing){var l="[/removed]",s=a.position+l.length;return r.push([i!==!1?i:a.position,s]),i=!1,l}return i||(i=a.position),"[removed]"}return t(e,o,a)},remove:function(e){var t="",n=0;return S.forEach(r,function(o){t+=e.slice(n,o[0]),n=o[1]}),t+=e.slice(n)}}}function T(e){return e.replace(k,"")}function b(e){var t=e.split("");return t=t.filter(function(e){var t=e.charCodeAt(0);return 127!==t&&(!(t<=31)||(10===t||13===t))}),t.join("")}var v=e("cssfilter").FilterCSS,y=e("cssfilter").getDefaultWhiteList,S=e("./util"),A=new v,N=/</g,O=/>/g,_=/"/g,D=/&quot;/g,x=/&#([a-zA-Z0-9]*);?/gim,L=/&colon;?/gim,R=/&newline;?/gim,w=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,I=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,M=/u\s*r\s*l\s*\(.*/gi,k=/<!--[\s\S]*?-->/g;n.whiteList=o(),n.getDefaultWhiteList=o,n.onTag=r,n.onIgnoreTag=i,n.onTagAttr=a,n.onIgnoreTagAttr=l,n.safeAttrValue=c,n.escapeHtml=s,n.escapeQuote=d,n.unescapeQuote=u,n.escapeHtmlEntities=f,n.escapeDangerHtml5Entities=m,n.clearNonPrintableCharacter=g,n.friendlyAttrValue=p,n.escapeAttrValue=h,n.onIgnoreTagStripAll=E,n.StripTagBody=C,n.stripCommentTag=T,n.stripBlankChar=b,n.cssFilter=A,n.getDefaultCSSWhiteList=y},{"./util":4,cssfilter:8}],2:[function(e,t,n){function o(e,t){var n=new a(t);return n.process(e)}var r=e("./default"),i=e("./parser"),a=e("./xss");n=t.exports=o,n.FilterXSS=a;for(var l in r)n[l]=r[l];for(var l in i)n[l]=i[l];"undefined"!=typeof window&&(window.filterXSS=t.exports)},{"./default":1,"./parser":3,"./xss":5}],3:[function(e,t,n){function o(e){var t=e.indexOf(" ");if(t===-1)var n=e.slice(1,-1);else var n=e.slice(1,t+1);return n=u.trim(n).toLowerCase(),"/"===n.slice(0,1)&&(n=n.slice(1)),"/"===n.slice(-1)&&(n=n.slice(0,-1)),n}function r(e){return"</"===e.slice(0,2)}function i(e,t,n){"user strict";var i="",a=0,l=!1,s=!1,c=0,d=e.length,u="",f="";for(c=0;c<d;c++){var m=e.charAt(c);if(l===!1){if("<"===m){l=c;continue}}else if(s===!1){if("<"===m){i+=n(e.slice(a,c)),l=c,a=c;continue}if(">"===m){i+=n(e.slice(a,l)),u=e.slice(l,c+1),f=o(u),i+=t(l,i.length,f,u,r(u)),a=c+1,l=!1;continue}if(('"'===m||"'"===m)&&"="===e.charAt(c-1)){s=m;continue}}else if(m===s){s=!1;continue}}return a<e.length&&(i+=n(e.substr(a))),i}function a(e,t){"user strict";function n(e,n){if(e=u.trim(e),e=e.replace(f,"").toLowerCase(),!(e.length<1)){var o=t(e,n||"");o&&r.push(o)}}for(var o=0,r=[],i=!1,a=e.length,c=0;c<a;c++){var m,g,p=e.charAt(c);if(i!==!1||"="!==p)if(i===!1||c!==o||'"'!==p&&"'"!==p||"="!==e.charAt(c-1))if(/\s|\n|\t/.test(p)){if(i===!1){if(g=l(e,c),g===-1){m=u.trim(e.slice(o,c)),n(m),i=!1,o=c+1;continue}c=g-1;continue}if(g=s(e,c-1),g===-1){m=u.trim(e.slice(o,c)),m=d(m),n(i,m),i=!1,o=c+1;continue}}else;else{if(g=e.indexOf(p,c+1),g===-1)break;m=u.trim(e.slice(o+1,g)),n(i,m),i=!1,c=g,o=c+1}else i=e.slice(o,c),o=c+1}return o<e.length&&(i===!1?n(e.slice(o)):n(i,d(u.trim(e.slice(o))))),u.trim(r.join(" "))}function l(e,t){for(;t<e.length;t++){var n=e[t];if(" "!==n)return"="===n?t:-1}}function s(e,t){for(;t>0;t--){var n=e[t];if(" "!==n)return"="===n?t:-1}}function c(e){return'"'===e[0]&&'"'===e[e.length-1]||"'"===e[0]&&"'"===e[e.length-1]}function d(e){return c(e)?e.substr(1,e.length-2):e}var u=e("./util"),f=/[^a-zA-Z0-9_:\.\-]/gim;n.parseTag=i,n.parseAttr=a},{"./util":4}],4:[function(e,t,n){t.exports={indexOf:function(e,t){
var n,o;if(Array.prototype.indexOf)return e.indexOf(t);for(n=0,o=e.length;n<o;n++)if(e[n]===t)return n;return-1},forEach:function(e,t,n){var o,r;if(Array.prototype.forEach)return e.forEach(t,n);for(o=0,r=e.length;o<r;o++)t.call(n,e[o],o,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")}}},{}],5:[function(e,t,n){function o(e){return void 0===e||null===e}function r(e){var t=e.indexOf(" ");if(t===-1)return{html:"",closing:"/"===e[e.length-2]};e=f.trim(e.slice(t+1,-1));var n="/"===e[e.length-1];return n&&(e=f.trim(e.slice(0,-1))),{html:e,closing:n}}function i(e){var t={};for(var n in e)t[n]=e[n];return t}function a(e){e=i(e||{}),e.stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=s.onIgnoreTagStripAll),e.whiteList=e.whiteList||s.whiteList,e.onTag=e.onTag||s.onTag,e.onTagAttr=e.onTagAttr||s.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||s.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||s.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||s.safeAttrValue,e.escapeHtml=e.escapeHtml||s.escapeHtml,this.options=e,e.css===!1?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new l(e.css))}var l=e("cssfilter").FilterCSS,s=e("./default"),c=e("./parser"),d=c.parseTag,u=c.parseAttr,f=e("./util");a.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,n=t.options,i=n.whiteList,a=n.onTag,l=n.onIgnoreTag,c=n.onTagAttr,m=n.onIgnoreTagAttr,g=n.safeAttrValue,p=n.escapeHtml,h=t.cssFilter;n.stripBlankChar&&(e=s.stripBlankChar(e)),n.allowCommentTag||(e=s.stripCommentTag(e));var E=!1;if(n.stripIgnoreTagBody){var E=s.StripTagBody(n.stripIgnoreTagBody,l);l=E.onIgnoreTag}var C=d(e,function(e,t,n,s,d){var E={sourcePosition:e,position:t,isClosing:d,isWhite:n in i},C=a(n,s,E);if(!o(C))return C;if(E.isWhite){if(E.isClosing)return"</"+n+">";var T=r(s),b=i[n],v=u(T.html,function(e,t){var r=f.indexOf(b,e)!==-1,i=c(n,e,t,r);if(!o(i))return i;if(r)return t=g(n,e,t,h),t?e+'="'+t+'"':e;var i=m(n,e,t,r);return o(i)?void 0:i}),s="<"+n;return v&&(s+=" "+v),T.closing&&(s+=" /"),s+=">"}var C=l(n,s,E);return o(C)?p(s):C},p);return E&&(C=E.remove(C)),C},t.exports=a},{"./default":1,"./parser":3,"./util":4,cssfilter:8}],6:[function(e,t,n){function o(e){return void 0===e||null===e}function r(e){var t={};for(var n in e)t[n]=e[n];return t}function i(e){e=r(e||{}),e.whiteList=e.whiteList||a.whiteList,e.onAttr=e.onAttr||a.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||a.onIgnoreAttr,this.options=e}var a=e("./default"),l=e("./parser");e("./util");i.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,n=t.options,r=n.whiteList,i=n.onAttr,a=n.onIgnoreAttr,s=l(e,function(e,t,n,l,s){var c=r[n],d=!1;c===!0?d=c:"function"==typeof c?d=c(l):c instanceof RegExp&&(d=c.test(l)),d!==!0&&(d=!1);var u={position:t,sourcePosition:e,source:s,isWhite:d};if(d){var f=i(n,l,u);return o(f)?n+":"+l:f}var f=a(n,l,u);if(!o(f))return f});return s},t.exports=i},{"./default":7,"./parser":9,"./util":10}],7:[function(e,t,n){function o(){var e={};return e["align-content"]=!1,e["align-items"]=!1,e["align-self"]=!1,e["alignment-adjust"]=!1,e["alignment-baseline"]=!1,e.all=!1,e["anchor-point"]=!1,e.animation=!1,e["animation-delay"]=!1,e["animation-direction"]=!1,e["animation-duration"]=!1,e["animation-fill-mode"]=!1,e["animation-iteration-count"]=!1,e["animation-name"]=!1,e["animation-play-state"]=!1,e["animation-timing-function"]=!1,e.azimuth=!1,e["backface-visibility"]=!1,e.background=!0,e["background-attachment"]=!0,e["background-clip"]=!0,e["background-color"]=!0,e["background-image"]=!0,e["background-origin"]=!0,e["background-position"]=!0,e["background-repeat"]=!0,e["background-size"]=!0,e["baseline-shift"]=!1,e.binding=!1,e.bleed=!1,e["bookmark-label"]=!1,e["bookmark-level"]=!1,e["bookmark-state"]=!1,e.border=!0,e["border-bottom"]=!0,e["border-bottom-color"]=!0,e["border-bottom-left-radius"]=!0,e["border-bottom-right-radius"]=!0,e["border-bottom-style"]=!0,e["border-bottom-width"]=!0,e["border-collapse"]=!0,e["border-color"]=!0,e["border-image"]=!0,e["border-image-outset"]=!0,e["border-image-repeat"]=!0,e["border-image-slice"]=!0,e["border-image-source"]=!0,e["border-image-width"]=!0,e["border-left"]=!0,e["border-left-color"]=!0,e["border-left-style"]=!0,e["border-left-width"]=!0,e["border-radius"]=!0,e["border-right"]=!0,e["border-right-color"]=!0,e["border-right-style"]=!0,e["border-right-width"]=!0,e["border-spacing"]=!0,e["border-style"]=!0,e["border-top"]=!0,e["border-top-color"]=!0,e["border-top-left-radius"]=!0,e["border-top-right-radius"]=!0,e["border-top-style"]=!0,e["border-top-width"]=!0,e["border-width"]=!0,e.bottom=!1,e["box-decoration-break"]=!0,e["box-shadow"]=!0,e["box-sizing"]=!0,e["box-snap"]=!0,e["box-suppress"]=!0,e["break-after"]=!0,e["break-before"]=!0,e["break-inside"]=!0,e["caption-side"]=!1,e.chains=!1,e.clear=!0,e.clip=!1,e["clip-path"]=!1,e["clip-rule"]=!1,e.color=!0,e["color-interpolation-filters"]=!0,e["column-count"]=!1,e["column-fill"]=!1,e["column-gap"]=!1,e["column-rule"]=!1,e["column-rule-color"]=!1,e["column-rule-style"]=!1,e["column-rule-width"]=!1,e["column-span"]=!1,e["column-width"]=!1,e.columns=!1,e.contain=!1,e.content=!1,e["counter-increment"]=!1,e["counter-reset"]=!1,e["counter-set"]=!1,e.crop=!1,e.cue=!1,e["cue-after"]=!1,e["cue-before"]=!1,e.cursor=!1,e.direction=!1,e.display=!0,e["display-inside"]=!0,e["display-list"]=!0,e["display-outside"]=!0,e["dominant-baseline"]=!1,e.elevation=!1,e["empty-cells"]=!1,e.filter=!1,e.flex=!1,e["flex-basis"]=!1,e["flex-direction"]=!1,e["flex-flow"]=!1,e["flex-grow"]=!1,e["flex-shrink"]=!1,e["flex-wrap"]=!1,e.float=!1,e["float-offset"]=!1,e["flood-color"]=!1,e["flood-opacity"]=!1,e["flow-from"]=!1,e["flow-into"]=!1,e.font=!0,e["font-family"]=!0,e["font-feature-settings"]=!0,e["font-kerning"]=!0,e["font-language-override"]=!0,e["font-size"]=!0,e["font-size-adjust"]=!0,e["font-stretch"]=!0,e["font-style"]=!0,e["font-synthesis"]=!0,e["font-variant"]=!0,e["font-variant-alternates"]=!0,e["font-variant-caps"]=!0,e["font-variant-east-asian"]=!0,e["font-variant-ligatures"]=!0,e["font-variant-numeric"]=!0,e["font-variant-position"]=!0,e["font-weight"]=!0,e.grid=!1,e["grid-area"]=!1,e["grid-auto-columns"]=!1,e["grid-auto-flow"]=!1,e["grid-auto-rows"]=!1,e["grid-column"]=!1,e["grid-column-end"]=!1,e["grid-column-start"]=!1,e["grid-row"]=!1,e["grid-row-end"]=!1,e["grid-row-start"]=!1,e["grid-template"]=!1,e["grid-template-areas"]=!1,e["grid-template-columns"]=!1,e["grid-template-rows"]=!1,e["hanging-punctuation"]=!1,e.height=!0,e.hyphens=!1,e.icon=!1,e["image-orientation"]=!1,e["image-resolution"]=!1,e["ime-mode"]=!1,e["initial-letters"]=!1,e["inline-box-align"]=!1,e["justify-content"]=!1,e["justify-items"]=!1,e["justify-self"]=!1,e.left=!1,e["letter-spacing"]=!0,e["lighting-color"]=!0,e["line-box-contain"]=!1,e["line-break"]=!1,e["line-grid"]=!1,e["line-height"]=!1,e["line-snap"]=!1,e["line-stacking"]=!1,e["line-stacking-ruby"]=!1,e["line-stacking-shift"]=!1,e["line-stacking-strategy"]=!1,e["list-style"]=!0,e["list-style-image"]=!0,e["list-style-position"]=!0,e["list-style-type"]=!0,e.margin=!0,e["margin-bottom"]=!0,e["margin-left"]=!0,e["margin-right"]=!0,e["margin-top"]=!0,e["marker-offset"]=!1,e["marker-side"]=!1,e.marks=!1,e.mask=!1,e["mask-box"]=!1,e["mask-box-outset"]=!1,e["mask-box-repeat"]=!1,e["mask-box-slice"]=!1,e["mask-box-source"]=!1,e["mask-box-width"]=!1,e["mask-clip"]=!1,e["mask-image"]=!1,e["mask-origin"]=!1,e["mask-position"]=!1,e["mask-repeat"]=!1,e["mask-size"]=!1,e["mask-source-type"]=!1,e["mask-type"]=!1,e["max-height"]=!0,e["max-lines"]=!1,e["max-width"]=!0,e["min-height"]=!0,e["min-width"]=!0,e["move-to"]=!1,e["nav-down"]=!1,e["nav-index"]=!1,e["nav-left"]=!1,e["nav-right"]=!1,e["nav-up"]=!1,e["object-fit"]=!1,e["object-position"]=!1,e.opacity=!1,e.order=!1,e.orphans=!1,e.outline=!1,e["outline-color"]=!1,e["outline-offset"]=!1,e["outline-style"]=!1,e["outline-width"]=!1,e.overflow=!1,e["overflow-wrap"]=!1,e["overflow-x"]=!1,e["overflow-y"]=!1,e.padding=!0,e["padding-bottom"]=!0,e["padding-left"]=!0,e["padding-right"]=!0,e["padding-top"]=!0,e.page=!1,e["page-break-after"]=!1,e["page-break-before"]=!1,e["page-break-inside"]=!1,e["page-policy"]=!1,e.pause=!1,e["pause-after"]=!1,e["pause-before"]=!1,e.perspective=!1,e["perspective-origin"]=!1,e.pitch=!1,e["pitch-range"]=!1,e["play-during"]=!1,e.position=!1,e["presentation-level"]=!1,e.quotes=!1,e["region-fragment"]=!1,e.resize=!1,e.rest=!1,e["rest-after"]=!1,e["rest-before"]=!1,e.richness=!1,e.right=!1,e.rotation=!1,e["rotation-point"]=!1,e["ruby-align"]=!1,e["ruby-merge"]=!1,e["ruby-position"]=!1,e["shape-image-threshold"]=!1,e["shape-outside"]=!1,e["shape-margin"]=!1,e.size=!1,e.speak=!1,e["speak-as"]=!1,e["speak-header"]=!1,e["speak-numeral"]=!1,e["speak-punctuation"]=!1,e["speech-rate"]=!1,e.stress=!1,e["string-set"]=!1,e["tab-size"]=!1,e["table-layout"]=!1,e["text-align"]=!0,e["text-align-last"]=!0,e["text-combine-upright"]=!0,e["text-decoration"]=!0,e["text-decoration-color"]=!0,e["text-decoration-line"]=!0,e["text-decoration-skip"]=!0,e["text-decoration-style"]=!0,e["text-emphasis"]=!0,e["text-emphasis-color"]=!0,e["text-emphasis-position"]=!0,e["text-emphasis-style"]=!0,e["text-height"]=!0,e["text-indent"]=!0,e["text-justify"]=!0,e["text-orientation"]=!0,e["text-overflow"]=!0,e["text-shadow"]=!0,e["text-space-collapse"]=!0,e["text-transform"]=!0,e["text-underline-position"]=!0,e["text-wrap"]=!0,e.top=!1,e.transform=!1,e["transform-origin"]=!1,e["transform-style"]=!1,e.transition=!1,e["transition-delay"]=!1,e["transition-duration"]=!1,e["transition-property"]=!1,e["transition-timing-function"]=!1,e["unicode-bidi"]=!1,e["vertical-align"]=!1,e.visibility=!1,e["voice-balance"]=!1,e["voice-duration"]=!1,e["voice-family"]=!1,e["voice-pitch"]=!1,e["voice-range"]=!1,e["voice-rate"]=!1,e["voice-stress"]=!1,e["voice-volume"]=!1,e.volume=!1,e["white-space"]=!1,e.widows=!1,e.width=!0,e["will-change"]=!1,e["word-break"]=!0,e["word-spacing"]=!0,e["word-wrap"]=!0,e["wrap-flow"]=!1,e["wrap-through"]=!1,e["writing-mode"]=!1,e["z-index"]=!1,e}function r(e,t,n){}function i(e,t,n){}n.whiteList=o(),n.getDefaultWhiteList=o,n.onAttr=r,n.onIgnoreAttr=i},{}],8:[function(e,t,n){function o(e,t){var n=new i(t);return n.process(e)}var r=e("./default"),i=e("./css");n=t.exports=o,n.FilterCSS=i;for(var a in r)n[a]=r[a];"undefined"!=typeof window&&(window.filterCSS=t.exports)},{"./css":6,"./default":7}],9:[function(e,t,n){function o(e,t){function n(){if(!i){var n=r.trim(e.slice(a,l)),o=n.indexOf(":");if(o!==-1){var c=r.trim(n.slice(0,o)),d=r.trim(n.slice(o+1));if(c){var u=t(a,s.length,c,d,n);u&&(s+=u+"; ")}}}a=l+1}e=r.trimRight(e),";"!==e[e.length-1]&&(e+=";");for(var o=e.length,i=!1,a=0,l=0,s="";l<o;l++){var c=e[l];if("/"===c&&"*"===e[l+1]){var d=e.indexOf("*/",l+2);if(d===-1)break;l=d+1,a=l+1,i=!1}else"("===c?i=!0:")"===c?i=!1:";"===c?i||n():"\n"===c&&n()}return r.trim(s)}var r=e("./util");t.exports=o},{"./util":10}],10:[function(e,t,n){t.exports={indexOf:function(e,t){var n,o;if(Array.prototype.indexOf)return e.indexOf(t);for(n=0,o=e.length;n<o;n++)if(e[n]===t)return n;return-1},forEach:function(e,t,n){var o,r;if(Array.prototype.forEach)return e.forEach(t,n);for(o=0,r=e.length;o<r;o++)t.call(n,e[o],o,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")}}},{}]},{},[2]),t.exports=filterXSS},{}],26:[function(e,t,n){"use strict";var o=e("./../common/env"),r=e("./../common/const"),i=e("./../common/utils"),a=12,l={pt2px:function e(){var e,t=document.createElement("span");return t.style.visibility="hidden",t.style.position="absolute",t.style.top=0,t.style.left=0,t.style.fontSize=a+"pt",o.doc.body.appendChild(t),e=window.getComputedStyle(t).fontSize,e=parseInt(e,10)/a,o.doc.body.removeChild(t),l.pt2px=function(){return e},e},getRootSizeRate:function(){if(!o.doc.getElementById(r.ID.WIZ_DEFAULT_STYLE))return 1;var e=o.win.getComputedStyle(o.doc.body.parentNode),t=parseFloat(e.fontSize);return parseFloat(t)/l.pt2px()/a},addClass:function(e,t){if(e){e.nodeType&&(e=[e]);var n,o;for(n=e.length-1;n>=0;n--)o=e[n],1!==o.nodeType||l.hasClass(o,t)||(o.className=(o.className+" "+t).trim())}},appendStyle:function(e,t){if(e){var n,o,r,i=e.split(";");for(n=0,o=i.length;n<o;n++)i[n].indexOf(":")>0&&(r=i[n].split(":"),t[r[0].trim()]=r[1].trim())}},attr:function(e,t){var n,o;if(e&&t&&1===e.nodeType)for(n in t)t.hasOwnProperty(n)&&"string"==typeof n&&(o=t[n],o?e.setAttribute(n,o):e.removeAttribute(n))},canEdit:function(e){var t=["script","style"];return e&&(1==e.nodeType||3==e.nodeType)&&(l.isTag(e,"br")||!l.isEmptyDom(e))&&!l.getParentByTagName(e,r.TAG.TMP_TAG,!0,null)&&!(1===e.nodeType&&l.isTag(e,t)||3===e.nodeType&&e.parentNode&&l.isTag(e.parentNode,t))},childNodesFilter:function(e){if(e&&1===e.nodeType){var t,n;for(t=e.childNodes.length-1;t>=0;t--)n=e.childNodes[t],1==n.nodeType?(/link|style|script|meta/gi.test(n.nodeName)&&e.removeChild(n),l.childNodesFilter(n)):3!=n.nodeType&&e.removeChild(n)}},clearStyle:function(e,t,n){function o(e,n){e.style[t]="",l.isTag(e,"font")&&"color"===n&&e.removeAttribute("color")}if(o(e,t),!n)for(;e&&!l.isBlock(e);)o(e,t),e=e.parentNode},clearStyleFromHtml:function(e,t){var n,o=/(<[^<>]* style=(['"]))((\r?\n|(?!(\2|[<>])).)*)/gi;t=t?t:[];var r,i;for(n=0;n<t.length;n++)r=t[n],i=r.indexOf("*"),t[n]=i>=0?r.substr(0,i).escapeRegex():r.escapeRegex()+"$";var a=t.length>0?new RegExp("^("+t.join("|")+")","i"):null;return e=e.replace(o,function(e,t,n,o){var r,i,s,c,d,u,f=[t],m=!0,g=o.split(";");for(d=0,u=g.length;d<u;d++){if(r=g[d],i=r.indexOf(":"),s="",c="",i>-1)s=r.substr(0,i).trim(),c=r.substr(i+1).trim();else if(!m&&r){f.push(r,";");continue}s&&a&&a.test(s)?(/^font-size$/i.test(s)&&(c=l.getFontSizeRem(c,{useRootSize:!0})),!c||/^(inherit|initial|transparent)$/i.test(c)?m=!1:(f.push(s,":",c,";"),m=!1)):m=!0}return f.join("")})},clone:function(e,t){var n,r,i,a,s,c,d;if(!e)return null;if(t)if(3===e.nodeType)n=o.doc.createTextNode("");else{for(n=o.doc.createElement(e.tagName),i=e.attributes,a={},s=0,c=i.length;s<c;s++)d=i[s],/^id$/i.test(d.nodeName)||(a[d.nodeName]=d.nodeValue);l.attr(n,a)}else 3===e.nodeType?n=o.doc.createTextNode(e.nodeValue):(r=o.doc.createElement("div"),r.innerHTML=e.outerHTML,n=r.childNodes[0]);return n},compareIndexList:function(e,t){var n,o,r,i=Math.min(e.length,t.length);for(n=0;n<i;n++){if(o=e[n],r=t[n],o<r)return-1;if(o>r)return 1}return e.length<t.length?-1:e.length>t.length?1:0},contains:function(e,t){var n=9===e.nodeType?e.documentElement:e,o=t&&t.parentNode;return e===o||!(!o||1!==o.nodeType||!(n.contains?n.contains(o):e.compareDocumentPosition&&16&e.compareDocumentPosition(o)))},convertImageToBase64:function(e,t,n,r){var i=o.doc.createElement("img");i.onload=function(){var e=o.doc.createElement("canvas");e.width=t,e.height=n;var a=e.getContext("2d"),l=t/i.width,s=n/i.height,c=Math.max(l,s);a.scale(c,c),a.drawImage(i,0,0),r(e.toDataURL()),i=null,e=null},i.src=e},createSpan:function(){var e=o.doc.createElement("span");return e.setAttribute(r.ATTR.SPAN,r.ATTR.SPAN),e},css:function(e,t){if(e&&t&&!l.isTag(e,"br")){var n,o,r={};for(n in t)t.hasOwnProperty(n)&&"string"==typeof n&&(o=t[n],o||0===o?r[n]=o:l.clearStyle(e,n,!1));for(n in r)r.hasOwnProperty(n)&&"string"==typeof n&&(o=r[n],o||0===o?o.toString().indexOf("!important")>0?(l.clearStyle(e,n,!0),e.style.cssText+=n+":"+o):"font-size"==n.toLowerCase()?(l.clearStyle(e,n,!0),o=l.getFontSizeRem(o),o&&(e.style.cssText+=n+":"+o)):e.style[n]=o:l.clearStyle(e,n,!1))}},focus:function(){o.win.WizTemplate?o.win.WizTemplate.focus():o.doc.body.focus()},getBlockParent:function(e,t){return e?l.getParentByFilter(e,function(e){return l.isBlock(e)},t):null},getComputedStyle:function(e,t,n){if(!e||3==e.nodeType||!t)return"";for(var r;!r;)if(1===e.nodeType){var a=o.win.getComputedStyle(e,null);if(r=a[t]||"",/^rgba?\(.*\)$/i.test(r)&&(r=i.rgb2Hex(r)),e==o.doc.body||!n||r)break;e=e.parentNode}else e=e.parentNode;return r},getDocType:function(e){var t=e.doctype;return t=(!t||t.systemId||t.publicId)&&t?'<!DOCTYPE HTML PUBLIC "'+t.publicId+'" "'+t.systemId+'" >':"<!DOCTYPE HTML>"},getEndOffset:function(e){return e?3==e.nodeType?e.nodeValue.length:e.childNodes.length:0},getFirstDeepChild:function(e){if(!e)return null;for(var t=e;t&&t.childNodes&&t.childNodes.length>0;){for(t=t.childNodes[0];t&&1===t.nodeType&&/^wiz_/gi.test(t.tagName);)t=t.nextSibling;t&&(e=t)}return e},getFontSizeRem:function(e,t){var e=e.trim(),n=parseFloat(e);if(e.indexOf("%")>-1)return Math.round(n/100*1e3)/1e3+"rem";if(/^smaller$/i.test(e))return"0.83rem";if(/^small$/i.test(e))return"0.8125rem";if(/^x-small$/i.test(e))return"0.75rem";if(/^xx-small$/i.test(e))return"0.75rem";if(/^larger$/i.test(e))return"1.2rem";if(/^large$/i.test(e))return"1.125rem";if(/^x-large$/i.test(e))return"1.5rem";if(/^xx-large$/i.test(e))return"2rem";if(/^medium$/i.test(e))return"1rem";if(!/pt|px/i.test(e))return isNaN(n)?null:n+"rem";var r={useRootSize:!(!t||!t.useRootSize)},i=o.win.getComputedStyle(o.doc.body.parentNode),s=parseFloat(i.fontSize),c=r.useRootSize?a*l.getRootSizeRate():a;return isNaN(s)||isNaN(n)||0==s?null:(n/=/pt/i.test(e)?c:s,Math.round(1e3*n)/1e3+"rem")},getFromIndexList:function(e){if(!e||0===e.length)return null;var t,n,r,i;r=o.doc.body;try{for(t=0,n=e.length-1;t<n;t++)r=r.childNodes[e[t]];return i=e[t],{dom:r,offset:i}}catch(e){return null}},getLastDeepChild:function(e){if(!e)return null;for(var t=e;t&&t.childNodes&&t.childNodes.length>0;){for(t=t.childNodes[t.childNodes.length-1];t&&1===t.nodeType&&/^wiz_/gi.test(t.tagName);)t=t.previousSibling;t&&(e=t)}return e},getImageData:function(e){var t=l.getImageSize(e.src),n=o.doc.createElement("canvas");n.width=t.width,n.height=t.height;var r=n.getContext("2d");r.drawImage(e,0,0);var i=n.toDataURL("image/png");return i.replace(/^data:image\/(png|jpg);base64,/,"")},getImageSize:function(e){var t=new Image;t.src=e;var n=t.height,o=t.width;return{width:o,height:n}},getIndex:function(e){if(!e||!e.parentNode)return-1;for(var t=0,n=e;n=n.previousSibling;)++t;return t},getIndexList:function(e){for(var t=e,n=[];t&&!l.isBody(t);)n.splice(0,0,l.getIndex(t)),t=t.parentNode;return n},getListA2B:function(e){function t(e,t){e.push(t)}var n,o=e.startDom,i=e.startOffset,a=e.endDom,s=e.endOffset,c=!!e.noSplit,d=!1,u=!1;1===o.nodeType&&i>0&&i<o.childNodes.length&&(o=o.childNodes[i],i=0),1===a.nodeType&&s>0&&s<a.childNodes.length&&(a=a.childNodes[s],s=0),o!==a&&0===s&&(a=l.getPreviousNode(a,!1,o),a||(a=o),s=l.isSelfClosingTag(a)?1:l.getEndOffset(a)),o===a&&i!==s?(n=3===o.nodeType,!n||o.parentNode.getAttribute(r.ATTR.SPAN_DELETE)||c?1===o.nodeType&&o.childNodes.length>0&&!l.isSelfClosingTag(o)&&(o=o.childNodes[i],a=a.childNodes[s-1],d=!0,u=!0):(o=l.splitRangeText(o,i,s,!1),a=o,d=!0,u=!0)):o!==a&&(3!==o.nodeType||o.parentNode.getAttribute(r.ATTR.SPAN_DELETE)||c?1===o.nodeType&&o.childNodes.length>0&&i<o.childNodes.length&&(o=o.childNodes[i],d=!0):(o=l.splitRangeText(o,i,null,!1),d=!0),3===a.nodeType&&s>0&&!a.parentNode.getAttribute(r.ATTR.SPAN_DELETE)&&!c?(a=l.splitRangeText(a,0,s,!0),u=!0):!l.isSelfClosingTag(a)&&1===a.nodeType&&s>0&&(a=l.getLastDeepChild(a.childNodes[s-1]),u=!0)),d&&(i=0),u&&(s=l.getEndOffset(a));var f=o,m=[];for(i===o.length&&(f=l.getNextNode(f,!1,a));f&&(o!==a||i!==s);){if(f===a||f===a.parentNode){t(m,a);break}if(l.isBody(f)){t(m,f);break}t(m,f),f=l.getNextNode(f,!1,a)}var g=l.getPreviousNode(m[0],!1,null),p=l.getNextNode(m[m.length-1],!1,null);g&&1===g.nodeType&&g.firstChild&&(g=g.firstChild),p&&1===p.nodeType&&p.lastChild&&(p=p.lastChild);var h=l.getEndOffset(g),E=0;return{list:m,startDom:o,startOffset:i,endDom:a,endOffset:s,startDomBak:g,startOffsetBak:h,endDomBak:p,endOffsetBak:E}},getListFromTagAndIndex:function(e,t,n,o){var r,a,s,c=[],d=t.querySelectorAll(e);for(r=0;r<d.length;r++)s=d[r],a=l.getIndexList(s).join("."),i.compareVersion(a,n)>-1&&i.compareVersion(a,o)<1&&c.push(s);return c},getNextNodeCanEdit:function(e,t,n){for(e=l.getNextNode(e,t,n);e&&!l.canEdit(e);)e=l.getNextNode(e,t,n);return e},getNextNode:function(e,t,n){function o(e){return e?t?e.nextElementSibling:e.nextSibling:null}function r(e){return e?t?e.firstElementChild:e.firstChild:null}var i=e;if(!e||e==n)return null;if(t=!!t,!o(e)&&!e.parentNode)return null;if(o(e))e=o(e);else for(;e.parentNode;){if(e=e.parentNode,l.isBody(e)){e=null;break}if(e===n)break;if(o(e)){e=o(e);break}}if(e===n)return e;var a;if(a=r(e),e&&a)for(;a&&(e=a,e!==n);)a=r(a);return e===i?null:e},getOffset:function(e){var t={top:0,left:0};if(e.offsetParent)for(;e.offsetParent;)t.top+=e.offsetTop,t.left+=e.offsetLeft,e=e.offsetParent;else t.left+=e.offsetLeft,t.top+=e.offsetTop;return t},getPageScroll:function(){var e={};return"undefined"!=typeof o.win.pageYOffset?(e.left=o.win.pageXOffset,e.top=o.win.pageYOffset):"undefined"!=typeof o.doc.compatMode&&"BackCompat"!=o.doc.compatMode?(e.left=o.doc.documentElement.scrollLeft,e.top=o.doc.documentElement.scrollTop):"undefined"!=typeof o.doc.body&&(e.left=o.doc.body.scrollLeft,e.top=o.doc.body.scrollTop),e},getParentByFilter:function(e,t,n){if(e&&!l.isBody(e))for(e=n?e:e.parentNode;e;){if(!t||t(e))return e;if(l.isBody(e))return null;e=e.parentNode}return null},getParentByClass:function(e,t,n){return l.getParentByFilter(e,function(e){return l.hasClass(e,t)},n)},getParentByTagName:function(e,t,n,o){return e?(t=i.listToMap(i.isArray(t)?t:[t]),l.getParentByFilter(e,function(e){return t[e.tagName]&&!(o&&o(e))},n)):null},getParentRoot:function(e){if(!e||0===e.length)return null;var t,n,r,i,a=[];for(i=1==e[0].nodeType?e[0]:e[0].parentNode;i&&!l.isBody(i);)a.push(i),i=i.parentNode;for(t=1,n=e.length;t<n;t++)for(i=e[t];i;){if(l.isBody(i))return o.doc.body;if(r=a.indexOf(i),r>-1){a.splice(0,r);break}i=i.parentNode}return 0===a.length?o.doc.body:a[0]},getParentList:function(e){for(var t=[],n=e.parentNode;n&&n!==o.doc.body;)t.splice(0,0,n),n=n.parentNode;return t},getPosition:function(e){return e?{top:e.offsetTop,left:e.offsetLeft,height:e.offsetHeight,width:e.offsetWidth}:null},getPreviousNode:function(e,t,n){function o(e){return t?e.previousElementSibling:e.previousSibling}function r(e){return t?e.lastElementChild:e.lastChild}var i=e;if(!e||e==n)return null;if(t=!!t,o(e))e=o(e);else for(;e.parentNode;){if(e=e.parentNode,l.isBody(e)){e=null;break}if(e==n)break;if(o(e)){e=o(e);break}}if(!e)return null;if(e===n&&(3===e.nodeType||1===e.nodeType&&0===e.childNodes.length))return e;var a;if(a=r(e),e&&a)for(;a&&(e=a,e!==n||3!==e.nodeType&&(1!==e.nodeType||0!==e.childNodes.length));)a=r(a);return e===i?null:e},getPreviousNodeCanEdit:function(e,t,n){for(e=l.getPreviousNode(e,t,n);e&&!l.canEdit(e);)e=l.getPreviousNode(e,t,n);return e},getTab:function(){var e=o.doc.createElement("span");return e.innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;",e.childNodes[0]},getTdIndex:function(e){return{x:e.cellIndex,y:e.parentNode.rowIndex,maxX:e.parentNode.cells.length,maxY:e.parentNode.parentNode.rows.length}},getWindowSize:function(){return{width:o.doc.documentElement.clientWidth,height:o.doc.documentElement.clientHeight}},getWizAmendParent:function(e){return l.getParentByFilter(e,function(e){return e&&1===e.nodeType&&(e.getAttribute(r.ATTR.SPAN_INSERT)||e.getAttribute(r.ATTR.SPAN_DELETE))},!0)},hasClass:function(e,t){return!(!e||1!==e.nodeType)&&(" "+e.className+" ").indexOf(" "+t+" ")>-1},after:function(e,t){l.before(e,t,!0)},before:function(e,t,n){if(n=!!n,t&&e){var r,a,l,s=t===o.doc.body,c=s?t:t.parentNode,d=s?n?null:o.doc.body.childNodes[0]:n?t.nextSibling:t;if(i.isArray(e))for(l=d,r=e.length-1;r>=0;r--)a=e[r],c.insertBefore(a,l),l=a;else c.insertBefore(e,d)}},isBlock:function(e){if(!e)return!1;if(l.isWizDom(e))return!0;var t=l.getComputedStyle(e,"display",!1);return!!t&&!/^(inline|inline\-block|inline\-table|none)$/i.test(t)},isWizDom:function(e){return 1===e.nodeType&&/^wiz_/i.test(e.tagName)},isBody:function(e){return e&&e==o.doc.body},isEmptyDom:function(e){if(!e)return!1;var t,n,o;if(3===e.nodeType)return o=e.nodeValue,i.isEmpty(o);if(1!==e.nodeType)return!0;if(0===e.childNodes.length)return l.isTag(e,"br")||!l.isSelfClosingTag(e);for(t=0,n=e.childNodes.length;t<n;t++)if(!l.isEmptyDom(e.childNodes[t]))return!1;return!0},isFillChar:function(e,t){return 3===e.nodeType&&!e.nodeValue.replace(new RegExp((t?"^":"")+r.FILL_CHAR),"").length},isInlineDom:function(e){return!l.isBlock(e)},isSelfClosingTag:function(e){var t=/^(area|base|br|col|command|embed|hr|img|input|keygen|link|meta|param|source|track|wbr)$/i;return e&&1===e.nodeType&&t.test(e.tagName)},isSameSpan:function(e,t){return!!e&&!!t&&1==e.nodeType&&1==t.nodeType&&l.isTag(e,"span")&&e.tagName==t.tagName&&e.getAttribute(r.ATTR.SPAN)==r.ATTR.SPAN&&l.isSameStyle(e,t)&&l.isSameAttr(e,t)},isSameAttr:function(e,t){var n=e.attributes,o=t.attributes;if(n.length!=o.length)return!1;var a,l,s;for(a=0,l=n.length;a<l;a++)if(s=n[a],"style"!=s.name)if(s.name!==r.ATTR.SPAN_TIMESTAMP){if(!o[s.name]||o[s.name].value!=s.value)return!1}else if(!i.isSameAmendTime(s.value,o[s.name].value))return!1;return!0},isSameStyle:function(e,t){var n={},o={};l.appendStyle(e.getAttribute("style"),n),l.appendStyle(t.getAttribute("style"),o);var r;for(r in n)if(n.hasOwnProperty(r)){if(o[r]!==n[r])return!1;delete n[r],delete o[r]}for(r in o)if(o.hasOwnProperty(r))return!1;return!0},isTag:function(e,t){if(i.isArray(t)||(t=[t]),!e||1!==e.nodeType)return!1;var n,o,r=e.tagName.toLowerCase();for(n=0,o=t.length;n<o;n++)if(r===t[n].toLowerCase())return!0;return!1},isUsableTextNode:function(e){return 3==e.nodeType&&!i.isEmpty(e.nodeValue)},isWizSpan:function(e){return!!e&&!!e.getAttribute(r.ATTR.SPAN)},mergeAtoB:function(e,t,n){l.mergeStyleAToB(e,t,n),l.mergeAttrAtoB(e,t,n)},mergeAttrAtoB:function(e,t,n){if(1==e.nodeType&&1==t.nodeType){var o,r,i,a=e.attributes,l=t.attributes;for(o=0,r=a.length;o<r;o++)i=a[o],"style"!=i.name&&(l[i.name]&&!n||t.setAttribute(i.name,i.value))}},mergeStyleAToB:function(e,t,n){if(1==e.nodeType&&1==t.nodeType){var o=e.getAttribute("style"),r=t.getAttribute("style")||"";if(o){var i={};n?(l.appendStyle(r,i),l.appendStyle(o,i)):(l.appendStyle(o,i),l.appendStyle(r,i));var a=[];for(var s in i)i.hasOwnProperty(s)&&a.push(s+":"+i[s]);t.setAttribute("style",a.join(";"))}}},packageByDiv:function(e){var t,n;for(t=e;t;){if(l.isBlock(t)){n=t,t=null;break}if(l.isTag(t.parentNode,["body","td","th"]))break;t=t.parentNode}if(n)return n;for(var r,i=t,a=t;i&&(r=i.previousSibling,r&&!l.isBlock(r));)i=r;for(;a&&(r=a.nextSibling,r&&!l.isBlock(r));)a=r;n=o.doc.createElement("div"),l.before(n,i);var s,c,r=i;do s=r.nextSibling,n.appendChild(r),c=r===a,r=s;while(!c);return n},peelDom:function(e,t){if(e&&3!==e.nodeType){var n,o,r,i={start:null,end:null};for(n=e.childNodes,r=n.length-1;r>=0;r--)o=n[r],t&&!t(o)||(l.after(o,e),i.start?i.end=o:(i.start=o,i.end=o));return l.remove(e),i}},peelTag:function(e){var t,n,r=o.doc.querySelectorAll(e);for(t=r.length-1;t>=0;t--){for(n=r[t];n.firstChild;)l.before(n.firstChild,n);l.remove(n)}},peelTagFromHtml:function(e,t){var n=new RegExp("<"+t+"( [^>]*)?>|</"+t+">","ig");return e.replace(n,"")},replaceTagName:function(e,t){if(!l.isTag(e,t)){var n=l.hasClass(e,r.CLASS.TODO_LAYER),i=o.doc.createElement(t);for(l.after(i,e);e.firstChild;)i.appendChild(e.firstChild);n&&(e.className&&(i.className=e.className),e.id&&(i.id=e.id)),l.remove(e)}},removeClass:function(e,t){if(e){e.nodeType&&(e=[e]),i.isArray(t)||(t=[t]);var n,o,r,a;for(n=e.length-1;n>=0;n--)if(r=e[n],1===r.nodeType){for(r.className=" "+r.className+" ",o=t.length;o>=0;o--)a=t[o],r.className=r.className.replace(" "+a+" "," ");r.className=r.className.trim()}}},remove:function(e){e&&e.parentNode&&e.parentNode.removeChild(e)},removeByName:function(e){var t,n,r=o.doc.getElementsByName(e);for(t=r.length-1;t>=0;t--)n=r[t],l.remove(n)},removeByTag:function(e){var t,n,r=o.doc.getElementsByTagName(e);for(t=r.length-1;t>=0;t--)n=r[t],l.remove(n)},removeByTagFromHtml:function(e,t){var n=new RegExp("<"+t+"( [^>]*)?>((?!</"+t+">).|\r|\n)*?</"+t+">","ig");return e.replace(n,"")},removeStyleByIdFromHtml:function(e,t){var n="("+t.join("|")+")",o=new RegExp("<style( ([^<>])+[ ]+|[ ]+)id *= *(['\"])"+n+"\\3[^<>]*>[^<]*</style>","ig"),r=new RegExp("<link( ([^<>])+[ ]+|[ ]+)id *= *(['\"])"+n+"\\3[^<>]*>","ig");return e.replace(o,"").replace(r,"")},removeStyleByNameFromHtml:function(e,t){var n="("+t.join("|")+")",o=new RegExp("<style( ([^<>])+[ ]+|[ ]+)name *= *(['\"])"+n+"\\3[^<>]*>[^<]*</style>","ig"),r=new RegExp("<link( ([^<>])+[ ]+|[ ]+)name *= *(['\"])"+n+"\\3[^<>]*>","ig");return e.replace(o,"").replace(r,"")},removeViewportFromHtml:function(e,t){if(o.doc.querySelector("head meta[name=viewport]")){var n=new RegExp("<meta( ([^<>])+[ ]+|[ ]+)name *= *(['\"])viewport\\3[^<>]*>","i");return e.replace(n,"")}return e},removeListFilter:function(e,t){var n,o,r=[];if(!e||!t)return r;for(n=e.length-1;n>=0;n--)o=e[n],t(o)&&r.unshift(e.splice(n,1)[0]);return r},search:function(e,t,n){var o,r,i,a=e.querySelectorAll(t);for(n=n?n:[],o=0,r=a.length;o<r;o++)i=a[o],n.push(i)},setContenteditable:function(e,t){!e&&o.win.WizTemplate?o.win.WizTemplate.setContenteditable(t):(e||(e=o.doc.body),e.setAttribute("contenteditable",t?"true":"false"))},setLayout:function(e){var t,n,i,a,s=e.layerObj,c=e.target,d=e.layout,u=!!e.fixed,f=!!e.noSpace,m=!!e.reverse,g=l.getPosition(s),p=c.nodeType?l.getPosition(c):c,h=l.getPageScroll(),E=o.doc.documentElement.clientWidth,C=o.doc.documentElement.clientHeight,T=window.getComputedStyle?o.win.getComputedStyle(o.doc.body,null)["margin-top"]:0,b="50%",v="30%",y=0,S=-g.width/2;T&&(T=parseInt(T),isNaN(T)&&(T=0)),u?(t=0,n=E-5,i=0+T,a=C):(t=0+h.left,n=E+h.left-5,i=0+(h.top<=T?0:Math.abs(h.top-T))+T,a=C+h.top),p&&d&&(y=0,S=0,d==r.TYPE.POS.upLeft||d==r.TYPE.POS.upRight?v=p.top-g.height-(f?0:r.AMEND.INFO_SPACE):d==r.TYPE.POS.downLeft||d==r.TYPE.POS.downRight?v=p.top+p.height+(f?0:r.AMEND.INFO_SPACE):d==r.TYPE.POS.leftUp||d==r.TYPE.POS.leftDown?b=p.left-g.width-(f?0:r.AMEND.INFO_SPACE):d!=r.TYPE.POS.rightUp&&d!=r.TYPE.POS.rightDown||(b=p.left+p.width+(f?0:r.AMEND.INFO_SPACE)),d==r.TYPE.POS.upLeft||d==r.TYPE.POS.downLeft?(b=p.left,u&&(b-=h.left)):d==r.TYPE.POS.upRight||d==r.TYPE.POS.downRight?(b=p.left+p.width-g.width,u&&(b-=h.left)):d==r.TYPE.POS.leftUp||d==r.TYPE.POS.rightUp?(v=p.top,u&&(v-=h.top)):d!=r.TYPE.POS.leftDown&&d!=r.TYPE.POS.rightDown||(v=p.top+p.height-g.height,u&&(v-=h.top)),b+g.width>n&&(b=n-g.width),b<t&&(b=t),v+g.height>a&&(v=a-g.height),m&&v<i&&(v=p.top+p.height),(v<i||v+g.height>a)&&(v=i)),l.css(s,{left:b+"px",top:v+"px","margin-top":y+"px","margin-left":S+"px"})},setTextarea:function(e,t){var n=void 0===e.textContent?"innerText":"textContent";return t?void(e[n]=i.replaceSpecialChar(t)):void(e.value!==e[n]&&(e[n]=e.value))},splitRangeText:function(e,t,n,r){if(!l.isUsableTextNode(e))return e;var i,a,s,c=e.nodeValue;return i=e.parentNode,a=l.createSpan(),!t&&!n||0===t&&n===e.nodeValue.length?i.childNodes.length>1||l.isTag(i,["td","th"])?(r?i.insertBefore(a,e):i.insertBefore(a,e.nextSibling),a.appendChild(e)):a=i:0===t?(a.textContent=c.substring(t,n),i.insertBefore(a,e),e.nodeValue=c.substring(n)):n&&n!==e.nodeValue.length?(s=o.doc.createTextNode(c.substring(n)),a.textContent=c.substring(t,n),i.insertBefore(a,e.nextSibling),i.insertBefore(s,a.nextSibling),e.nodeValue=c.substring(0,t)):(a.textContent=c.substring(t),i.insertBefore(a,e.nextSibling),e.nodeValue=c.substring(0,t)),a}};t.exports=l},{"./../common/const":16,"./../common/env":18,"./../common/utils":22}],27:[function(e,t,n){"use strict";var o=e("./../common/env"),r=e("./../common/const"),i=e("./../common/utils"),a=e("./domBase");a.clearChild=function(e,t){if(e){var n,o=t.indexOf(e)>=0;if(!(o||3!==e.nodeType||a.isUsableTextNode(e)||a.getParentByTagName(e,"pre",!1)))return void a.remove(e);if(!o&&3===e.nodeType)return n=e.nodeValue.replace(r.FILL_CHAR_REG,""),void(n!==e.nodeValue&&(e.nodeValue=n));
if(!o&&1===e.nodeType){var i,l,s=e.childNodes;for(i=s.length-1;i>=0;i--)l=s[i],a.clearChild(l,t);a.mergeChildSpan(e,t),t.indexOf(e)<0&&0===e.childNodes.length&&1===e.nodeType&&!a.isSelfClosingTag(e)&&e.getAttribute(r.ATTR.SPAN)&&a.remove(e)}}},a.fragmentFilterForCopy=function(e){var t,n,o=e.querySelectorAll("."+r.CLASS.CODE_CONTAINER+" textarea");for(n=o.length-1;n>=0;n--)t=o[n],a.remove(t);for(o=e.querySelectorAll("."+r.CLASS.CODE_MIRROR_MEASURE),n=o.length-1;n>=0;n--)t=o[n],a.remove(t);for(o=e.querySelectorAll("."+r.CLASS.CODE_MIRROR_GUTTER),n=o.length-1;n>=0;n--)t=o[n],a.remove(t);for(o=e.querySelectorAll("."+r.CLASS.CODE_TOOLS),n=o.length-1;n>=0;n--)t=o[n],a.remove(t)},a.fixFontSize=function(){var e,t,n,r,i,l=o.doc.querySelectorAll("[style]"),s=/font-size\s*:\s*([%.\w]*)/i;for(e=0;e<l.length;e++)t=l[e],n=t.getAttribute("style"),i=s.exec(n),!i||i[1].indexOf("rem")>0||(r=a.getFontSizeRem(i[1],{useRootSize:!0}),a.isTag(t,"html")||(t.style.fontSize=r))},a.fixOrderList=function(){var e,t,n,i,l=o.doc.querySelectorAll("ol");for(e=0;e<l.length;e++){for(t=l[e],n=t,i=0;n;)i++,n=a.getParentByTagName(n,["ul","ol"],!1);a.removeClass(t,r.CLASS.ORDER_LIST_LEVEL),a.addClass(t,r.CLASS.ORDER_LIST_LEVEL[i%3])}},a.getBodyText=function(){var e=o.doc.body;return e?e.innerText?e.innerText:"":" "},a.getContentHtml=function(e){a.fixFontSize();var t=e&&e.isSaveTemp;o.event.call(r.EVENT.BEFORE_GET_DOCHTML,null);var n,l,s,c=a.getDocType(o.doc),d=o.doc.getElementsByTagName("input");for(n=0,l=d.length;n<l;n++)s=d[n],/^test$/i.test(s.getAttribute("type"))&&s.value!==s.getAttribute("value")&&s.setAttribute("value",s.value);for(d=o.doc.getElementsByTagName("textarea"),n=0,l=d.length;n<l;n++)s=d[n],a.setTextarea(s);for(d=o.doc.querySelectorAll("."+r.CLASS.TABLE_CONTAINER),n=0,l=d.length;n<l;n++)a.moveOutFromTableContainer(d[n]);var u=[r.NAME.TMP_STYLE];t||u.push(r.NAME.UNSAVE_STYLE);var f=a.removeStyleByNameFromHtml(o.doc.documentElement.outerHTML,u);f=a.removeByTagFromHtml(f,r.TAG.TMP_TAG),f=a.peelTagFromHtml(f,r.TAG.TMP_PLUGIN_TAG),f=f.replace(/<!--(.|\n)*?(-->)/g,""),f=f.replace(/<script[^<>]*\/>/gi,"").replace(/<script[^<>]*>(((?!<\/script>).)|(\r?\n))*<\/script>/gi,"");var m=/(<[\w]*[^<>]*[ ]+)contenteditable([ ]*=[ ]*['"][^'"<>]*['"])?/gi;f=f.replace(m,"$1"),f=f.replace(/(<div class="CodeMirror-measure">)<pre><span>xxxxxxxxxx<\/span><\/pre>/gi,"$1"),f=a.hideTableFromHtml(f),f=a.hideCodeFromHtml(f),o.win.WizTemplate&&(f=o.win.WizTemplate.hideTemplateFormHtml(f)),f=i.replaceSpecialChar(f);var g,p;return t||(g=new RegExp("(<img[^<>]*)( "+r.ATTR.IMG_EDITING+"=('|\")1\\3)","ig"),f=f.replace(g,"$1"),p=new RegExp("(<[^<>]*src[ ]*=[ ]*(\"|'))"+o.options.indexFilesFullPath.escapeRegex(),"ig"),f=f.replace(p,"$1"+o.options.indexFilesPath+"/")),c+f},a.getPrevBlock=function(e){var t,n=!1;if(a.isBlock(e)||a.isTag(e,"br"))return e;for(;e&&(n&&e.childNodes&&e.childNodes.length>0?(e=e.childNodes[e.childNodes.length-1],n=!1):(t=e.previousSibling,t?(e=t,n=!0):(e=e.parentNode,n=!1)),!a.isBlock(e)&&!a.isTag(e,"br")););return e},a.getNextBlock=function(e){var t,n=!1;if(a.isBlock(e)||a.isTag(e,"br"))return e;for(;e&&(n&&e.childNodes&&e.childNodes.length>0?(e=e.childNodes[0],n=!1):(t=e.nextSibling,t?(e=t,n=!0):(e=e.parentNode,n=!1)),!a.isBlock(e)&&!a.isTag(e,"br")););return e},a.hideCodeFromHtml=function(e){var t=/(<div [^<>]*)(CodeMirror-activeline-background|CodeMirror-cursors|CodeMirror-selected|CodeMirror-hscrollbar|CodeMirror-vscrollbar)([^<>]*>)/gi;e=e.replace(t,"$1 wiz-hide wiz_$2$3");var n=/(<span [^<>]*)(CodeMirror-matchingbracket)([^<>]*>)/gi;return e=e.replace(n,"$1$3")},a.hideTableFromHtml=function(e){var t=/(<[^<> ]*[^<>]* class[ ]*=[ ]*['"])([^'"]*)(['"])/i,n=/(<[^<> ]*[^<>]* class[ ]*=[ ]*['"])([^'"]*)(['"])/gi;if(!t.test(e))return e;for(var o,i,a,l=[],s=0;o=n.exec(e);)i=o[2],(" "+i+" ").indexOf(" "+r.CLASS.SELECTED_CELL+" ")>-1&&(a=new RegExp(" "+r.CLASS.SELECTED_CELL+" ","ig"),i=(" "+i+" ").replace(a,"").trim()),l.push(e.substr(s,o.index-s),o[1],i,o[3]),s=o.index+o[0].length;return l.push(e.substr(s)),l.join("")},a.mergeChildSpan=function(e,t){if(e&&1===e.nodeType){var n,o;for(n=0,o=e.children.length;n<o;n++)a.mergeChildSpan(e.children[n],t);a.mergeSiblingSpan(e,t);var i,l=e.children[0];if(l&&t.indexOf(l)<0&&1==e.childNodes.length&&e.getAttribute(r.ATTR.SPAN)==r.ATTR.SPAN&&l.getAttribute(r.ATTR.SPAN)==r.ATTR.SPAN)a.mergeChildToParent(e,l);else for(;l;)t.indexOf(l)<0&&t.indexOf(e)<0&&a.isSameSpan(e,l)?(i=l.previousElementSibling,a.mergeChildToParent(e,l),l=i?i.nextElementSibling:e.children[0]):l=l.nextElementSibling}},a.mergeChildToParent=function(e,t){if(e&&t&&t.parentNode===e){for(;t.childNodes.length>0;)a.before(t.childNodes[0],t);a.mergeAtoB(e,t,!1),a.mergeAtoB(t,e,!0),e.removeChild(t)}},a.mergeSiblingSpan=function(e,t){var n,o,i=e.childNodes[0];if(i)for(;i;)if(n=i.nextSibling,n&&t.indexOf(n)<0&&t.indexOf(i)<0&&a.isSameSpan(i,n)){for(;n.childNodes.length;)o=n.childNodes[0],o&&(o.innerHTML||o.nodeValue&&o.nodeValue!=r.FILL_CHAR)?i.appendChild(o):n.removeChild(o);a.remove(n)}else i=n},a.modifyChildNodesStyle=function(e,t,n){if(e){var o,r,i=e.childNodes,l=!1;for(o=0;o<i.length;o++)r=i[o],!l&&a.isUsableTextNode(r)?(l=!0,a.modifyStyle(e,t,n)):1===r.nodeType&&a.modifyChildNodesStyle(r,t,n)}},a.modifyNodeStyle=function(e,t,n,o){return 1===e.nodeType?a.isSelfClosingTag(e)?a.modifyStyle(e,t,n):a.modifyChildNodesStyle(e,t,n):a.isUsableTextNode(e)&&(e=a.splitRangeText(e,null,null,o),a.modifyStyle(e,t,n)),e},a.modifyNodesStyle=function(e,t,n){if(0!==e.length){var o,r,i;for(o=0,r=e.length;o<r;o++)i=e[o],e[o]=a.modifyNodeStyle(i,t,n,o===r-1)}},a.modifyStyle=function(e,t,n){function o(e){if(e){var t=a.createSpan();for(t.setAttribute("style",e.getAttribute("style")||""),e.removeAttribute("style");e.firstChild;)t.insertBefore(e.firstChild,null);e.insertBefore(t,null)}}var i=a.isSelfClosingTag(e),l=a.hasClass(e,r.CLASS.TODO_CHECKBOX);if(!(l||n&&n[r.ATTR.SPAN_INSERT]&&i)){var s=e;if(n&&(n[r.ATTR.SPAN_INSERT]||n[r.ATTR.SPAN_DELETE])&&(s=a.getWizAmendParent(e),s?e=null:s=e),e&&!i&&(!a.isTag(e,"span")||e.getAttribute(r.ATTR.SPAN)!==r.ATTR.SPAN))for(s=a.createSpan(),e.insertBefore(s,null);e.childNodes.length>1;)s.insertBefore(e.childNodes[0],null);var c,d,u=[];for(c in t)t.hasOwnProperty(c)&&(d=t[c],d||u.push(c));var f,m=s,g=s;if(u.length>0){for(;m&&!a.isBlock(m)&&!a.hasClass(m,r.CLASS.TODO_MAIN);)a.isTag(m,"a")&&(f=m),g=m,m=g.parentNode;f?f===g?(o(f),a.splitDomSingle(f.firstChild,s)):(a.splitDomSingle(g,f),o(f),a.splitDomSingle(f.firstChild,s)):a.splitDomSingle(g,s)}a.css(s,t),a.attr(s,n)}},a.moveOutFromTableContainer=function(e){function t(e,t){if(e&&t){var n,o,i,l,s=e===t,c=!1,d=!1;for(n=t.childNodes,i=e,l=n.length-1;l>=0;l--)o=n[l],1!==o.nodeType||!(s&&a.hasClass(o,r.CLASS.TABLE_BODY)||!s&&a.isTag(o,["table",r.TAG.TMP_TAG]))||d?(a.before(o,i,!c),c&&(i=o)):(a.hasClass(o,r.CLASS.TABLE_BODY)||a.isTag(o,"table"))&&(c=!0,d=!0);0===t.childNodes.length&&a.remove(e)}}e&&(t(e,e),t(e,e.querySelector("."+r.CLASS.TABLE_BODY)))},a.removeEmptyParent=function(e){if(e){var t;a.isEmptyDom(e)&&(e===o.doc.body||a.isTag(e,["td","th"])?e.innerHTML="<br/>":(t=e.parentNode,t&&(t.removeChild(e),a.removeEmptyParent(t))))}},a.splitDomBeforeSub=function(e,t){function n(e,t){for(var n,o=e.parentNode,r=e.cloneNode(!1);t;)n=t.nextSibling,r.appendChild(t),t=n;return o.insertBefore(r,e.nextSibling),r}if(!e||!t)return e;for(var o=[t],r=t.parentNode,i=r.firstChild===t;r&&(o.push(r),i&&r.parentNode.firstChild!==r&&(i=!1),r!==e);)r=r.parentNode;if(i)return e;if(o[o.length-1]!==e)return e;for(;o.length>1;)o[1]=n(o[1],o[0]),o.splice(0,1);return o[0]},a.splitDomAfterSub=function(e,t){var n,o;if(t.nextSibling)o=t.nextSibling;else for(n=t.parentNode;n&&n!==e&&!(o=n.nextSibling);)n=n.parentNode;return o&&a.splitDomBeforeSub(e,o),e},a.splitDomSingle=function(e,t){if(e&&t&&1===e.nodeType&&t===e.firstChild&&1===e.childNodes.length)return e;var n=a.splitDomBeforeSub(e,t);return n=a.splitDomAfterSub(n,t)},t.exports=a},{"./../common/const":16,"./../common/env":18,"./../common/utils":22,"./domBase":26}],28:[function(e,t,n){"use strict";var o=e("../common/env"),r=e("../common/const"),i=e("./domBase"),a={active:"active",selected:"selected"},l={bind:function(){l.unbind(),o.event.add(r.EVENT.ON_MOUSE_DOWN,l.handler.onMouseDown)},unbind:function(){o.event.remove(r.EVENT.ON_MOUSE_DOWN,l.handler.onMouseDown)},handler:{onMouseDown:function(e){var t=e.target,n=s.getHeaderFromDom(t);if(n)return void s.showOptions(n);var o=s.getOptionFromDom(t);o&&s.selectOption(o);var r=s.getContainerFromDom(t);r||s.hideOptions()}}},s={getContainerFromDom:function(e){return i.getParentByClass(e,r.CLASS.SELECT_PLUGIN_CONTAINER,!0)},getHeaderFromDom:function(e){return i.getParentByClass(e,r.CLASS.SELECT_PLUGIN_HEADER,!0)},getHeaderText:function(e){return e.querySelector("."+r.CLASS.SELECT_PLUGIN_HEADER_TEXT)},getOptionFromDom:function(e){return i.getParentByClass(e,r.CLASS.SELECT_PLUGIN_OPTIONS_ITEM,!0)},hideOptions:function(e){var t,n;for(t=e?[e]:o.doc.querySelectorAll("."+r.CLASS.SELECT_PLUGIN_CONTAINER+"."+a.active),n=t.length-1;n>=0;n--)i.removeClass(t[n],a.active)},selectOption:function(e){var t=s.getContainerFromDom(e);if(t){var n=t.querySelectorAll("."+r.CLASS.SELECT_PLUGIN_OPTIONS_ITEM+"."+a.selected);if(n!==e){t.value=e.getAttribute("value"),i.removeClass(n,a.selected),i.addClass(e,a.selected);var l=s.getHeaderText(t);l.textContent=e.textContent,s.hideOptions(t),o.event.call(r.EVENT.ON_SELECT_PLUGIN_CHANGE,t)}}},showOptions:function(e){var t=s.getContainerFromDom(e);return i.hasClass(t,a.active)?void s.hideOptions(t):(s.hideOptions(),void i.addClass(t,a.active))}},c={on:function(){l.bind()},off:function(){l.unbind()},create:function(e,t,n){var l,s,c,d,u,f=o.doc.createElement("div"),m=o.doc.createElement("div"),g=o.doc.createElement("span"),p=o.doc.createElement("i"),h=o.doc.createElement("ul");for(m.appendChild(g),m.appendChild(p),f.appendChild(m),f.appendChild(h),s=0,c=e.length;s<c;s++)d=e[s].text,u=e[s].value,l=o.doc.createElement("li"),l.textContent=d,i.attr(l,{value:u,"data-index":s}),u===n&&(g.textContent=d,f.value=u,i.addClass(l,a.selected)),i.addClass(l,r.CLASS.SELECT_PLUGIN_OPTIONS_ITEM),h.appendChild(l);return i.addClass(p,"icon-down_arrow editor-icon"),i.addClass(g,r.CLASS.SELECT_PLUGIN_HEADER_TEXT),i.addClass(m,r.CLASS.SELECT_PLUGIN_HEADER),i.addClass(h,r.CLASS.SELECT_PLUGIN_OPTIONS),i.addClass(f,r.CLASS.SELECT_PLUGIN_CONTAINER+" "+t),i.attr(f,{onselectstart:"return false;"}),f},destory:function(){}};t.exports=c},{"../common/const":16,"../common/env":18,"./domBase":26}],29:[function(e,t,n){"use strict";var o=e("../common/xss"),r={xssFilter:function(){if("undefined"==typeof o)return null;var e=decodeURIComponent(location.pathname),t=e.lastIndexOf("/")+1,n=e.lastIndexOf(".");e=n>0?e.substring(t,n)+"_files":"";var r=/^((file|wiz(note)?):\/\/)|(index_files\/)|(data:image\/(?!svg))/,i="#",a=new RegExp("^("+i.escapeRegex()+(e?"|"+e.escapeRegex():"")+")","i"),l=/^(id|class|name|style|data|width|height)/i,s=new o.FilterXSS({onIgnoreTag:function(e,t,n){if(/script/gi.test(e))return o.escapeAttrValue(t);if(n.isClosing)return"</"+e+">";var r=o.parseAttr(t,function(t,n){return n=s.options.safeAttrValue(e,t,n,s),/^on/i.test(t)?"":n?t+'="'+n+'"':t});return r=/^<!/i.test(t)?"<!"+r:"<"+r,"/"===t[t.length-2]&&(r+="/"),r+=">"},onIgnoreTagAttr:function(e,t,n,o){return!/^object$/i.test(e)&&n&&l.test(t)?t+'="'+n+'"':""},safeAttrValue:function(e,t,n){return/^meta$/i.test(e)&&/^http-equiv$/i.test(t)&&/refresh/i.test(n)?"":"href"!==t&&"src"!==t||!r.test(n)&&!a.test(n)?o.safeAttrValue(e,t,n):o.escapeAttrValue(n)}});return s.options.whiteList.iframe=["src","scrolling"],s.options.whiteList.button=["title","type","value"],s.options.whiteList.object=[],function(e){return s.process(e)}}()};t.exports=r},{"../common/xss":25}],30:[function(e,t,n){"use strict";function o(){return l.doc.getSelection().toString()}function r(){var e,t,n,o,r=l.doc.getSelection(),i=S.getRange(),a={parent:null,target:null};i||S.restoreCaret()||C.focus(),p.isAmendEditing()&&(i.collapsed||(m.removeSelection(g.getCurUser()),m.removeUserDel(null,g.getCurUser()),r.collapseToEnd())),i=S.getRange(),i.collapsed&&(e=i.startContainer,t=i.startOffset,o=C.getParentByFilter(e,function(e){if(1!==e.nodeType)return!1;var t=e.getAttribute("href");return!(!t||!/^wiz:\/*open_attachment\?/i.test(t))},!0),o&&(n=C.createSpan(),n.innerHTML=s.FILL_CHAR,0===t?(C.before(n,o),S.setRange(n,0)):(C.after(n,o),S.setRange(n,1))));var c=m.fixedAmendRange(),d=p.splitAmendDomByRange(c);return i=S.getRange(),e=i.startContainer,t=i.startOffset,d?(a.target=d,a.parent=d.parentNode):3==e.nodeType&&t>0&&t<e.nodeValue.length?(a.target=C.splitRangeText(e,t,null,!1),a.parent=a.target.parentNode):1==e.nodeType&&t>0&&t<e.childNodes.length?(a.target=e.childNodes[t],a.parent=e):e==l.doc.body||e==l.doc.body.parentNode?(a.target=0===t?l.doc.body.childNodes[0]:null,a.parent=l.doc.body):0===t?(a.target=e,a.parent=e.parentNode):3===e.nodeType?(a.target=e.nextSibling,a.parent=e.parentNode):(a.target=null,a.parent=e),a.target&&1===a.target.nodeType&&!C.isSelfClosingTag(a.target)&&C.isEmptyDom(a.target)&&(a.parent=a.target,C.isTag(a.parent.childNodes[0],"br")?(a.parent.removeChild(a.parent.childNodes[0]),a.target=a.parent.childNodes.length>0?a.parent.childNodes[0]:null):a.target=a.parent.childNodes[0]),C.isWizDom(a.parent)&&(a.target=a.parent,a.parent=a.parent.parentNode),a}function i(e){if(e){a&&clearTimeout(a);var t=30,n=30;l.client.type.isPhone&&(t=100,n=300),a=setTimeout(function(){var t,o=e;C.isSelfClosingTag(e)?(o=o.parentNode,t=C.getIndex(e)+1):t=C.getEndOffset(e),C.isEmptyDom(o)&&(t=0),S.setRange(o,t,null,null),1===e.nodeType&&(a=setTimeout(function(){S.fixScroll()},n))},t)}}var a,l=e("../common/env"),s=e("../common/const"),c=e("../common/utils"),d=e("../common/dependLoader"),u=e("../common/historyUtils"),f=e("../common/wizStyle"),m=e("../amend/amendUtils/amendExtend"),g=e("../amend/amendUser"),p=e("../amend/amend"),h=e("../blockUtils/blockCore"),E=e("../codeUtils/codeCore"),C=e("../domUtils/domExtend"),T=e("../domUtils/selectPlugin"),b=e("../editor/commandExtend"),v=e("../formatPainterUtils/formatPainterCore"),y=e("../imgUtils/imgCore"),S=e("../rangeUtils/rangeExtend"),A=e("../tableUtils/tableCore"),N=(e("../tableUtils/tableUtils"),e("../tableUtils/tableZone"),e("../todoUtils/todoCore")),O=e("./editorEvent"),_=e("./tabKey"),D="",x={init:function(){},on:function(e){function t(){C.fixOrderList(),O.bind(),b.on(),T.on(),y.on(),A.on(),_.on(),N.on(),h.on(),E.on(),v.init(),p.startReverse(),u.start(l.options.maxRedo,l.options.callback.redo),y.setImgFullPath(),l.client.type.isPhone||l.client.type.isPad?setTimeout(function(){x.setOriginalHtml()},500):x.setOriginalHtml(),"function"==typeof e&&e()}d.loadCss(l.doc,[l.dependency.files.css.fonts]),C.setContenteditable(null,!0),l.readonly=!1,f.insertTmpEditorStyle(),E.loadDependency(t)},off:function(){u.stop(),p.stopReverse(),p.stop(),v.off(),E.off(),h.off(),N.off(),_.off(),A.off(),y.off(),T.off(),b.off(),O.unbind(),l.readonly=!0,C.setContenteditable(null,!1),C.removeByName(s.NAME.TMP_STYLE),C.removeByTag(s.TAG.TMP_TAG)},find:function(e,t,n,o){if(!e)return!1;var r=l.win.find(e,t,n);return!r&&o&&(S.setRange(l.doc.body,n?l.doc.body.childNodes.length:0),r=l.win.find(e,t,n)),r},getOriginalHtml:function(){return D},insertDom:function(e,t){function n(e){if(e.parent&&!e.target)for(;e.parent!==l.doc.body&&!e.target;)e.target=e.parent.nextSibling,e.parent=e.parent.parentNode}function o(e){if(1!==e.nodeType)return null;var t;return C.isTag(e,"img")?e:(t=e.querySelectorAll("img"),t.length>0?t[t.length-1]:null)}if(e){var a,s,d,u,f,m,g,p=r();for(t&&C.isEmptyDom(p.parent)&&!C.isTag(p.parent,["td","th"])&&!p.target&&(d=p.parent,p.parent=d.parentNode,p.target=d.nextSibling,p.parent.removeChild(d)),c.isArray(e)||(e=[e]),a=0,s=e.length;a<s;a++)u=e[a],C.isBlock(u)&&n(u),p.parent.insertBefore(e[a],p.target),g=o(e[a]),g&&(m=g),f=e[a];i(f),m&&m.addEventListener("load",function(){i(f)})}},insertHtml:function(e,t){if(e){var n,o,r=l.doc.createElement("div"),i=[];for(r.innerHTML=e,n=0,o=r.childNodes.length;n<o;n++)i.push(r.childNodes[n]);x.insertDom(i,t),r=null,l.event.call(s.EVENT.AFTER_INSERT_DOM)}},modifySelectionDom:function(e,t){A.modifySelectionDom(e,t)||S.modifySelectionDom(e,t)},replace:function(e,t,n){if(!e)return!1;var r,i,a=o();return a==e&&(t?(i=l.doc.createTextNode(t),r=l.doc.createElement("span"),r.appendChild(i),t=r.innerHTML,r=null,i=null):t="",b.execCommand("insertHTML",!1,t)),x.find(e,n)},replaceAll:function(e,t,n){if(!e)return!1;for(S.setRange(l.doc.body,0);x.replace(e,t,n););},setOriginalHtml:function(){D=C.getContentHtml()}};t.exports=x},{"../amend/amend":5,"../amend/amendUser":7,"../amend/amendUtils/amendExtend":9,"../blockUtils/blockCore":10,"../codeUtils/codeCore":12,"../common/const":16,"../common/dependLoader":17,"../common/env":18,"../common/historyUtils":19,"../common/utils":22,"../common/wizStyle":23,"../domUtils/domExtend":27,"../domUtils/selectPlugin":28,"../editor/commandExtend":31,"../formatPainterUtils/formatPainterCore":35,"../imgUtils/imgCore":37,"../rangeUtils/rangeExtend":43,"../tableUtils/tableCore":44,"../tableUtils/tableUtils":46,"../tableUtils/tableZone":47,"../todoUtils/todoCore":48,"./editorEvent":32,"./tabKey":34}],31:[function(e,t,n){"use strict";function o(){var e=[],t=g.getRange();if(!t)return e;var n=g.getRangeDetail(t.startContainer,t.startOffset).container,o=g.getRangeDetail(t.endContainer,t.endOffset).container,r=f.getBlockParent(n,!0);r&&r!==c.doc.body&&(n=r);var i=n===o?n:f.getParentRoot([n,o]);i!==c.doc.body&&(i=f.getBlockParent(i,!0)),f.isTag(i,["h1","h2","h3","h4","h5","h6"])&&e.push(i);var a,l=f.getIndexList(n).join("."),s=f.getIndexList(o).join(".");for(a=1;a<7;a++)e=e.concat(f.getListFromTagAndIndex("h"+a,i,l,s));return e}function r(){var e=[],t=g.getRange();if(!t)return e;for(var n,o,r,a,l,s,p,h,E,C,T,b,v=g.getRangeDetail(t.startContainer,t.startOffset).container,y=g.getRangeDetail(t.endContainer,t.endOffset).container,S=f.getBlockParent(v,!0),A=(f.getBlockParent(y,!0),f.getIndexList(y).join(".")),N=S;N&&(T=!1,a=!1,l=!1,s=!1,p=!1,h=!1,r=f.isBlock(N),b=f.getIndexList(N).join("."),!(u.compareVersion(b,A)>0)||!r&&E);){if(!r){if(a=3===N.nodeType&&u.isEmpty(N.nodeValue),E||a||(E=N),n=N.nextSibling){N=n;continue}T=!0}if(E&&(T||r)){for(C=N,N=c.doc.createElement("div"),T?f.after(N,C):f.before(N,C);E&&E!==N;)N.appendChild(E),E=E.nextSibling;e.push(N)}else if(r&&(s=!!f.getParentByClass(N,d.CLASS.CODE_CONTAINER,!0),s||(h=f.isWizDom(N),h||(p=!!f.getParentByClass(N,d.CLASS.TABLE_CONTAINER,!0))),!h&&!s&&!p))if(l=!!m.isLayer(N))e.push(N);else{if(o=i(N),o.hasBlock||!o.hasLine){N=N.firstChild;continue}if(f.isTag(N,"li")){for(n=c.doc.createElement("div"),f.after(n,N);N.firstChild;)n.appendChild(N.firstChild);N.appendChild(n),N=n}e.push(N)}for(E=null,C=null,n=N.nextSibling;!n&&N!==c.doc.body&&N.parentNode;)N=N.parentNode,n=N.nextSibling;N=n}return e}function i(e){var t,n,o,r=e.childNodes||[],i=!1,a=!1;for(t=0,n=r.length;t<n&&(o=r[t],f.isBlock(o)?i=!0:(1===o.nodeType||3===o.nodeType&&!f.isEmptyDom(o))&&(a=!0),!i||!a);t++);return{hasBlock:i,hasLine:a}}function a(e){var t=g.getRange();if(t){var n,i,a,l=g.getRangeDetail(t.startContainer,t.startOffset),s=g.getRangeDetail(t.endContainer,t.endOffset),d=f.getPreviousNode(l.container,!1)||c.doc.body,u=f.getNextNode(s.container,!1)||c.doc.body,m=o();for(n=0;n<m.length;n++)i=m[n],f.isTag(i,[e])||f.replaceTagName(i,e);var p=r();for(n=0;n<p.length;n++)a=p[n],f.replaceTagName(a,e);l.container.parentNode||(l={container:d,offset:f.getEndOffset(d)}),s.container.parentNode||(s={container:u,offset:0}),g.setRange(l.container,l.offset,s.container,s.offset)}}function l(e){return s(e)?(h.clearSubSup(),!1):c.doc.execCommand(e,!1)}function s(e){var t,n="subscript"===e?"sub":"sup",o=g.getRange();return o&&(t=g.getRangeDetail(o.startContainer,o.startOffset),t=t.container,t=f.getFirstDeepChild(t),t=f.getParentByTagName(t,n,!0)),!!t}var c=e("../common/env"),d=e("../common/const"),u=(e("../common/historyUtils"),e("../common/utils")),f=e("../domUtils/domExtend"),m=e("../todoUtils/todoUtils"),g=e("../rangeUtils/rangeExtend"),p={bind:function(){p.unbind(),c.event.add(d.EVENT.EXEC_COMMEND,p.handler.onExecCommand)},unbind:function(){c.event.remove(d.EVENT.EXEC_COMMEND,p.handler.onExecCommand)},handler:{onExecCommand:function(){h.execCommand.apply(this,arguments)}}},h={on:function(){p.bind()},off:function(){p.unbind()},clearSubSup:function(){var e,t,n,o,r,i,a,l=g.getRangeDomList({noSplit:!1});if(!l||0===l.list.length)return o=g.getRange(),void(o&&o.collapsed&&(r=f.createSpan(),r.innerHTML=d.FILL_CHAR+d.FILL_CHAR,o.insertNode(r),n=f.getParentByTagName(r,["sub","sup"],!0),n?(n=f.splitDomSingle(n,r),f.peelDom(n),g.setRange(r,1)):f.remove(r)));var s=f.getParentByTagName(l.list[0],["sub","sup"],!0);if(1===l.list.length)return n=f.splitDomSingle(s,l.list[0]),void(n?(i=n.firstChild,a=n.lastChild,f.peelDom(n),g.setRange(i,0,a,f.getEndOffset(a))):g.setRange(l.startDom,l.startOffset,l.endDom,l.endOffset));s&&f.splitDomBeforeSub(s,l.list[0]);var c=f.getParentByTagName(l.list[l.list.length-1],["sub","sup"],!0);c&&f.splitDomAfterSub(c,l.list[l.list.length-1]);var u=!1;for(e=0;e<l.list.length;e++)t=l.list[e],n=f.getParentByTagName(t,["sub","sup"],!0),0===e?i=t:e===l.list.length-1&&(a=t),n&&(0===e?i=n.firstChild:e===l.list.length-1&&(a=n.lastChild),f.peelDom(n),u=!0);u?g.setRange(i,0,a,f.getEndOffset(a)):g.fixRange(l)},execCommand:function(){var e,t,n,o=g.getRange();o&&o.collapsed&&(e=m.getMainByCaret(),t=m.getCheckbox(e),n=t?t.id:"");var r;r=/formatblock/i.test(arguments[0])?a(arguments[2]):/subscript|superscript/i.test(arguments[0])?l(arguments[0]):c.doc.execCommand.apply(c.doc,arguments);var i=arguments[0];if(/^(indent)|(outdent)|(insertOrderedList)|(insertUnorderedList)$/i.test(i)&&f.fixOrderList(),n&&(/^indent$/i.test(i)&&c.client.type.isIOS||/^outdent$/i.test(i))&&(/^outdent$/i.test(i)&&m.fixNewTodo(),t=c.doc.querySelector("#"+n),e=m.getMainFromChild(t),e&&m.isEmptyMain(e))){for(var s=m.getCheckbox(e);e.lastChild!==s;)e.removeChild(e.lastChild);var u=f.createSpan();f.after(u,s),u.innerHTML=d.FILL_CHAR+d.FILL_CHAR,g.setRange(u,1)}return f.fixFontSize(),c.event.call(d.EVENT.ON_EXEC_COMMAND),r},queryCommandState:function(e){var t;return t=/subscript|superscript/i.test(e)?s(e):c.doc.queryCommandState(e)}};t.exports=h},{"../common/const":16,"../common/env":18,"../common/historyUtils":19,"../common/utils":22,"../domUtils/domExtend":27,"../rangeUtils/rangeExtend":43,"../todoUtils/todoUtils":51}],32:[function(e,t,n){"use strict";function o(){L&&clearTimeout(L);var e=E.getRange(),t=T.getZone();!e&&!t.range||t.active||(L=setTimeout(r,200))}function r(){function e(e){return O.queryCommandState(e)?"1":"0"}var t,n,o,r={backColor:"",blockFormat:"",bold:"0",canCreateCode:"1",canCreateTable:"1",canCreateTodo:"1",clientTools:"1",fontName:"",fontSize:"",foreColor:"",formatPainterStatus:h.status().toString(),InsertOrderedList:"0",InsertUnorderedList:"0",italic:"0",justifyleft:"0",justifycenter:"0",justifyright:"0",justifyfull:"0",strikeThrough:"0",subscript:"0",superscript:"0",underline:"0"},i=E.getRange(),a=T.getZone(),l=[];if(i||a.range&&!a.active){a.grid&&a.range?(r.canCreateTable="0",r.canCreateCode="0"):i&&p.getContainerFromChild(i.startContainer)?(r.clientTools="0",r.canCreateCode="0",r.canCreateTable="0",r.canCreateTodo="0",r.canFormatPainter="0"):v.canCreateTodo()||(r.canCreateTodo="0"),!i||a.range&&!T.isSingleCell()?(o=b.getAlign(a.grid,a.range),n=T.getSelectedCells(),l=b.getDomsByCellList(n),r.justifyleft="left"===o.align?"1":"0",r.justifycenter="center"===o.align?"1":"0",r.justifyright="right"===o.align?"1":"0",t={"font-size":"","font-family":"","font-weight":"","font-style":"","text-decoration":"",color:"","background-color":""}):(r.blockFormat=s.doc.queryCommandValue("formatBlock"),r.fontName=s.doc.queryCommandValue("fontName"),r.foreColor=f.rgb2Hex(s.doc.queryCommandValue("foreColor")),r.backColor=f.rgb2Hex(s.doc.queryCommandValue("backColor")),r.bold=e("bold"),r.italic=e("italic"),r.underline=e("underline"),r.strikeThrough=e("strikeThrough"),r.subscript=e("subscript"),r.superscript=e("superscript"),r.justifyleft=e("justifyleft"),r.justifycenter=e("justifycenter"),r.justifyright=e("justifyright"),r.justifyfull=e("justifyfull"),r.InsertOrderedList=e("InsertOrderedList"),r.InsertUnorderedList=e("InsertUnorderedList"),t={"font-size":""},l=E.getRangeDomList({noSplit:!0}),l&&(l=l.list.length>0?l.list:[l.startDom]));var c,d,u,m,C;for(c=0,d=l.length;c<d;c++)if(C=l[c],3===C.nodeType||1===C.nodeType){C=3===C.nodeType?C.parentNode:l[c];for(u in t)if(t.hasOwnProperty(u)){if(m=g.getComputedStyle(C,u,!0),!m)continue;0===c?t[u]=m:t[u]!==m&&(t[u]="")}}var y=t["font-size"];y&&(r.fontSize=Math.round(parseFloat(y)/g.pt2px()/g.getRootSizeRate())+"pt"),y=t["font-family"],y&&(r.fontName=y),y=t["font-weight"],y&&/bold|bolder/.test(y)&&(r.bold="1"),y=t["font-style"],y&&/italic|oblique/.test(y)&&(r.italic="1"),y=t["text-decoration"],y&&/underline/.test(y)?r.underline="1":y&&/line\-through/.test(y)&&(r.strikeThrough="1"),"#f3f7ff"===r.backColor&&(r.backColor=""),R.triggerListener(_.SelectionChange,[r])}}function i(e,t){var n,o,r,i,a,l,d,p=T.getZone(),h=E.getRange(),v=!1,N=!0,O=[];return t=!!t,p.range||!h||h.collapsed||(a=h.cloneContents(),v=!!a.querySelector("."+c.CLASS.CODE_CONTAINER)),h&&(i=g.getParentRoot([h.startContainer,h.endContainer]),y.isAmendEditing()&&i&&i.getAttribute(c.ATTR.SPAN_DELETE)===S.getCurUser().hash)?(alert(t?u.Err.Cut_Null:u.Err.Copy_Null),void f.stopEvent(e)):void(!(p.range||h&&!h.collapsed&&(v||y.isAmendEditing()))||p.range&&h&&!h.collapsed||(!p.range||h&&!h.collapsed?h&&!h.collapsed&&(n=E.getFragmentForCopy()):n=T.getFragmentForCopy(),n&&(y.isAmendEditing()&&(o=n.innerHTML.length,y.fragmentFilter(n),r=n.innerHTML.length,0===r&&o>0&&(alert(u.Err.Copy_Null),N=!1)),N&&(e.clipboardData.clearData(),e.clipboardData.setData("text/plain",n.innerText),e.clipboardData.setData("text/html",n.innerHTML),t&&m.saveSnap(!1),t&&y.isAmendEditing()?(l=S.getCurUser(),d=A.getDeletedStyle(l),!p.range||h&&!h.collapsed?(A.removeSelection(l),A.removeUserDel(null,l),s.doc.getSelection().collapseToEnd(),E.caretFocus()):(O=b.getDomsByCellList(T.getSelectedCells()),E.modifyDomsStyle(O,d.style,d.attr,[]),A.removeUserDel(p.table,l))):t&&p.range&&(!h||h.collapsed)&&C.clearCellValue()),n.innerHTML="",n.parentNode&&n.parentNode.removeChild(n),n=null),f.stopEvent(e)))}function a(e){var t,n,o,r=[];for(t in e)n=e[t],o=("undefined"==typeof n?"undefined":l(n)).toLowerCase(),"string"!==o&&"number"!==o||("string"===o&&(n='"'+n.replace(/"/g,'\\"')+'"'),r.push('"'+t+'":'+n));return"{"+r.join(",")+"}"}var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=e("../common/env"),c=e("../common/const"),d=e("../common/lang"),u=d.getLang(),f=e("../common/utils"),m=e("../common/historyUtils"),g=e("../domUtils/domExtend"),p=e("../codeUtils/codeUtils"),h=e("../formatPainterUtils/formatPainterCore"),E=e("../rangeUtils/rangeExtend"),C=e("../tableUtils/tableCore"),T=e("../tableUtils/tableZone"),b=e("../tableUtils/tableUtils"),v=e("../todoUtils/todoUtils"),y=e("../amend/amend"),S=e("../amend/amendUser"),A=e("../amend/amendUtils/amendExtend"),N=e("./pasteUtils"),O=e("./commandExtend"),_={SelectionChange:"selectionchange"},D={selectionchange:[]},x={},L=null,R={TYPE:_,bind:function(){R.unbind(),s.doc.addEventListener("click",w.onClick),s.doc.addEventListener("compositionstart",w.onCompositionstart),s.doc.addEventListener("compositionend",w.onCompositionend),s.doc.addEventListener("copy",w.onCopy),s.doc.addEventListener("cut",w.onCut),s.doc.addEventListener("DOMSubtreeModified",w.onDOMSubtreeModified),s.doc.addEventListener("dragstart",w.onDragStart),s.doc.addEventListener("dragenter",w.onDragEnter),s.doc.addEventListener("drop",w.onDrop),s.doc.addEventListener("keydown",w.onKeydown),s.doc.addEventListener("keyup",w.onKeyup),s.doc.addEventListener("mousedown",w.onMousedown),s.doc.addEventListener("mousemove",w.onMousemove),s.doc.addEventListener("mouseover",w.onMouseover),s.doc.addEventListener("mouseup",w.onMouseup),s.doc.addEventListener("orientationchange",w.onOrientationchange),s.doc.addEventListener("paste",w.onPaste),s.doc.addEventListener("scroll",w.onScroll),s.doc.addEventListener("selectstart",w.onSelectionStart),s.doc.addEventListener("selectionchange",w.onSelectionChange),(s.client.type.isIOS||s.client.type.isAndroid)&&(s.doc.addEventListener("touchend",w.onTouchEnd),s.doc.addEventListener("touchstart",w.onTouchStart))},unbind:function(){s.doc.removeEventListener("click",w.onClick),s.doc.removeEventListener("compositionstart",w.onCompositionstart),s.doc.removeEventListener("compositionend",w.onCompositionend),s.doc.removeEventListener("copy",w.onCopy),s.doc.removeEventListener("cut",w.onCut),s.doc.removeEventListener("dragstart",w.onDragStart),s.doc.removeEventListener("dragenter",w.onDragEnter),s.doc.removeEventListener("drop",w.onDrop),s.doc.removeEventListener("keydown",w.onKeydown),s.doc.removeEventListener("keyup",w.onKeyup),s.doc.removeEventListener("mousedown",w.onMousedown),s.doc.removeEventListener("mousemove",w.onMousemove),s.doc.removeEventListener("mouseover",w.onMouseover),s.doc.removeEventListener("mouseup",w.onMouseup),s.doc.removeEventListener("orientationchange",w.onOrientationchange),s.doc.removeEventListener("paste",w.onPaste),s.doc.removeEventListener("scroll",w.onScroll),s.doc.removeEventListener("selectstart",w.onSelectionStart),s.doc.removeEventListener("selectionchange",w.onSelectionChange),s.doc.removeEventListener("touchend",w.onTouchEnd),s.doc.removeEventListener("touchstart",w.onTouchStart)},startTrackEvent:function(e,t){x[t]||(x[t]=function(e){s.client.sendCmdToWiznote(c.CLIENT_EVENT.WizEditorTrackEvent,{id:t,e:a(e)})},s.doc.addEventListener(e,x[t]))},stopTrackEvent:function(e,t){x[t]&&(s.doc.removeEventListener(e,x[t]),delete x[t])},addListener:function(e,t){if(t&&"function"==typeof t){var n=D[e];if(n){var r,i;for(r=0,i=n.length;r<i;r++)if(n[r]===t)return;n.push(t),e===_.SelectionChange&&s.event.add(c.EVENT.ON_SELECTION_CHANGE,o)}}},removeListener:function(e,t){if(!t||"function"==typeof t){var n=D[e];if(n){var r;for(r=n.length-1;r>=0;r--)n[r]!==t&&t||n.splice(r,1);0===n.length&&s.event.remove(c.EVENT.ON_SELECTION_CHANGE,o)}}},triggerListener:function(e,t){var n=D[e];if(n){var o,r,i;for(o=0,r=n.length;o<r;o++)i=n[o],i.apply(this,t)}}},w={onClick:function(e){s.event.call(c.EVENT.ON_CLICK,e)},onCompositionstart:function(e){s.event.call(c.EVENT.ON_COMPOSITION_START,e)},onCompositionend:function(e){s.event.call(c.EVENT.ON_COMPOSITION_END,e)},onCopy:function(e){p.getContainerFromChild(e.target)||i(e,!1)},onCut:function(e){p.getContainerFromChild(e.target)||(m.saveSnap(!1),i(e,!0),s.event.call(c.EVENT.ON_CUT,e))},onDOMSubtreeModified:function(e){s.event.call(c.EVENT.ON_DOM_SUBTREE_MODIFIED,e)},onDragStart:function(e){s.event.call(c.EVENT.ON_DRAG_START,e)},onDragEnter:function(e){s.event.call(c.EVENT.ON_DRAG_ENTER,e)},onDrop:function(e){s.event.call(c.EVENT.ON_DROP,e)},onKeydown:function(e){var t,n=E.getRange();n&&n.collapsed&&s.doc.body&&0===s.doc.body.childNodes.length&&(t=s.doc.createElement("div"),t.appendChild(s.doc.createElement("br")),s.doc.body.appendChild(t),E.setRange(t,1));var o=e.keyCode||e.which;if(!p.getContainerFromChild(e.target)){s.win.WizQtEditor&&s.client.type.isMac&&83===o&&(s.client.type.isLinux&&e.ctrlKey||!s.client.type.isLinux&&e.metaKey)&&s.win.WizQtEditor.saveCurrentNote();var r,i,a,l,d=T.getZone();return s.win.WizQtEditor&&s.client.type.isMac&&!d.range&&(r=s.doc.getSelection(),i=e.shiftKey?"extend":"move",e.metaKey&&37==o||e.ctrlKey&&65==o?(a="backward",l="lineboundary"):e.metaKey&&39==o||e.ctrlKey&&69==o?(a="forward",l="lineboundary"):e.metaKey&&38==o?(a="backward",l="documentboundary"):e.metaKey&&40==o?(a="forward",
l="documentboundary"):e.ctrlKey&&80==o?(a="backward",l="line"):e.ctrlKey&&78==o?(a="forward",l="line"):e.ctrlKey&&70==o?(a="forward",l="character"):e.ctrlKey&&66==o&&(a="backward",l="character")),a?(r.modify(i,a,l),void E.fixScroll()):void s.event.call(c.EVENT.ON_KEY_DOWN,e)}},onKeyup:function(e){s.event.call(c.EVENT.ON_KEY_UP,e),s.client.type.isIOS&&E.fixScroll()},onMousedown:function(e){s.event.call(c.EVENT.ON_MOUSE_DOWN,e)},onMousemove:function(e){s.event.call(c.EVENT.ON_MOUSE_MOVE,e)},onMouseover:function(e){s.event.call(c.EVENT.ON_MOUSE_OVER,e)},onMouseup:function(e){s.event.call(c.EVENT.ON_MOUSE_UP,e)},onOrientationchange:function(e){s.event.call(c.EVENT.ON_ORIENTATION_CHANGE,e),s.client.type.isIOS&&E.fixScroll()},onPaste:function(e){N.pasteFromClipBoard(e)&&s.event.call(c.EVENT.ON_PASTE,e)},onScroll:function(e){s.event.call(c.EVENT.ON_SCROLL,e)},onSelectionStart:function(e){s.event.call(c.EVENT.ON_SELECT_START,e)},onSelectionChange:function(e){s.event.call(c.EVENT.ON_SELECTION_CHANGE,e),s.client.type.isIOS&&E.fixScroll()},onTouchEnd:function(e){s.event.call(c.EVENT.ON_TOUCH_END,e)},onTouchStart:function(e){s.event.call(c.EVENT.ON_TOUCH_START,e)}};t.exports=R},{"../amend/amend":5,"../amend/amendUser":7,"../amend/amendUtils/amendExtend":9,"../codeUtils/codeUtils":14,"../common/const":16,"../common/env":18,"../common/historyUtils":19,"../common/lang":20,"../common/utils":22,"../domUtils/domExtend":27,"../formatPainterUtils/formatPainterCore":35,"../rangeUtils/rangeExtend":43,"../tableUtils/tableCore":44,"../tableUtils/tableUtils":46,"../tableUtils/tableZone":47,"../todoUtils/todoUtils":51,"./commandExtend":31,"./pasteUtils":33}],33:[function(e,t,n){"use strict";function o(e){var t,n,o=/<body[^>]*>((\r?\n|.)*)(\r?\n)*<\/body>/gi,r=/<head[^>]*>((\r?\n|.)*)(\r?\n)*<\/head>/i,i=/<style[^>]*>[^<>]*<\/style>/gi,a=o.exec(e);if(a){if(t=r.exec(e),e="",t)for(t=t[1],t=t.replace(/<!--.*?(-->)/g,"");null!==(n=i.exec(t));)n.index===i.lastIndex&&i.lastIndex++,e+=n[0];e+=a[1]}else{e=e.replace(/<!--.*?(-->)/g,"");var l,s,c,d,u=[/<body( [^<>]*)?>/i,/<html( [^<>]*)?>/i],f=[/<\/body>/i,/<\/html>/i];for(c=0,d=u.length;c<d;c++)if(s=u[c],l=e.match(s)){e=e.substr(l.index+l[0].length);break}for(c=0,d=f.length;c<d;c++)s=f[c],l=e.match(s),l&&(e=e.substr(0,l.index))}return e=e.replace(/(^(\r?\n)*)|((\r?\n)*$)/g,""),e=e.replace(/\u00A0/gi,"&nbsp;"),e=m.clearStyleFromHtml(e,["display","color","width","font-family","font-size","font-style","font-weight","text-align","text-indent","background*","text-decoration*","padding*","margin*","list*","border*"]),e=g.xssFilter(e)}function r(e){var t=/	/g,n=/  /g;e=(e||"").replace(t,"    ").replace(n,"  ");var o,r,i,a=[],l=e.split(/\r?\n/);for(r=0;r<l.length;r++)o=l[r],i=o?c.doc.createTextNode(o):c.doc.createElement("br"),a.push(i);return a}function i(){var e,t=(c.doc.getSelection(),h.getRange()),n=h.getRangeDetail(t.startContainer,t.startOffset),o=m.getParentByTagName(n.container,["li","td","th"],!0);m.isEmptyDom(o)?(e=c.doc.createElement("span"),e.innerHTML=d.FILL_CHAR,h.setRange(o,0,o,m.getEndOffset(o)),t=h.getRange(),t.deleteContents(),t.insertNode(e),h.setRangeToEnd(e),S.execCommand("insertparagraph"),o.innerHTML="<br>"):S.execCommand("insertparagraph")}function a(e){var t,n,o,a,l,s=c.doc.createElement("div"),d=r(e),u=c.doc.getSelection(),f=!0;for(n=0;n<d.length;n++)s.appendChild(d[n]);for(;s.firstChild;)l=s.firstChild,f||i(),t=h.getRange(),m.isTag(l,"br")?s.removeChild(l):(o=h.getRangeDetail(t.startContainer,t.startOffset),a=m.getParentByTagName(o.container,["li","td","th"],!0),m.isEmptyDom(a)&&h.setRange(a,0,a,m.getEndOffset(a)),t=h.getRange(),t.deleteContents(),t.insertNode(l),h.setRangeToEnd(l)),u.collapseToEnd(),f=!1}function l(e,t){var n,o=c.doc.createElement("div");b.isAmendEditing()?b.readyForPaste():(n=y.fixedAmendRange(),b.splitAmendDomByRange(n));var r,i,l,s,d,u,f=(c.doc.getSelection(),h.getRange()),g=null;if(e)for(o.innerHTML=e,p.pastePatch.ready(o),r=h.getRangeDetail(f.startContainer,f.startOffset),i=m.getParentByTagName(r.container,["li","td","th"],!0),m.isEmptyDom(i)&&(h.setRange(i,0,i,m.getEndOffset(i)),f=h.getRange());o.firstChild;)f=h.getRange(),r=h.getRangeDetail(f.startContainer,f.startOffset),u=m.getBlockParent(r.container,!0),l=m.getParentByTagName(u,["pre"],!0),l&&(u=l),d=o.firstChild,/^h[1-6]$/i.test(u.tagName)&&(d.tagName===u.tagName||3===d.nodeType||m.isTag(d,["span"]))?(s=c.doc.createElement("span"),s.appendChild(c.doc.createTextNode(3===d.nodeType?d.nodeValue:d.innerText)),f.deleteContents(),f.insertNode(s),o.removeChild(d),d=s):/^h[1-6]$/i.test(u.tagName)||/^h[1-6]$/i.test(d.tagName)&&u!==c.doc.body?(s=c.doc.createElement("span"),f.insertNode(s),u=m.splitDomBeforeSub(u,s),m.after(d,u),m.isEmptyDom(u)?m.remove(u):m.remove(s)):g?m.after(d,g):f.insertNode(d),h.setRangeToEnd(d),g=d;else a(t);p.pastePatch.fix()}function s(e,t){var n,o,r,i,a,s,d,u,f,g,S,A,N,O=h.getRange(),_=C.getZone();if(e?(n=T.getTemplateByHtmlForPaste(e),n.isHtml=!0,p.pastePatch.ready(n.pasteDom,!0)):t&&!C.isSingleCell()?(n=T.getTemplateByTxtForPaste(t),n.isHtml=!0):n={isTable:!1,isHtml:!1,pasteDom:c.doc.createElement("div")},n.isTable){for(r=T.getTableGrid(n.pasteDom),s=r.length,a=r[0]?r[0].length:0,u=_.grid.length-_.range.minY-s,d=_.grid[0].length-_.range.minX-a,A=u;A<0;A++)E.insertRow(!1);for(S=d;S<0;S++)E.insertCol(!1);_=C.getZone(),e?(g=Math.max(_.range.minY+s-1,_.range.maxY),f=Math.max(_.range.minX+a-1,_.range.maxX)):(g=_.range.minY+s-1,f=_.range.minX+a-1),T.eachRange(_.grid,{minY:_.range.minY,maxY:g,minX:_.range.minX,maxX:f},function(e){if(!e.fake)if(N=e.cell,i=r[(e.y-_.range.minY)%s][(e.x-_.range.minX)%a],b.isAmendEditing()){if(h.setRange(N,0,N.lastChild,m.getEndOffset(N.lastChild)),y.removeSelection(v.getCurUser()),y.removeUserDel(N,v.getCurUser()),i.fake)return;if(m.isEmptyDom(N))N.innerHTML=i.cell.innerHTML;else for(;i.cell.firstChild;)N.appendChild(i.cell.firstChild);b.fixPaste(N.firstChild,N.lastChild,v.getCurUser())}else N.innerHTML=i.fake?"":i.cell.innerHTML}),C.setStart(_.grid[_.range.minY][_.range.minX].cell).setEnd(_.grid[g][f].cell)}else!O&&_.range&&(o=_.grid[_.range.minY][_.range.minX].cell,C.setStart(o).setEnd(o),h.setRange(o,0,o.lastChild,m.getEndOffset(o.lastChild))),l(e,t)}var c=e("../common/env"),d=e("../common/const"),u=e("../common/utils"),f=e("../common/historyUtils"),m=e("../domUtils/domExtend"),g=e("../domUtils/xssUtils"),p=e("../codeUtils/codeUtils"),h=e("../rangeUtils/rangeExtend"),E=e("../tableUtils/tableCore"),C=e("../tableUtils/tableZone"),T=e("../tableUtils/tableUtils"),b=e("../amend/amend"),v=e("../amend/amendUser"),y=e("../amend/amendUtils/amendExtend"),S=e("./commandExtend"),A={pasteForIOS:function(e){e&&u.stopEvent(e);var t=c.doc.getSelection();h.backupCaret(),t.removeAllRanges(),setTimeout(function(){h.restoreCaret(),e&&c.client.sendCmdToWiznote(d.CLIENT_EVENT.WizEditorPaste)},0)},pasteFromClipBoard:function(e){if(p.getContainerFromChild(e.target))return!1;if(c.client.type.isIOS)return A.pasteForIOS(e),!1;var t=e.clipboardData.getData("text/html")||"",n=e.clipboardData.getData("text/plain");return A.paste(t,n),u.stopEvent(e),!0},pasteFromClient:function(e,t){A.paste(e,t)},paste:function(e,t){e=o(e),e=u.replaceSpecialChar(e),t=u.replaceSpecialChar(t);var n=h.getRange(),r=C.getZone();if((n||r.table||r.range)&&(e||t)){var i=p.getContainerFromChild(n.startContainer);if(i)return void p.insertCodeSrc(i,t);f.saveSnap(!1),r.table||r.range?s(e,t):l(e,t),m.fixOrderList();var a,c,d=p.oldPatch.fixOldCode();for(a=0;a<d.length;a++)c=d[a],p.fixCodeContainer(c)}}};t.exports=A},{"../amend/amend":5,"../amend/amendUser":7,"../amend/amendUtils/amendExtend":9,"../codeUtils/codeUtils":14,"../common/const":16,"../common/env":18,"../common/historyUtils":19,"../common/utils":22,"../domUtils/domExtend":27,"../domUtils/xssUtils":29,"../rangeUtils/rangeExtend":43,"../tableUtils/tableCore":44,"../tableUtils/tableUtils":46,"../tableUtils/tableZone":47,"./commandExtend":31}],34:[function(e,t,n){"use strict";function o(e){var t=c.getRange(),n=d.getZone();if(!t||n.range)return!1;if(e)return f.saveSnap(!1),r.client.type.isMac?setTimeout(function(){s.execCommand("outdent")},10):s.execCommand("outdent"),!0;var o=t.startContainer,i=t.startOffset,a=c.getRangeDetail(o,i),g=l.isTag(o,["ul","ol","li"]),p=u.isCaretAfterCheckbox(),h=l.getParentByTagName(o,["ul","ol","li"],!1),E=!1,C=a.container;if(h&&0===a.offset)for(;C!==r.doc.body;){if(C.previousSibling){E=!1;break}if(E=!0,C=C.parentNode,C===h)break}return!l.isTag(o,["td","th"])&&(!t.collapsed||p||E||g?(f.saveSnap(!1),r.client.type.isMac?setTimeout(function(){s.execCommand("indent")},10):s.execCommand("indent"),!0):!(3!==o.nodeType&&!l.getParentByTagName(o,["a","b","body","div","font","html","i","p","span","strong","u"]))&&(f.saveSnap(!1),s.execCommand("insertHTML",!1,m),!0))}var r=e("../common/env"),i=e("../common/const"),a=e("../common/utils"),l=e("../domUtils/domExtend"),s=e("../editor/commandExtend"),c=e("../rangeUtils/rangeExtend"),d=e("../tableUtils/tableZone"),u=e("../todoUtils/todoUtils"),f=e("../common/historyUtils"),m="&nbsp; &nbsp;&nbsp;",g={bind:function(){g.unbind(),r.event.add(i.EVENT.ON_KEY_DOWN,g.handler.onKeyDown)},unbind:function(){r.event.remove(i.EVENT.ON_KEY_DOWN,g.handler.onKeyDown)},handler:{onKeyDown:function(e){var t=e.keyCode||e.which;9===t&&o(e.shiftKey)&&a.stopEvent(e)}}},p={init:function(e){m=e},on:function(){g.bind()},off:function(){g.unbind()}};t.exports=p},{"../common/const":16,"../common/env":18,"../common/historyUtils":19,"../common/utils":22,"../domUtils/domExtend":27,"../editor/commandExtend":31,"../rangeUtils/rangeExtend":43,"../tableUtils/tableZone":47,"../todoUtils/todoUtils":51}],35:[function(e,t,n){"use strict";function o(){s={style:null,tagList:[]}}function r(e){return"h"===e.charAt(0)||"div"===e}function i(e){return/sub|sup/i.test(e)}function a(e){for(var t,n,o,a=T.concat(),d={},u=b.concat(v,y),f={},g=!1,p=!1,h=!1,E=!1,S=1===e.nodeType?e:e.parentNode,A=S;A&&A!==c.doc.body;)l(S,A,a,d),A=A.parentNode;for(o=a.length-1;o>=0;o--)d[a[o]]=null;for(s.style=d,A=e;A;)A=m.getParentByTagName(A,u,!0),A&&(t=A.tagName.toLowerCase(),n={name:t,enabled:!0},r(t)?(s.tagList.splice(0,0,n),g=!0):i(t)?(s.tagList.push(n),p=!0):(s.tagList.push(n),/^i$/i.test(t)?h=!0:/^b$/i.test(t)&&(E=!0)),f[t]=1,A=A.parentNode);for(g||s.tagList.splice(0,0,{name:"div",enabled:!0}),p||s.tagList.push({name:"sub",enabled:!1}),o=0;o<u.length;o++)t=u[o],r(t)||i(t)||f[t]||s.tagList.push({name:t,enabled:!1});var N=C.getZone();N.range?delete s.style["text-align"]:(t=s.style["text-align"]?"text-align-"+s.style["text-align"]:"text-align-left",delete s.style["text-align"],s.tagList.push({name:t,enabled:!0}))}function l(e,t,n,o){var r,i,a,l=c.win.getComputedStyle(e);for(a=n.length-1;a>=0;a--)r=n[a],i=t.style[r],!i&&"color"===r&&m.isTag(t,"font")&&(i=t.getAttribute(r)),i&&m.getFontSizeRem(i)===m.getFontSizeRem(l[r])&&(n.splice(a,1),o[r]=i)}var s,c=e("../common/env"),d=e("../common/const"),u=e("../common/wizStyle"),f=e("../common/historyUtils"),m=(e("../common/utils"),e("../domUtils/domExtend")),g=e("../editor/commandExtend"),p=e("../rangeUtils/rangeExtend"),h=e("../codeUtils/codeUtils"),E=e("../tableUtils/tableCore"),C=e("../tableUtils/tableZone"),T=["background","background-color","color","font-family","font-size","font-weight","font-style","text-decoration","text-align"],b=["h1","h2","h3","h4","h5","h6"],v=["sub","sup"],y=["b","i","u","strike"],S={b:"bold",div:"formatBlock",h1:"formatBlock",h2:"formatBlock",h3:"formatBlock",h4:"formatBlock",h5:"formatBlock",h6:"formatBlock",i:"italic",strike:"strikeThrough",sub:"subscript",sup:"superscript",u:"underline","text-align-center":"justifyCenter","text-align-justify":"justifyFull","text-align-left":"JustifyLeft","text-align-right":"JustifyRight"},A=!1,N={bind:function(){N.unbind(),c.event.add(d.EVENT.ON_KEY_DOWN,N.handler.onKeyDown),c.event.add(d.EVENT.ON_MOUSE_UP,N.handler.onMouseUp)},unbind:function(){c.event.remove(d.EVENT.ON_KEY_DOWN,N.handler.onKeyDown),c.event.remove(d.EVENT.ON_MOUSE_UP,N.handler.onMouseUp)},handler:{onKeyDown:function(e){var t=e.keyCode||e.which;27===t&&O.off()},onMouseUp:function(){if(s.style){f.saveSnap(!1);var e,t,n,o=C.getZone();o.range&&(delete s.tagList["text-align-left"],delete s.tagList["text-align-right"]);var a,l,c,d;for(a=0;a<s.tagList.length;a++)l=s.tagList[a],c=S[l.name],r(l.name)?g.execCommand(c,!1,l.name):i(l.name)?l.enabled?g.execCommand(c,!1):g.clearSubSup():(d=g.queryCommandState(c),l.enabled&&!d?g.execCommand(c,!1):!l.enabled&&d?g.execCommand(c,!1):(g.execCommand(c,!1),e=p.getRange(),e&&(t=p.getRangeDetail(e.startContainer,e.startOffset),n=p.getRangeDetail(e.endContainer,e.endOffset)),g.execCommand(c,!1),e&&p.setRange(t.container,t.offset,n.container,n.offset)));E.modifySelectionDom(s.style,null)||p.modifySelectionDom(s.style,null),A||O.init()}}}},O={init:function(){O.off()},on:function(e){if(o(),A=!!e,0===O.status())return 0;var t,n=p.getRange(),r=C.getZone(),i=0;return n?(t=p.getRangeDetail(n.startContainer,n.startOffset),i=t.offset,t=t.container):t=r.start.cell,t=m.getFirstDeepChild(t),a(t,i),N.bind(),u.insertStyle({id:d.ID.FORMAT_PAINTER_STYLE,name:d.NAME.TMP_STYLE},'body {cursor:url("'+c.dependency.files.cursor.formatPainter+'"), auto;}'),2},off:function(){return o(),u.removeStyleById(d.ID.FORMAT_PAINTER_STYLE),N.unbind(),O.status()},status:function(){if(c.readonly||c.client.type.isPhone||c.client.type.isPad)return 0;var e=p.getRange(),t=C.getZone();return!e&&!t.range||t.active?0:e&&h.getContainerFromChild(e.startContainer)?0:s&&s.style?2:1}};t.exports=O},{"../codeUtils/codeUtils":14,"../common/const":16,"../common/env":18,"../common/historyUtils":19,"../common/utils":22,"../common/wizStyle":23,"../domUtils/domExtend":27,"../editor/commandExtend":31,"../rangeUtils/rangeExtend":43,"../tableUtils/tableCore":44,"../tableUtils/tableZone":47}],36:[function(e,t,n){"use strict";function o(e){var t=new RegExp("("+s.CLASS.IMG_NOT_DRAG+")|("+s.CLASS.IMG_ATTACHMENT+")","i"),n=!(!e||!d.isTag(e,"img")||t.test(e.className)||!e.src);if(!n)return n;var o;return l.readonly?(o=d.getParentByFilter(e,function(e){return e&&d.isTag(e,"a")&&/^(http|https|wiz|wiznote|wiznotecmd):/.test(e.getAttribute("href"))},!0),!o):(o=d.getParentByFilter(e,function(e){return e&&d.isTag(e,"a")&&/^(wiz|wiznote|wiznotecmd):open_attachment/.test(e.getAttribute("href"))},!0),!o)}function r(e){var t=e.target;if(o(t))return l.client.sendCmdToWiznote(s.CLIENT_EVENT.WizReaderClickImg,{src:t.src,imgList:l.client.type.isIOS?null:u.getAll(!0)}),c.stopEvent(e),!1}function i(e){var t=e.target;if(o(t)){var n,r=l.doc.querySelectorAll("img["+s.ATTR.IMG_EDITING+"]"),i={};for(i[s.ATTR.IMG_EDITING]="",n=r.length-1;n>=0;n--)d.attr(r[n],i);i[s.ATTR.IMG_EDITING]=1,d.attr(t,i),l.client.sendCmdToWiznote(s.CLIENT_EVENT.WizEditorClickImg,{src:t.src})}}function a(){}var l=e("./../common/env"),s=e("./../common/const"),c=e("./../common/utils"),d=e("./../domUtils/domExtend"),u=e("./imgUtils"),f={bind:function(){f.unbind(),l.client.type.isIOS||l.client.type.isAndroid?l.event.add(s.EVENT.ON_CLICK,f.handler.onClick):l.readonly&&(l.client.type.isWin||l.client.type.isMac||l.client.type.isLinux)&&l.event.add(s.EVENT.ON_DBLCLICK,f.handler.onClick)},unbind:function(){l.event.remove(s.EVENT.ON_CLICK,f.handler.onClick)},handler:{onClick:function(e){l.readonly?r(e):l.client.type.isAndroid&&i(e)}}},m={init:a,bind:f.bind,unbind:f.unbind};t.exports=m},{"./../common/const":16,"./../common/env":18,"./../common/utils":22,"./../domUtils/domExtend":27,"./imgUtils":39}],37:[function(e,t,n){"use strict";var o=e("./../common/env"),r=e("./imgResize"),i=e("./imgClick"),a={on:function(){o.client.type.isPhone||o.client.type.isPad||(r.init(),r.bind()),i.init(),i.bind()},off:function(){o.client.type.isPhone||o.client.type.isPad||r.unbind(),i.unbind()},setImgFullPath:function(){var e,t,n,r=o.doc.querySelectorAll("img"),i=new RegExp("^(\\.\\/)?"+o.options.indexFilesPath.escapeRegex()+"\\/","i");for(e=r.length-1;e>=0;e--)t=r[e],n=t.getAttribute("src"),i.test(n)&&t.setAttribute("src",n.replace(i,o.options.indexFilesFullPath))}};t.exports=a},{"./../common/env":18,"./imgClick":36,"./imgResize":38}],38:[function(e,t,n){"use strict";function o(){S=N.doc.body.style.cursor||"",N.win.WizImgResizeOnGetHTML=function(){}}function r(e){if(e&&e.tagName&&"img"==e.tagName.toLowerCase()&&m(e)){var t=a();t&&(c(e),f(e),k.bindContainer(t))}}function i(){d(),u(),y=null,N.doc.body.style.cursor=S}function a(){var e=l();if(e)return e;e=N.doc.createElement(O.TAG.TMP_TAG),D.addClass(e,O.CLASS.IMG_RESIZE_CONTAINER),e.setAttribute("contenteditable","false"),e.setAttribute(w,"unsave");for(var t=0;t<L.length;t++){var n=N.doc.createElement("div");D.addClass(n,O.CLASS.IMG_RESIZE_HANDLE),D.addClass(n,L[t]),D.attr(n,{"data-type":L[t]}),e.appendChild(n)}return N.doc.body.appendChild(e),e}function l(){var e=N.doc.body.querySelector("."+O.CLASS.IMG_RESIZE_CONTAINER);return!e||e.length<1?null:e}function s(e,t){if(e&&t){var n=e.offset,o=n.left,r=n.top,i=e.width,a=e.height,l=t.getAttribute("data-type"),s=0,c=0;switch(l){case"lt":s=o-7,c=r-7;break;case"tm":s=o+(i-7)/2,c=r-7;break;case"rt":s=o+i,c=r-7;break;case"rm":s=o+i,c=r+(a-7)/2;break;case"rb":s=o+i,c=r+a;break;case"bm":s=o+(i-7)/2,c=r+a;break;case"lb":s=o-7,c=r+a;break;case"lm":s=o-7,c=r+(a-7)/2}D.css(t,{left:s+"px",top:c+"px"})}}function c(e){if(e){var t=l();if(t)for(var n=t.querySelectorAll("."+O.CLASS.IMG_RESIZE_HANDLE),o={offset:D.getOffset(e),width:e.width,height:e.height},r=0;r<n.length;r++){var i=n[r];s(o,i),i.style.visibility="inherit"}}}function d(){var e=N.doc.querySelectorAll("."+O.CLASS.IMG_RESIZE_ACTIVE);if(e&&0!==e.length){var t;for(t=e.length-1;t>=0;t--)D.removeClass(e[t],O.CLASS.IMG_RESIZE_ACTIVE)}}function u(){var e=l();e&&(k.unbindContainer(e),D.remove(e))}function f(e){if(e){d(),D.addClass(e,O.CLASS.IMG_RESIZE_ACTIVE),e.attributes[O.ATTR.IMG_RATE]=e.width/e.height,y=e;var t=D.getIndex(e);x.setRange(e.parentNode,t,e.parentNode,t+1)}}function m(e){if(!e)return!1;var t=e.getAttribute("class");return!t||-1===t.indexOf(O.CLASS.IMG_NOT_DRAG)}function g(e){var t=l();t&&(t.style.display=e?"block":"none",e||i())}function p(e,t,n,o){if(o){var r=n*e,i=t/e;r<t?r=t:i=n,o.width=r,o.height=i}}var h,E,C,T,b,v,y,S,A,N=e("./../common/env"),O=e("./../common/const"),_=e("./../common/utils"),D=e("./../domUtils/domExtend"),x=e("../rangeUtils/rangeExtend"),L=["lt","tm","rt","rm","rb","bm","lb","lm"],R="",w="wiz_style",I=!1,M=null,k={bind:function(){k.unbind(),N.event.add(O.EVENT.BEFORE_GET_DOCHTML,k.handler.beforeGetDocHtml),N.event.add(O.EVENT.ON_CUT,k.handler.onCut),N.event.add(O.EVENT.ON_KEY_DOWN,k.handler.onKeyDown),N.event.add(O.EVENT.ON_MOUSE_DOWN,k.handler.onMouseDown),N.event.add(O.EVENT.ON_MOUSE_MOVE,k.handler.onMouseMove),N.event.add(O.EVENT.ON_MOUSE_UP,k.handler.onMouseUp)},bindContainer:function(e){k.unbindContainer(e),e.addEventListener("mousedown",k.handler.onContainerMouseDown)},unbind:function(){N.event.remove(O.EVENT.BEFORE_GET_DOCHTML,k.handler.beforeGetDocHtml),N.event.remove(O.EVENT.ON_CUT,k.handler.onCut),N.event.remove(O.EVENT.ON_KEY_DOWN,k.handler.onKeyDown),N.event.remove(O.EVENT.ON_MOUSE_DOWN,k.handler.onMouseDown),N.event.remove(O.EVENT.ON_MOUSE_MOVE,k.handler.onMouseMove),N.event.remove(O.EVENT.ON_MOUSE_UP,k.handler.onMouseUp)},unbindContainer:function(e){e.removeEventListener("mousedown",k.handler.onContainerMouseDown)},handler:{beforeGetDocHtml:function(){i()},onCut:function(e){g(!1)},onKeyDown:function(e){var t,n,o=e.keyCode||e.which;!y||8!==o&&46!==o||(t=y.parentNode,t&&(n=D.getIndex(y),x.setRange(t,n,t,n+1))),g(!1)},onContainerMouseDown:function(e){var t=e.target||e.srcElement;R=t.getAttribute("data-type");var n,o,r,i=N.doc.querySelector("."+O.CLASS.IMG_RESIZE_ACTIVE);if(i){switch(n=e.pageX,o=e.pageY,r=D.getOffset(i),R){case"lt":h=r.left-n,E=r.top-o,b=r.left+i.width,v=r.top+i.height,A="nw-resize";break;case"tm":h=void 0,E=r.top-o,A="n-resize";break;case"rt":h=n-i.width-r.left,E=r.top-o,b=r.left,v=r.top+i.height,A="ne-resize";break;case"rm":h=n-i.width-r.left,E=void 0,A="e-resize";break;case"rb":h=n-i.width-r.left,E=o-i.height-r.top,A="se-resize";break;case"bm":h=void 0,E=o-i.height-r.top,b=r.left/2,v=r.top,A="s-resize";break;case"lb":h=r.left-n,E=o-i.height-r.top,b=r.left+i.width,v=r.top,A="sw-resize";break;case"lm":h=r.left-n,E=void 0,A="w-resize"}_.stopEvent(e)}},onDrop:function(e){N.doc.removeEventListener("drop",k.handler.onDrop),y===M&&i(),I=!1,M=null},onMouseDown:function(e){var t=e.target||e.srcElement;D.isTag(t,"img")?(I=!0,M=t,N.doc.addEventListener("drop",k.handler.onDrop)):(I=!1,M=null),e.target!==y&&(g(!1),d())},onMouseMove:function(e){var t,n,o,r,i,a=e.target||e.srcElement;if(a&&a===M&&(r=D.getIndex(e.target),i=a,x.setRange(i.parentNode,r,i.parentNode,r+1)),i=N.doc.querySelector("."+O.CLASS.IMG_RESIZE_ACTIVE),i&&(t=D.getOffset(i),R)){n=e.pageX,o=e.pageY,N.doc.body.style.cursor=A;var l,s,d,u,f;switch(C&&T||(C=n,T=o),R){case"tm":i.width=i.width,o<t.top?i.height+=T-o:(f=i.height-(o-T)-E,i.height=f<0?0:f);break;case"rm":u=n-t.left-h,i.width=u<0?0:u,i.height=i.height,i.attributes[O.ATTR.IMG_RATE]=i.width/i.height;break;case"bm":i.width=i.width,f=o-v-E,i.height=f<0?0:f,i.attributes[O.ATTR.IMG_RATE]=i.width/i.height;break;case"lm":i.height=i.height,n<t.left?i.width+=C-n:(u=i.width-(n-C)-h,i.width=u<0?0:u);break;case"lt":l=Number(i.attributes[O.ATTR.IMG_RATE]),s=b-n,d=v-o,s-=h,d-=E,s=s<0?0:s,d=d<0?0:d,p(l,s,d,i);break;case"rt":l=Number(i.attributes[O.ATTR.IMG_RATE]),s=n-b,d=v-o,s-=h,d-=E,s=s<0?0:s,d=d<0?0:d,p(l,s,d,i);break;case"lb":l=Number(i.attributes[O.ATTR.IMG_RATE]),s=b-n,d=o-v,s-=h,d-=E,s=s<0?0:s,d=d<0?0:d,p(l,s,d,i);break;case"rb":l=Number(i.attributes[O.ATTR.IMG_RATE]),s=n-t.left,d=o-t.top,s-=h,d-=E,s=s<0?0:s,d=d<0?0:d,p(l,s,d,i)}if(i.style.cssText){var m=i.style.cssText;m=m.replace(/width:\s*\d+.?\d+px;?/gi,"width: "+i.width+"px").replace(/height:\s*\d+.?\d+px;?/gi,"height: "+i.height+"px"),i.style.cssText=m}C=n,T=o,c(i),N.event.call(O.EVENT.UPDATE_RENDER,null)}},onMouseUp:function(e){N.doc.removeEventListener("drop",k.handler.onDrop),I=!1,M=null;var t=e.target||e.srcElement;D.isTag(t,"img")&&r(t),R="",C=void 0,T=void 0,b=void 0,v=void 0,h=void 0,E=void 0,N.doc.body.style.cursor=S}}},P={init:o,bind:k.bind,unbind:k.unbind};t.exports=P},{"../rangeUtils/rangeExtend":43,"./../common/const":16,"./../common/env":18,"./../common/utils":22,"./../domUtils/domExtend":27}],39:[function(e,t,n){"use strict";function o(e,t){if(!e||e.className&&e.className.indexOf("wiz-todo")>-1)return!1;var n=e.src;if(!n)return!1;var o,r=/^(http|https|ftp):/,i=/^(data):/;return o=!i.test(n),o&&t?!r.test(n):o}var r=e("./../common/env"),i=e("./../common/const"),a=e("./../domUtils/domBase"),l={getAll:function(e){var t,n,i=r.doc.images,a=[],l={};for(t in i)i.hasOwnProperty(t)&&(n=decodeURIComponent(i[t].src),o(i[t],e)&&!l[n]&&(a.push(n),l[n]=!0));return a},getImageSize:function(e){var t=new Image;t.src=e;var n=t.height,o=t.width;return{width:o,height:n}},getImageData:function(e){var t=l.getImageSize(e.src),n=r.doc.createElement("canvas");n.width=t.width,n.height=t.height;var o=n.getContext("2d");o.drawImage(e,0,0);var i=n.toDataURL("image/png");return i.replace(/^data:image\/(png|jpg);base64,/,"")},makeAttachmentDom:function(e,t){var n,o,l,s=[];return n=r.doc.createElement("div"),n.style.margin="10px auto",o=r.doc.createElement("a"),o.href="wiz://open_attachment?guid="+e,l=r.doc.createElement("img"),l.src=t,l.style.verticalAlign="bottom",l.style.maxWidth="280px",a.addClass(l,i.CLASS.IMG_ATTACHMENT),o.appendChild(l),n.appendChild(o),s.push(n),n=r.doc.createElement("div"),n.appendChild(r.doc.createElement("br")),s.push(n),s},makeDomByPath:function(e){var t,n,o,i,a=[],l=[];for(e.indexOf("*")?l=e.split("*"):l.push(e),o=0,i=l.length;o<i;o++)t=r.doc.createElement("div"),a.push(t),n=r.doc.createElement("img"),n.src=l[o],n.style.verticalAlign="bottom",n.style.maxWidth="100%",t.insertBefore(n,null),t=r.doc.createElement("div"),t.insertBefore(r.doc.createElement("br"),null),a.push(t);return a},remove:function(e){var t,n,o=r.doc.querySelectorAll(e);for(n=o.length-1;n>=0;n--)t=o[n],t.parentElement.removeChild(t)},replaceSrc:function(e,t){var n,o,l=r.doc.querySelectorAll(e),s={};for(s[i.ATTR.IMG_EDITING]="",o=l.length-1;o>=0;o--)n=l[o],n.src=t,a.attr(n,s)}};t.exports=l},{"./../common/const":16,"./../common/env":18,"./../domUtils/domBase":26}],40:[function(e,t,n){"use strict";function o(){var e,t,n,o,i=d.getRange();i&&(e=r(i.startContainer,i.startOffset),e?t=0:(e=i.startContainer,t=i.startOffset),i.collapsed?(n=e,o=s.getEndOffset(e)):(n=r(i.endContainer,i.endOffset),n?o=s.getEndOffset(n):(n=i.endContainer,o=i.endOffset)),d.setRange(e,t,n,o))}function r(e,t){return 1===e.nodeType&&e.childNodes.length>t&&(e=e.childNodes[t]),s.getParentByTagName(e,"a",!0)}var i=e("../common/env"),a=e("../common/const"),l=e("../common/historyUtils"),s=e("../domUtils/domExtend"),c=e("../editor/commandExtend"),d=e("../rangeUtils/rangeExtend"),u={bind:function(){u.unbind(),i.event.add(a.EVENT.ON_KEY_DOWN,u.handler.onKeyDown)},unbind:function(){i.event.remove(a.EVENT.ON_KEY_DOWN,u.handler.onKeyDown)},handler:{onKeyDown:function(e){var t,n,o,r,c,d,u=e.keyCode||e.which;if(32===u||13===u){for(l.saveSnap(!1),o=i.doc.getSelection(),r=o.getRangeAt(0).cloneRange(),t=r.startContainer;1===t.nodeType&&r.startOffset>0&&(t=r.startContainer.childNodes[r.startOffset-1]);)r.setStart(t,s.getEndOffset(t)),r.collapse(!0),t=r.startContainer;do{if(0===r.startOffset){for(t=r.startContainer.previousSibling;t&&1===t.nodeType;)t=t.lastChild;if(!t||s.isFillChar(t,!1))break;c=t.nodeValue.length}else t=r.startContainer,c=r.startOffset;r.setStart(t,c-1),d=r.toString().charCodeAt(0)}while(160!==d&&32!==d);if(r.toString().replace(a.FILL_CHAR_REG,"").match(/(?:https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.)/i)){for(;r.toString().length&&!/^(?:https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.)/i.test(r.toString());)try{r.setStart(r.startContainer,r.startOffset+1)}catch(e){for(t=r.startContainer;!(n=t.nextSibling);){if(s.isBody(t))return;t=t.parentNode}r.setStart(n,0)}if(s.getParentByTagName(r.startContainer,"a",!0,null))return;var f,m=i.doc.createElement("a"),g=i.doc.createTextNode(" "),p=r.extractContents();m.href=p.textContent,m.appendChild(i.doc.createTextNode(p.textContent)),f=m.getAttribute("href").replace(a.FILL_CHAR_REG,""),f=/^(?:https?:\/\/)/gi.test(f)?f:"http://"+f,m.href=f,r.insertNode(m),m.parentNode.insertBefore(g,m.nextSibling),r.setStart(g,0),r.collapse(!0),o.removeAllRanges(),o.addRange(r)}}}}},f={on:function(){u.bind()},off:function(){u.unbind()},getCurrentLink:function(){var e=d.getRange();if(!e)return"";var t=s.getParentByTagName(e.startContainer,"a",!0);return t?t.href:""},removeSelectedLink:function(){o(),l.saveSnap(!1),c.execCommand("unlink",!1,!1)},setCurrentLink:function(e){e&&(o(),l.saveSnap(!1),c.execCommand("createLink",!1,e))}};t.exports=f},{"../common/const":16,"../common/env":18,"../common/historyUtils":19,"../domUtils/domExtend":27,"../editor/commandExtend":31,"../rangeUtils/rangeExtend":43}],41:[function(e,t,n){"use strict";function o(e,t,n){r(e,t,n);for(var i=t.children,a=0;a<i.length;a++){var l=i[a];o(t.id?t.id:e,l,n)}}function r(e,t,n){if(t){var o=t.tagName;if(!/^(style|script|link|meta|img)$/gi.test(o)&&!d.hasClass(t,s.CLASS.TODO_CHECKBOX)&&!d.hasClass(t,s.CLASS.TODO_AVATAR)){var r=t.className;if(r&&r.length>0)for(var l=r.split(" "),c=0;c<l.length;c++){var u=l[c];0!==u.length&&a("."+i(u),n)}var f=t.id;f&&f.length>0&&a("#"+i(f),n),e?a("#"+i(e)+" "+o,n):a(i(o),n)}}}function i(e){return e.replace(/ /g,"")}function a(e,t){t[e]||/^(\.|#)?[\d]+/i.test(e)||!/^(\.|#)?[\. \w-]+$/i.test(e)||(t[e]="")}var l=e("../common/env"),s=e("../common/const"),c=e("../common/wizStyle"),d=e("../domUtils/domBase"),u="#7990b6",f="#1f2126",m="50%",g="wiz_night_mode_style",p={on:function(e,t,n){e&&(u=e),t&&(f=t),n&&(m=n),p.off();var r={},i=[];o("",l.doc.body,r);var a="{color:"+u+" !important; background-color:"+f+" !important; background-image: none !important; box-shadow: none !important; border-color:"+u+" !important; }";for(var d in r)r.hasOwnProperty(d)&&i.push(d);var h=i.join(", ");h+=a,h+="img{filter: brightness("+m+");-webkit-filter: brightness("+m+");}",h+=s.TAG.TMP_HIGHLIGHT_TAG+"{background-color: #50a9fb !important;  color: black !important;}",c.insertStyle({id:g,name:s.NAME.TMP_STYLE},h)},off:function(){var e=l.doc.getElementById(g);e&&e.remove()}};t.exports=p},{"../common/const":16,"../common/env":18,"../common/wizStyle":23,"../domUtils/domBase":26}],42:[function(e,t,n){"use strict";var o,r=e("./../common/env"),i=e("./../common/const"),a=(e("./../common/base64"),e("./../domUtils/domBase")),l={caretFocus:function(){var e=l.getRange(),t=e?e.getClientRects():null,n=t&&t.length>0?t[0]:null,o=r.doc.documentElement.clientHeight,i=r.doc.documentElement.clientWidth;n&&n.top<0?r.doc.body.scrollTop+=n.top:n&&n.top+n.height>o&&(r.doc.body.scrollTop+=n.top+n.height-o),n&&n.left<0?r.doc.body.scrollLeft+=n.left:n&&n.left+n.width>i&&(r.doc.body.scrollLeft+=n.left+n.width-i)},clearFillCharByCollapsed:function(){var e,t,n,o=l.getRange();o&&o.collapsed&&3===o.startContainer.nodeType&&(e=o.startContainer,t=e.nodeValue.substr(0,o.startOffset),n=e.nodeValue.substr(o.startOffset),t=t.replace(i.FILL_CHAR_REG,""),n=n.replace(i.FILL_CHAR_REG,""),e.nodeValue=t+n,l.setRange(e,t.length))},fixScroll:function(){function e(){var e,t,n,o,i=l.getRange();if(i&&(i.collapsed||!r.client.type.isPhone&&!r.client.type.isPad)&&(e=l.getRangeClientRect())){t=a.getWindowSize();var s=t.height,c=0;r.client.type.isIOS&&(s=t.height),n=r.doc.body.scrollTop,o=r.doc.body.scrollLeft,r.client.type.isIOS&&e.top+c<0?r.doc.body.scrollTop=n+e.top+c:r.client.type.isIOS&&e.top+e.height>s-c?r.doc.body.scrollTop=n+e.top+e.height+c-s:!r.client.type.isIOS&&e.top<0?r.doc.body.scrollTop=n+e.top:!r.client.type.isIOS&&e.top+e.height>t.height&&(r.doc.body.scrollTop=n+e.top+e.height-t.height),e.left<o?r.doc.body.scrollLeft=o+e.left:e.left+e.width>t.width&&(r.doc.body.scrollLeft=o+e.left+e.width-t.width)}}o&&clearTimeout(o),o=setTimeout(e,30)},getFragmentForCopy:function(){var e=l.getRange(),t=null;return!e||e.collapsed?t:(t=r.doc.createElement("div"),t.appendChild(e.cloneContents()),a.fragmentFilterForCopy(t),a.css(t,{position:"absolute",top:"-99999px",left:"-99999px",overflow:"hidden"}),r.doc.body.appendChild(t),t)},getRange:function(){var e=r.doc.getSelection();return e.rangeCount>0?e.getRangeAt(0):null},getRangeAnchor:function(e){var t=l.getRange();if(!t)return null;var n=e?t.startContainer:t.endContainer,o=e?t.startOffset:t.endOffset;return t.collapsed||e?3===n.nodeType&&o<n.nodeValue.length?n:3===n.nodeType?a.getNextNode(n,!1,null):0===n.childNodes.length?n:o==n.childNodes.length?a.getNextNode(n.childNodes[o-1],!1,null):a.getFirstDeepChild(n.childNodes[o]):3===n.nodeType&&o>0?n:3===n.nodeType?a.getPreviousNode(n,!1,null):o>0?a.getLastDeepChild(n.childNodes[o-1]):a.getPreviousNode(n,!1,null)},getRangeClientRect:function(){var e=l.getRange();if(!e)return null;var t,n,o=e.getBoundingClientRect();return 0===o.width&&0===o.height&&(t=l.getRange().getClientRects(),t.length>0&&(o=t[0])),0===o.width&&0===o.height&&(n=e.startContainer,1===n.nodeType&&(n=n.childNodes[e.startOffset===n.childNodes.length?e.startOffset-1:e.startOffset],n.getBoundingClientRect&&(o=n.getBoundingClientRect(),o={bottom:o.bottom,height:o.height,left:o.left+o.width,right:o.right,top:o.top,width:0}))),o},getRangeDetail:function(e,t){var n=!1;return t>0&&t===a.getEndOffset(e)?(1===e.nodeType&&(e=a.getLastDeepChild(e.childNodes[t-1]),t=a.getEndOffset(e)),n=!0):1===e.nodeType&&(0===e.childNodes.length||t<e.childNodes.length&&(e=e.childNodes[t],t=0)),{container:e,offset:t,isEnd:n}},getRangeDomList:function(e){var t=l.getRange();if(!t)return null;var n=t.startContainer,o=t.startOffset,r=t.endContainer,i=t.endOffset,s=a.getListA2B({startDom:n,startOffset:o,endDom:r,endOffset:i,noSplit:!!e.noSplit});return s},getRangeParentRoot:function(){var e,t,n=l.getRange();return n?(e=n.startContainer,
t=n.endContainer,a.getParentRoot([e,t])):null},isRangeEdge:function(e){var t={isStart:!1,isEnd:!1},n=l.getRange();if(n){t.isCollapsed=n.collapsed,t.startDom=n.startContainer,t.startOffset=n.startOffset,t.endDom=n.endContainer,t.endOffset=n.endOffset;var o,r;return 1==t.startDom.nodeType&&t.startOffset<t.startDom.childNodes.length?o=a.getFirstDeepChild(t.startDom.childNodes[t.startOffset]):1==t.startDom.nodeType&&(o=a.getNextNode(t.startDom.childNodes[t.startOffset-1],!1,null)),1==t.endDom.nodeType&&t.endOffset>0?r=a.getLastDeepChild(t.endDom.childNodes[t.endOffset-1]):1==t.endDom.nodeType&&(r=a.getPreviousNode(t.endDom,!1,null)),t.isStart=t.startDom==e||t.startDom==o,t.isEnd=t.endDom==e||t.endDom==r,t}},moveToPoint:function(e,t){var n,o,i;r.doc.caretPositionFromPoint?(n=r.doc.caretPositionFromPoint(e,t),o=n.offsetNode,i=n.offset):r.doc.caretRangeFromPoint&&(n=r.doc.caretRangeFromPoint(e,t),o=n.startContainer,i=n.startOffset),l.setRange(o,i)},selectElementContents:function(e){var t=r.doc.createRange();t.selectNodeContents(e);var n=r.doc.getSelection();n.removeAllRanges(),n.addRange(t)},selectCharIncludeFillChar:function(e){var t,n,o,s,c=r.doc.getSelection(),d=c.getRangeAt(0),u=e?"backward":"forward";if(1===d.startContainer.nodeType){if(t=l.getRangeAnchor(!1),d.startContainer==t&&a.isTag(t,"br")&&a.isEmptyDom(t.parentNode))return void(t.parentNode.nextSibling?l.setRange(t.parentNode,0,t.parentNode.nextSibling,0):(c.modify("move","forward","character"),c.modify("extend","backward","character"),t.nextSibling&&c.modify("extend","backward","character")));a.isTag(t,"br")&&c.modify("extend",u,"character")}c.modify("extend",u,"character"),d=c.getRangeAt(0),s=d.toString(),t=l.getRangeAnchor(e),t&&(n=e&&t==d.startContainer?d.startOffset:e||t!=d.endContainer?-1:d.endOffset,o=3===t.nodeType&&n>0&&n<t.nodeValue.length?t:e?a.getPreviousNode(t,!1,null):a.getNextNode(t,!1,null),0===s.length?t&&!a.isSelfClosingTag(t)&&o&&(1!==o.nodeType||1===o.nodeType&&a.isSelfClosingTag(o))&&c.modify("extend",u,"character"):s.indexOf(i.FILL_CHAR)>-1&&""===s.replace(i.FILL_CHAR_REG,"")&&c.modify("extend",u,"character"))},setRange:function(e,t,n,o){if(e||n){var i=a.getEndOffset(e),l=a.getEndOffset(n);t<0?t=0:t>i&&(t=i),o<0?o=a.getEndOffset(n):o>l&&(o=l);var s=r.doc.getSelection();e||(e=r.doc.body,t=0);var c;0===s.rangeCount&&(c=r.doc.createRange(),c.selectNode(e),s.addRange(c)),s.collapse(e,t),n&&s.extend(n,o)}},setRangeToEnd:function(e){var t=e,n=a.getEndOffset(e);a.isSelfClosingTag(t)&&(t=t.parentNode,n=a.getIndex(e)+1),l.setRange(t,n)}};t.exports=l},{"./../common/base64":15,"./../common/const":16,"./../common/env":18,"./../domUtils/domBase":26}],43:[function(e,t,n){"use strict";var o,r=e("./../common/env"),i=e("./../common/const"),a=(e("./../common/utils"),e("./../domUtils/domExtend")),l=e("./rangeBase");l.backupCaret=function(){var e=l.getRange();if(!e){if(o)return!0;if(a.focus(),e=l.getRange(),!e)return!1}return o=l.getRange(),!0},l.restoreCaret=function(){if(!o)return!1;var e=r.doc.getSelection();return 0==e.rangeCount&&a.focus(),e.removeAllRanges(),e.addRange(o),o=null,!0},l.modifyCaretStyle=function(e,t){var n,o,s,c,d=r.doc.getSelection(),u=d.focusNode,f=!0;3==u.nodeType&&(u=u.parentNode);for(o in e)e.hasOwnProperty(o)&&"string"==typeof o&&(s=e[o],u.style[o]!==s&&(f=!1));if(!f){a.isTag(u,"span")&&a.isEmptyDom(u)?(a.modifyStyle(u,e,t),c=u):(n=d.getRangeAt(0),n.deleteContents(),c=a.createSpan(),c.innerHTML=i.FILL_CHAR,n.insertNode(c),a.modifyStyle(c,e,t));var m=u.parentNode?u.parentNode:u;a.clearChild(m,[c]),l.setRange(c.childNodes[0],1,c.childNodes[0],1)}},l.modifyDomsStyle=function(e,t,n,o){a.modifyNodesStyle(e,t,n);var r,i,l,s,c=[];for(r=0,i=e.length;r<i;r++)l=e[r].parentNode,l&&c.indexOf(l)<0&&c.push(l);l=a.getParentRoot(c),s=a.getWizAmendParent(l),l=s?s.parentNode:l,a.clearChild(l,o)},l.modifyRangeStyle=function(e,t){var n,o,r;n=l.getRangeDomList({noSplit:!1}),n&&(o=n.list,r=o.length,0!==r&&(l.modifyDomsStyle(o,e,t,[n.startDomBak,n.endDomBak]),l.fixRange(n)))},l.fixRange=function(e){var t=!e.startDom.parentNode,n=!e.endDom.parentNode,o=a.isSelfClosingTag(e.endDom);t&&a.isSelfClosingTag(e.startDomBak)&&(e.startDomBak=a.getNextNode(e.startDomBak,!1,e.endDomBak),e.startOffsetBak=0),l.setRange(t?e.startDomBak:e.startDom,t?e.startOffsetBak:e.startOffset,n||o?e.endDomBak:e.endDom,n||o?e.endOffsetBak:e.endOffset)},l.modifySelectionDom=function(e,t){var n=l.getRange();return!!n&&(n.collapsed?l.modifyCaretStyle(e,t):l.modifyRangeStyle(e,t),!0)},t.exports=l},{"./../common/const":16,"./../common/env":18,"./../common/utils":22,"./../domUtils/domExtend":27,"./rangeBase":42}],44:[function(e,t,n){"use strict";var o=e("../common/env"),r=e("../common/const"),i=e("../common/utils"),a=e("../common/historyUtils"),l=e("../blockUtils/blockUtils"),s=e("../codeUtils/codeUtils"),c=e("../domUtils/domExtend"),d=e("../rangeUtils/rangeExtend"),u=e("./tableUtils"),f=e("./tableMenu"),m=e("./tableZone"),g={bind:function(){g.unbind(),o.event.add(r.EVENT.ON_DRAG_START,g.handler.onDragStart),o.event.add(r.EVENT.ON_KEY_UP,g.handler.onKeyUp),o.client.type.isPhone||o.client.type.isPad?(o.event.add(r.EVENT.ON_TOUCH_START,g.handler.onMouseDown),o.event.add(r.EVENT.ON_TOUCH_END,g.handler.onMouseUp)):(o.event.add(r.EVENT.ON_MOUSE_DOWN,g.handler.onMouseDown),o.event.add(r.EVENT.ON_MOUSE_OVER,g.handler.onMouseOver),o.event.add(r.EVENT.ON_MOUSE_UP,g.handler.onMouseUp)),o.event.add(r.EVENT.ON_SELECTION_CHANGE,g.handler.onSelectionChange),o.event.add(r.EVENT.AFTER_RESTORE_HISTORY,g.handler.afterRestoreHistory)},unbind:function(){o.event.remove(r.EVENT.ON_DRAG_START,g.handler.onDragStart),o.event.remove(r.EVENT.ON_KEY_UP,g.handler.onKeyUp),o.event.remove(r.EVENT.ON_MOUSE_DOWN,g.handler.onMouseDown),o.event.remove(r.EVENT.ON_MOUSE_OVER,g.handler.onMouseOver),o.event.remove(r.EVENT.ON_MOUSE_UP,g.handler.onMouseUp),o.event.remove(r.EVENT.ON_TOUCH_START,g.handler.onMouseDown),o.event.remove(r.EVENT.ON_TOUCH_END,g.handler.onMouseUp),o.event.remove(r.EVENT.ON_SELECTION_CHANGE,g.handler.onSelectionChange),o.event.remove(r.EVENT.AFTER_RESTORE_HISTORY,g.handler.afterRestoreHistory)},handler:{afterRestoreHistory:function(){var e,t,n,i,a=[];if(e=o.doc.getElementsByClassName(r.CLASS.SELECTED_CELL),0===e.length)return void m.clear();for(n=0,i=e.length;n<i;n++)a.push(e[n]);var l=c.getParentByTagName(a[0],"table",!0,null);if(!l)return void m.clear();m.setStart(a[0]);var s,d=m.getZone(),g=a[a.length-1],p=u.getRangeByCellData(u.getCellData(d.grid,g));for(n=1;n<a.length-1;n++)t=a[n],1!=t.rowSpan&&(s=u.getRangeByCellData(u.getCellData(d.grid,t)),(s.maxY>p.maxY||(s.maxY=p.maxY&&s.maxX>p.maxX))&&(g=t,p=s));m.setEnd(g),f.show()},onDragStart:function(e){var t=c.getParentByTagName(e.target,"table",!0,null);t&&i.stopEvent(e)},onKeyDown:function(e){var t=o.doc.getSelection(),n=m.getZone();if(!n.range)return!0;var r,a,l,g=e.shiftKey?"extend":"move",p=e.keyCode||e.which,h=!1,E=t.focusNode;switch(p){case 37:e.ctrlKey||e.metaKey||!E||(h=!0,t.modify(g,"backward","character")),r={x:-1,y:0};break;case 38:e.ctrlKey||e.metaKey||!E||(h=!0,t.modify("move","backward","line")),r={x:0,y:-1};break;case 9:e.shiftKey||(r={x:1,y:0,canChangeRow:!0});break;case 39:e.ctrlKey||e.metaKey||!E||(h=!0,t.modify(g,"forward","character")),r={x:1,y:0};break;case 13:if(!e.ctrlKey&&!e.metaKey)break;case 40:e.ctrlKey||e.metaKey||!E||(h=!0,t.modify("move","forward","line")),r={x:0,y:1}}var C,T,b,v;if(h){if(a=t.focusNode,E=c.getParentByTagName(E,["td","th"],!0,null),a=c.getParentByTagName(a,["td","th"],!0,null),a&&a!=E&&(38==p||40==p||13==p?h=!1:m.setStart(a).setEnd(a)),h)return b=u.checkCaretInTableContainer(e),a||b.tableContainer?b.before&&(d.setRange(n.start.cell,0),m.setStart(n.start.cell).setEnd(n.start.cell)):(m.clear(),f.show()),i.stopEvent(e),!1;if(38==p&&n.start.cell==n.end.cell&&0==n.start.y_src){for(l=n.start.x,a=c.getPreviousNode(u.getContainer(E));a&&!c.isTag(a,"br")&&c.isEmptyDom(a);)a=c.getPreviousNode(a);return a?(m.clear(),f.show(),v=s.getContainerFromChild(a),v?s.focusToLast(v.codeMirror):(d.setRange(a,c.getEndOffset(a)),0!==l||c.getParentByTagName(a,["table"],!0,null)||t.modify("move","backward","lineboundary"),d.fixScroll())):(d.setRange(n.start.cell,0),m.setStart(n.start.cell).setEnd(n.start.cell)),i.stopEvent(e),!1}if(40==p&&n.start.cell==n.end.cell&&n.start.y_src+n.start.cell.rowSpan>=n.grid.length){for(l=n.start.x,a=c.getNextNode(u.getContainer(E));a&&!c.isTag(a,"br")&&c.isEmptyDom(a);)a=c.getNextNode(a);return a?(m.clear(),f.show(),v=s.getContainerFromChild(a),v?s.focusToFirst(v.codeMirror):(d.setRange(a,c.getEndOffset(a)),0!==l||c.getParentByTagName(a,["table"],!0,null)||t.modify("move","backward","lineboundary"),d.fixScroll())):m.setStart(n.start.cell).setEnd(n.start.cell),i.stopEvent(e),!1}}if(r){if(C=e.shiftKey?n.end||n.start:n.start,T=m.switchCell(C,r),T==C)return i.stopEvent(e),!1;if(T)return e.shiftKey?m.setEnd(T.cell,!0):m.setStart(T.cell,T.x,T.y).setEnd(T.cell),d.fixScroll(),i.stopEvent(e),!1}return!0},onKeyUp:function(e){var t,n=m.getZone(),o=d.getRange();!n.range&&o&&o.collapsed&&(t=c.getParentByTagName(o.startContainer,["td","th"],!0,null),t&&(m.setStart(t).setEnd(t),f.show())),u.fixSelection(e)},onMouseDown:function(e){var t="mousedown"!==e.type||0===e.button||1===e.button;if(!t)return void f.hide();var n=u.isMenu(e.target);if(!n){var r=c.getParentByTagName(e.target,["th","td"],!0,null),a=r?c.getParentByTagName(r,"table",!1,null):null,l=u.getMousePosition(e,a),s=m.isZoneBorder(e);if(s.isBodyBorder||s.isContainer)return void(o.client.type.isPhone||o.client.type.isPad||i.stopEvent(e));if(!o.client.type.isPhone&&!o.client.type.isPad){if(s.isRight)return void m.startDragColLine(e.target,l.x);if(s.isBottom)return void m.startDragRowLine(e.target,l.y);if(s.isDot)return}s.isBorder||s.isScroll||(m.setStart(r),f.show())}},onMouseOver:function(e){var t=c.getParentByTagName(e.target,["td","th"],!0,null);m.modify(t)},onMouseUp:function(e){u.fixSelection(e);var t="mouseup"!==e.type||0===e.button||1===e.button;if(t){var n,o,r=m.getZone();if(!r.active){if(n=u.isMenu(e.target))return;if(o=m.isZoneBorder(e),o.isRight&&!m.isRangeActiving())return;if(o.isBottom&&!m.isRangeActiving())return;if(o.isDot)return;if(o.isBorder||o.isScroll)return}var i=c.getParentByTagName(e.target,["td","th"],!0,null);m.setEnd(i),f.show()}},onSelectionChange:function(e){var t,n,o=u.checkCaretInTableContainer(e),r=d.getRange();r&&!r.collapsed&&(n=u.getContainer(r.startContainer),n&&c.moveOutFromTableContainer(n),n=u.getContainer(r.endContainer),n&&c.moveOutFromTableContainer(n));var i=m.getZone();o.tableContainer&&!i.range&&(t=o.tableContainer.querySelectorAll("td"),t=o.tableMenu||o.after?t[t.length-1]:o.before?t[0]:null,t&&(m.setStart(t).setEnd(t),f.show()))}}},p={on:function(){o.readonly||(g.bind(),f.init(p)),u.initTableContainer(null),m.clear()},off:function(){m.clear()},canCreateTable:function(){return u.canCreateTable(m.getZone())},clearCellValue:function(){var e=m.getZone();e.range&&(a.saveSnap(!1),u.clearCellValue(e.grid,e.range))},deleteCols:function(){var e=m.getZone();if(e.range){if(0===e.range.minX&&e.range.maxX===e.grid[0].length-1)return void p.deleteTable();a.saveSnap(!1);var t;for(t=e.range.maxX;t>=e.range.minX;t--)u.deleteCols(e.grid,t);m.clear()}},deleteRows:function(){var e=m.getZone();if(e.range){if(0===e.range.minY&&e.range.maxY===e.grid.length-1)return void p.deleteTable();a.saveSnap(!1);var t;for(t=e.range.maxY;t>=e.range.minY;t--)u.deleteRows(e.grid,t);m.clear()}},deleteTable:function(){var e=m.getZone();if(e.table){a.saveSnap(!1);var t=e.table.parentNode;t&&t.removeChild(e.table),f.remove(),m.remove(),t=c.getParentByFilter(t,function(e){return c.hasClass(e,r.CLASS.TABLE_CONTAINER)},!0);var n;t&&(n=o.doc.createElement("br"),t.parentNode.insertBefore(n,t),c.remove(t),d.setRange(n,0))}},distributeCols:function(){var e=m.getZone();e.range&&(a.saveSnap(!1),u.distributeCols(e.table,e.grid),m.updateGrid())},insertCol:function(e){var t=m.getZone();t.range&&(a.saveSnap(!1),u.insertCol(t.grid,e?t.range.minX:t.range.maxX+1),m.updateGrid())},insertRow:function(e){var t=m.getZone();t.range&&(a.saveSnap(!1),u.insertRow(t.grid,e?t.range.minY:t.range.maxY+1),m.updateGrid())},insertTable:function(e,t){a.saveSnap(!1);var n,i=d.getRange();if(p.canCreateTable()){var s,f,g;i&&(i.deleteContents(),s=d.getRangeDetail(i.startContainer,i.startOffset),s=c.getBlockParent(s.container,!0),s&&s!==o.doc.body&&c.isEmptyDom(s)&&c.isTag(s,"div")&&(f=s,s.innerHTML="")),g=u.createTable(e,t),f=f?f:o.doc.createElement("div"),f.appendChild(g),f.parentNode||(f=l.insertBlock(g)),u.initTableContainer(g),n=g.querySelector("td"),m.setStart(n).setEnd(n),o.event.call(r.EVENT.UPDATE_RENDER)}},merge:function(){var e=m.getZone();if(e.range){a.saveSnap(!1);var t=u.mergeCell(e.grid,e.range);t&&(m.updateGrid(),m.setStart(t).setEnd(t))}},modifySelectionDom:function(e,t){var n=d.getRange(),o=m.getZone();return!(n&&!n.collapsed||!o.range)&&(u.modifySelectionDom(o,e,t),!0)},onKeyDown:g.handler.onKeyDown,setCellAlign:function(e,t){var n=m.getZone();n.range&&(a.saveSnap(!1),u.setCellAlign(n.grid,n.range,{align:e,valign:t}),m.setStartRange())},setCellBg:function(e){var t=m.getZone();t.range&&(a.saveSnap(!1),u.setCellBg(t.grid,t.range,e),m.setStartRange())},split:function(){var e=m.getZone(),t=u.splitCell(e.table,e.grid,e.range);t&&(a.saveSnap(!1),m.updateGrid(),e=m.getZone(),m.setStart(e.grid[t.minY][t.minX].cell).setEnd(e.grid[t.maxY][t.maxX].cell))}};t.exports=p},{"../blockUtils/blockUtils":11,"../codeUtils/codeUtils":14,"../common/const":16,"../common/env":18,"../common/historyUtils":19,"../common/utils":22,"../domUtils/domExtend":27,"../rangeUtils/rangeExtend":43,"./tableMenu":45,"./tableUtils":46,"./tableZone":47}],45:[function(e,t,n){"use strict";function o(){var e=d.doc.querySelector("."+u.CLASS.TABLE_TOOLS);if(e)return e;var t,n,o=[{id:E.col,exClass:"icon-insert editor-icon",subMenu:{type:T.list,data:[{type:u.TYPE.TABLE.INSERT_ROW_UP,name:m.Table.InsertRowUp,isSplit:!1},{type:u.TYPE.TABLE.INSERT_ROW_DOWN,name:m.Table.InsertRowDown,isSplit:!1},{type:u.TYPE.TABLE.INSERT_COL_LEFT,name:m.Table.InsertColLeft,isSplit:!1},{type:u.TYPE.TABLE.INSERT_COL_RIGHT,name:m.Table.InsertColRight,isSplit:!1},{type:u.TYPE.TABLE.DELETE_ROW,name:m.Table.DeleteRow,isSplit:!0},{type:u.TYPE.TABLE.DELETE_COL,name:m.Table.DeleteCol,isSplit:!1}]}},{id:E.align,exClass:"icon-align editor-icon",subMenu:{type:T.custom,make:function(){var e,t,n,o=[["top","middle","bottom"],["left","center","right"]],r='<div class="wiz-table-menu-sub wiz-table-cell-align">';for(e=0;e<o.length;e++){for(r+="<div>",t=0;t<o[e].length;t++)n=0===e?"valign":"align",r+='<div class="'+C.alignItem+" "+C.clickItem+'" data-type="'+u.TYPE.TABLE.SET_CELL_ALIGN+'" data-align-type="'+n+'" data-align-value="'+o[e][t]+'">',0===e?(r+='<i class="editor-icon icon-box"></i>',r+='<i class="editor-icon valign icon-valign_'+o[e][t]+'"></i>'):r+='<i class="editor-icon align icon-align_'+o[e][t]+'"></i>',r+="</div>";r+="</div>"}return r+="</div>"}}},{id:E.bg,exClass:"icon-box editor-icon",subMenu:{type:T.custom,make:function(){var e,t,n=[["","#f7b6ff","#fecf9c"],["#acf3fe","#b2ffa1","#b6caff"],["#ffc7c8","#eeeeee","#fef49c"]],o='<div class="wiz-table-menu-sub wiz-table-color-pad">';for(e=0;e<n.length;e++){for(o+="<div>",t=0;t<n[e].length;t++)o+='<div class="'+C.colorPadItem+" "+C.clickItem+'" data-color="'+n[e][t]+'" data-type="'+u.TYPE.TABLE.SET_CELL_BG+'">',o+='<i class="editor-icon icon-box"></i>',o+=0===e&&0===t?'<i class="pad-demo editor-icon icon-oblique_line"></i>':'<i class="pad-demo editor-icon icon-inner_box" style="color:'+n[e][t]+';"></i>',o+="</div>";o+="</div>"}return o+="</div>"}}},{id:E.cells,exClass:"icon-merge editor-icon",subMenu:{type:T.list,data:[{type:u.TYPE.TABLE.MERGE_CELL,name:m.Table.MergeCell,isSplit:!1},{type:u.TYPE.TABLE.SPLIT_CELL,name:m.Table.SplitCell,isSplit:!1},{type:u.TYPE.TABLE.CLEAR_CELL,name:m.Table.ClearCell,isSplit:!1}]}},{id:E.more,exClass:"icon-more editor-icon",subMenu:{type:T.list,data:[{type:u.TYPE.TABLE.DISTRIBUTE_COLS,name:m.Table.DistributeCols,exClass:"",isSplit:!1},{type:u.TYPE.TABLE.DELETE_TABLE,name:m.Table.DeleteTable,exClass:"",isSplit:!0}]}}];e=d.doc.createElement(u.TAG.TMP_TAG),h.addClass(e,u.CLASS.TABLE_TOOLS);var i="<ul>";for(t=0;t<o.length;t++)n=o[t],i+='<li id="'+n.id+'" class="'+u.CLASS.TABLE_MENU_ITEM+'"><div class="'+u.CLASS.TABLE_MENU_BUTTON+'"><i class="'+n.exClass+'"></i>',n.id===E.bg&&(i+='<i id="'+E.bgDemo+'" class="editor-icon icon-inner_box"></i>'),i+="</div>",i+=n.subMenu.type===T.list?r(n.subMenu.data):n.subMenu.make(),i+="</li>";return i+="</ul>",e.innerHTML=i,l=e.querySelector("#"+E.bgDemo),l&&(l.style.color="#fff"),e}function r(e){var t,n,o='<ul class="wiz-table-menu-sub">';for(t=0;t<e.length;t++)n=e[t],o+='<li class="wiz-table-menu-sub-item '+C.clickItem,n.isSplit&&(o+=" split"),o+='" data-type="'+n.type+'">'+n.name,o+="</li>";return o+="</ul>"}function i(){var e,t=c.parentNode.querySelector("."+u.CLASS.TABLE_BODY),n=t?t.offsetTop:0;return e=n-c.offsetHeight+5,e+"px"}function a(){var e=c.parentNode,t=h.getOffset(e),n=d.doc.body.scrollTop;n>t.top-30&&n<e.offsetHeight+t.top-2.5*c.offsetHeight?h.css(c,{position:"fixed",top:"0",left:t.left+"px"}):h.css(c,{position:"",top:i(),left:""})}var l,s,c,d=e("../common/env"),u=e("../common/const"),f=e("../common/lang"),m=f.getLang(),g=e("./tableUtils"),p=e("./tableZone"),h=e("../domUtils/domExtend"),E={col:"wiz-menu-col",align:"wiz-menu-align",bg:"wiz-menu-bg",bgDemo:"wiz-menu-bg-demo",cells:"wiz-menu-cells",more:"wiz-menu-more"},C={active:"active",disabled:"disabled",clickItem:"click-item",colorPadItem:"wiz-table-color-pad-item",alignItem:"wiz-table-cell-align-item"},T={list:1,custom:2},b={bind:function(){b.unbind(),c&&(c.addEventListener("click",b.handler.onClick),c.addEventListener("mouseover",b.handler.onMouseOver)),d.event.add(u.EVENT.BEFORE_SAVESNAP,b.handler.onBeforeSaveSnap),d.event.add(u.EVENT.ON_SCROLL,b.handler.onScroll)},unbind:function(){c&&(c.removeEventListener("click",b.handler.onClick),c.removeEventListener("mouseover",b.handler.onMouseOver)),d.event.remove(u.EVENT.BEFORE_SAVESNAP,b.handler.onBeforeSaveSnap),d.event.remove(u.EVENT.ON_SCROLL,b.handler.onScroll)},handler:{onBeforeSaveSnap:function(){},onClick:function(e){var t=h.getParentByFilter(e.target,function(e){return h.hasClass(e,u.CLASS.TABLE_MENU_BUTTON)},!0);if(t)return void v.showSub(t.parentNode);var n;if(t=h.getParentByFilter(e.target,function(e){return h.hasClass(e,C.clickItem)},!0),t&&!h.hasClass(t,C.disabled)){var o=t.getAttribute("data-type"),r=!0;switch(o){case u.TYPE.TABLE.CLEAR_CELL:s.clearCellValue();break;case u.TYPE.TABLE.MERGE_CELL:s.merge();break;case u.TYPE.TABLE.SPLIT_CELL:s.split();break;case u.TYPE.TABLE.INSERT_ROW_UP:s.insertRow(!0);break;case u.TYPE.TABLE.INSERT_ROW_DOWN:s.insertRow();break;case u.TYPE.TABLE.INSERT_COL_LEFT:s.insertCol(!0);break;case u.TYPE.TABLE.INSERT_COL_RIGHT:s.insertCol();break;case u.TYPE.TABLE.DELETE_ROW:s.deleteRows();break;case u.TYPE.TABLE.DELETE_COL:s.deleteCols();break;case u.TYPE.TABLE.SET_CELL_BG:var i=t.getAttribute("data-color");s.setCellBg(i),n=h.getParentByFilter(t,function(e){return h.hasClass(e,"wiz-table-color-pad")},!1),h.removeClass(n.querySelectorAll(".wiz-table-color-pad ."+C.colorPadItem+"."+C.active),C.active),h.addClass(t,C.active),l.setAttribute("data-last-color",i);break;case u.TYPE.TABLE.SET_CELL_ALIGN:var a=null,c=null;"align"==t.getAttribute("data-align-type")?a=t.getAttribute("data-align-value"):c=t.getAttribute("data-align-value"),s.setCellAlign(a,c),n=t.parentNode,h.removeClass(n.querySelectorAll("."+C.active),C.active),h.addClass(t,C.active),r=!1;break;case u.TYPE.TABLE.DELETE_TABLE:s.deleteTable();break;case u.TYPE.TABLE.DISTRIBUTE_COLS:s.distributeCols();break;default:r=!1}r&&v.hideSub()}},onMouseOver:function(e){var t=h.getParentByFilter(e.target,function(e){return h.hasClass(e,C.colorPadItem)},!0);t&&l&&(l.style.color=t.getAttribute("data-color")||"#fff")},onScroll:function(e){c&&"none"!=c.style.display&&a()}}},v={init:function(e){s=e},hide:function(){c&&(c.style.display="none"),b.unbind()},hideSub:function(){if(c){var e=c.querySelectorAll("."+u.CLASS.TABLE_MENU_ITEM+"."+C.active);h.removeClass(e,C.active),l&&(l.style.color=l.getAttribute("data-last-color")||"#fff")}},remove:function(){c&&(h.remove(c),c=null)},show:function(){if(!d.client.type.isPhone&&!d.client.type.isPad){var e=p.getZone();if(!e.grid||!e.range)return void v.hide();var t=h.getParentByFilter(e.table,function(e){return h.hasClass(e,u.CLASS.TABLE_CONTAINER)},!1);c=o(),h.attr(c,{contenteditable:"false"}),v.hideSub(),t.appendChild(c),h.css(c,{top:i()}),c.style.display="block",a(),b.bind()}},showSub:function(e){if(h.hasClass(e,C.active))return void h.removeClass(e,C.active);var t,n,o,r,i=p.getZone();e.id===E.cells?(t=g.canMerge(i.grid,i.range),n=g.canSplit(i.grid,i.range),r=e.querySelector("[data-type="+u.TYPE.TABLE.MERGE_CELL+"]"),r&&t?h.removeClass(r,C.disabled):r&&h.addClass(r,C.disabled),r=e.querySelector("[data-type="+u.TYPE.TABLE.SPLIT_CELL+"]"),r&&n?h.removeClass(r,C.disabled):r&&h.addClass(r,C.disabled)):e.id===E.align&&(o=g.getAlign(i.grid,i.range),r=e.querySelector("."+C.alignItem+"."+C.active+"[data-align-type=align]"),!r||o.align&&r.getAttribute("data-align-value").toLowerCase()===o.align||(h.removeClass(r,C.active),r=null),!r&&o.align&&(r=e.querySelector("[data-align-value="+o.align+"]"),h.addClass(r,C.active)),r=e.querySelector("."+C.alignItem+"."+C.active+"[data-align-type=valign]"),!r||o.valign&&r.getAttribute("data-align-value").toLowerCase()===o.valign||(h.removeClass(r,C.active),r=null),!r&&o.valign&&(r=e.querySelector("[data-align-value="+o.valign+"]"),h.addClass(r,C.active))),v.hideSub(),h.addClass(e,C.active)}};t.exports=v},{"../common/const":16,"../common/env":18,"../common/lang":20,"../domUtils/domExtend":27,"./tableUtils":46,"./tableZone":47}],46:[function(e,t,n){"use strict";var o=e("./../common/env"),r=e("./../common/const"),i=e("./../common/utils"),a=e("./../domUtils/domExtend"),l=e("../rangeUtils/rangeExtend"),s={init:function(){},canCreateTable:function(e){var t,n=l.getRange();if(n){if(t=a.getParentByTagName(n.startContainer,["table"],!0,null)||a.getParentByTagName(n.endContainer,["table"],!0,null))return!1;if(a.getParentByClass(n.startContainer,r.CLASS.CODE_CONTAINER,!0))return!1}return!e.range},canMerge:function(e,t){return e&&t&&e[t.minY][t.minX].cell!==e[t.maxY][t.maxX].cell},canSplit:function e(t,n){if(!t||!n)return!1;var o,r={},e=!1;return s.eachRange(t,n,function(n){o=n.x_src+"_"+n.y_src,n.fake&&!r[o]&&(r[o]=t[n.y_src][n.x_src],e=!0)}),!!e&&r},checkCaretInTableContainer:function(e){var t,n,o,r,i,c,d={tableContainer:null,tableMenu:!1,before:!1,after:!1},u=/^(mouse|touch)/i;if(e&&u.test(e.type))r=e.target;else{if(t=l.getRange(),!t||!t.collapsed)return d;c=l.getRangeDetail(t.startContainer,t.startOffset),r=c.container,i=c.offset}return a.isTag(r,"table")&&s.initTableContainer(r),s.isMenu(r)?(d.tableContainer=s.getContainerExcludeTable(r),d.tableMenu=!0,d):(n=s.getContainerExcludeTable(r),n&&(d.tableContainer=n,e&&u.test(e.type)?o=n.querySelector("table"):i>0?d.after=!0:d.before=!0),d)},clearCellValue:function(e,t){e&&t&&s.eachRange(e,t,function(e){e.fake||(e.cell.innerHTML="<br/>")})},cloneCell:function(e,t){var n=o.doc.createElement(e.tagName);return n.style.cssText=e.style.cssText,t?n.innerHTML="<br/>":(n.colSpan=e.colSpan,n.rowSpan=e.rowSpan,n.innerHTML=e.innerHTML),n},createCell:function(e){var t=o.doc.createElement("td");return t.setAttribute("align","left"),t.setAttribute("valign","middle"),e&&t.setAttribute("style","width:"+e+"px"),t.appendChild(o.doc.createElement("br")),t},createTable:function(e,t){if(e&&t){var n,r,i,a=o.doc.createElement("table"),l=o.doc.createElement("tbody");for(i=0;i<t;i++){for(n=o.doc.createElement("tr"),r=0;r<e;r++)n.appendChild(s.createCell(o.options.table.colWidth));l.appendChild(n)}return a.appendChild(l),a.style.width=o.options.table.colWidth*e+"px",a}},deleteCols:function(e,t){if(e&&0!==e.length&&!(t>e[0].length)){var n,r,i,l=a.getParentByTagName(e[0][0].cell,"table",!1,null),c=[],d=o.options.table.colWidth;for(n=0;n<e.length;n++)r=e[n][t],r.y_src==n&&r.cell.colSpan>1?(r.cell.colSpan--,c.push(r.cell)):r.y_src==n&&(d=s.getCellWidth(r.cell),r.cell.parentElement.removeChild(r.cell)),e[n].splice(t,1);for(n=0;n<c.length;n++)i=c[n],i.style.width=s.getCellWidth(i)-d+"px";l.getElementsByTagName("td").length||l.getElementsByTagName("th").length?s.fixTableWidth(l):l.parentElement.removeChild(l)}},deleteRows:function(e,t){if(e&&0!==e.length&&!(t>e.length)){var n,o,r,i=a.getParentByTagName(e[0][0].cell,"table",!1,null),l=i.rows;for(n=e[t].length-1;n>=0;n--)o=e[t][n],o.x_src==n&&o.y_src<o.y?o.cell.rowSpan--:o.x_src==n&&o.y_src==o.y&&o.cell.rowSpan>1&&t+1<e.length&&(o.cell.rowSpan--,r=s.getNextCellDataInRow(e[t+1],n),r=r?r.cell:null,l[t+1].insertBefore(o.cell,r));e.splice(t,1),l[t].parentElement.removeChild(l[t]),i.getElementsByTagName("tr").length?s.fixTableWidth(i):i.parentElement.removeChild(i)}},distributeCols:function(e,t){if(e&&t){var n=t[0].length;if(0!==n){var o,r,i,a=e.rows,l=e.offsetWidth/n;for(o=a.length-1;o>=0;o--)for(r=a[o].cells.length-1;r>=0;r--)i=a[o].cells[r],i.style.width=l*i.colSpan+"px";e.style.width=e.offsetWidth+"px"}}},eachRange:function(e,t,n){if(e&&t&&n&&"function"==typeof n){var o,r,i=!0;for(r=t.minY;i!==!1&&r<e.length&&r<=t.maxY;r++)for(o=t.minX;i!==!1&&o<e[r].length&&o<=t.maxX;o++)i=n(e[r][o])}},fixSelection:function(){var e=l.getRange();if(e&&!e.collapsed){var t=e.startContainer,n=e.startOffset,o=e.endContainer,r=e.endOffset,i=s.getContainer(t),c=s.getContainer(o);if(!(!i&&!c||i&&c)){for(var d,u=i?i:c;d=s.getContainer(u);)u=i?a.getNextNode(d,!1,o):a.getPreviousNode(d,!1,t);i?(t=u?u:o,n=0):(o=u?u:t,r=a.getEndOffset(o)),i?l.setRange(o,r,t,n):l.setRange(t,n,o,r)}}},fixTableWidth:function(e){if(e){var t,n,o,r=e.rows,i=0;for(t=0;t<r[0].cells.length;t++)n=r[0].cells[t],o=s.getCellWidth(n),i+=o;e.style.width=i+"px"}},getAlign:function(e,t){if(!e||!t)return!1;var n,o,r,i={align:"",valign:""};return s.eachRange(e,t,function(e){return r=e.cell,e.fake||(n=r.align.toLowerCase(),o=r.vAlign.toLowerCase()),""===i.align&&(i.align=n,i.valign=o),null!==i.align&&(i.align=i.align===n?n:null),null!==i.valign&&(i.valign=i.valign===o?o:null),null!==i.align||null!==i.valign}),i},getCellWidth:function(e){return parseInt(e.style.width||e.offsetWidth,10)},getCellData:function(e,t){if(!e||!t)return null;var n,o,r;for(n=0;n<e.length;n++)for(o=0;o<e[n].length;o++)if(r=e[n][o],r.cell===t)return r;return null},getCellsByRange:function(e,t){var n=[];return e&&t?(s.eachRange(e,t,function(e){e.fake||n.push(e.cell)}),n):n},getContainer:function(e){return a.getParentByClass(e,r.CLASS.TABLE_CONTAINER,!0)},getTableBody:function(e){return a.getParentByFilter(e,function(e){return a.hasClass(e,r.CLASS.TABLE_BODY)},!0)},getContainerExcludeTable:function(e){var t=a.getParentByTagName(e,["th","td"],!0,null),n=t?null:s.getContainer(e);return n},getDomsByCellList:function(e){var t,n,o,r,i=[];if(!e)return i;for(t=0,n=e.length;t<n;t++)o=e[t],r=a.getListA2B({startDom:o.firstChild,startOffset:0,endDom:o.lastChild,endOffset:1,noSplit:!0}),i=i.concat(r.list);return i},getNextCellInTable:function(e){var t=e.nextElementSibling;if(t)return t;for(var n=e.parentNode.nextElementSibling;n;){if(n.cells.length>0)return n.cells[0];n=n.nextElementSibling}return null},getNextCellDataInRow:function(e,t){if(!e)return null;var n;for(n=t;n<e.length;n++)if(!e[n].fake)return e[n];return null},getMousePosition:function(e,t){var n=i.getEventClientPos(e),r=s.getTableBody(t||e.target),a=n.x+o.doc.body.scrollLeft+(r?r.scrollLeft:0),l=n.y+o.doc.body.scrollTop+(r?r.scrollTop:0);return{x:a,y:l}},getPreviousCellDataInRow:function(e,t){if(!e)return null;var n;for(n=t;n>=0;n--)if(!e[n].fake)return e[n];return null},getRangeByCellData:function(e){return e?{minX:e.x_src,minY:e.y_src,maxX:e.x_src+e.cell.colSpan-1,maxY:e.y_src+e.cell.rowSpan-1}:{minX:0,minY:0,maxX:0,maxY:0}},getRangeByCellsData:function(e,t,n){if(!e||!t||!n)return null;var o=s.getRangeByCellData(t);if(t.cell===n.cell)return o;for(var r,i,a,l,c,d,u,f,m,g=s.getRangeByCellData(n),p=Math.min(o.minX,g.minX),h=Math.min(o.minY,g.minY),E=Math.max(o.maxX,g.maxX),C=Math.max(o.maxY,g.maxY),T={},b=!0;b;)for(b=!1,r=p,i=h,a=E,l=C,d=h;d<=C;d++){for(c=p;c<=E;c++)if(d>h&&d<C&&c<E-1)c=E-1;else if(u=e[d][c],m=u.x_src+"_"+u.y_src,!T[m]&&(f=s.getRangeByCellData(u),p=Math.min(p,f.minX),h=Math.min(h,f.minY),E=Math.max(E,f.maxX),C=Math.max(C,f.maxY),p!==r||h!==i||E!==a||C!==l)){b=!0;break}if(b)break}return{minX:p,minY:h,maxX:E,maxY:C}},getTableGrid:function(e){function t(e,t){for(;C[t][e];)e++;return e}if(!e||!a.isTag(e,"table"))return null;var n,o,r,i,l,s,c,d,u,f,m,g,p,h,E,C=[];for(r=e.rows,o=0;o<r.length;o++)for(i=r[o],l=i.cells,C[o]||(C[o]=[]),n=0;n<l.length;n++)for(s=l[n],c=s.colSpan,d=s.rowSpan,s.firstChild||(s.innerHTML="<br>"),E=t(n,o),u=0;u<d;u++)for(C[o+u]||(C[o+u]=[]),f=0;f<c;f++)g=o+u,m=t(E+f,g),0==u&&0==f&&(p=m,h=g),C[g][m]={cell:s,x:m,y:g,x_src:p,y_src:h,fake:u>0||f>0};return C},getTemplateByHtmlForPaste:function(e){var t,n,r,i,l,s=!1,c=o.doc.createElement("div");if(c.innerHTML=e,a.childNodesFilter(c),t=c.querySelectorAll("table"),1==t.length&&(n=t[0],a.remove(n),a.isEmptyDom(c)?(s=!0,r=n):c.innerHTML=e),!s){for(t=c.querySelectorAll("table"),i=t.length-1;i>=0;i--)n=t[i],a.before(o.doc.createTextNode(n.innerText),n),a.remove(n);for(i=c.childNodes.length-1;i>=0;i--)l=c.childNodes[i],1!==l.nodeType&&3!==l.nodeType&&a.isEmptyDom(l)&&c.removeChild(l);r=c}return{isTable:s,pasteDom:r}},getTemplateByTxtForPaste:function(e){e=(e||"").trim();var t,n,r,i,a,l=e.split(/\r?\n/),c=o.doc.createElement("table"),d=o.doc.createElement("tbody"),u=0;for(c.appendChild(d),n=0;n<l.length;n++){for(r=l[n].split("\t"),i=o.doc.createElement("tr"),t=0;t<r.length;t++)a=s.createCell(),r[t]&&(a.innerHTML="",a.appendChild(o.doc.createTextNode(r[t]))),i.appendChild(a);u=Math.max(u,i.cells.length),d.appendChild(i)}for(l=c.rows,n=0;n<l.length;n++)for(i=l[n],r=i.cells,t=r.length;t<u;t++)i.appendChild(s.createCell());return{isTable:!0,pasteDom:c}},initTable:function(e){var t,n,o;for(t=e.rows.length-1;t>=0;t--)for(n=e.rows[t].cells.length-1;n>=0;n--)o=e.rows[t].cells[n],o.style.width=o.offsetWidth+"px";e.style.width=e.offsetWidth+"px"},initTableContainer:function(e){function t(e,t){var n=e.parentNode;return t(n)||(n=o.doc.createElement("div"),a.before(n,e),n.appendChild(e)),n}var n,i,l,s,c,d=e?[e]:o.doc.querySelectorAll("table");for(s=0,c=d.length;s<c;s++)n=d[s],l=t(n,function(e){return e!==o.doc.body&&(1===e.childNodes.length?(a.addClass(e,r.CLASS.TABLE_BODY),!0):a.hasClass(e,r.CLASS.TABLE_BODY))}),i=t(l,function(e){return e!==o.doc.body&&(1===e.childNodes.length?(a.addClass(e,r.CLASS.TABLE_CONTAINER),!0):a.hasClass(e,r.CLASS.TABLE_CONTAINER))}),a.addClass(i,r.CLASS.TABLE_CONTAINER),a.css(i,{position:"relative",padding:"0"}),a.addClass(l,r.CLASS.TABLE_BODY),a.removeClass(l,r.CLASS.TABLE_MOVING)},insertCol:function(e,t){if(e){t=t||0;var n,r,i,l,c,d,u=a.getParentByTagName(e[0][0].cell,"table",!1,null),f=u.rows,m=null;for(n=0;n<e.length;n++)r=e[n],r.length>t?(i=e[n][t],l=i.cell):(i=null,l=null),l&&l!==m&&i.x_src<t?(i.cell.colSpan++,i.cell.style.width=s.getCellWidth(i.cell)+o.options.table.colWidth+"px"):(!l||l&&i.x_src==t)&&(c=s.createCell(o.options.table.colWidth),l&&i.y_src<i.y?(d=s.getNextCellDataInRow(e[n],t),f[n].insertBefore(c,d?d.cell:null)):f[n].insertBefore(c,l)),m=i?i.cell:null;s.fixTableWidth(u)}},insertRow:function(e,t){if(e){t=t||0;var n,r,i,l=(a.getParentByTagName(e[0][0].cell,"table",!1,null),o.doc.createElement("tr")),c=e[e.length>t?t:e.length-1];for(n=0;n<c.length;n++)r=c[n],e.length>t&&r.y_src<r.y&&r.x_src==r.x?r.cell.rowSpan++:(e.length<=t||r.y_src==r.y)&&(i=s.cloneCell(r.cell,!0),r.cell.colSpan>1&&(i.style.width=r.cell.offsetWidth/r.cell.colSpan+"px"),l.appendChild(i));var d=c[0].cell.parentElement,u=d.parentElement;e.length<=t&&(d=null),u.insertBefore(l,d)}
},isMenu:function(e){return!!e&&!!a.getParentByFilter(e,function(e){return a.hasClass(e,r.CLASS.TABLE_TOOLS)},!0)},mergeCell:function(e,t){if(!s.canMerge(e,t))return null;var n=t.maxY-t.minY+1,r=t.maxX-t.minX+1,i=e[t.minY][t.minX].cell,l=o.doc.createElement("div");for(s.eachRange(e,t,function(e){if(!e.fake&&e.cell!=i){if(!a.isEmptyDom(e.cell))for(l.lastChild&&l.appendChild(o.doc.createElement("br"));e.cell.firstChild;)l.appendChild(e.cell.firstChild);a.remove(e.cell)}});l.firstChild;)i.appendChild(l.firstChild);return i.rowSpan=n,i.colSpan=r,i},modifySelectionDom:function(e,t,n){var o,r;o=t["text-align"]||null,r=t["text-valign"]||null,delete t["text-align"],delete t["text-valign"],s.eachRange(e.grid,e.range,function(e){e.fake||l.modifyDomsStyle(e.cell.childNodes,t,n,[])}),(o||r)&&s.setCellAlign(e.grid,e.range,{align:o,valign:r})},setCellAlign:function(e,t,n){if(e&&t){var o={};null!=n.align&&(o.align=n.align||"left"),null!=n.valign&&(o.valign=n.valign||"middle"),s.eachRange(e,t,function(e){e.fake||(o.align&&a.css(e.cell,{"text-align":""}),o.valign&&a.css(e.cell,{"text-valign":""}),a.attr(e.cell,o))})}},setCellBg:function(e,t,n){e&&t&&(n=n||"","transparent"===n.toLowerCase()&&(n=""),s.eachRange(e,t,function(e){e.fake||a.css(e.cell,{"background-color":n})}))},getKeyForColWidth:function(e){return e.x_src+"_"+e.y_src},fixColTimer:-1,fixColWidth:function(e,t,n,i,a){a>=0||(s.fixColTimer&&clearTimeout(s.fixColTimer),s.fixColTimer=setTimeout(function(){var l,c,d,u,f=a;for(e.style.width=t+"px",l=0,c=n.length;l<c;l++)d=n[l],u=d.cell.offsetWidth-i[s.getKeyForColWidth(d)]+a,f=0===l?u:Math.max(f,u);if(f>a){for(e.style.width=t-a+f+"px",l=0,c=n.length;l<c;l++)d=n[l],d.cell.style.width=i[s.getKeyForColWidth(d)]-a+f+"px";o.event.call(r.EVENT.UPDATE_RENDER)}},0))},setColWidth:function(e,t,n,r){function i(){var e,i,a,l,s=r;for(e=0;e<t.length;e++){if(i=t[e][n],l=o.options.table.colWidthMin-i.cell.offsetWidth,1==i.cell.colSpan){s=l,a=i.cell;break}s<l&&(s=l,a=i.cell)}return r<s?s:r}r=i();var a,l,c,d,u=e.offsetWidth+r,f=[],m={};for(a=0,l=t.length;a<l;a++)c=t[a][n],d=s.getKeyForColWidth(c),m[d]||(m[d]=c.cell.offsetWidth+r,f.push(c));for(e.style.width=u+"px",a=0,l=f.length;a<l;a++)c=f[a],c.cell.style.width=m[s.getKeyForColWidth(c)]+"px";s.fixColWidth(e,u,f,m,r)},setRowHeight:function(e,t,n,r){var i,a,l,s,c=r;for(i=0;i<t[n].length;i++){if(a=t[n][i],s=o.options.table.rowHeightMin-a.cell.offsetHeight,1==a.cell.rowSpan){c=s,l=a.cell;break}c<s&&(c=s,l=a.cell)}l&&(r<c?l.parentNode.style.height=o.options.table.rowHeightMin+"px":l.parentNode.style.height=a.cell.offsetHeight+r+"px")},splitCell:function(e,t,n){var o,r,i,a,l,c,d=s.canSplit(t,n);if(!d)return null;var u,f,m;for(a in d)if(d.hasOwnProperty(a))for(i=d[a],c=i.cell.rowSpan,l=i.cell.colSpan,r=i.y_src;r<i.y_src+c;r++)for(o=i.x_src;o<i.x_src+l;o++)u=t[r][o],u.fake?(f=s.getNextCellDataInRow(t[r],o),f=f?f.cell:null,m=s.cloneCell(u.cell,!0),e.rows[r].insertBefore(m,f),u.fake=!1,u.cell=m,u.y_src=r,u.x_src=o):(u.cell.rowSpan=1,u.cell.colSpan=1),u.cell.style.width="";return n}};t.exports=s},{"../rangeUtils/rangeExtend":43,"./../common/const":16,"./../common/env":18,"./../common/utils":22,"./../domUtils/domExtend":27}],47:[function(e,t,n){"use strict";function o(e){_.table=e,_.grid=A.getTableGrid(_.table)}function r(){if(_.table){var e,t=_.table.getElementsByClassName(v.CLASS.SELECTED_CELL);for(e=t.length-1;e>=0;e--)N.removeClass(t[e],[v.CLASS.SELECTED_CELL,v.CLASS.SELECTED_CELL_MULTI])}}function i(){if(!_.grid||!_.range)return null;var e=[];return A.eachRange(_.grid,_.range,function(t){t.fake||e.push(t)}),e}function a(e,t,n){var o=e.querySelector("#"+t);return o||(o=b.doc.createElement(n),o.id=t,e.appendChild(o)),o}function l(){if(!_.grid||!_.range)return!1;var e=!1;return A.eachRange(_.grid,_.range,function(t){return e=t.fake,!e}),!1}function s(){if(!_.grid||!_.range)return!1;var e=_.grid[_.range.minY][_.range.minX],t=_.grid[_.range.maxY][_.range.maxX],n=_.start;return e.cell==t.cell&&t.cell==n.cell}function c(){var e=O.getRange();if(!e)return b.client.type.isPhone||b.client.type.isPad||!s();var t,n,o;return _.grid&&_.start&&(t=N.getParentByTagName(e.startContainer,["th","td"],!0,null),n=e.collapsed?t:N.getParentByTagName(e.endContainer,["th","td"],!0,null)),!_.start||_.start.cell==t&&t==n||!e.collapsed&&_.start.cell==t&&t!=n&&0===e.endOffset&&n==A.getNextCellInTable(t)&&(n=t.lastChild,o=N.getEndOffset(n),setTimeout(function(){O.setRange(e.startContainer,e.startOffset,n,o)},200),!0)}function d(e){if(e){var t,n;for(t=0,n=e.length;t<n;t++)N.addClass(e[t].cell,v.CLASS.SELECTED_CELL+(n>1?" "+v.CLASS.SELECTED_CELL_MULTI:""))}}function u(e){if(_.table){var t=p(),n=t.colLine.minLeft;e<n&&(e=n),N.css(t.colLine,{top:_.table.offsetTop+"px",left:e+"px",height:_.table.offsetHeight+"px",display:"block"}),t.container.style.display="block"}}function f(e){if(_.table){var t=p(),n=t.rowLine.minTop;e<n&&(e=n),N.css(t.rowLine,{left:_.table.offsetLeft+"px",top:e+"px",width:_.table.offsetWidth+"px",display:"block"}),t.container.style.display="block"}}function m(e){A.initTableContainer(_.table);var t=_.table.parentNode;t.appendChild(e.container)}function g(){r(),d(i());var e=p();if(!_.start||!_.range)return e.container.style.display="none",e.start.dom.style.display="none",void(e.range.dom.style.display="none");m(e);var t,n,o,a,l,c,u,f,g=b.doc.body.clientTop,E=b.doc.body.clientLeft,C=_.start?_.start.cell:null,T=_.grid[_.range.minY][_.range.minX],v=_.grid[_.range.maxY][_.range.maxX];T&&v&&(T=T.cell,v=v.cell,C&&(n=g+C.offsetTop,t=E+C.offsetLeft,o=C.offsetWidth,a=C.offsetHeight),c=g+T.offsetTop,l=E+T.offsetLeft,T==v?(u=T.offsetWidth,f=T.offsetHeight):(u=v.offsetLeft+v.offsetWidth-l,f=v.offsetTop+v.offsetHeight-c),N.css(e.start.dom,{top:n+"px",left:t+"px"}),N.css(e.start.top,{width:o+"px"}),N.css(e.start.left,{height:a+"px"}),N.css(e.start.bottom,{top:a-1+"px",width:o+"px"}),N.css(e.start.right,{left:o-1+"px",height:a+"px"}),N.css(e.start.dot,{top:a-1-4+"px",left:o-1-4+"px"}),N.css(e.range.dom,{top:c+"px",left:l+"px"}),N.css(e.range.top,{width:u+"px"}),N.css(e.range.left,{height:f+"px"}),N.css(e.range.bottom,{top:f+"px",width:u+"px"}),N.css(e.range.right,{left:u+"px",height:f+"px"}),N.css(e.range.dot,{top:f-4+"px",left:u-4+"px"}),e.start.dom.style.display="block",s()?(e.start.dot.style.display="block",e.range.dom.style.display="none"):(e.start.dot.style.display="none",e.range.dom.style.display="block"),e.container.style.display="block",e.start.dot.style.display="none",e.range.dot.style.display="none",h())}function p(){var e={container:null,rowLine:null,colLine:null,start:{dom:null,top:null,right:null,bottom:null,left:null,dot:null},range:{dom:null,top:null,right:null,bottom:null,left:null,dot:null}};return e.container=a(b.doc.body,v.ID.TABLE_RANGE_BORDER,v.TAG.TMP_TAG),N.attr(e.container,{contenteditable:"false"}),e.colLine=a(e.container,v.ID.TABLE_COL_LINE,"div"),e.rowLine=a(e.container,v.ID.TABLE_ROW_LINE,"div"),e.start.dom=a(e.container,v.ID.TABLE_RANGE_BORDER+"_start","div"),e.start.top=a(e.start.dom,v.ID.TABLE_RANGE_BORDER+"_start_top","div"),e.start.right=a(e.start.dom,v.ID.TABLE_RANGE_BORDER+"_start_right","div"),e.start.bottom=a(e.start.dom,v.ID.TABLE_RANGE_BORDER+"_start_bottom","div"),e.start.left=a(e.start.dom,v.ID.TABLE_RANGE_BORDER+"_start_left","div"),e.start.dot=a(e.start.dom,v.ID.TABLE_RANGE_BORDER+"_start_dot","div"),e.range.dom=a(e.container,v.ID.TABLE_RANGE_BORDER+"_range","div"),e.range.top=a(e.range.dom,v.ID.TABLE_RANGE_BORDER+"_range_top","div"),e.range.right=a(e.range.dom,v.ID.TABLE_RANGE_BORDER+"_range_right","div"),e.range.bottom=a(e.range.dom,v.ID.TABLE_RANGE_BORDER+"_range_bottom","div"),e.range.left=a(e.range.dom,v.ID.TABLE_RANGE_BORDER+"_range_left","div"),e.range.dot=a(e.range.dom,v.ID.TABLE_RANGE_BORDER+"_range_dot","div"),e}function h(){var e;return _.grid&&_.range&&!s()?(e=b.doc.getSelection(),void e.empty()):void(c()||O.setRange(_.start.cell,_.start.cell.childNodes.length))}var E,C,T,b=e("../common/env"),v=e("../common/const"),y=e("../common/utils"),S=e("../common/historyUtils"),A=e("./tableUtils"),N=e("../domUtils/domExtend"),O=e("../rangeUtils/rangeExtend"),_={active:!1,table:null,start:null,end:null,range:null,grid:null},D={bind:function(){D.unbind(),b.event.add(v.EVENT.ON_SELECTION_CHANGE,D.handler.onSelectionChange),b.event.add(v.EVENT.UPDATE_RENDER,D.handler.updateRender),_.table&&(_.table.addEventListener("DOMSubtreeModified",D.handler.onDomModified),b.doc.body.addEventListener("resize",D.handler.onDomModified))},unbind:function(){var e=x.getZone();b.event.remove(v.EVENT.ON_SELECTION_CHANGE,D.handler.onSelectionChange),b.event.remove(v.EVENT.UPDATE_RENDER,D.handler.updateRender),e.table&&(e.table.removeEventListener("DOMSubtreeModified",D.handler.onDomModified),b.doc.body.removeEventListener("resize",D.handler.onDomModified))},bindStopSelectStart:function(){D.unbindStopSelectStart(),b.event.add(v.EVENT.ON_SELECT_START,D.handler.onStopSelectStart)},unbindStopSelectStart:function(){b.event.remove(v.EVENT.ON_SELECT_START,D.handler.onStopSelectStart)},bindDragLine:function(){D.unbindDragLine(),D.bindStopSelectStart(),b.event.add(v.EVENT.ON_MOUSE_MOVE,D.handler.onDragLineMove),b.event.add(v.EVENT.ON_MOUSE_UP,D.handler.onDragLineEnd)},unbindDragLine:function(){D.unbindStopSelectStart(),b.event.remove(v.EVENT.ON_MOUSE_MOVE,D.handler.onDragLineMove),b.event.remove(v.EVENT.ON_MOUSE_UP,D.handler.onDragLineEnd)},handler:{onDragLineMove:function(e){var t=p(),n=A.getMousePosition(e,_.table);"block"==t.colLine.style.display?u(n.x-t.colLine.startMouse+t.colLine.startLine):f(n.y-t.rowLine.startMouse+t.rowLine.startLine)},onDragLineEnd:function(e){D.unbindDragLine();var t,n=p(),o=A.getMousePosition(e,_.table),r="block"==n.colLine.style.display,i="block"==n.rowLine.style.display;n.colLine.style.display="none",n.rowLine.style.display="none",S.saveSnap(!1),r&&n.colLine.startMouse!==o.x?(t=n.colLine.cellData,t&&(A.initTable(_.table),A.setColWidth(_.table,_.grid,t.x,o.x-n.colLine.startMouse))):i&&n.rowLine.startMouse!==o.y&&(t=n.rowLine.cellData,t&&(A.initTable(_.table),A.setRowHeight(_.table,_.grid,t.y,o.y-n.rowLine.startMouse))),n.colLine.cellData=null,n.colLine.minLeft=null,n.colLine.startLine=null,n.colLine.startMouse=null,n.rowLine.cellData=null,n.rowLine.minTop=null,n.rowLine.startLine=null,n.rowLine.startMouse=null,b.event.call(v.EVENT.UPDATE_RENDER)},onSelectionChange:function(e){var t=b.doc.getSelection();c()||(t.empty(),y.stopEvent(e))},onDomModified:function(e){var t=e&&"DOMSubtreeModified"==e.type&&1===e.target.nodeType&&e.target.querySelector("img");T&&clearTimeout(T),T=setTimeout(function(){b.event.call(v.EVENT.UPDATE_RENDER,e,t)},100)},onStopSelectStart:function(e){return y.stopEvent(e),!1},updateRender:function(e,t){function n(e){g(),e&&C<60&&(E&&clearTimeout(E),E=setTimeout(function(){C++,n(e)},500))}C=0,n(t)}}},x={clear:function(){_.active=!1,_.start=null,_.end=null,_.range=null,_.grid=null,g();var e=p();return e.colLine.style.display="none",e.rowLine.style.display="none",_.table=null,D.unbind(),x},getFragmentForCopy:function(){var e=null;if(!_.range)return e;var t,n,o,r,i,a=b.doc.createElement("table"),l=b.doc.createElement("tbody");for(a.appendChild(l),n=_.range.minY;n<=_.range.maxY;n++){for(r=b.doc.createElement("tr"),t=_.range.minX;t<=_.range.maxX;t++)o=_.grid[n][t],o.fake||(i=A.cloneCell(o.cell,!1),r.children.length>0&&r.appendChild(b.doc.createTextNode("\t")),r.appendChild(i));r.appendChild(b.doc.createTextNode("\n")),l.appendChild(r)}return e=b.doc.createElement("div"),e.appendChild(a),e},getRangeBorder:p,getSelectedCells:function(){return A.getCellsByRange(_.grid,_.range)},getZone:function(){return{active:_.active,table:_.table,start:_.start,end:_.end,range:_.range,grid:_.grid}},hasMergeCell:l,isRangeActiving:function(){return _.start&&_.active},isSingleCell:s,isZoneBorder:function(e){var t,n=e.target,o=e.offsetX,r=e.offsetY,i=y.getEventClientPos(e),a=!1,l=!1,s=!1,c=!1,d=!1,u=!!N.getParentByFilter(n,function(e){return e&&1==e.nodeType&&(e.id==v.ID.TABLE_RANGE_BORDER+"_start_dot"||e.id==v.ID.TABLE_RANGE_BORDER+"_range_dot")},!0);u||(s=!!N.getParentByFilter(n,function(e){if(e&&1==e.nodeType&&(e.id==v.ID.TABLE_RANGE_BORDER+"_start_right"||e.id==v.ID.TABLE_RANGE_BORDER+"_range_right"))return!0;var t,n;return!(!e||1!=e.nodeType||!N.isTag(e,["td","th"]))&&(t=e.offsetWidth-4,n=e.offsetWidth+4,o>=t&&o<=n)},!0)),u||s||(c=!!N.getParentByFilter(n,function(e){if(e&&1==e.nodeType&&(e.id==v.ID.TABLE_RANGE_BORDER+"_start_bottom"||e.id==v.ID.TABLE_RANGE_BORDER+"_range_bottom"))return!0;var t,n;return!(!e||1!=e.nodeType||!N.isTag(e,["td","th"]))&&(t=e.offsetHeight-4,n=e.offsetHeight+4,r>=t&&r<=n)},!0)),c||u||s||(l=!!N.getParentByFilter(n,function(e){return e&&1==e.nodeType&&e.id==v.ID.TABLE_RANGE_BORDER},!0));var f,m,g;return c||u||s||l||(d=!!A.getContainerExcludeTable(n),d||n!=b.doc.body||(f=b.win.getComputedStyle(n),m=parseInt(f.paddingLeft),g=parseInt(f.paddingRight),a=i.x<=m||i.x>=b.doc.body.offsetWidth-g)),t=(e.target.clientWidth>0&&e.target.clientWidth<e.offsetX||e.target.clientHeight>0&&e.target.clientHeight<e.offsetY)&&(e.target.offsetWidth>=e.offsetX||e.target.offsetHeight>=e.offsetY),{isBodyBorder:a,isBorder:l,isBottom:c,isContainer:d,isDot:u,isRight:s,isScroll:t}},modify:function(e){if(!_.active||!e)return x;var t=N.getParentByTagName(e,["table"],!0,null);if(!t||t!==_.table)return x;var n=A.getCellData(_.grid,e);_.range=A.getRangeByCellsData(_.grid,_.start,n),_.end=n,g();var o=N.getParentByFilter(_.table,function(e){return N.hasClass(e,v.CLASS.TABLE_BODY)},!1);return N.addClass(o,v.CLASS.TABLE_MOVING),x},remove:function(){x.clear();var e,t=p();t&&(e=t.container.parentNode,e&&e.removeChild(t.container))},setEnd:function(e,t){t&&(_.active=!0),x.modify(e),_.active=!1,h(),b.event.call(v.EVENT.ON_SELECTION_CHANGE,null);var n=N.getParentByFilter(_.table,function(e){return N.hasClass(e,v.CLASS.TABLE_BODY)},!1);return N.removeClass(n,v.CLASS.TABLE_MOVING),x},setStart:function(e,t,n){if(!e)return x.clear(),x;var r=N.getParentByTagName(e,["table"],!0,null);if(!r)return x.clear(),x;if(r!==_.table&&(x.clear(),o(r)),_.active=!0,_.end=null,_.start=A.getCellData(_.grid,e),"undefined"!=typeof t&&"undefined"!=typeof n)try{var i=_.grid[n][t];i&&i.cell==_.start.cell&&(_.start=i)}catch(e){}return _.range=A.getRangeByCellsData(_.grid,_.start,_.start),g(),_.start.cell.scrollIntoViewIfNeeded&&_.start.cell.scrollIntoViewIfNeeded(),D.bind(),x},setStartRange:h,startDragColLine:function(e,t){var n,i;if(e&&1==e.nodeType&&e.id==v.ID.TABLE_RANGE_BORDER+"_start_right")i=_.start,e=_.start.cell,n=_.table;else if(e&&1==e.nodeType&&e.id==v.ID.TABLE_RANGE_BORDER+"_range_right")i=_.grid[_.range.maxY][_.range.maxX],e=i.cell,n=_.table;else{if(e=N.getParentByTagName(e,["th","td"],!0,null),!e)return;if(n=N.getParentByTagName(e,["table"],!0,null),!n)return;n!==_.table&&(r(),x.clear()),_.grid||o(n),i=A.getCellData(_.grid,e)}for(var a,l=i.x;l+1<_.grid[i.y].length&&(l++,a=_.grid[i.y][l],a.cell==e);)i=a;var s=e.offsetLeft+e.offsetWidth,c=p();m(c),c.colLine.minLeft=n.offsetLeft,c.colLine.startLine=s,c.colLine.startMouse=t,c.colLine.cellData=i,u(s);var d=b.doc.getSelection();d.empty(),D.bindDragLine()},startDragRowLine:function(e,t){var n,i;if(e&&1==e.nodeType&&e.id==v.ID.TABLE_RANGE_BORDER+"_start_bottom")i=_.start,e=_.start.cell,n=_.table;else if(e&&1==e.nodeType&&e.id==v.ID.TABLE_RANGE_BORDER+"_range_bottom")i=_.grid[_.range.maxY][_.range.maxX],e=i.cell,n=_.table;else{if(e=N.getParentByTagName(e,["th","td"],!0,null),!e)return;if(n=N.getParentByTagName(e,["table"],!0,null),!n)return;n!==_.table&&(r(),x.clear()),_.grid||o(n),i=A.getCellData(_.grid,e)}for(var a,l=i.y;l+1<_.grid.length&&(l++,a=_.grid[l][i.x],a.cell==e);)i=a;var s=e.offsetTop+e.offsetHeight,c=p();m(c),c.rowLine.minTop=n.offsetTop,c.rowLine.startLine=s,c.rowLine.startMouse=t,c.rowLine.cellData=i,f(s);var d=b.doc.getSelection();d.empty(),D.bindDragLine()},switchCell:function(e,t){function n(){t.canChangeRow&&r>=0&&r<_.grid.length&&(o<0?(o=_.grid[r].length-1,r-=1):o>=_.grid[r].length&&(o=0,r+=1))}if(!t||!_.start)return null;t.x=t.x?t.x>0?1:-1:0,t.y=t.y?t.y>0?1:-1:0;var o=e.x+t.x,r=e.y+t.y;n();for(var i=e;r>=0&&r<_.grid.length&&o>=0&&o<_.grid[r].length&&i.cell==e.cell;)i=_.grid[r][o],o+=t.x,r+=t.y,n();return i},updateGrid:function(){var e,t;return _.table&&(_.grid&&(e=_.grid[_.range.minY][_.range.minX],t=_.grid[_.range.maxY][_.range.maxX]),o(_.table),e=A.getCellData(_.grid,e.cell),t=A.getCellData(_.grid,t.cell),_.range=A.getRangeByCellsData(_.grid,e,t),_.start=A.getCellData(_.grid,_.start.cell),_.end&&(_.end=A.getCellData(_.grid,_.end.cell))),b.event.call(v.EVENT.UPDATE_RENDER),x}};t.exports=x},{"../common/const":16,"../common/env":18,"../common/historyUtils":19,"../common/utils":22,"../domUtils/domExtend":27,"../rangeUtils/rangeExtend":43,"./tableUtils":46}],48:[function(e,t,n){"use strict";function o(e){if(!g.hasPermission())return null;var t=e.target;if(!c.hasClass(t,a.CLASS.TODO_CHECKBOX))return null;var n=f.getContainerFromChild(t),o=f.getContainerFromChild(n.parentNode);return o?f.fixNewTodo(o):f.fixNewTodo(n),i.readonly&&h.curCheckbox?null:(!i.readonly||h.docLockChecked?r(t,e):(h.curCheckbox=t,g.checkDocLock("onCheckDocLock")),void d.setRange(n,n.children.length))}function r(e,t){var n=f.checkTodo(e,g);n&&(i.readonly&&h.addModifiedId(n),t&&l.stopEvent(t))}var i=e("../common/env"),a=e("../common/const"),l=e("../common/utils"),s=e("../common/historyUtils"),c=e("../domUtils/domExtend"),d=e("../rangeUtils/rangeExtend"),u=e("./todoRouteForClient"),f=e("./todoUtils"),m=e("./todoStyle"),g=null,p=null,h={curCheckbox:null,docLockChecked:!1,modifiedIdList:{},htmlToSave:"",init:function(){if(i.readonly){h.modifiedIdList={};var e,t,n=i.doc.querySelectorAll("."+a.CLASS.TODO_CHECKBOX);for(e=0;e<n.length;e++)t=n[e],t.wizTodoIndex=e}},addModifiedId:function(e){if(i.readonly){var t=e.checkbox,n=e.checked,o=h.modifiedIdList[t.wizTodoIndex];"boolean"==typeof o&&o!==n?delete h.modifiedIdList[t.wizTodoIndex]:h.modifiedIdList[t.wizTodoIndex]=n}},getModifiedIdList:function(){var e,t=[];for(e in h.modifiedIdList)h.modifiedIdList.hasOwnProperty(e)&&t.push({id:e,checked:h.modifiedIdList[e]});return t},modifyDoc:function(){var e="",t=h.getModifiedIdList();if(0===t.length)return e;e=g.getOriginalDoc();var n=i.doc.getElementById(a.ID.IFRAME_FOR_SAVE);n||(n=i.doc.createElement("iframe"),n.id=a.ID.IFRAME_FOR_SAVE,i.doc.body.appendChild(n)),n.style.display="none";var o,r,l,s,d,u,m=i.doc,p=i.win,E=n.contentDocument,C=g.isPersonalDocument();for(E.open("text/html","replace"),E.write(e),E.close(),i.doc=E,i.win=n.contentWindow,f.oldPatch.fixOldTodo(),f.fixNewTodo(),s=i.doc.querySelectorAll("."+a.CLASS.TODO_CHECKBOX),o=t.length-1;o>=0;o--)r=t[o].id,l=t[o].checked,d=s[r],d&&(u=f.getMainFromChild(d),f.check(u,l),C||f.addUserInfo(u,l,d.id,g));return f.checkTodoStyle(!0),e=c.getContentHtml(),i.doc=m,i.win=p,i.doc.body.removeChild(n),e}},E={bind:function(){E.unbind(),i.event.add(a.EVENT.ON_SELECTION_CHANGE,E.handler.onSelectionChange),i.event.add(a.EVENT.AFTER_RESTORE_HISTORY,E.handler.afterRestoreHistory),i.event.add(a.EVENT.ON_EXEC_COMMAND,E.handler.onExecCommand),i.event.add(a.EVENT.ON_PASTE,E.handler.onPaste),i.event.add(a.EVENT.AFTER_INSERT_DOM,E.handler.afterInsertDom),i.client.type.isIOS||i.client.type.isAndroid?(i.event.add(a.EVENT.ON_TOUCH_END,E.handler.onTouchEnd),i.event.add(a.EVENT.ON_TOUCH_START,E.handler.onTouchStart)):i.event.add(a.EVENT.ON_CLICK,E.handler.onClick)},unbind:function(){i.event.remove(a.EVENT.ON_CLICK,E.handler.onClick),i.event.remove(a.EVENT.ON_SELECTION_CHANGE,E.handler.onSelectionChange),i.event.remove(a.EVENT.ON_TOUCH_END,E.handler.onTouchEnd),i.event.remove(a.EVENT.ON_TOUCH_START,E.handler.onTouchStart),i.event.remove(a.EVENT.AFTER_RESTORE_HISTORY,E.handler.afterRestoreHistory)},handler:{afterRestoreHistory:function(){f.checkTodoStyle(!1),f.fixNewTodo(),m.restoreUserAvatarStyle()},onClick:function(e){o(e)},onCheckDocLock:function(e,t){h.docLockChecked=!t,e||r(h.curCheckbox),h.curCheckbox=null},onExecCommand:function(){var e,t,n,o,r=d.getRange();if(r&&(e=r.collapsed?r.startContainer:c.getParentRoot([r.startContainer,r.endContainer]),e=c.getBlockParent(e,!0)))for(t=e.querySelectorAll("."+a.CLASS.TODO_CHECKBOX),n=0,o=t.length;n<o;n++)f.fixCheckbox(t[n],!1)},onKeyDown:function(e){if(!g.hasPermission())return!0;var t=d.getRange();if(!t)return!0;var n,o,r,u,m,p,h,E,C,T,b,v,y,S,A,N,O,_,D=e.keyCode||e.which;if(!t.collapsed){if(8!==D&&46!==D&&l.checkNonTxtKey(e))return!0;if(_=d.getRangeDomList({noSplit:!0}),_&&_.list.length>0){for(s.saveSnap(!1),r=t.endContainer,u=t.endOffset,3!==r.nodeType&&(t.endOffset===r.childNodes.length?(r=c.getLastDeepChild(r),u=c.getEndOffset(r)):(r=r.childNodes[t.endOffset],u=0)),T=f.getContainerFromChild(r),N=_.list.length-1;N>=0;N--)O=_.list[N],f.isCheckbox(O)&&(C=f.getContainerFromChild(O),E=f.getMainFromChild(O),E&&(h=E.parentNode,f.cancelTodo(h,!0)),T&&C==T&&(r.parentNode||(r=h,u=c.getEndOffset(r)),d.setRange(t.startContainer,t.startOffset,r,u)));return!0}t.collapse(!0)}if(m=f.isCaretAfterCheckbox(),p=f.getMainByCaret(),h=p?c.getBlockParent(p,!1):f.getContainerFromChild(t.startContainer),b=c.getEndOffset(t.endContainer)===t.endOffset,!h||p||f.getCheckbox(h)||(c.removeClass(h,a.CLASS.TODO_LAYER),h=null),!h&&!b&&13!==D)return!0;if(8===D&&m)return s.saveSnap(!1),f.cancelTodo(h),l.stopEvent(e),!1;if(46===D&&(s.saveSnap(!1),n=t.startContainer,o=t.startOffset,d.selectCharIncludeFillChar(),t=d.getRange(),r=t.endContainer,E=f.getMainFromChild(r)||f.getMainInDom(r),d.setRange(n,o),E&&E!=p))return f.cancelTodo(E.parentNode,!0),!1;if(37===D&&m&&(O=c.getPreviousNode(h)))return d.setRange(O,c.getEndOffset(O)),l.stopEvent(e),!1;if(!h||13!==D||e.shiftKey)return!0;if(s.saveSnap(!1),f.isEmptyContainer(h))return c.getParentByTagName(h,["blockquote","ul","ol"])?i.event.call(a.EVENT.EXEC_COMMEND,"outdent",!1):(h.innerHTML="<br>",c.removeClass(h,a.CLASS.TODO_LAYER),d.setRange(h,1)),l.stopEvent(e),!1;t.deleteContents(),f.fixNewTodo(h);var x=!1,L=f.getUserInfoInDom(h),R=void 0;L?(R=c.getPreviousNode(L,!1,h),t.startContainer===L&&t.startOffset!==c.getEndOffset(L)?x=!0:f.getUserInfoFromChild(t.startContainer)&&(x=!0)):R=h,t.setEndAfter(x?h:R);var w=t.cloneContents(),I=i.doc.createElement("div");for(w.appendChild(I);w.childNodes.length>1;)I.appendChild(w.firstChild);v=c.isEmptyDom(I);var M;if(v)S=f.cloneTodo(h),p=f.getMainInDom(S),c.after(S,h),f.setTodo(S,g),O=c.getLastDeepChild(S),3===O.nodeType?O.nodeValue=a.FILL_CHAR+a.FILL_CHAR:(O.appendChild(i.doc.createTextNode(a.FILL_CHAR+a.FILL_CHAR)),O=O.childNodes[0]),d.setRange(O,1);else{for(M=t.extractContents(),A=[],N=0;N<M.childNodes.length;N++)A.push(M.childNodes[N]);for(y=h!==i.doc.body&&c.isBlock(h)?h.tagName:"div",S=i.doc.createElement(y),c.after(S,h),p=f.setTodo(S,g),f.insertToMain(A,p),N=0;N<A.length;N++)f.clearBlock(A[N]);d.setRange(p,1)}if(l.stopEvent(e),p.getBoundingClientRect().top+p.clientHeight>i.doc.documentElement.clientHeight||p.getBoundingClientRect().top+p.clientHeight<0){var k=p.getBoundingClientRect().left+i.doc.body.scrollLeft,P=i.doc.body.scrollTop+p.clientHeight;window.scrollTo(k,P)}},afterInsertDom:function(){f.fixNewTodo(),f.checkTodoStyle(!1)},onPaste:function(){setTimeout(function(){E.handler.afterInsertDom()},300)},onSelectionChange:function(){var e=d.getRange();if(e){var t,n,o;e.collapsed||(n=e.endContainer,o=e.endOffset);var r=f.isCaretBeforeCheckbox();r.enable&&(t=r.checkbox,t&&t.nextSibling?(n=t.nextSibling,o=0):t&&(n=t.parentNode,o=c.getIndex(t)+1),e.collapsed?d.setRange(n,o):d.setRange(e.startContainer,e.startOffset,n,o))}},onTouchStart:function(e){p=e.target},onTouchEnd:function(e){e.target===p&&(p=null,o(e))}}},C={init:function(){},on:function(){f.oldPatch.fixOldTodo(),f.fixNewTodo(),h.init(),E.bind(),g||(g=u.getRoute()),f.checkTodoStyle(!0)},off:function(){E.unbind()},checkTodoStyle:function(){f.checkTodoStyle(!1)},closeDocument:function(){var e;return g||(g=u.getRoute()),e=i.client.type.isWin&&i.options.pc.pluginModified?c.getContentHtml():h.modifyDoc(),!e||i.client.type.isIOS||i.client.type.isMac||g.saveDoc(e,""),g.beforeCloseDoc&&g.beforeCloseDoc(),h.init(),e},onCheckDocLock:E.handler.onCheckDocLock,onKeyDown:E.handler.onKeyDown,setTodo:function(){s.saveSnap(!1),f.setTodo(null,g)},setTodoInfo:function(e){g.setTodoInfo&&g.setTodoInfo(e)}};t.exports=C},{"../common/const":16,"../common/env":18,"../common/historyUtils":19,"../common/utils":22,"../domUtils/domExtend":27,"../rangeUtils/rangeExtend":43,"./todoRouteForClient":49,"./todoStyle":50,"./todoUtils":51}],49:[function(e,t,n){"use strict";function o(){function e(){try{return s.UserAlias}catch(e){return console.error(e),""}}function t(){try{return s.GetUserGUID()}catch(e){return console.error(e),""}}function n(e){try{return s.GetUserAvatarFileName(e)}catch(e){return console.error(e),""}}function o(){try{return s.WizDocument.IsPersonalDocument()}catch(e){return console.error(e),!1}}function r(e){s.WizDocument&&(s.WizDocument.Type=e)}function i(){try{return!u.readonly||s.WizDocument.CanEdit}catch(e){return console.error(e),!1}}function a(){try{return s.WizDocument.GetHtml()}catch(e){return console.error(e),""}}function l(e,t){try{s.WizDocument.SetHtml2(e,t)}catch(e){console.error(e)}}function c(e){if(o())return void WizReader.todo[e](!1,!1);try{s.ExecuteCommand("OnClickingChecklist","WizReader.todo."+e+"({cancel}, {needCallAgain});","readingnote")}catch(e){console.error(e)}}s=u.win.external,this.getUserAlias=e,this.getUserGuid=t,this.getUserAvatarFileName=n,this.isPersonalDocument=o,this.setDocumentType=r,this.hasPermission=i,this.getOriginalDoc=a,this.saveDoc=l,this.checkDocLock=c}function r(){function e(){return"zzz"}function t(){return"63272832-e387-4d31-85c6-7549555f2231"}function n(){return"/wizas/a/users/avatar/63272832-e387-4d31-85c6-7549555f2231?default=true"}function o(){return!1}function r(e){}function i(){return!0}function a(){return u.doc.body.outerHTML}function l(e,t){console.log("saveDoc")}function s(e){setTimeout(function(){WizReader.todo.onCheckDocLock(!1,!1)},500)}this.getUserAlias=e,this.getUserGuid=t,this.getUserAvatarFileName=n,this.isPersonalDocument=o,this.setDocumentType=r,this.hasPermission=i,this.getOriginalDoc=a,this.saveDoc=l,this.checkDocLock=s}function i(){function e(){return c.userAlias}function t(){return c.userGuid}function n(e){return c.userAvatarFilePath}function o(){return c.isPersonalDocument}function r(e){c.changeCurrentDocumentType(e)}function i(){return!u.readonly||c.hasEditPermissionOnCurrentNote}function a(){return c.currentNoteHtml}function l(e,t){}function s(e){return c.clickingTodoCallBack.connect(WizReader.todo[e]),c.checkListClickable()}c=u.win.WizQtEditor,this.getUserAlias=e,this.getUserGuid=t,this.getUserAvatarFileName=n,this.isPersonalDocument=o,this.setDocumentType=r,this.hasPermission=i,this.getOriginalDoc=a,this.saveDoc=l,this.checkDocLock=s}function a(){function e(){return d.getUserAlias()}function t(){return d.getUserGuid()}function n(e){return d.getUserAvatarFileName(e)}function o(){return d.isPersonalDocument()}function r(e){d.setDocumentType(e)}function i(){return!u.readonly||d.hasPermission()}function a(){return d.getDocHtml()}function l(e,t){d.setDocHtml(e,t)}function s(e){d.checkDocLock()}function c(){d.onWizTodoReadCheckedClose()}d=u.win.WizNote,this.getUserAlias=e,this.getUserGuid=t,this.getUserAvatarFileName=n,this.isPersonalDocument=o,this.setDocumentType=r,this.hasPermission=i,this.getOriginalDoc=a,this.saveDoc=l,this.checkDocLock=s,this.beforeCloseDoc=c}function l(){function e(e){this.userAlias=e.alias,this.userGuid=e.userGuid,this.avatarFileName=e.avatar,this.personalDocument="true"===e.isPersonal,this._hasPermission="true"===e.hasPermission,this.originalHtml=f.decode(e.docHtml)}function t(){return this.userAlias}function n(){return this.userGuid}function o(e){return this.avatarFileName}function r(){return this.personalDocument}function i(e){u.win.location.href="wiztodolist://setDocumentType/?type="+e}function a(){return!u.readonly||this._hasPermission}function l(){return this.originalHtml}function s(e){u.win.location.href="wiztodolist://tryLockDocument/?callback="+e}this.getUserAlias=t,this.getUserGuid=n,this.getUserAvatarFileName=o,this.isPersonalDocument=r,this.setDocumentType=i,this.setTodoInfo=e,this.hasPermission=a,this.getOriginalDoc=l,this.checkDocLock=s,this.userAlias="",this.userGuid="",this.avatarFileName="",this.personalDocument=!1,this._hasPermission=!1,this.originalHtml=""}var s,c,d,u=e("../common/env"),f=e("../common/base64"),m={getRoute:function(){var e=null;return e=u.client.type.isWin?new o:u.client.type.isMac?new i:u.client.type.isIOS?new l:u.client.type.isAndroid?new a:new r},setQtEditor:function(){c=u.win.WizQtEditor}};t.exports=m},{"../common/base64":15,"../common/env":18}],50:[function(e,t,n){"use strict";function o(e){var t=new RegExp("^"+i.ID.TODO_AVATAR_STYLE+"(.*)$","i");return e.replace(t,"$1")}var r=e("../common/env"),i=e("../common/const"),a=e("../common/wizStyle"),l=e("../domUtils/domBase"),s={},c={todoChecked:"data:text/xml;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUYxRkNCNDRFNUYzMTFFN0I3MjU4OUZFNDhFRjQzMjQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUYxRkNCNDVFNUYzMTFFN0I3MjU4OUZFNDhFRjQzMjQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5RjFGQ0I0MkU1RjMxMUU3QjcyNTg5RkU0OEVGNDMyNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5RjFGQ0I0M0U1RjMxMUU3QjcyNTg5RkU0OEVGNDMyNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PoB3J04AAAJhSURBVHja7JjLK0RRHMdnhFiM55RsFJGFrcSOGguDaHZCSRY2Q7PwiAUlj1gMCkvF2FDKZpLXSh7xB1jMf6AmY5RSGt9Tv6vjdO5j7twzzcKvPt07v+ae873n/B5nxp1KpVy5ZHmuHLOcE5QvOqLR6O99KNmZLR2rYFYqiKwBrIU9lz5cSzKYiAXoCF7swGCHdsC47grBGsEDKHPgzUMGYgrAPhjkfBsyQSsk5gtMgQgGjTu8RUXgGPRyviMwIxPko+s0hGwriBcPOAMdnO8GjLItlgnSYuZQgZhKljeghfM9gwDtiG5QM3N6m6rBJWjifDHgBwmjoFZhteAK1HG+V9BF17QL4wII2yykbEVuBTEfFNAx08KoI2aR7mvAEPi0KKYZnFPsaMZipQ882m0dVdw9C75r4LXwXDtlT6VQKEfJb7uXBYUB2sAdqDd4poeyySP456jeZNRcv2llYkJruQetku8PgFNQLPjXWTviHWhNbrvdPkEZkeB8Xlq5AOdjPSlCbcElVOFZybjhTI4fMZr8m/OxVTgBk6zsg13JmL9VWFidZXou7SwTBw/SxPxLbep8/4mvwpJ4cuSAtkdYWdFuYZuVnRiDRqmrV4VVCpJlnmZJvSqs+kwtyzwWK/16VTgbh3w+80yrsK1Dvg3TMq/UrApnS5DLYtZZMrf4yxU/gzSHW/EZ6c88fr/fNIYqFIqpSCeo3+k6rFDQGHdQMxV0xXXnCVDuoJByGnOJPl9YETQP3kAh2KLDfsoh4jRmIc0xb0XQC51zTqnqOm1JGruV5jLOsv+/Y/4FpWk/AgwACweeMaBPu0MAAAAASUVORK5CYII=",todoUnChecked:"data:text/xml;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QjlFNzg2NjRFNUYzMTFFN0IyNkY5NzZGNEEyNTU3NEYiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QjlFNzg2NjVFNUYzMTFFN0IyNkY5NzZGNEEyNTU3NEYiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpCOUU3ODY2MkU1RjMxMUU3QjI2Rjk3NkY0QTI1NTc0RiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpCOUU3ODY2M0U1RjMxMUU3QjI2Rjk3NkY0QTI1NTc0RiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PohRJcgAAAEHSURBVHja7JgxCsJAEEWNSEAQ0XgG8QrWIhYp7e2stRMhpRDETltLe8sU4gE8guIdokQrm/UHvoUWZsVdEJmBx5AUMy87m5DEUUrlfinyuR8LEcqKwuuJKIrSVAdT0AZlwz0TsAVjcPR9/70QogF2oGJpEdIL7IIWaIJD1shCytzAENSAYwiPNW/sEWaOjGNKYwQWhlfnxJpFbomOzqZ+7JmVxb27ZC59cpfFFoVieQ6JkAiJkAiJkAiJkAj9gZBnsa/3iVDC3LMo1Ge+6ghtmWdgAKoGRaqsOeHxRkcoAGfggjlfyJUhYtZ02SPQEdrzi3INLhbGdWHtJns9hSP/h0Toy7gLMABy5T6ChFra5QAAAABJRU5ErkJggg=="
},d={common:"."+i.CLASS.TODO_MAIN+" {padding-left: 12px;line-height:30px;}li > ."+i.CLASS.TODO_MAIN+" {padding-left: 0}."+i.CLASS.TODO_CHECKED+" {color: #666;}."+i.CLASS.TODO_UNCHECKED+" {text-decoration: initial;}."+i.CLASS.TODO_CHECKED+" ."+i.CLASS.TODO_CHECKBOX+" {background-image:url("+c.todoChecked+")}."+i.CLASS.TODO_UNCHECKED+" ."+i.CLASS.TODO_CHECKBOX+" {background-image:url("+c.todoUnChecked+")}."+i.CLASS.TODO_CHECKBOX+" {border-radius:0;position:relative;top:-1px;vertical-align:middle;border:0;background-color:transparent;outline:none;width:18px !important; height:18px !important; cursor:default; padding:0px 10px 0px 5px;-webkit-user-select: none;background-size:18px;background-repeat:no-repeat;background-position:5px;box-sizing:initial;}."+i.CLASS.TODO_AVATAR+" {border:0;background-color:transparent;outline:none;width:20px !important; height: 20px !important; vertical-align: -20%; padding:0; margin:0 10px 0 0; border-radius:100%;background-size:20px;background-repeat:no-repeat;}."+i.CLASS.TODO_USER_INFO+" {padding-left: 20px;}input."+i.CLASS.TODO_AVATAR+" {position:relative;top:-4px;}."+i.CLASS.TODO_ACCOUNT+", ."+i.CLASS.TODO_DATE+" { color: #666; }"},u={insertTodoStyle:function(e){u.removeTodoOldStyle();var t=r.doc.getElementById(i.ID.TODO_STYLE);!e&&t||a.replaceStyleById(i.ID.TODO_STYLE,d.common,!1),u.removeUnUsedTodoStyle();var n="wiz_todo_checkbox_img_preview";if(r.client.type.isIOS&&!r.doc.body.querySelector("#"+n)){var o=r.doc.createElement(i.TAG.TMP_TAG),s=r.doc.createElement("img"),f=r.doc.createElement("img");s.src=c.todoChecked,f.src=c.todoUnChecked,o.setAttribute("contenteditable","false"),l.css(o,{width:0,height:0,opacity:0,overflow:"hidden",display:"inline-block"}),o.id=n,o.appendChild(s),o.appendChild(f),r.doc.body.appendChild(o)}},removeTodoOldStyle:function(){a.removeStyleById(i.ID.TODO_STYLE_OLD)},removeTodoStyle:function(){u.removeTodoOldStyle();var e=r.doc.getElementById(i.ID.TODO_STYLE);l.remove(e);var t,n,a=r.doc.querySelectorAll("style");for(n=a.length-1;n>=0;n--)e=a[n],e.id&&0===e.id.indexOf(i.ID.TODO_AVATAR_STYLE)&&(t=o(e.id),s[t]=e.innerHTML,l.remove(e))},removeUnUsedTodoStyle:function(e){var t,n,a,c,d,u=r.doc.querySelectorAll("style");if(e)return n=i.ID.TODO_AVATAR_STYLE+e,a=i.CLASS.TODO_USER_AVATAR+e,c=r.doc.querySelector("."+a),t=r.doc.getElementById(n),void(t&&!c&&(s[e]=t.innerHTML,l.remove(t)));for(d=u.length-1;d>=0;d--)t=u[d],n=t.id,n&&0===n.indexOf(i.ID.TODO_AVATAR_STYLE)&&(e=o(n),r.doc.querySelector("."+i.CLASS.TODO_USER_AVATAR+e)||(s[e]=t.innerHTML,l.remove(t)))},restoreUserAvatarStyle:function(){var e,t;for(e in s)s.hasOwnProperty(e)&&(t=i.ID.TODO_AVATAR_STYLE+e,!r.doc.querySelector("#"+t)&&r.doc.querySelector("."+i.CLASS.TODO_USER_AVATAR+e)&&a.replaceStyleById(t,s[e],!1))}};t.exports=u},{"../common/const":16,"../common/env":18,"../common/wizStyle":23,"../domUtils/domBase":26}],51:[function(e,t,n){"use strict";var o=e("../common/env"),r=e("../common/const"),i=e("../common/lang"),a=i.getLang(),l=e("../common/base64"),s=e("../common/wizStyle"),c=e("../common/utils"),d=e("../domUtils/domExtend"),u=e("../rangeUtils/rangeExtend"),f=e("../common/historyUtils"),m=e("./todoStyle"),g="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",p={addUserInfo:function(e,t,n,i){if(e){var a,l,s,c,f,g,h,E,C;if(a=p.deleteUserInfo(e.parentNode),!t)return void m.removeUnUsedTodoStyle(a);for(a=i.getUserGuid(),l=i.getUserAlias(),s=i.getUserAvatarFileName(r.CSS.TODO_LIST.IMG_WIDTH),c=p.getTime(),p.setUserAvatarStyle(a,s),f=p.getUserInfoHtml(a,l,c),g=o.doc.createElement("span"),d.addClass(g,r.CLASS.TODO_USER_INFO),g.innerHTML=f,g.setAttribute(r.ATTR.TODO_ID,n),C=e.childNodes.length-1;C>=0;C--)h=e.childNodes[C],d.isTag(h,"br")&&e.removeChild(h);for(E=e.nextElementSibling;E;){if(p.isMain(E)){e.parentElement.insertBefore(g,E);break}if(d.isTag(E,"br")){e.parentElement.insertBefore(g,E);break}E=E.nextElementSibling}E||e.parentElement.appendChild(g),g.hasChildNodes()||g.appendChild(o.doc.createElement("br")),u.setRange(g,g.childNodes.length)}},canBeContainer:function(e){return!d.isTag(e,["body","blockquote","td","th"])&&d.isBlock(e)},canCreateTodo:function(){var e=u.getRange();if(!e)return!1;if(d.getParentByClass(e.startContainer,r.CLASS.CODE_CONTAINER,!0))return!1;var t=u.getRangeDomList({noSplit:!0}),n=d.getBlockParent(t.startDom,!0)||o.doc.body,i=null;if(e.collapsed||t.endDom===t.startDom)e.collapsed&&n===o.doc.body&&(n=o.doc.body.childNodes[0]);else if(i=d.getBlockParent(t.endDom,!0)||o.doc.body,i!==n)return!1;return{rangeList:t,start:n,end:i}},cancelTodo:function(e,t){if(e){var n,i,a,l,s,c=u.getRange();n=c?c.startContainer:null,i=c?c.startOffset:0,a=p.getMainInDom(e),s=p.deleteUserInfo(e),m.removeUnUsedTodoStyle(s),l=p.deleteMain(a),l=l?l.start:null,d.removeClass(e,r.CLASS.TODO_LAYER),d.removeClass(e,r.CLASS.TODO_CHECKED),d.removeClass(e,r.CLASS.TODO_UNCHECKED),l&&!d.isEmptyDom(e)||e.querySelector("br")||(l=o.doc.createElement("br"),e.appendChild(l)),t||(n&&n.parentNode||(n=l,i=0),u.setRange(n,i)),p.checkTodoStyle(!1)}},check:function e(t,n){var o=this.getContainerFromChild(t);n?(d.removeClass(o,r.CLASS.TODO_UNCHECKED),d.addClass(o,r.CLASS.TODO_CHECKED)):(d.removeClass(o,r.CLASS.TODO_CHECKED),d.addClass(o,r.CLASS.TODO_UNCHECKED));var e=p.getCheckbox(t),i=n?"checked":"unchecked";e.setAttribute(r.ATTR.TODO_CHECK,i)},checkTodo:function(e,t){var n={checkbox:null,checked:!1};f.saveSnap(!1);var o,i=p.getMainFromChild(e);return i&&i.children[0]==e||p.fixCheckbox(e,!1),o="checked"!==e.getAttribute(r.ATTR.TODO_CHECK),p.check(i,o),n.checkbox=e,n.checked=o,t.isPersonalDocument()||p.addUserInfo(i,o,e.id,t),n},checkTodoStyle:function(e){var t=o.doc.querySelector("."+r.CLASS.TODO_CHECKBOX);t?m.insertTodoStyle(e):m.removeTodoStyle()},clearBlock:function(e){if(!e||1!==e.nodeType&&3!==e.nodeType&&11!==e.nodeType)return!1;var t,n;for(n=0;n<e.childNodes.length;n++)t=e.childNodes[n],p.clearBlock(t)&&t!=e.childNodes[n]&&n--;var o=11==e.nodeType,r=!o&&p.isTodoTag(e),i=!o&&d.isBlock(e);if(i&&d.isEmptyDom(e)){if(!(e.children.length>0))return d.remove(e),!0;d.peelDom(e)}else(i||r)&&d.peelDom(e);return!1},clearTodoClass:function(e){e&&d.removeClass(e,[r.CLASS.TODO_ACCOUNT,r.CLASS.TODO_AVATAR,r.CLASS.TODO_DATE,r.CLASS.TODO_LAYER,r.CLASS.TODO_MAIN,r.CLASS.TODO_CHECKED,r.CLASS.TODO_UNCHECKED,r.CLASS.TODO_USER_INFO])},cloneTodo:function(e){if(!e)return null;var t,n,i,a,l;if(t=d.clone(e,!0),a=p.getMainInDom(e),!a)return null;n=d.clone(a,!0),d.removeClass(t,r.CLASS.TODO_CHECKED),d.addClass(t,r.CLASS.TODO_UNCHECKED);for(var s=a,c=n;s&&s.childNodes&&s.childNodes.length;){for(l=s.childNodes[s.childNodes.length-1];l&&(3===l.nodeType&&0===l.nodeValue.replace(r.FILL_CHAR_REG,"").length||d.isBlock(l)||d.isSelfClosingTag(l));)l=l.previousSibling;!l||p.isCheckbox(l)?(i=o.doc.createTextNode(""),l=null):i=d.clone(l,!0),c.appendChild(i),c=i,s=l}return t.appendChild(n),u.setRange(n,1),t},deleteMain:function(e){return d.peelDom(e,function(e){return!p.isMain(e)&&!p.isCheckbox(e)})},deleteUserInfo:function(e){var t="",n=p.getMainInDom(e),o=e.querySelector("."+r.CLASS.TODO_AVATAR),i=o?o.className:"",a=new RegExp("^(.*"+r.CLASS.TODO_USER_AVATAR+")([^ ]*)(.*)$","i");i.indexOf(r.CLASS.TODO_USER_AVATAR)>-1&&(t=i.replace(a,"$2"));for(var l,s=n?n.nextElementSibling:e.firstChild;s&&!p.isMain(s);)p.isUserInfo(s)?(l=s,s=s.nextElementSibling,e.removeChild(l)):s=s.nextElementSibling;return t},fixCheckbox:function(e,t){if(e){if(e.id||(e.id=p.getCheckId()),d.attr(e,{style:null}),d.isTag(e,"input")){var n=o.doc.createElement("img");n.id=e.id,n.className=e.className,n.src=g,n.setAttribute(r.ATTR.TODO_CHECK,e.getAttribute(r.ATTR.TODO_CHECK)),d.before(n,e),d.remove(e),e=n}if(t||!p.getMainFromChild(e)){var i,a,l,s,c=d.getBlockParent(e),u=p.canBeContainer(c),f=o.doc.createElement("span"),m=!1;for(f.className=(t?r.CLASS.TODO_LABEL_OLD:r.CLASS.TODO_MAIN)+" "+r.CLASS.TODO_UNCHECKED,i=o.doc.createElement(u?c.tagName:"div"),u?d.after(i,c):d.before(i,e),i.appendChild(f),a=e;a;){if(l=a.nextSibling,d.isBlock(a)){if(!u)break;m=!0,s=i.nextSibling}m?d.before(a,s):p.isUserInfo(a)?d.after(a,f):f.appendChild(a),a=l}d.addClass(i,r.CLASS.TODO_LAYER);var h=p.getContainerFromChild(i.parentNode);h&&d.removeClass(h,r.CLASS.TODO_LAYER),u&&d.isEmptyDom(c)&&d.remove(c)}}},fixMain:function(e){if(e){var t,n,o=d.getLastDeepChild(e),i=p.getCheckbox(e);if(i||d.removeClass(e,r.CLASS.TODO_MAIN),d.attr(e,{style:null}),t=p.getContainerFromChild(e),t&&t!=e&&t!==e.parentNode)try{t.appendChild(e)}catch(e){console.error(e)}d.hasClass(e,r.CLASS.TODO_CHECKED)?(d.addClass(t,r.CLASS.TODO_CHECKED),d.removeClass(e,r.CLASS.TODO_CHECKED)):d.hasClass(e,r.CLASS.TODO_UNCHECKED)&&(d.addClass(t,r.CLASS.TODO_UNCHECKED),d.removeClass(e,r.CLASS.TODO_UNCHECKED));var a=e.querySelectorAll("."+r.CLASS.TODO_MAIN);for(n=a.length-1;n>=0;n--)d.after(a[n],e);if(d.isEmptyDom(e)&&e.parentNode&&d.remove(e),o!=i&&(1!==o.nodeType&&3!==o.nodeType||1==o.nodeType&&d.isTag(o,"br")||3===o.nodeType&&0===o.nodeValue.replace(r.FILL_CHAR_REG,"").length)){for(t=o.parentNode;t!=e&&1==t.childNodes.length;)o=t,t=t.parentNode;d.remove(o),p.fixMain(e)}}},fixNewTodo:function(e){function t(e){if(d.isEmptyDom(e))return void d.remove(e);var t=p.getCheckbox(e);t||d.removeClass(l,r.CLASS.TODO_LAYER)}var n,i,a,l,s,c,u,f,m,g,h,E,C,T;for(i=e?e:o.doc,a=i.querySelectorAll("."+r.CLASS.TODO_LAYER),n=0;n<a.length;n++)if(l=a[n],d.attr(l,{style:null}),t(l),s=l.querySelectorAll("."+r.CLASS.TODO_LAYER),0!==s.length&&(c=s[0],u=c.parentNode,E=p.isTodoTag(u)||p.isLayer(u)?c:u,C=l,C!==E)){for(;T=E.nextSibling;)d.after(T,C),C=T;d.after(E,l),t(l)}for(g=i.querySelectorAll("."+r.CLASS.TODO_MAIN),n=0;n<g.length;n++)h=g[n],p.fixMain(h);for(f=i.querySelectorAll("."+r.CLASS.TODO_CHECKBOX),n=0;n<f.length;n++)m=f[n],p.fixCheckbox(m,!1);if(e){var b=d.getLastDeepChild(i);d.isTag(b,"br")&&d.remove(b)}},getCheckbox:function(e){return e?e.querySelector("."+r.CLASS.TODO_CHECKBOX):null},getCheckId:function(){return"wiz_todo_"+Date.now()+"_"+Math.floor(1e6*Math.random()+1)},getContainerFromChild:function(e){return e?d.getParentByFilter(e,function(e){return p.isLayer(e)},!0):null},getMainByCaret:function(){var e=u.getRange();if(!e)return null;var t=u.getRangeDetail(e.startContainer,e.startOffset);return p.getMainFromChild(t.container)},getMainFromChild:function(e){return e?d.getParentByClass(e,r.CLASS.TODO_MAIN,!0):null},getMainHtml:function(){var e='<span class="'+r.CLASS.TODO_MAIN+" "+r.CLASS.TODO_UNCHECKED+'"><img src="'+g+'" id="%1" class="'+r.CLASS.TODO_CHECKBOX+" "+r.CLASS.IMG_NOT_DRAG+'" '+r.ATTR.TODO_CHECK+'="unchecked" /></span>';return e=e.replace("%1",p.getCheckId())},getMainInDom:function(e){return e&&e.hasChildNodes()?p.isMain(e)?e:p.isLayer(e)?e.querySelector("."+r.CLASS.TODO_MAIN):null:null},getUserInfoFromChild:function(e){return e?d.getParentByClass(e,r.CLASS.TODO_USER_INFO,!0):null},getUserInfoInDom:function(e){return e.querySelector("."+r.CLASS.TODO_USER_INFO)},getUserInfoHtml:function(e,t,n){var o='<span class="'+r.CLASS.TODO_ACCOUNT+'"><input disabled readonly class="%1" />%2, </span><span class="'+r.CLASS.TODO_DATE+'">%3.</span>',i=r.CLASS.TODO_USER_AVATAR+l.encode(e);return o.replace("%1",r.CLASS.IMG_NOT_DRAG+" "+r.CLASS.TODO_AVATAR+" "+i).replace("%2",t).replace("%3",n)},getTime:function(){function e(e){return(e<10?"0":"")+e}var t,n,o=new Date;return n=e(o.getHours())+":"+e(o.getMinutes()),t="en"==a.version?a.Month[o.getMonth()]+" "+o.getDate()+", "+o.getFullYear()+" at "+n:o.getFullYear()+a.Date.Year+(o.getMonth()+1)+a.Date.Month+o.getDate()+a.Date.Day+" "+n},insertToMain:function(e,t){if(e&&t){var n,o,r=null;for(n=e.length-1;n>=0;n--)o=e[n],p.clearTodoClass(o),t.insertBefore(o,r),r=o}},isCaretAfterCheckbox:function(){var e=u.getRange();if(!e)return!1;var t,n,o,r;return o=p.getMainByCaret(),!!o&&(!!e.collapsed&&(t=u.getRangeDetail(e.startContainer,e.startOffset),!(3===t.container.nodeType&&t.offset>0&&(r=t.container.nodeValue.substr(0,t.offset),!c.isEmpty(r)))&&(n=t.isEnd?t.container:d.getPreviousNode(t.container,!1,o),p.isCheckbox(n))))},isCaretBeforeCheckbox:function(){var e={enable:!1,checkbox:null},t=u.getRange();if(!t)return e;var n=t.endContainer;return 1===n.nodeType?n=n.childNodes[t.endOffset]:3===n.nodeType&&d.isEmptyDom(n)&&t.endOffset==n.nodeValue.length&&!p.getContainerFromChild(n)&&(n=d.getNextNode(n,!1),n&&(n=d.getParentByFilter(n,function(e){return p.isLayer(e)},!0))),p.isLayer(n)||p.isMain(n)?(e.enable=!0,e.checkbox=p.getCheckbox(n)):p.isCheckbox(n)&&(e.enable=!0,e.checkbox=n),e.checkbox||(e.enable=!1),e},isCheckbox:function(e){return d.hasClass(e,r.CLASS.TODO_CHECKBOX)},isEmptyContainer:function(e){if(!e)return!0;var t,n,o=e.childNodes;for(t=0;t<o.length;t++)if(n=o[t],p.isMain(n)){if(!p.isEmptyMain(n))return!1}else if(!d.isEmptyDom(n))return!1;return!0},isEmptyMain:function(e){if(!e)return!0;var t,n,o=e.childNodes;for(t=0;t<o.length;t++)if(n=o[t],!p.isCheckbox(n)&&!d.isEmptyDom(n))return!1;return!0},isMain:function(e){return d.hasClass(e,r.CLASS.TODO_MAIN)},isLayer:function(e){return d.hasClass(e,r.CLASS.TODO_LAYER)},isTodoTag:function(e){return!!e&&(p.isMain(e)||p.isUserInfo(e)||d.hasClass(e,r.CLASS.TODO_ACCOUNT)||d.hasClass(e,r.CLASS.TODO_DATE))},isUserInfo:function(e){return d.hasClass(e,r.CLASS.TODO_USER_INFO)},setTodo:function(e,t){var n,i,a,l,s,c,f,m,g,h,E=[];if(e)i=e;else{var C=p.canCreateTodo();if(C===!1)return null;if(n=C.rangeList,i=C.start,i=d.packageByDiv(i),i!==o.doc.body){var T=d.getPrevBlock(i),b=d.getNextBlock(i);b&&b!==i&&(d.splitDomBeforeSub(i,b),d.isTag(b,"br")&&d.remove(b)),T&&T!==b&&T!==i&&(i=d.splitDomBeforeSub(i,T),d.isTag(T,"br")?d.remove(T):d.before(T,i))}}for(g=0,h=i.childNodes.length;g<h;g++){if(m=i.childNodes[g],d.isBlock(m)){d.splitDomBeforeSub(i,m);break}E.push(m)}s=p.getMainInDom(i),c=p.getUserInfoInDom(i);var v=!!p.getCheckbox(s);if((s||c)&&p.cancelTodo(i),v)return null;for(l=p.getMainHtml(),f=o.doc.createElement("div"),d.addClass(f,r.CLASS.TODO_LAYER),p.canBeContainer(i)?d.addClass(i,r.CLASS.TODO_LAYER):l='<div class="'+r.CLASS.TODO_LAYER+'">'+l+"</div>",f.innerHTML=l,s=p.getMainInDom(f),a=s.lastChild,p.insertToMain(E,s);f.lastChild;)i.insertBefore(f.lastChild,i.firstChild);return d.isSelfClosingTag(a)?u.setRange(a.parentNode,d.getIndex(a)+1):u.setRange(a,d.getEndOffset(a)),t.setDocumentType(r.TYPE.TODO),p.checkTodoStyle(!1),s},setUserAvatarStyle:function(e,t){var n=l.encode(e),i=r.ID.TODO_AVATAR_STYLE+n,a=r.CLASS.TODO_USER_AVATAR+n,c=o.doc.getElementById(i);if(!c)return(c=o.win.parent.document.getElementById(i))?void s.insertStyle({id:i},c.innerHTML):void d.convertImageToBase64(t,50,50,function(e){var t=o.doc.getElementById(i);t||s.insertStyle({id:i},"."+a+"{background-image:url("+e+");}")})},oldPatch:{fixImg:function(e){if(e){var t=o.doc.createElement("img");t.className=e.className,t.src=g,d.removeClass(t,r.CLASS.TODO_CHECK_IMG_OLD),d.addClass(t,r.CLASS.TODO_CHECKBOX),e.id&&(t.id=e.id),e.getAttribute("state")&&t.setAttribute(r.ATTR.TODO_CHECK,e.getAttribute("state"));var n=e.parentNode;n.insertBefore(t,e),n.removeChild(e)}},fixLabel:function(e){if(e&&(d.removeClass(e,r.CLASS.TODO_LABEL_OLD),d.addClass(e,r.CLASS.TODO_MAIN),d.hasClass(e,r.CLASS.TODO_CHECKED_OLD)?(d.removeClass(e,r.CLASS.TODO_CHECKED_OLD),d.addClass(e,r.CLASS.TODO_CHECKED)):d.hasClass(e,r.CLASS.TODO_UNCHECKED_OLD)&&(d.removeClass(e,r.CLASS.TODO_UNCHECKED_OLD),d.addClass(e,r.CLASS.TODO_UNCHECKED))),e&&!d.isTag(e,"span")){var t=e.parentNode;if(t){var n=o.doc.createElement("span");for(n.className=e.className;e.firstChild;)n.appendChild(e.firstChild);t.insertBefore(n,e),t.removeChild(e)}}},fixOldTodo:function(){var e,t,n,i,a,l,s,c,u,f,m,g;for(s=o.doc.querySelectorAll("."+r.CLASS.TODO_CHECK_IMG_OLD),e=s.length-1;e>=0;e--)c=s[e],f=p.oldPatch.getLabelFromChild(c),f&&f.children[0]===c||p.fixCheckbox(c,!0),p.oldPatch.fixImg(c);for(u=o.doc.querySelectorAll("."+r.CLASS.TODO_LABEL_OLD),e=0;e<u.length;e++){for(f=u[e],a=p.oldPatch.packageTodo(f),d.addClass(a,r.CLASS.TODO_LAYER),n=a.querySelectorAll("."+r.CLASS.TODO_LABEL_OLD),t=n.length-1;t>0;t--)i=n[t],l=p.oldPatch.packageTodo(i),d.after(l,a);p.oldPatch.fixUserInfo(f)}for(u=o.doc.querySelectorAll("."+r.CLASS.TODO_LABEL_OLD),e=u.length-1;e>=0;e--)p.oldPatch.fixLabel(u[e]);for(m=o.doc.querySelectorAll("."+r.CLASS.TODO_TAIL_OLD),e=m.length-1;e>=0;e--)g=m[e],d.isEmptyDom(g)?d.remove(g):d.removeClass(r.CLASS.TODO_TAIL_OLD)},fixUserInfo:function(e){var t,n,o=e.parentNode,i=p.oldPatch.getCheckImg(e),a=i?i.id:"",l=o.childNodes,s=!1;for(n=0;n<l.length;n++)t=l[n],d.hasClass(t,r.CLASS.TODO_USER_INFO)&&(s?(o.removeChild(t),n--):(s=!0,t.setAttribute(r.ATTR.TODO_ID,a)))},getCheckImg:function(e){return e?e.querySelector("."+r.CLASS.TODO_CHECK_IMG_OLD):null},getLabelFromChild:function(e){return e?d.getParentByFilter(e,function(e){return d.hasClass(e,r.CLASS.TODO_LABEL_OLD)},!0):null},isFirstLabel:function(e){if(!e)return!1;var t,n,o=e.parentNode,r=o.childNodes;for(t=0;t<r.length;t++){if(n=r[t],n===e)return!0;if(!d.isEmptyDom(n))return!1}return!1},packageTodo:function(e){if(!e)return null;var t=e.parentNode;if(t!==o.doc.body&&p.oldPatch.isFirstLabel(e))return t;var n,i=p.oldPatch.getCheckImg(e),a=i?i.id:"",l=a?t.querySelector("span["+r.ATTR.TODO_ID+"="+a+"]"):null,s=e.nextSibling,c=o.doc.createElement("div");for(c.appendChild(e);s;)n=s.nextSibling,c.appendChild(s),s=s===l?null:n;return t.insertBefore(c,n),c}}};t.exports=p},{"../common/base64":15,"../common/const":16,"../common/env":18,"../common/historyUtils":19,"../common/lang":20,"../common/utils":22,"../common/wizStyle":23,"../domUtils/domExtend":27,"../rangeUtils/rangeExtend":43,"./todoStyle":50}],52:[function(e,t,n){"use strict";function o(e){return e?(e.total=!!e.total,e.dom=e.dom,e.cursor=!!e.cursor):e={dom:null,cursor:!1,total:!0},e}var r=e("./common/env"),i=e("./common/const"),a=e("./domUtils/domExtend"),l=e("./amend/amend"),s=e("./common/historyUtils"),c=e("./common/base64"),d=e("./common/wizStyle"),u=e("./rangeUtils/rangeExtend"),f=e("./codeUtils/codeCore"),m=e("./formatPainterUtils/formatPainterCore"),g=e("./tableUtils/tableCore"),p=e("./todoUtils/todoCore"),h=e("./linkUtils/linkUtils"),E=e("./imgUtils/imgUtils"),C=e("./nightMode/nightModeUtils"),T=e("./editor/base"),b=e("./editor/editorEvent"),v=e("./editor/commandExtend"),y=e("./editor/pasteUtils"),S={version:"1.1",init:function(e){return r.init("editor",e),r.dependency.files.init(),T.init(),l.initUser(),l.setUsersData(),r.win.WizTemplate&&r.win.WizTemplate.init({document:r.doc,lang:r.options.lang,clientType:r.options.clientType}),S},on:function(e){function t(){r.readonly!==!0&&(r.win.WizTemplate&&r.win.WizTemplate.on(!1),r.options.autoFocus&&(r.win.WizTemplate?r.win.WizTemplate.focus():S.focus()),setTimeout(function(){r.client.type.isPhone&&r.client.type.isPad||(r.client.type.isMac&&r.options.noteType!==i.NOTE_TYPE.COMMON?setTimeout(function(){r.doc.body.scrollTop=n},100):r.doc.body.scrollTop=n),"function"==typeof e&&e()},0))}if(r.readonly!==!1){var n=r.doc.body.scrollTop;return r.win.WizReader&&r.win.WizReader.off(),d.removeStyleByName(i.NAME.STYLE_FOR_LOAD),T.on(t),S}},off:function(e,t){function n(){r.readonly!==!1&&(r.client.type.isPhone&&r.client.type.isPad||(r.doc.body.scrollTop=o),"function"==typeof t&&t())}if(r.readonly!==!0){var o=r.doc.body.scrollTop;return r.win.WizTemplate&&r.win.WizTemplate.off(),T.off(),d.removeStyleByName(i.NAME.STYLE_FOR_LOAD),r.win.WizReader&&r.win.WizReader.on(e,n),S}},backupCaret:function(){return u.backupCaret()},execCommand:function(){return s.saveSnap(!1),v.execCommand.apply(this,arguments)},find:function(e,t,n,o){return T.find(e,t,n,o)},focus:function(){return a.focus(),S},getBodyText:function(){return a.getBodyText()},getContentHtml:function(e){var t,n=[],o=u.getRange();return o&&(t=a.getParentRoot([o.startContainer,o.endContainer]),t&&(n=[t])),a.clearChild(r.doc.body,n),l.hideAmendInfo(),p.checkTodoStyle(),a.getContentHtml(e)},insertDefaultStyle:function(e,t){return d.insertDefaultStyle(e,t),S},insertCustomStyle:function(e,t,n){return d.insertCustomStyle(e,t,n),S},insertB64Html:function(e,t){T.insertHtml(c.decode(e),t)},insertHtml:function(e,t){T.insertHtml(e,t)},isModified:function(){var e=r.readonly===!1;if(!e)return e;var t=a.getContentHtml(),n=T.getOriginalHtml();return t=a.removeByTagFromHtml(t,i.TAG.CODE_MIRROR),n=a.removeByTagFromHtml(n,i.TAG.CODE_MIRROR),r.readonly===!1&&t!=n},modifySelectionDom:function(e,t){T.modifySelectionDom(e,t)},paste:function(e,t){y.pasteFromClient(e,t)},pasteB64:function(e,t){S.paste(c.decode(e),c.decode(t))},redo:function(){return s.redo(),S},removeFormat:function(e,t,n){return d.removeFormat(e,t,n),S},removeStyleById:function(e){return d.removeStyleById(e),S},replace:function(e,t,n){return T.replace(e,t,n)},replaceAll:function(e,t,n){T.replaceAll(e,t,n)},restoreCaret:function(){return u.restoreCaret()},saveSnap:function(){return s.saveSnap(!1),S},setUnModified:function(){T.setOriginalHtml()},undo:function(){return s.undo(),S},ListenerType:b.TYPE,addListener:function(e,t){return b.addListener(e,t),S},removeListener:function(e,t){return b.removeListener(e,t),S},triggerListener:function(e,t){return b.triggerListener(e,t),S},startTrackEvent:function(e,t){b.startTrackEvent(e,t)},stopTrackEvent:function(e,t){b.stopTrackEvent(e,t)},amend:{on:function(){return l.start(),S},off:function(){return l.startReverse(),S},isEdited:function(){return l.isAmendEdited()},isEditing:function(){return l.isAmendEditing()},hasAmendSpanByCursor:function(){return l.hasAmendSpanByCursor()},accept:function(e){l.accept(o(e))},refuse:function(e){l.refuse(o(e))}},code:{insertCode:f.insertCode},formatPainter:{on:function(e){return m.on(e)},off:function(){m.off()}},img:{getAll:function(e){return E.getAll(e).join(",")},insertAsAttachment:function(e,t){T.insertDom(E.makeAttachmentDom(e,t),!0)},insertByPath:function(e){T.insertDom(E.makeDomByPath(e),!0)},removeCur:function(){var e="img["+i.ATTR.IMG_EDITING+"]";E.remove(e)},replaceCur:function(e){var t="img["+i.ATTR.IMG_EDITING+"]";E.replaceSrc(t,e)}},link:{on:function(){h.on()},off:function(){h.off()},getCurrentLink:function(){return h.getCurrentLink()},removeSelectedLink:function(){h.removeSelectedLink()},setCurrentLink:function(e){h.setCurrentLink(e)}},range:{moveToPoint:function(e,t){u.moveToPoint(e,t)}},table:{canCreateTable:g.canCreateTable,clearCellValue:g.clearCellValue,deleteCols:g.deleteCols,deleteRows:g.deleteRows,deleteTable:g.deleteTable,distributeCols:g.distributeCols,insertCol:g.insertCol,insertRow:g.insertRow,insertTable:g.insertTable,merge:g.merge,setCellAlign:g.setCellAlign,setCellBg:g.setCellBg,split:g.split},todo:{setTodo:p.setTodo,setTodoInfo:p.setTodoInfo},nightMode:{on:function(e,t,n){C.on(e,t,n)},off:function(){C.off()}},utils:{clearStyleFromHtml:function(e,t){return a.clearStyleFromHtml(e,t)}}};window.WizEditor=S,t.exports=S},{"./amend/amend":5,"./codeUtils/codeCore":12,"./common/base64":15,"./common/const":16,"./common/env":18,"./common/historyUtils":19,"./common/wizStyle":23,"./domUtils/domExtend":27,"./editor/base":30,"./editor/commandExtend":31,"./editor/editorEvent":32,"./editor/pasteUtils":33,"./formatPainterUtils/formatPainterCore":35,"./imgUtils/imgUtils":39,"./linkUtils/linkUtils":40,"./nightMode/nightModeUtils":41,"./rangeUtils/rangeExtend":43,"./tableUtils/tableCore":44,"./todoUtils/todoCore":48}]},{},[52]);